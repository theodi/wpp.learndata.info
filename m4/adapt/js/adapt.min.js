require(["html-react-parser","semver","bowser","react","react-dom","libraries/SCORM_API_wrapper","underscore"],function(HTMLReactParser,semver,Bowser,React,ReactDOM$1,pipwerks,_$1){function _interopDefaultLegacy(e){return e&&typeof e==="object"&&"default"in e?e:{"default":e}}var HTMLReactParser__default=_interopDefaultLegacy(HTMLReactParser);var semver__default=_interopDefaultLegacy(semver);var Bowser__default=_interopDefaultLegacy(Bowser);var React__default=_interopDefaultLegacy(React);var ReactDOM__default=_interopDefaultLegacy(ReactDOM$1);var pipwerks__default=_interopDefaultLegacy(pipwerks);var ___default=_interopDefaultLegacy(_$1);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})}keys.push.apply(keys,symbols)}return keys}function _objectSpread2(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key])})}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}}return target}function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function(obj){return typeof obj}}else{_typeof=function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}else if(call!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return _assertThisInitialized(self)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver)}return desc.value}}return _get(target,property,receiver||target)}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _toArray(arr){return _arrayWithHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableRest()}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _iterableToArrayLimit(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function(){};return{s:F,n:function(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function(e){throw e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function(){it=it.call(o)},n:function(){var step=it.next();normalCompletion=step.done;return step},e:function(e){didErr=true;err=e},f:function(){try{if(!normalCompletion&&it.return!=null)it.return()}finally{if(didErr)throw err}}}}var Wait=__AMD("core/js/wait",function(_Backbone$Controller){_inherits(Wait,_Backbone$Controller);var _super=_createSuper(Wait);function Wait(){_classCallCheck(this,Wait);return _super.apply(this,arguments)}_createClass(Wait,[{key:"initialize",value:function initialize(){this._waitCount=0;this._callbackHandle=null;this.being=this.begin.bind(this);this.end=this.end.bind(this)}},{key:"isWaiting",value:function isWaiting(){return this._waitCount!==0}},{key:"begin",value:function begin(){if(!this.isWaiting())this.trigger("wait");this._waitCount++;if(this._callbackHandle){clearTimeout(this._callbackHandle);this._callbackHandle=null}return this}},{key:"end",value:function end(){if(!this.isWaiting())return this;this._waitCount--;if(this.isWaiting()||this._callbackHandle)return this;this._callbackHandle=setTimeout(function(){this._callbackHandle=null;this.trigger("ready")}.bind(this),0);return this}},{key:"queue",value:function queue(callback){var _this=this;if(!callback){this.begin();return new Promise(function(resolve){_this.once("ready",resolve);_this.end()})}this.begin();this.once("ready",callback);this.end();return this}},{key:"for",value:function _for(callback){var _this2=this;this.begin();_.defer(function(){return callback(_.once(_this2.end))});return this}}]);return Wait}(Backbone.Controller));var LockingModel=__AMD("core/js/models/lockingModel",function(_Backbone$Model){_inherits(LockingModel,_Backbone$Model);var _super=_createSuper(LockingModel);function LockingModel(){_classCallCheck(this,LockingModel);return _super.apply(this,arguments)}_createClass(LockingModel,[{key:"set",value:function set(attrName,attrVal){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var stopProcessing=_typeof(attrName)==="object"||typeof attrVal!=="boolean"||!this.isLocking(attrName);if(stopProcessing)return _get(_getPrototypeOf(LockingModel.prototype),"set",this).apply(this,arguments);var isSettingValueForSpecificPlugin=options===null||options===void 0?void 0:options.pluginName;if(!isSettingValueForSpecificPlugin){console.error("Must supply a pluginName to change a locked attribute");options.pluginName="compatibility"}var pluginName=options.pluginName;if(this.defaults[attrName]!==undefined){this._lockedAttributes[attrName]=!this.defaults[attrName]}var lockingValue=this._lockedAttributes[attrName];var isAttemptingToLock=lockingValue===attrVal;if(isAttemptingToLock){this.setLockState(attrName,true,{pluginName:pluginName,skipcheck:true});return _get(_getPrototypeOf(LockingModel.prototype),"set",this).call(this,attrName,lockingValue)}this.setLockState(attrName,false,{pluginName:pluginName,skipcheck:true});var totalLockValue=this.getLockCount(attrName,{skipcheck:true});if(totalLockValue===0){return _get(_getPrototypeOf(LockingModel.prototype),"set",this).call(this,attrName,!lockingValue)}return this}},{key:"setLocking",value:function setLocking(attrName,defaultLockValue){if(this.isLocking(attrName))return;if(!this._lockedAttributes)this._lockedAttributes={};this._lockedAttributes[attrName]=defaultLockValue}},{key:"unsetLocking",value:function unsetLocking(attrName){if(!this.isLocking(attrName))return;if(!this._lockedAttributes)return;delete this._lockedAttributes[attrName];delete this._lockedAttributesValues[attrName];if(Object.keys(this._lockedAttributes).length===0){delete this._lockedAttributes;delete this._lockedAttributesValues}}},{key:"isLocking",value:function isLocking(attrName){var isCheckingGeneralLockingState=attrName===undefined;var isUsingLockedAttributes=Boolean(this.lockedAttributes||this._lockedAttributes);if(isCheckingGeneralLockingState){return isUsingLockedAttributes}if(!isUsingLockedAttributes)return false;if(!this._lockedAttributes){this._lockedAttributes=_.result(this,"lockedAttributes")}var isAttributeALockingAttribute=this._lockedAttributes.hasOwnProperty(attrName);if(!isAttributeALockingAttribute)return false;if(!this._lockedAttributesValues){this._lockedAttributesValues={}}if(!this._lockedAttributesValues[attrName]){this._lockedAttributesValues[attrName]={}}return true}},{key:"isLocked",value:function isLocked(attrName,options){var shouldSkipCheck=options===null||options===void 0?void 0:options.skipcheck;if(!shouldSkipCheck){var stopProcessing=!this.isLocking(attrName);if(stopProcessing)return}return this.getLockCount(attrName)>0}},{key:"getLockCount",value:function getLockCount(attrName,options){var shouldSkipCheck=options===null||options===void 0?void 0:options.skipcheck;if(!shouldSkipCheck){var stopProcessing=!this.isLocking(attrName);if(stopProcessing)return}var isGettingValueForSpecificPlugin=options===null||options===void 0?void 0:options.pluginName;if(isGettingValueForSpecificPlugin){return this._lockedAttributesValues[attrName][options.pluginName]?1:0}var lockingAttributeValues=Object.values(this._lockedAttributesValues[attrName]);var lockingAttributeValuesSum=lockingAttributeValues.reduce(function(sum,value){return sum+(value?1:0)},0);return lockingAttributeValuesSum}},{key:"setLockState",value:function setLockState(attrName,value,options){var shouldSkipCheck=options===null||options===void 0?void 0:options.skipcheck;if(!shouldSkipCheck){var stopProcessing=!this.isLocking(attrName);if(stopProcessing)return this}var isSettingValueForSpecificPlugin=options===null||options===void 0?void 0:options.pluginName;if(!isSettingValueForSpecificPlugin){console.error("Must supply a pluginName to set a locked attribute lock value");options.pluginName="compatibility"}if(value){this._lockedAttributesValues[attrName][options.pluginName]=value}else{delete this._lockedAttributesValues[attrName][options.pluginName]}return this}}]);return LockingModel}(Backbone.Model));var AdaptSingleton=function(_LockingModel){_inherits(AdaptSingleton,_LockingModel);var _super=_createSuper(AdaptSingleton);function AdaptSingleton(){_classCallCheck(this,AdaptSingleton);return _super.apply(this,arguments)}_createClass(AdaptSingleton,[{key:"initialize",value:function initialize(){this.loadScript=window.__loadScript;this.location={};this.store={};this.setupWait()}},{key:"defaults",value:function defaults(){return{_canScroll:true,_outstandingCompletionChecks:0,_pluginWaitCount:0,_isStarted:false,_shouldDestroyContentObjects:true}}},{key:"lockedAttributes",value:function lockedAttributes(){return{_canScroll:false}}},{key:"componentStore",get:function(){this.log.deprecated("Adapt.componentStore, please use Adapt.store instead");return this.store}},{key:"init",value:function(){var _init=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var _this=this;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:this.addDirection();this.disableAnimation();this.trigger("adapt:preInitialize");_context2.next=5;return this.wait.queue();case 5:this.deferUntilCompletionChecked(_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this.trigger("adapt:start");_context.next=3;return _this.wait.queue();case 3:if(!Backbone.History.started){Backbone.history.start()}_this.set("_isStarted",true);_this.trigger("adapt:initialize");_context.next=8;return _this.wait.queue();case 8:case"end":return _context.stop();}}},_callee)})));case 6:case"end":return _context2.stop();}}},_callee2,this)}));function init(){return _init.apply(this,arguments)}return init}()},{key:"checkingCompletion",value:function checkingCompletion(){var outstandingChecks=this.get("_outstandingCompletionChecks");this.set("_outstandingCompletionChecks",outstandingChecks+1)}},{key:"checkedCompletion",value:function checkedCompletion(){var outstandingChecks=this.get("_outstandingCompletionChecks");this.set("_outstandingCompletionChecks",outstandingChecks-1)}},{key:"deferUntilCompletionChecked",value:function(){var _deferUntilCompletionChecked=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var _this2=this;var callback,_args3=arguments;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:callback=_args3.length>0&&_args3[0]!==undefined?_args3[0]:function(){};if(!(this.get("_outstandingCompletionChecks")===0)){_context3.next=3;break}return _context3.abrupt("return",callback());case 3:return _context3.abrupt("return",new Promise(function(resolve){var checkIfAnyChecksOutstanding=function(model,outstandingChecks){if(outstandingChecks!==0)return;_this2.off("change:_outstandingCompletionChecks",checkIfAnyChecksOutstanding);callback();resolve()};_this2.on("change:_outstandingCompletionChecks",checkIfAnyChecksOutstanding)}));case 4:case"end":return _context3.stop();}}},_callee3,this)}));function deferUntilCompletionChecked(){return _deferUntilCompletionChecked.apply(this,arguments)}return deferUntilCompletionChecked}()},{key:"setupWait",value:function setupWait(){var _this3=this;this.wait=new Wait;var beginWait=function(){_this3.log.deprecated("Use Adapt.wait.begin() as Adapt.trigger('plugin:beginWait') may be removed in the future");_this3.wait.begin()};var endWait=function(){_this3.log.deprecated("Use Adapt.wait.end() as Adapt.trigger('plugin:endWait') may be removed in the future");_this3.wait.end()};var ready=function(){if(_this3.wait.isWaiting()){return}var isEventListening=_this3._events["plugins:ready"];if(!isEventListening){return}_this3.log.deprecated("Use Adapt.wait.queue(callback) as Adapt.on('plugins:ready', callback) may be removed in the future");_this3.trigger("plugins:ready")};this.listenTo(this.wait,"ready",ready);this.listenTo(this,{"plugin:beginWait":beginWait,"plugin:endWait":endWait})}},{key:"isWaitingForPlugins",value:function isWaitingForPlugins(){this.log.deprecated("Use Adapt.wait.isWaiting() as Adapt.isWaitingForPlugins() may be removed in the future");return this.wait.isWaiting()}},{key:"checkPluginsReady",value:function checkPluginsReady(){this.log.deprecated("Use Adapt.wait.isWaiting() as Adapt.checkPluginsReady() may be removed in the future");if(this.isWaitingForPlugins()){return}this.trigger("plugins:ready")}},{key:"navigateToElement",value:function(){var _navigateToElement=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:case"end":return _context4.stop();}}},_callee4)}));function navigateToElement(){return _navigateToElement.apply(this,arguments)}return navigateToElement}()},{key:"scrollTo",value:function(){var _scrollTo=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:case"end":return _context5.stop();}}},_callee5)}));function scrollTo(){return _scrollTo.apply(this,arguments)}return scrollTo}()},{key:"register",value:function register(name,object){var _this4=this;if(Array.isArray(name)){name.forEach(function(name){return _this4.register(name,object)});return object}if(name.split(" ").length>1){this.register(name.split(" "),object);return object}if(!object.view&&!object.model||object instanceof Backbone.View){this.log.deprecated("View-only registrations are no longer supported");object={view:object}}if(object.view&&!object.view.template){object.view.template=name}var isModelSetAndInvalid=object.model&&!(object.model.prototype instanceof Backbone.Model)&&!(object.model instanceof Function);if(isModelSetAndInvalid){throw new Error("The registered model is not a Backbone.Model or Function")}var isViewSetAndInvalid=object.view&&!(object.view.prototype instanceof Backbone.View)&&!(object.view instanceof Function);if(isViewSetAndInvalid){throw new Error("The registered view is not a Backbone.View or Function")}this.store[name]=Object.assign({},this.store[name],object);return object}},{key:"getViewName",value:function getViewName(nameModelViewOrData){var _this5=this;if(typeof nameModelViewOrData==="string"){return nameModelViewOrData}if(nameModelViewOrData instanceof Backbone.Model){nameModelViewOrData=nameModelViewOrData.toJSON()}if(nameModelViewOrData instanceof Backbone.View){var foundName;Object.entries(this.store).forEach(function(_ref2){var _ref3=_slicedToArray(_ref2,2),key=_ref3[0],entry=_ref3[1];if(!(entry!==null&&entry!==void 0&&entry.view))return;if(!(nameModelViewOrData instanceof entry.view))return;foundName=key;return true});return foundName}if(nameModelViewOrData instanceof Object){var names=[typeof nameModelViewOrData._view==="string"&&nameModelViewOrData._view,typeof nameModelViewOrData._component==="string"&&nameModelViewOrData._component,typeof nameModelViewOrData._type==="string"&&nameModelViewOrData._type].filter(Boolean);if(names.length){var name=names.find(function(name){var _this5$store$name;return(_this5$store$name=_this5.store[name])===null||_this5$store$name===void 0?void 0:_this5$store$name.view});return name||names.pop()}}throw new Error("Cannot derive view class name from input")}},{key:"getViewClass",value:function getViewClass(nameModelViewOrData){var _object$view;var name=this.getViewName(nameModelViewOrData);var object=this.store[name];if(!object){this.log.warnOnce("A view for '".concat(name,"' isn't registered in your project"));return}var isBackboneView=((_object$view=object.view)===null||_object$view===void 0?void 0:_object$view.prototype)instanceof Backbone.View;if(!isBackboneView&&object.view instanceof Function){return object.view()}return object.view}},{key:"getModelName",value:function getModelName(nameModelOrData){var _this6=this;if(typeof nameModelOrData==="string"){return nameModelOrData}if(nameModelOrData instanceof Backbone.Model){nameModelOrData=nameModelOrData.toJSON()}if(nameModelOrData instanceof Object){var _entry$view;var name=nameModelOrData._component;var entry=this.store[name];var isViewOnlyQuestion=entry&&!entry.model&&((_entry$view=entry.view)===null||_entry$view===void 0?void 0:_entry$view._isQuestionType);if(isViewOnlyQuestion){this.log.deprecated("Assuming a question model for a view-only question: ".concat(name));return"question"}var names=[typeof nameModelOrData._model==="string"&&nameModelOrData._model,typeof nameModelOrData._component==="string"&&nameModelOrData._component,typeof nameModelOrData._type==="string"&&nameModelOrData._type].filter(Boolean);if(names.length){var _name=names.find(function(name){var _this6$store$name;return(_this6$store$name=_this6.store[name])===null||_this6$store$name===void 0?void 0:_this6$store$name.model});return _name||names.pop()}}throw new Error("Cannot derive model class name from input")}},{key:"getModelClass",value:function getModelClass(nameModelOrData){var _object$model;var name=this.getModelName(nameModelOrData);var object=this.store[name];if(!object){this.log.warnOnce("A model for '".concat(name,"' isn't registered in your project"));return}var isBackboneModel=((_object$model=object.model)===null||_object$model===void 0?void 0:_object$model.prototype)instanceof Backbone.Model;if(!isBackboneModel&&object.model instanceof Function){return object.model()}return object.model}},{key:"findById",value:function findById(id){return this.data.findById(id)}},{key:"findViewByModelId",value:function findViewByModelId(id){var model=this.data.findById(id);if(!model)return;if(model===this.parentView.model)return this.parentView;var idPathToView=[id];var currentLocationId=this.location._currentId;var currentLocationModel=model.getAncestorModels().find(function(model){var modelId=model.get("_id");if(modelId===currentLocationId)return true;idPathToView.unshift(modelId);return false});if(!currentLocationModel){return console.warn("Adapt.findViewByModelId() unable to find view for model id: ".concat(id))}var foundView=idPathToView.reduce(function(view,currentId){if(!view)return null;var childViews=view.getChildViews();return childViews===null||childViews===void 0?void 0:childViews.find(function(view){return view.model.get("_id")===currentId})},this.parentView);return foundView}},{key:"findByTrackingPosition",value:function findByTrackingPosition(trackingPosition){return this.data.findByTrackingPosition(trackingPosition)}},{key:"parseRelativeString",value:function parseRelativeString(relativeString){var splitIndex=relativeString.search(/[ +\-\d]{1}/);if(splitIndex===-1)splitIndex=relativeString.length;var type=relativeString.slice(0,splitIndex).replace(/^@/,"");var offset=parseInt(relativeString.slice(splitIndex).trim()||0);return{type:type,offset:offset}}},{key:"addDirection",value:function addDirection(){var defaultDirection=this.config.get("_defaultDirection");$("html").addClass("dir-"+defaultDirection).attr("dir",defaultDirection)}},{key:"disableAnimation",value:function disableAnimation(){var disableAnimationArray=this.config.get("_disableAnimationFor");var disableAnimation=this.config.get("_disableAnimation");if(disableAnimationArray){for(var i=0,l=disableAnimationArray.length;i<l;i++){if(!$("html").is(disableAnimationArray[i]))continue;this.config.set("_disableAnimation",true);$("html").addClass("disable-animation");console.log("Animation disabled.")}return}$("html").toggleClass("disable-animation",disableAnimation===true)}},{key:"remove",value:function(){var _remove=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(){var currentView;return regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:currentView=this.parentView;if(currentView){currentView.model.setOnChildren({_isReady:false,_isRendered:false})}this.trigger("preRemove",currentView);_context6.next=5;return this.wait.queue();case 5:if(currentView&&this.get("_shouldDestroyContentObjects")){currentView.destroy()}this.trigger("remove",currentView);_.defer(this.trigger.bind(this),"postRemove",currentView);case 8:case"end":return _context6.stop();}}},_callee6,this)}));function remove(){return _remove.apply(this,arguments)}return remove}()}]);return AdaptSingleton}(LockingModel);var Adapt=__AMD("core/js/adapt",new AdaptSingleton);var TemplateRenderEvent=__AMD("core/js/templateRenderEvent",function(_Backbone$Controller){_inherits(TemplateRenderEvent,_Backbone$Controller);var _super=_createSuper(TemplateRenderEvent);function TemplateRenderEvent(){_classCallCheck(this,TemplateRenderEvent);return _super.apply(this,arguments)}_createClass(TemplateRenderEvent,[{key:"initialize",value:function initialize(type,name,mode,value,args){this.type=type;this.name=name;this.mode=mode;this.value=value;this.args=args}}]);return TemplateRenderEvent}(Backbone.Controller));function onRender(cb){var intercept=function(object,name,mode,cb){return object[name]=cb.bind(object,object[name],name,mode)};Object.keys(Handlebars.templates).forEach(function(name){intercept(Handlebars.templates,name,"template",cb)});Object.keys(Handlebars.partials).forEach(function(name){intercept(Handlebars.partials,name,"partial",cb)})}onRender(function(template,name,mode){for(var _len=arguments.length,args=new Array(_len>3?_len-3:0),_key=3;_key<_len;_key++){args[_key-3]=arguments[_key]}var preRenderEvent=new TemplateRenderEvent("".concat(mode,":preRender"),name,mode,null,args);Adapt.trigger(preRenderEvent.type,preRenderEvent);var value=template.apply(void 0,_toConsumableArray(preRenderEvent.args));var postRenderEvent=new TemplateRenderEvent("".concat(mode,":postRender"),name,mode,value,preRenderEvent.args);Adapt.trigger(postRenderEvent.type,postRenderEvent);return postRenderEvent.value});Adapt.on("app:dataReady",function(){var config=Adapt.config.get("_fixes");if((config===null||config===void 0?void 0:config._imgLazyLoad)===false)return;applyImgLoadingFix()});function applyImgLoadingFix(){var findImgTag=/<img([^>]*)>/gi;var hasLoadingAttr=/ loading=/gi;Adapt.on("template:postRender partial:postRender",function(event){var imgTagsFound=event.value.match(findImgTag);if(!imgTagsFound){return}event.value=imgTagsFound.reduce(function(value,img){if(hasLoadingAttr.test(img)){return value}return value.replace(img,img.replace(findImgTag,"<img loading=\"eager\"$1>"))},event.value)});Adapt.on("reactElement:preRender",function(event){if(event.name!=="img")return;var options=event.args[1]=event.args[1]||{};if(options&&options.hasOwnProperty("loading"))return;options.loading="eager"})}var LOG_LEVEL=ENUM(["DEBUG","INFO","WARN","ERROR","FATAL"]);var LOG_LEVEL$1=__AMD("core/js/enums/logLevelEnum",LOG_LEVEL);var Logging=function(_Backbone$Controller){_inherits(Logging,_Backbone$Controller);var _super=_createSuper(Logging);function Logging(){_classCallCheck(this,Logging);return _super.apply(this,arguments)}_createClass(Logging,[{key:"initialize",value:function initialize(){this._config={_isEnabled:true,_level:LOG_LEVEL$1.INFO.asLowerCase,_console:true,_warnFirstOnly:true};this._warned={};this.listenToOnce(Adapt,"configModel:dataLoaded",this.onLoadConfigData)}},{key:"onLoadConfigData",value:function onLoadConfigData(){this.loadConfig();this.debug("Logging config loaded");this.trigger("log:ready")}},{key:"loadConfig",value:function loadConfig(){if(Adapt.config.has("_logging")){this._config=Adapt.config.get("_logging")}this.checkQueryStringOverride()}},{key:"checkQueryStringOverride",value:function checkQueryStringOverride(){var matches=window.location.search.match(/[?&]loglevel=([a-z]*)/i);if(!matches||matches.length<2)return;var override=LOG_LEVEL$1(matches[1].toUpperCase());if(!override)return;this._config._level=override.asLowerCase;this.debug("Loglevel override in query string:",this._config._level)}},{key:"debug",value:function debug(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}this._log(LOG_LEVEL$1.DEBUG,args)}},{key:"info",value:function info(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}this._log(LOG_LEVEL$1.INFO,args)}},{key:"warn",value:function warn(){for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3]}this._log(LOG_LEVEL$1.WARN,args)}},{key:"error",value:function error(){for(var _len4=arguments.length,args=new Array(_len4),_key4=0;_key4<_len4;_key4++){args[_key4]=arguments[_key4]}this._log(LOG_LEVEL$1.ERROR,args)}},{key:"fatal",value:function fatal(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++){args[_key5]=arguments[_key5]}this._log(LOG_LEVEL$1.FATAL,args)}},{key:"removed",value:function removed(){for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++){args[_key6]=arguments[_key6]}args=["REMOVED"].concat(args);this.warnOnce.apply(this,_toConsumableArray(args))}},{key:"deprecated",value:function deprecated(){for(var _len7=arguments.length,args=new Array(_len7),_key7=0;_key7<_len7;_key7++){args[_key7]=arguments[_key7]}args=["DEPRECATED"].concat(args);this.warnOnce.apply(this,_toConsumableArray(args))}},{key:"warnOnce",value:function warnOnce(){for(var _len8=arguments.length,args=new Array(_len8),_key8=0;_key8<_len8;_key8++){args[_key8]=arguments[_key8]}if(this._hasWarned(args)){return}this._log(LOG_LEVEL$1.WARN,args)}},{key:"_log",value:function _log(level,data){var isEnabled=this._config._isEnabled;if(!isEnabled)return;var configLevel=LOG_LEVEL$1(this._config._level.toUpperCase());var isLogLevelAllowed=level>=configLevel;if(!isLogLevelAllowed)return;this._logToConsole(level,data);this.trigger("log",level,data);this.trigger("log:"+level.asLowerCase,level,data)}},{key:"_logToConsole",value:function _logToConsole(level,data){var shouldLogToConsole=this._config._console;if(!shouldLogToConsole)return;var log=[level.asUpperCase+":"];data&&log.push.apply(log,_toConsumableArray(data));if(console[level.asLowerCase]){var _console;(_console=console)[level.asLowerCase].apply(_console,log)}else{var _console2;(_console2=console).log.apply(_console2,log)}}},{key:"_hasWarned",value:function _hasWarned(args){if(!this._config._warnFirstOnly){return false}var hash=args.map(String).join(":");if(this._warned[hash]){return true}this._warned[hash]=true;return false}}]);return Logging}(Backbone.Controller);var log=__AMD("core/js/logging",Adapt.log=new Logging);Adapt.on("app:dataReady",function(){var config=Adapt.config.get("_fixes");if((config===null||config===void 0?void 0:config._jsxReactHelpersHTML)===false)return;applyReactHelpersHTML()});function applyReactHelpersHTML(){Adapt.on("reactElement:preRender",function(event){var _event$args=_toArray(event.args),tagName=_event$args[0],props=_event$args[1],children=_event$args.slice(2);if(!children)return;if(!Array.isArray(children))children=[children];children=children.filter(Boolean);var hasSomeUnsafeConversions=children.some(function(c){return c===null||c===void 0?void 0:c.__html});if(!hasSomeUnsafeConversions)return;var hasManyChildren=children.length>1;if(hasManyChildren){event.args=event.args.map(function(child){if(!child||!child.__html)return child;var attributes=Object.entries(props).map(function(_ref){var _ref2=_slicedToArray(_ref,2),name=_ref2[0],value=_ref2[1];return"".concat(name,"=\"").concat(value,"\"")}).join(" ");log.warnOnce("html() call should be the only child in its parent <".concat(tagName," ").concat(attributes,">"));return child.__html?HTMLReactParser__default["default"](child.__html):undefined});return}props=event.args[1]=event.args[1]||{};props.dangerouslySetInnerHTML=children[0];event.args.length=2})}var BrowserFocus=__AMD("core/js/a11y/browserFocus",function(_Backbone$Controller){_inherits(BrowserFocus,_Backbone$Controller);var _super=_createSuper(BrowserFocus);function BrowserFocus(){_classCallCheck(this,BrowserFocus);return _super.apply(this,arguments)}_createClass(BrowserFocus,[{key:"initialize",value:function initialize(){this._onBlur=this._onBlur.bind(this);this._onClick=this._onClick.bind(this);this.$body=$("body");this.listenTo(Adapt,{"accessibility:ready":this._attachEventListeners})}},{key:"_attachEventListeners",value:function _attachEventListeners(){this.$body.on("blur","*",this._onBlur).on("blur",this._onBlur);this.$body[0].addEventListener("click",this._onClick,true)}},{key:"_onBlur",value:function _onBlur(event){var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isFocusNextOnDisabled){return}var $element=$(event.target);if($element.is("[data-a11y-force-focus]")){$element.removeAttr("tabindex data-a11y-force-focus")}if(event.target!==event.currentTarget){return}if(!$element.is("[disabled]")){return}Adapt.a11y.focusNext($element)}},{key:"_onClick",value:function _onClick(event){var $element=$(event.target);var isAriaDisabled=$element.closest("[aria-disabled=true]").length===1;if(isAriaDisabled){event.preventDefault();event.stopImmediatePropagation()}var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isFocusOnClickEnabled){return}var $stack=$([].concat(_toConsumableArray($element.toArray()),_toConsumableArray($element.parents().toArray())));var $focusable=$stack.filter(config._options._tabbableElements);if(!$focusable.length){return}$focusable[0].focus()}}]);return BrowserFocus}(Backbone.Controller));var FocusOptions=__AMD("core/js/a11y/focusOptions",function FocusOptions(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},_ref$preventScroll=_ref.preventScroll,preventScroll=_ref$preventScroll===void 0?false:_ref$preventScroll,_ref$defer=_ref.defer,defer=_ref$defer===void 0?false:_ref$defer;_classCallCheck(this,FocusOptions);this.preventScroll=preventScroll;this.defer=defer});var KeyboardFocusOutline=__AMD("core/js/a11y/keyboardFocusOutline",function(_Backbone$Controller){_inherits(KeyboardFocusOutline,_Backbone$Controller);var _super=_createSuper(KeyboardFocusOutline);function KeyboardFocusOutline(){_classCallCheck(this,KeyboardFocusOutline);return _super.apply(this,arguments)}_createClass(KeyboardFocusOutline,[{key:"initialize",value:function initialize(){this._onKeyDown=this._onKeyDown.bind(this);this.$html=$("html");this.showOnKeys={9:true,13:true,32:true,37:true,38:true,39:true,40:true};this.listenTo(Adapt,{"accessibility:ready":this._attachEventListeners})}},{key:"_attachEventListeners",value:function _attachEventListeners(){document.addEventListener("keydown",this._onKeyDown);this._start()}},{key:"_start",value:function _start(){var config=Adapt.a11y.config;if(config._options._isFocusOutlineDisabled){this.$html.addClass("a11y-disable-focusoutline");return}if(!config._isEnabled||!config._options._isFocusOutlineKeyboardOnlyEnabled){return}this.$html.addClass("a11y-disable-focusoutline")}},{key:"_onKeyDown",value:function _onKeyDown(event){var config=Adapt.a11y.config;if(config._options._isFocusOutlineDisabled){this.$html.addClass("a11y-disable-focusoutline");return}if(!config._isEnabled||!config._options._isFocusOutlineKeyboardOnlyEnabled||!this.showOnKeys[event.keyCode]){return}var $element=$(event.target);if(!$element.is(config._options._tabbableElements)||$element.is(config._options._focusOutlineKeyboardOnlyIgnore)){return}this.$html.removeClass("a11y-disable-focusoutline")}}]);return KeyboardFocusOutline}(Backbone.Controller));var Log=__AMD("core/js/a11y/log",function(_Backbone$Controller){_inherits(Log,_Backbone$Controller);var _super=_createSuper(Log);function Log(){_classCallCheck(this,Log);return _super.apply(this,arguments)}_createClass(Log,[{key:"initialize",value:function initialize(){this._warned={}}},{key:"_hasWarned",value:function _hasWarned(args){var config=Adapt.a11y.config;if(!config._options._warnFirstOnly){return false}var hash=args.map(String).join(":");if(this._warned[hash]){return true}this._warned[hash]=true;return false}},{key:"_canWarn",value:function _canWarn(){var config=Adapt.a11y.config;return Boolean(config._options._warn)}},{key:"removed",value:function removed(){var _Adapt$log;for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}if(!this._canWarn){return}args=["A11Y"].concat(args);if(this._hasWarned(args)){return}(_Adapt$log=Adapt.log).removed.apply(_Adapt$log,_toConsumableArray(args));return this}},{key:"deprecated",value:function deprecated(){var _Adapt$log2;for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}if(!this._canWarn){return}args=["A11Y"].concat(args);if(this._hasWarned(args)){return}(_Adapt$log2=Adapt.log).deprecated.apply(_Adapt$log2,_toConsumableArray(args));return this}}]);return Log}(Backbone.Controller));var Scroll=__AMD("core/js/a11y/scroll",function(_Backbone$Controller){_inherits(Scroll,_Backbone$Controller);var _super=_createSuper(Scroll);function Scroll(){_classCallCheck(this,Scroll);return _super.apply(this,arguments)}_createClass(Scroll,[{key:"initialize",value:function initialize(){this._onTouchStart=this._onTouchStart.bind(this);this._onTouchEnd=this._onTouchEnd.bind(this);this._onScrollEvent=this._onScrollEvent.bind(this);this._onKeyDown=this._onKeyDown.bind(this);this._scrollDisabledElements=$([]);this.$window=$(window);this.$body=$("body");this._preventScrollOnKeys={37:true,38:true,39:true,40:true};this._ignoreKeysOnElementsMatching="textarea, input, select";this._isRunning=false;this._touchStartEventObject=null}},{key:"disable",value:function disable($elements){$elements=$($elements);this._scrollDisabledElements=this._scrollDisabledElements.add($elements);this._checkRunning();return this}},{key:"enable",value:function enable($elements){$elements=$($elements);if(!$elements.length){this.clear();return this}this._scrollDisabledElements=this._scrollDisabledElements.not($elements);this._checkRunning();return this}},{key:"clear",value:function clear(){this._scrollDisabledElements=$([]);this._checkRunning();return this}},{key:"_checkRunning",value:function _checkRunning(){if(!this._scrollDisabledElements.length){this._stop();return}this._start()}},{key:"_start",value:function _start(){if(this._isRunning){return}this._isRunning=true;window.addEventListener("touchstart",this._onTouchStart);window.addEventListener("touchend",this._onTouchEnd);window.addEventListener("touchmove",this._onScrollEvent,{passive:false});window.addEventListener("wheel",this._onScrollEvent,{passive:false});document.addEventListener("wheel",this._onScrollEvent,{passive:false});document.addEventListener("keydown",this._onKeyDown)}},{key:"_onTouchStart",value:function _onTouchStart(event){event=$.event.fix(event);this._touchStartEventObject=event;return true}},{key:"_onTouchEnd",value:function _onTouchEnd(){this._touchStartEventObject=null;return true}},{key:"_onScrollEvent",value:function _onScrollEvent(event){event=$.event.fix(event);return this._preventScroll(event)}},{key:"_onKeyDown",value:function _onKeyDown(event){event=$.event.fix(event);if(!this._preventScrollOnKeys[event.keyCode]){return}var $target=$(event.target);if($target.is(this._ignoreKeysOnElementsMatching)){return}return this._preventScroll(event)}},{key:"_preventScroll",value:function _preventScroll(event){var _event$touches;var isGesture=((_event$touches=event.touches)===null||_event$touches===void 0?void 0:_event$touches.length)>1;if(isGesture){return}var $target=$(event.target);if(this._scrollDisabledElements.length){var scrollingParent=this._getScrollingParent(event,$target);if(scrollingParent.filter(this._scrollDisabledElements).length===0){this.$window.scroll();return}}event.preventDefault();return false}},{key:"_getScrollingParent",value:function _getScrollingParent(event,$target){var _this$_touchStartEven;var isTouchEvent=event.type==="touchmove";var hasTouchStartEvent=(_this$_touchStartEven=this._touchStartEventObject)===null||_this$_touchStartEven===void 0?void 0:_this$_touchStartEven.originalEvent;if(isTouchEvent&&!hasTouchStartEvent){return $target}var directionY=this._getScrollDirection(event);if(directionY==="none"){return this.$body}var parents=[$target[0]].concat(_toConsumableArray($target.parents()));for(var i=0,l=parents.length;i<l;i++){var $parent=$(parents[i]);if($parent.is("body")){return this.$body}if(!this._isScrollable($parent)){continue}if(!this._isScrolling($parent,directionY)){continue}return $parent}return this.$body}},{key:"_isScrollable",value:function _isScrollable($target){var scrollType=$target.css("overflow-y");if(scrollType!=="auto"&&scrollType!=="scroll"){return false}var pointerEvents=$target.css("pointer-events");if(pointerEvents==="none"){return false}return true}},{key:"_isScrolling",value:function _isScrolling($target,directionY){var scrollTop=Math.ceil($target.scrollTop());var innerHeight=$target.outerHeight();var scrollHeight=$target[0].scrollHeight;var hasScrollingSpace=false;switch(directionY){case"down":hasScrollingSpace=scrollTop+innerHeight<scrollHeight;if(hasScrollingSpace){return true}break;case"up":hasScrollingSpace=scrollTop>0;if(hasScrollingSpace){return true}break;}return false}},{key:"_getScrollDirection",value:function _getScrollDirection(event){var deltaY=this._getScrollDelta(event);if(deltaY===0){return"none"}return deltaY>0?"up":"down"}},{key:"_getScrollDelta",value:function _getScrollDelta(event){var deltaY=0;var isTouchEvent=event.type==="touchmove";var originalEvent=event.originalEvent;if(isTouchEvent){var startOriginalEvent=this._touchStartEventObject.originalEvent;var currentY=originalEvent.pageY;var previousY=startOriginalEvent.pageY;if(currentY===0||currentY===previousY){currentY=originalEvent.touches[0].pageY;previousY=startOriginalEvent.touches[0].pageY}deltaY=currentY-previousY}else{var hasDeltaY=originalEvent.wheelDeltaY||originalEvent.deltaY!==undefined;if(hasDeltaY){deltaY=-originalEvent.deltaY}else{deltaY=originalEvent.wheelDelta||0}}return deltaY}},{key:"_stop",value:function _stop(){if(!this._isRunning){return}this._isRunning=false;window.removeEventListener("touchstart",this._onTouchStart);window.removeEventListener("touchend",this._onTouchEnd);window.removeEventListener("touchmove",this._onScrollEvent,{passive:false});window.removeEventListener("wheel",this._onScrollEvent,{passive:false});document.removeEventListener("wheel",this._onScrollEvent,{passive:false});document.removeEventListener("keydown",this._onKeyDown)}}]);return Scroll}(Backbone.Controller));var WrapFocus=__AMD("core/js/a11y/wrapFocus",function(_Backbone$Controller){_inherits(WrapFocus,_Backbone$Controller);var _super=_createSuper(WrapFocus);function WrapFocus(){_classCallCheck(this,WrapFocus);return _super.apply(this,arguments)}_createClass(WrapFocus,[{key:"initialize",value:function initialize(){_.bindAll(this,"_onWrapAround");this.listenTo(Adapt,{"accessibility:ready":this._attachEventListeners})}},{key:"_attachEventListeners",value:function _attachEventListeners(){var config=Adapt.a11y.config;$("body").on("click focus",config._options._focusguard,this._onWrapAround)}},{key:"_onWrapAround",value:function _onWrapAround(event){var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isPopupWrapFocusEnabled){return}event.preventDefault();event.stopPropagation();Adapt.a11y.focusFirst("body",{defer:false})}}]);return WrapFocus}(Backbone.Controller));var Popup=__AMD("core/js/a11y/popup",function(_Backbone$Controller){_inherits(Popup,_Backbone$Controller);var _super=_createSuper(Popup);function Popup(){_classCallCheck(this,Popup);return _super.apply(this,arguments)}_createClass(Popup,[{key:"initialize",value:function initialize(){this._floorStack=[$("body")];this._focusStack=[];this._tabIndexes={};this._ariaHiddens={};this._elementUIDIndex=0;this.listenTo(Adapt,{"popup:opened":function($element,ignoreInternalTrigger){if(ignoreInternalTrigger){return}Adapt.a11y.log.deprecated("Adapt.trigger(\"popup:opened\", $element) is replaced with Adapt.a11y.popupOpened($element);");this.opened($element,true)},"popup:closed":function($target,ignoreInternalTrigger){if(ignoreInternalTrigger){return}Adapt.a11y.log.deprecated("Adapt.trigger(\"popup:closed\", $target) is replaced with Adapt.a11y.popupClosed($target);");this.closed($target,true)}})}},{key:"opened",value:function opened($popupElement,silent){$popupElement=$popupElement||$(document.activeElement);this._addPopupLayer($popupElement);if(!silent){Adapt.trigger("popup:opened",$popupElement,true)}return this}},{key:"_addPopupLayer",value:function _addPopupLayer($popupElement){var _this=this;$popupElement=$($popupElement);var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isPopupManagementEnabled||$popupElement.length===0){return $popupElement}this._floorStack.push($popupElement);this._focusStack.push($(document.activeElement));var $elements=$(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes);var $branch=$popupElement.add($popupElement.parents());var $siblings=$branch.siblings().filter(config._options._tabbableElementsExcludes);$elements=$elements.add($siblings);$elements.each(function(index,item){var $item=$(item);var elementUID;if(typeof item.a11y_uid==="undefined"){item.a11y_uid="UID"+ ++_this._elementUIDIndex}elementUID=item.a11y_uid;if(_this._tabIndexes[elementUID]===undefined){_this._tabIndexes[elementUID]=[]}if(_this._ariaHiddens[elementUID]===undefined){_this._ariaHiddens[elementUID]=[]}var tabindex=$item.attr("tabindex");var ariaHidden=$item.attr("aria-hidden");_this._tabIndexes[elementUID].push(tabindex===undefined?"":tabindex);_this._ariaHiddens[elementUID].push(ariaHidden===undefined?"":ariaHidden);if(config._options._isPopupTabIndexManagementEnabled){$item.attr("tabindex",-1)}if(config._options._isPopupAriaHiddenManagementEnabled){$item.attr("aria-hidden",true)}});var $items=$popupElement.find(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes);if(config._options._isPopupTabIndexManagementEnabled){$items.attr("tabindex",0)}if(config._options._isPopupAriaHiddenManagementEnabled){$items.removeAttr("aria-hidden").removeClass("aria-hidden").parents(config._options._ariaHiddenExcludes).removeAttr("aria-hidden").removeClass("aria-hidden")}}},{key:"closed",value:function closed($focusElement,silent){var $previousFocusElement=this._removeLastPopupLayer();$focusElement=$focusElement||$previousFocusElement||$("body");if(!silent){Adapt.trigger("popup:closed",$focusElement,true)}Adapt.a11y.focusFirst($($focusElement),{preventScroll:true});return this}},{key:"_removeLastPopupLayer",value:function _removeLastPopupLayer(){var _this2=this;var config=Adapt.a11y.config;if(!config._isEnabled||!config._options._isPopupManagementEnabled){return $(document.activeElement)}if(this._floorStack.length<=1){return}this._floorStack.pop();$(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes).each(function(index,item){var _this2$_tabIndexes$el,_this2$_tabIndexes$el2;var $item=$(item);var previousTabIndex="";var previousAriaHidden="";var elementUID;if(typeof item.a11y_uid==="undefined"){item.a11y_uid="UID"+ ++_this2._elementUIDIndex}elementUID=item.a11y_uid;if((_this2$_tabIndexes$el=_this2._tabIndexes[elementUID])!==null&&_this2$_tabIndexes$el!==void 0&&_this2$_tabIndexes$el.length){previousTabIndex=_this2._tabIndexes[elementUID].pop();previousAriaHidden=_this2._ariaHiddens[elementUID].pop()}if((_this2$_tabIndexes$el2=_this2._tabIndexes[elementUID])!==null&&_this2$_tabIndexes$el2!==void 0&&_this2$_tabIndexes$el2.length){delete _this2._tabIndexes[elementUID];delete _this2._ariaHiddens[elementUID]}if(config._options._isPopupTabIndexManagementEnabled){if(previousTabIndex===""){$item.removeAttr("tabindex")}else{$item.attr({"tabindex":previousTabIndex})}}if(config._options._isPopupAriaHiddenManagementEnabled){if(previousAriaHidden===""){$item.removeAttr("aria-hidden")}else{$item.attr({"aria-hidden":previousAriaHidden})}}});return this._focusStack.pop()}},{key:"setCloseTo",value:function setCloseTo($focusElement){var $original=this._focusStack.pop();this._focusStack.push($focusElement);return $original}}]);return Popup}(Backbone.Controller));var defaultAriaLevels=__AMD("core/js/enums/defaultAriaLevels",{_menu:1,_menuGroup:2,_menuItem:2,_page:1,_article:2,_block:3,_component:4,_componentItem:5,_notify:1});Object.assign($.fn,{isFixedPostion:function(){Adapt.a11y.log.removed("$(\"..\").isFixedPostion was unneeded and has been removed, let us know if you need it back.");return false},a11y_aria_label:function(){Adapt.a11y.log.removed("$(\"..\").a11y_aria_label was incorrect behaviour.");return this},limitedScrollTo:function(){Adapt.a11y.log.removed("$.limitedScrollTo had no impact on the screen reader cursor.");return this},a11y_text:function(){Adapt.a11y.log.removed("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return this},a11y_selected:function(){Adapt.a11y.log.removed("$(\"..\").a11y_selected is removed. Please use aria-live instead.");return this},a11y_on:function(isOn){Adapt.a11y.log.deprecated("$(\"..\").a11y_on, use Adapt.a11y.findTabbable($element); and Adapt.a11y.toggleAccessible($elements, isAccessible); instead.");var $tabbable=Adapt.a11y.findTabbable(this);Adapt.a11y.toggleAccessible($tabbable,isOn);return this},a11y_only:function(){Adapt.a11y.log.removed("$(\"..\").a11y_only, use Adapt.a11y.popupOpened($popupElement); instead.");return this},scrollDisable:function(){if(Adapt.a11y.config._options._isScrollDisableEnabled===false){return this}Adapt.a11y.log.deprecated("$(\"..\").scrollDisable, use Adapt.a11y.scrollDisable($elements); instead.");Adapt.a11y.scrollDisable(this);return this},scrollEnable:function(){if(Adapt.a11y.config._options._isScrollDisableEnabled===false){return this}Adapt.a11y.log.deprecated("$(\"..\").scrollEnable, use Adapt.a11y.scrollEnable($elements); instead.");Adapt.a11y.scrollEnable(this);return this},a11y_popup:function(){Adapt.a11y.log.deprecated("$(\"..\").a11y_popup, use Adapt.a11y.popupOpened($popupElement); instead.");return Adapt.a11y.popupOpened(this)},a11y_cntrl:function(isOn,withDisabled){Adapt.a11y.log.deprecated("$(\"..\").a11y_cntrl, use Adapt.a11y.toggleAccessible($elements, isAccessible); and if needed Adapt.a11y.toggleEnabled($elements, isEnabled); instead.");Adapt.a11y.toggleAccessible(this,isOn);if(withDisabled)Adapt.a11y.toggleEnabled(this,isOn);return this},a11y_cntrl_enabled:function(isOn){Adapt.a11y.log.deprecated("$(\"..\").a11y_cntrl_enabled, use Adapt.a11y.toggleAccessibleEnabled($elements, isAccessibleEnabled); instead.");Adapt.a11y.toggleAccessibleEnabled(this,isOn);return this},isReadable:function(){Adapt.a11y.log.deprecated("$(\"..\").isReadable, use Adapt.a11y.isReadable($element); instead.");return Adapt.a11y.isReadable(this)},findForward:function(selector){Adapt.a11y.log.removed("$(\"..\").findForward has been removed as the use cases are very small, let us know if you need it back.");return Adapt.a11y._findFirstForward(this,selector)},findWalk:function(selector){Adapt.a11y.log.removed("$(\"..\").findWalk has been removed as the use cases are very small, let us know if you need it back.");return Adapt.a11y._findFindForwardDescendant(this,selector)},focusNoScroll:function(){Adapt.a11y.log.deprecated("$(\"..\").focusNoScroll, use Adapt.a11y.focus($element); instead.");return Adapt.a11y.focus(this)},focusNext:function(returnOnly){Adapt.a11y.log.deprecated("$(\"..\").focusNext, use Adapt.a11y.focusNext($element); or if needed Adapt.a11y.findFirstReadable($element); instead.");if(returnOnly){return Adapt.a11y.findFirstReadable(this)}return Adapt.a11y.focusNext(this)},focusOrNext:function(returnOnly){Adapt.a11y.log.deprecated("$(\"..\").focusOrNext, use Adapt.a11y.focusFirst($element); or if needed Adapt.a11y.findFirstReadable($element); or Adapt.a11y.isReadable($element); instead.");if(returnOnly){if(Adapt.a11y.isReadable(this))return this;return Adapt.a11y.findFirstReadable(this)}return Adapt.a11y.focusFirst(this)},a11y_focus:function(dontDefer){Adapt.a11y.log.deprecated("$(\"..\").a11y_focus, use Adapt.a11y.focusFirst($element, { defer: true }); instead.");Adapt.a11y.focusFirst(this,{defer:!dontDefer});return this}});Object.assign($,{a11y_alert:function(){Adapt.a11y.log.removed("$.a11y_alert is removed. Please use aria-live instead.");return this},a11y_update:function(){Adapt.a11y.log.removed("a11y_update is no longer required.");return this},a11y_text:function(text){Adapt.a11y.log.removed("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return text},a11y_on:function(isOn,selector){Adapt.a11y.log.deprecated("$(\"..\").a11y_on, use Adapt.a11y.toggleHidden($elements, isHidden); instead.");return Adapt.a11y.toggleHidden(selector,!isOn)},a11y_popdown:function($focusTarget){Adapt.a11y.log.removed("$.a11y_popdown, use Adapt.a11y.popupClosed($focusTarget); instead.");return Adapt.a11y.popupClosed($focusTarget)},a11y_focus:function(dontDefer){Adapt.a11y.log.deprecated("$.a11y_focus, use Adapt.a11y.focusFirst(\"body\", { defer: true }); instead.");Adapt.a11y.focusFirst("body",{defer:!dontDefer});return this},a11y_normalize:function(html){Adapt.a11y.log.deprecated("$.a11y_normalize, use Adapt.a11y.normalize(\"html\"); instead.");return Adapt.a11y.normalize(html)},a11y_remove_breaks:function(html){Adapt.a11y.log.deprecated("$.a11y_remove_breaks, use Adapt.a11y.removeBreaks(\"html\"); instead.");return Adapt.a11y.removeBreaks(html)}});var A11y=function(_Backbone$Controller){_inherits(A11y,_Backbone$Controller);var _super=_createSuper(A11y);function A11y(){_classCallCheck(this,A11y);return _super.apply(this,arguments)}_createClass(A11y,[{key:"defaults",value:function defaults(){return{_isFocusOutlineKeyboardOnlyEnabled:true,_isFocusOutlineDisabled:false,_isFocusAssignmentEnabled:true,_isFocusOnClickEnabled:true,_isFocusNextOnDisabled:true,_isScrollDisableEnabled:true,_isAriaHiddenManagementEnabled:true,_isPopupManagementEnabled:true,_isPopupWrapFocusEnabled:true,_isPopupAriaHiddenManagementEnabled:true,_isPopupTabIndexManagementEnabled:true,_ariaHiddenExcludes:":not(#wrapper):not(body)",_tabbableElements:"a,button,input,select,textarea,[tabindex]:not([data-a11y-force-focus])",_focusOutlineKeyboardOnlyIgnore:"input,textarea",_tabbableElementsExcludes:":not(.a11y-ignore):not([data-a11y-force-focus])",_focusableElements:"a,button,input,select,textarea,[tabindex],label",_readableElements:"[role=heading],[aria-label],[aria-labelledby],[alt]",_focusForwardElementsExcludes:":not([aria-labelledby][role=dialog],[aria-labelledby][role=main],[aria-labelledby][role=region],[aria-labelledby][role=radiogroup],[aria-labelledby][role=group],[aria-labelledby][role=tablist],[aria-labelledby][role=list],[aria-labelledby][role=tree],[aria-labelledby][role=treegrid],[aria-labelledby][role=table],[aria-labelledby][role=grid][aria-labelledby],[role=menu],[aria-labelledby][role=rowgroup])",_focusguard:".a11y-focusguard",_wrapStyleElements:"b,i,abbr,strong,em,small,sub,sup,ins,del,mark,zw,nb",_warnFirstOnly:true,_warn:true}}},{key:"initialize",value:function initialize(){this.isFocusable=this.isFocusable.bind(this);this.isReadable=this.isReadable.bind(this);this.isTabbable=this.isTabbable.bind(this);this.$html=$("html");this._htmlCharRegex=/&.*;/g;this.config=null;this._browserFocus=new BrowserFocus;this._keyboardFocusOutline=new KeyboardFocusOutline;this._wrapFocus=new WrapFocus;this._popup=new Popup;this._scroll=new Scroll;this.log=new Log;this._removeLegacyElements();this.listenToOnce(Adapt,{"configModel:dataLoaded":this._onConfigDataLoaded,"navigationView:postRender":this._removeLegacyElements},this);Adapt.on("device:changed",this._setupNoSelect);this.listenTo(Adapt,{"router:location":this._onNavigationStart,"contentObjectView:ready router:plugin":this._onNavigationEnd})}},{key:"_onConfigDataLoaded",value:function _onConfigDataLoaded(){this.config=Adapt.config.get("_accessibility");this.config._isActive=false;this.config._options=_.defaults(this.config._options||{},this.defaults());Adapt.offlineStorage.set("a11y",false);this.$html.toggleClass("has-accessibility",this.isEnabled());this._setupNoSelect();this._addFocuserDiv();if(this._isReady){return}this._isReady=true;Adapt.trigger("accessibility:ready")}},{key:"_setupNoSelect",value:function _setupNoSelect(){var _this$config,_this=this;if(!((_this$config=this.config)!==null&&_this$config!==void 0&&_this$config._disableTextSelectOnClasses)){return}var classes=this.config._disableTextSelectOnClasses.split(" ");var isMatch=classes.some(function(className){return _this.$html.is(className)});this.$html.toggleClass("u-no-select",isMatch)}},{key:"_addFocuserDiv",value:function _addFocuserDiv(){if($("#a11y-focuser").length){return}$("body").append($("<div id=\"a11y-focuser\" class=\"a11y-ignore\" tabindex=\"-1\">&nbsp;</div>"))}},{key:"_removeLegacyElements",value:function _removeLegacyElements(){var $legacyElements=$("body").children("#accessibility-toggle, #accessibility-instructions");var $navigationElements=$(".nav").find("#accessibility-toggle, #accessibility-instructions");if(!$legacyElements.length&&!$navigationElements.length){return}Adapt.log.warn("REMOVED: #accessibility-toggle and #accessibility-instructions have been removed. Please remove them from all of your .html files.");$legacyElements.remove();$navigationElements.remove()}},{key:"_onNavigationStart",value:function _onNavigationStart(){var _this2=this;if(!this.isEnabled()){return}_.defer(function(){return _this2.toggleHidden(".contentobject",true)})}},{key:"_onNavigationEnd",value:function _onNavigationEnd(view){var _view$model;if((view===null||view===void 0?void 0:(_view$model=view.model)===null||_view$model===void 0?void 0:_view$model.get("_id"))!==Adapt.location._currentId||!this.isEnabled()){return}this.toggleHidden(".contentobject",false)}},{key:"isActive",value:function isActive(){this.log.removed("Accessibility is now always active when enabled. Please unify your user experiences.");return false}},{key:"isEnabled",value:function isEnabled(){var _this$config2;return(_this$config2=this.config)===null||_this$config2===void 0?void 0:_this$config2._isEnabled}},{key:"ariaLevel",value:function ariaLevel(){var defaultLevelOrType=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var overrideLevelOrType=arguments.length>1?arguments[1]:undefined;var cfg=Adapt.config.get("_accessibility");if(overrideLevelOrType){defaultLevelOrType=overrideLevelOrType}if(!isNaN(defaultLevelOrType)){return defaultLevelOrType}if(_.isString(defaultLevelOrType)){var _cfg$_ariaLevels,_ariaLevels;var ariaLevels=(_cfg$_ariaLevels=cfg._ariaLevels)!==null&&_cfg$_ariaLevels!==void 0?_cfg$_ariaLevels:defaultAriaLevels;return(_ariaLevels=ariaLevels===null||ariaLevels===void 0?void 0:ariaLevels["_"+defaultLevelOrType])!==null&&_ariaLevels!==void 0?_ariaLevels:defaultLevelOrType}return defaultLevelOrType}},{key:"toggleHidden",value:function toggleHidden($elements){var isHidden=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;$elements=$($elements);var config=this.config;if(!config._isEnabled||!config._options._isAriaHiddenManagementEnabled){return this}if(isHidden===true){$elements.attr("aria-hidden",true)}else{$elements.removeAttr("aria-hidden")}return this}},{key:"toggleAccessibleEnabled",value:function toggleAccessibleEnabled($elements,isAccessibleEnabled){this.toggleAccessible($elements,isAccessibleEnabled);this.toggleEnabled($elements,isAccessibleEnabled);return this}},{key:"toggleAccessible",value:function toggleAccessible($elements){var isReadable=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;$elements=$($elements);var config=this.config;if(!config._isEnabled||!config._options._isAriaHiddenManagementEnabled||$elements.length===0){return this}if(!isReadable){$elements.attr({tabindex:"-1","aria-hidden":"true"}).addClass("aria-hidden")}else{$elements.removeAttr("aria-hidden tabindex").removeClass("aria-hidden");$elements.parents(config._options._ariaHiddenExcludes).removeAttr("aria-hidden").removeClass("aria-hidden")}return this}},{key:"toggleEnabled",value:function toggleEnabled($elements){var isEnabled=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;$elements=$($elements);if($elements.length===0){return this}if(!isEnabled){$elements.attr({tabindex:"-1","aria-disabled":"true"}).addClass("is-disabled")}else{$elements.removeAttr("aria-disabled tabindex").removeClass("is-disabled")}return this}},{key:"findFirstTabbable",value:function findFirstTabbable($element){$element=$($element).first();return this._findFirstForward($element,this.isTabbable)}},{key:"findFirstReadable",value:function findFirstReadable($element){$element=$($element).first();return this._findFirstForward($element,this.isReadable)}},{key:"findFirstFocusable",value:function findFirstFocusable($element){$element=$($element).first();return this._findFirstForward($element,this.isFocusable)}},{key:"findTabbable",value:function findTabbable($element){var config=this.config;return $($element).find(config._options._tabbableElements).filter(config._options._tabbableElementsExcludes)}},{key:"findReadable",value:function findReadable($element){var _this3=this;return $($element).find("*").filter(function(index,element){return _this3.isReadable(element)})}},{key:"findFocusable",value:function findFocusable($element){var _this4=this;return $($element).find("*").filter(function(index,element){return _this4.isFocusable(element)})}},{key:"isTabbable",value:function isTabbable($element){var config=this.config;var value=$($element).is(config._options._tabbableElements).is(config._options._tabbableElementsExcludes);if(!value){return null}return value}},{key:"isReadable",value:function isReadable($element){var checkParents=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var config=this.config;$element=$($element).first();var $branch=checkParents?$element.add($element.parents()):$element;var isNotVisible=$branch.toArray().some(function(item){var $item=$(item);return $item.css("display")==="none"||$item.css("visibility")==="hidden"||$item.attr("aria-hidden")==="true"});if(isNotVisible){return false}var hasNativeFocusOrIsScreenReadable=$element.is(config._options._focusableElements)||$element.is(config._options._readableElements);if(hasNativeFocusOrIsScreenReadable){return true}var childNodes=$element[0].childNodes;for(var c=0,cl=childNodes.length;c<cl;c++){var childNode=childNodes[c];var isTextNode=childNode.nodeType===3;if(!isTextNode){continue}var isOnlyWhiteSpace=/^\s*$/.test(childNode.nodeValue);if(isOnlyWhiteSpace){continue}return true}return null}},{key:"isFocusable",value:function isFocusable($element){var checkParents=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var config=this.config;$element=$($element).first();if(!$element.is(config._options._focusForwardElementsExcludes))return null;return this.isReadable($element,checkParents)}},{key:"_findFirstForward",value:function _findFirstForward($element,selector){var _this5=this;$element=$($element).first();var iterator;switch(_typeof(selector)){case"string":iterator=function($tag){return $tag.is(selector)||undefined};break;case"function":iterator=selector;break;case"undefined":iterator=Boolean;}if($element.length===0){return $element.not("*")}var $found=this._findFirstForwardDescendant($element,iterator);if($found.length){return $found}$element.nextAll().toArray().some(function(sibling){var $sibling=$(sibling);var value=iterator($sibling);if(value===false){return false}if(value){$found=$sibling;return true}$found=_this5._findFirstForwardDescendant($sibling,iterator);return Boolean($found.length)});if($found.length){return $found}$element.add($element.parents()).toArray().reverse().some(function(parent){var $parent=$(parent);if(iterator($parent)===false){return false}return $parent.nextAll().toArray().some(function(sibling){var $sibling=$(sibling);var value=iterator($sibling);if(value===false){return false}if(value){$found=$sibling;return true}$found=_this5._findFirstForwardDescendant($sibling,iterator);return Boolean($found.length)})});if(!$found.length){return $element.not("*")}return $found}},{key:"_findFirstForwardDescendant",value:function _findFirstForwardDescendant($element,selector){$element=$($element).first();var iterator;switch(_typeof(selector)){case"string":iterator=function($tag){return $tag.is(selector)||undefined};break;case"function":iterator=selector;break;case"undefined":iterator=Boolean;}var $notFound=$element.not("*");if($element.length===0){return $notFound}var stack=[{item:$element[0],value:undefined}];var stackIndexPosition=0;var childIndexPosition=stackIndexPosition+1;do{var stackEntry=stack[stackIndexPosition];var $stackItem=$(stackEntry.item);switch(stackEntry.value){case true:return $stackItem;case false:return $notFound;}$stackItem.children().toArray().forEach(function(item){var $item=$(item);var value=iterator($item);if(value===false){return}stack.splice(childIndexPosition++,0,{item:item,value:value})});stackIndexPosition++;childIndexPosition=stackIndexPosition+1}while(stackIndexPosition<stack.length);return $notFound}},{key:"focusNext",value:function focusNext($element,options){options=new FocusOptions(options);$element=$($element).first();$element=this.findFirstFocusable($element);this.focus($element,options);return this}},{key:"focusFirst",value:function focusFirst($element,options){options=new FocusOptions(options);$element=$($element).first();if(this.isReadable($element)){this.focus($element,options);return $element}$element=this.findFirstFocusable($element);this.focus($element,options);return $element}},{key:"focus",value:function focus($element,options){options=new FocusOptions(options);$element=$($element).first();var config=this.config;if(!config._isEnabled||!config._options._isFocusAssignmentEnabled||$element.length===0){return this}function perform(){if($element.attr("tabindex")===undefined){$element.attr({tabindex:"-1","data-a11y-force-focus":"true"})}if(options.preventScroll){var y=$(window).scrollTop();try{$element[0].focus({preventScroll:true})}catch(e){}switch(Adapt.device.browser){case"internet explorer":case"microsoft edge":case"safari":window.scrollTo(null,y);}}else{$element[0].focus()}}if(options.defer){_.defer(perform)}else{perform()}return this}},{key:"normalize",value:function normalize(htmls){htmls=Array.prototype.slice.call(arguments).filter(Boolean).filter(_.isString).join(" ");var text=$("<div>"+htmls+"</div>").text();return text.replace(this._htmlCharRegex,"")}},{key:"removeBreaks",value:function removeBreaks(htmls){var _this6=this;htmls=Array.prototype.slice.call(arguments).filter(Boolean).filter(_.isString).join(" ");var $div=$("<div>"+htmls+"</div>");var stack=[$div[0]];var stackIndex=0;var outputs=[];do{if(stack[stackIndex].childNodes.length){var nodes=stack[stackIndex].childNodes;var usable=nodes.filter(function(node){var isTextNode=node.nodeType===3;if(isTextNode){return true}var isStyleElement=$(node).is(_this6.config._options._wrapStyleElements);if(isStyleElement){return true}return false});outputs.push.apply(outputs,usable);stack.push.apply(stack,nodes)}stackIndex++}while(stackIndex<stack.length);var rtnText="";outputs.forEach(function(item){rtnText+=item.outerHTML||item.textContent});return rtnText}},{key:"scrollEnable",value:function scrollEnable($elements){this._scroll.enable($elements);return this}},{key:"scrollDisable",value:function scrollDisable($elements){this._scroll.disable($elements);return this}},{key:"popupOpened",value:function popupOpened($popupElement){this._popup.opened($popupElement);return this}},{key:"popupClosed",value:function popupClosed($focusElement){this._popup.closed($focusElement);return this}},{key:"setPopupCloseTo",value:function setPopupCloseTo($focusElement){return this._popup.setCloseTo($focusElement)}}]);return A11y}(Backbone.Controller);var a11y=__AMD("core/js/a11y",Adapt.a11y=new A11y);Object.defineProperty(Adapt,"accessibility",{get:function(){a11y.log.deprecated("Adapt.accessibility has moved to Adapt.a11y");return a11y}});var AdaptCollection=__AMD("core/js/collections/adaptCollection",function(_Backbone$Collection){_inherits(AdaptCollection,_Backbone$Collection);var _super=_createSuper(AdaptCollection);function AdaptCollection(){_classCallCheck(this,AdaptCollection);return _super.apply(this,arguments)}_createClass(AdaptCollection,[{key:"initialize",value:function initialize(models,options){this.once("reset",this.loadedData,this)}},{key:"loadedData",value:function loadedData(){Adapt.trigger("adaptCollection:dataLoaded")}}]);return AdaptCollection}(Backbone.Collection));var BuildModel=__AMD("core/js/models/buildModel",function(_LockingModel){_inherits(BuildModel,_LockingModel);var _super=_createSuper(BuildModel);function BuildModel(){_classCallCheck(this,BuildModel);return _super.apply(this,arguments)}_createClass(BuildModel,[{key:"defaults",value:function defaults(){return{jsonext:"json"}}},{key:"initialize",value:function initialize(attrs,options){var _this=this;this.url=options.url;this.fetch({success:function(){_this.isLoaded=true;Adapt.trigger("buildModel:dataLoaded")},error:function(){console.log("Unable to load adapt/js/build.js");Adapt.trigger("buildModel:dataLoaded")}})}},{key:"isFrameworkVersion",value:function isFrameworkVersion(version){return semver__default["default"].satisfies(this.get("package").version,version,{includePrerelease:true})}},{key:"isPluginInstalled",value:function isPluginInstalled(name){var version=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"*";var plugin=this.get("plugins").find(function(plugin){if(plugin.name!==name)return false;return semver__default["default"].satisfies(plugin.version,version,{includePrerelease:true})});return Boolean(plugin)}},{key:"whenReady",value:function whenReady(){if(this.isLoaded)return Promise.resolve();return new Promise(function(resolve){Adapt.once("buildModel:dataLoaded",resolve)})}}]);return BuildModel}(LockingModel));var ConfigModel=__AMD("core/js/models/configModel",function(_LockingModel){_inherits(ConfigModel,_LockingModel);var _super=_createSuper(ConfigModel);function ConfigModel(){_classCallCheck(this,ConfigModel);return _super.apply(this,arguments)}_createClass(ConfigModel,[{key:"defaults",value:function defaults(){return{screenSize:{large:900,medium:760,small:520},_forceRouteLocking:false,_canLoadData:true,_disableAnimation:false}}},{key:"setValuesFromURLParams",value:function setValuesFromURLParams(){var _this=this;var paramMappings={dir:"_defaultDirection",lang:"_defaultLanguage"};var params=new URLSearchParams(window.location.search);Object.entries(paramMappings).forEach(function(_ref){var _Adapt$build$get;var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];var passedVal=params.get(key);if(!passedVal)return;if(key==="lang"&&((_Adapt$build$get=Adapt.build.get("availableLanguageNames"))===null||_Adapt$build$get===void 0?void 0:_Adapt$build$get.includes(passedVal))===false)return;_this.set(value,passedVal)})}},{key:"initialize",value:function initialize(attrs,options){var _this2=this;this.url=options.url;this.fetch({success:function(){_this2.setValuesFromURLParams();Adapt.trigger("offlineStorage:prepare");Adapt.wait.queue(function(){Adapt.trigger("configModel:dataLoaded");if(!_this2.get("_canLoadData"))return;Adapt.trigger("configModel:loadCourseData")})},error:function(){return console.log("Unable to load course/config.json")}})}},{key:"loadData",value:function loadData(){}}]);return ConfigModel}(LockingModel));var ModelEvent=__AMD("core/js/modelEvent",function(_Backbone$Controller){_inherits(ModelEvent,_Backbone$Controller);var _super=_createSuper(ModelEvent);function ModelEvent(){_classCallCheck(this,ModelEvent);return _super.apply(this,arguments)}_createClass(ModelEvent,[{key:"initialize",value:function initialize(type,target,value){this.type=type;this.target=target;this.value=value;this.canBubble=true;this.deepPath=[target];this.timeStamp=null}},{key:"stopPropagation",value:function stopPropagation(){this.canBubble=false}},{key:"addPath",value:function addPath(target){this.deepPath.unshift(target)}}]);return ModelEvent}(Backbone.Controller));var AdaptModel=__AMD("core/js/models/adaptModel",function(_LockingModel){_inherits(AdaptModel,_LockingModel);var _super=_createSuper(AdaptModel);function AdaptModel(){_classCallCheck(this,AdaptModel);return _super.apply(this,arguments)}_createClass(AdaptModel,[{key:"toJSON",value:function toJSON(){var json=_objectSpread2({},this.attributes);delete json._children;delete json._parent;return $.extend(true,{},json)}},{key:"get",value:function get(name){switch(name){case"_parent":case"_children":Adapt.log.deprecated("Use model.getChildren() or model.getParent() instead of model.get('_children') or model.get('_parent')");}return _get(_getPrototypeOf(AdaptModel.prototype),"get",this).call(this,name)}},{key:"defaults",value:function defaults(){return{_canShowFeedback:true,_classes:"",_canReset:true,_canRequestChild:false,_isComplete:false,_isInteractionComplete:false,_isA11yRegionEnabled:false,_isA11yCompletionDescriptionEnabled:true,_requireCompletionOf:-1,_isEnabled:true,_isResetOnRevisit:false,_isAvailable:true,_isOptional:false,_isRendered:false,_isReady:false,_isVisible:true,_isLocked:false,_isHidden:false}}},{key:"trackingPosition",get:function(){var _this=this;var firstDescendant=this.getAllDescendantModels(false).concat([this])[0];var nearestTrackingIdModel=[firstDescendant].concat(firstDescendant.getAncestorModels()).find(function(model){return model.has("_trackingId")});if(!nearestTrackingIdModel)return;var trackingId=nearestTrackingIdModel.get("_trackingId");var trackingIdDescendants=[nearestTrackingIdModel].concat(nearestTrackingIdModel.getAllDescendantModels(true));var indexInTrackingIdDescendants=trackingIdDescendants.findIndex(function(descendant){return descendant===_this});if(indexInTrackingIdDescendants>=0){return[trackingId,indexInTrackingIdDescendants]}var trackingIdAncestors=nearestTrackingIdModel.getAncestorModels();var ancestorDistance=trackingIdAncestors.findIndex(function(ancestor){return ancestor===_this});return[trackingId,-(ancestorDistance+1)]}},{key:"parse",value:function parse(data){if(data._isResetOnRevisit==="false"){data._isResetOnRevisit=false}return data}},{key:"trackable",value:function trackable(){return["_id","_isComplete","_isInteractionComplete"]}},{key:"trackableType",value:function trackableType(){return[String,Boolean,Boolean]}},{key:"bubblingEvents",value:function bubblingEvents(){return["change:_isComplete","change:_isInteractionComplete","change:_isActive"]}},{key:"setupModel",value:function setupModel(){var _this2=this;if(this.hasManagedChildren){this.setupChildListeners()}this.init();_.defer(function(){if(_this2.hasManagedChildren){_this2.checkCompletionStatus();_this2.checkInteractionCompletionStatus();_this2.checkLocking()}_this2.setupTrackables()})}},{key:"setupTrackables",value:function setupTrackables(){var _this3=this;var originalTrackableStateFunction=this.triggerTrackableState;this.triggerTrackableState=_.compose(function(){_this3.triggerTrackableState.isQueued=true},_.debounce(function(){originalTrackableStateFunction.apply(_this3);_this3.triggerTrackableState.isQueued=false},17));this.listenTo(this,"change",function(_ref){var changed=_ref.changed;if(_this3.triggerTrackableState.isQueued||!Adapt.attributes._isStarted){return}var trackablePropertyNames=_.result(_this3,"trackable",[]);var changedPropertyNames=Object.keys(changed);var isTrackable=changedPropertyNames.find(function(item){return trackablePropertyNames.includes(item)});if(isTrackable){_this3.triggerTrackableState()}})}},{key:"setupChildListeners",value:function setupChildListeners(){var children=this.getChildren();if(!children.length){return}this.listenTo(children,{all:this.onAll,bubble:this.bubble,"change:_isReady":this.checkReadyStatus,"change:_isComplete":this.onIsComplete,"change:_isInteractionComplete":this.checkInteractionCompletionStatus})}},{key:"init",value:function init(){}},{key:"getTrackableState",value:function getTrackableState(){var _ref2;var trackable=this.resultExtend("trackable",[]);var json=this.toJSON();var args=trackable;args.unshift(json);return(_ref2=_).pick.apply(_ref2,_toConsumableArray(args))}},{key:"setTrackableState",value:function setTrackableState(state){var _ref3;var trackable=this.resultExtend("trackable",[]);var args=trackable;args.unshift(state);state=(_ref3=_).pick.apply(_ref3,_toConsumableArray(args));this.set(state);return this}},{key:"triggerTrackableState",value:function triggerTrackableState(){Adapt.trigger("state:change",this,this.getTrackableState())}},{key:"reset",value:function reset(){var type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"hard";var canReset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.get("_canReset");if(!canReset)return false;switch(type){case"hard":case true:this.set({_isEnabled:true,_isComplete:false,_isInteractionComplete:false});return true;case"soft":this.set({_isEnabled:true,_isInteractionComplete:false});return true;}return false}},{key:"checkReadyStatus",value:function checkReadyStatus(model,value){if(value===false){return false}var children=this.getAvailableChildModels();if(children.find(function(child){return child.get("_isReady")===false&&child.get("_isRendered")})){return false}this.set("_isReady",true);return true}},{key:"setCompletionStatus",value:function setCompletionStatus(){if(!this.get("_isVisible"))return;this.set({_isComplete:true,_isInteractionComplete:true})}},{key:"checkCompletionStatus",value:function checkCompletionStatus(){Adapt.checkingCompletion();_.defer(this.checkCompletionStatusFor.bind(this),"_isComplete")}},{key:"checkInteractionCompletionStatus",value:function checkInteractionCompletionStatus(){Adapt.checkingCompletion();_.defer(this.checkCompletionStatusFor.bind(this),"_isInteractionComplete")}},{key:"checkCompletionStatusFor",value:function checkCompletionStatusFor(){var completionAttribute=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"_isComplete";var completed=false;var children=this.getAvailableChildModels();var requireCompletionOf=this.get("_requireCompletionOf");if(requireCompletionOf===-1){completed=children.every(function(child){return child.get(completionAttribute)||child.get("_isOptional")})}else{completed=children.filter(function(child){return child.get(completionAttribute)&&!child.get("_isOptional")}).length>=requireCompletionOf}this.set(completionAttribute,completed);Adapt.checkedCompletion()}},{key:"getTypeGroup",value:function getTypeGroup(){}},{key:"isTypeGroup",value:function isTypeGroup(typeGroup){var hasUpperCase=/[A-Z]+/.test(typeGroup);var isPluralized=typeGroup.slice(-1)==="s";var lowerCased=typeGroup.toLowerCase();var singular=isPluralized&&lowerCased.slice(0,-1);var singularLowerCased=(singular||lowerCased).toLowerCase();if(isPluralized||hasUpperCase){Adapt.log.deprecated("'".concat(typeGroup,"' appears pluralized or contains uppercase characters, suggest using the singular, lowercase type group '").concat(singularLowerCased,"'."))}var pluralizedLowerCaseTypes=[singularLowerCased,!isPluralized&&"".concat(lowerCased,"s")].filter(Boolean);var typeGroups=this.getTypeGroups();if(_.intersection(pluralizedLowerCaseTypes,typeGroups).length){return true}return false}},{key:"getTypeGroups",value:function getTypeGroups(){if(this._typeGroups)return this._typeGroups;var typeGroups=[this.get("_type")];var parentClass=this;while(parentClass=Object.getPrototypeOf(parentClass)){if(!Object.prototype.hasOwnProperty.call(parentClass,"getTypeGroup"))continue;typeGroups.push(parentClass.getTypeGroup.call(this))}return this._typeGroups=_.uniq(typeGroups.filter(Boolean).map(function(s){return s.toLowerCase()}))}},{key:"findAncestor",value:function findAncestor(ancestorType){var parent=this.getParent();if(!parent)return;if(!ancestorType||parent.isTypeGroup(ancestorType)){return parent}return parent.findAncestor(ancestorType)}},{key:"findDescendantModels",value:function findDescendantModels(descendants,options){var allDescendantsModels=this.getAllDescendantModels();var returnedDescendants=allDescendantsModels.filter(function(model){return model.isTypeGroup(descendants)});if(!options){return returnedDescendants}if(options.where){return returnedDescendants.filter(function(descendant){for(var property in options.where){var value=options.where[property];if(descendant.get(property)!==value){return false}}return true})}}},{key:"getAllDescendantModels",value:function getAllDescendantModels(isParentFirst){var descendants=[];if(!this.hasManagedChildren){return descendants}var children=this.getChildren();children.models.forEach(function(child){if(!child.hasManagedChildren){descendants.push(child);return}var subDescendants=child.getAllDescendantModels(isParentFirst);if(isParentFirst===true){descendants.push(child)}descendants.push.apply(descendants,_toConsumableArray(subDescendants));if(isParentFirst!==true){descendants.push(child)}});return descendants}},{key:"findRelativeModel",value:function findRelativeModel(relativeString){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var rootModel=options.limitParentId?Adapt.findById(options.limitParentId):Adapt.course;var relativeDescriptor=Adapt.parseRelativeString(relativeString);var searchBackwards=relativeDescriptor.offset<0;var moveBy=Math.abs(relativeDescriptor.offset);var movementCount=0;var hasDescendantsOfType=Boolean(this.findDescendantModels(relativeDescriptor.type).length);if(hasDescendantsOfType){moveBy--}var pageDescendants;if(searchBackwards){var _pageDescendants;pageDescendants=[rootModel];(_pageDescendants=pageDescendants).push.apply(_pageDescendants,_toConsumableArray(rootModel.getAllDescendantModels(true)));pageDescendants.reverse()}else{pageDescendants=rootModel.getAllDescendantModels(false);pageDescendants.push(rootModel)}var modelId=this.get("_id");var modelIndex=pageDescendants.findIndex(function(pageDescendant){if(pageDescendant.get("_id")===modelId){return true}return false});var isFilterFunction=typeof options.filter==="function";if(options.loop){var totalOfType=pageDescendants.reduce(function(count,model){if(!model.isTypeGroup(relativeDescriptor.type))return count;return++count},0);moveBy=moveBy%totalOfType;pageDescendants=pageDescendants.concat(pageDescendants.slice(0))}for(var i=modelIndex,l=pageDescendants.length;i<l;i++){var descendant=pageDescendants[i];if(!descendant.isTypeGroup(relativeDescriptor.type))continue;var isSelf=i===modelIndex;if(!isSelf&&isFilterFunction&&!options.filter(descendant))continue;if(movementCount>moveBy){break}if(movementCount===moveBy){return Adapt.findById(descendant.get("_id"))}movementCount++}}},{key:"hasManagedChildren",get:function(){return true}},{key:"getChildren",value:function getChildren(){if(this._childrenCollection){return this._childrenCollection}var childrenCollection;if(!this.hasManagedChildren){childrenCollection=new Backbone.Collection}else{var id=this.get("_id");var children=Adapt.data.filter(function(model){return model.get("_parentId")===id});childrenCollection=new Backbone.Collection(children)}if(this.get("_type")==="block"&&childrenCollection.length===2&&childrenCollection.models[0].get("_layout")!=="left"){childrenCollection.comparator="_layout";childrenCollection.sort()}this.setChildren(childrenCollection);return this._childrenCollection}},{key:"setChildren",value:function setChildren(children){this._childrenCollection=children;this.set("_children",children)}},{key:"getAvailableChildModels",value:function getAvailableChildModels(){return this.getChildren().where({_isAvailable:true})}},{key:"getParent",value:function getParent(){if(this._parentModel){return this._parentModel}var parentId=this.get("_parentId");if(!parentId)return;this.setParent(Adapt.findById(parentId));return this._parentModel}},{key:"setParent",value:function setParent(parent){this._parentModel=parent;this.set("_parentId",this._parentModel.get("_id"));this.set("_parent",this._parentModel)}},{key:"getAncestorModels",value:function getAncestorModels(shouldIncludeChild){var parents=[];var context=this;if(shouldIncludeChild)parents.push(context);while(context.has("_parentId")){context=context.getParent();parents.push(context)}return parents.length?parents:null}},{key:"getSiblings",value:function getSiblings(passSiblingsAndIncludeSelf){var id=this.get("_id");var parentId=this.get("_parentId");var siblings;if(!passSiblingsAndIncludeSelf){if(this._hasSiblingsAndSelf===false){return this.get("_siblings")}siblings=Adapt.data.filter(function(model){return model.get("_parentId")===parentId&&model.get("_id")!==id});this._hasSiblingsAndSelf=false}else{if(this._hasSiblingsAndSelf){return this.get("_siblings")}siblings=Adapt.data.filter(function(model){return model.get("_parentId")===parentId});this._hasSiblingsAndSelf=true}var siblingsCollection=new Backbone.Collection(siblings);this.set("_siblings",siblingsCollection);return siblingsCollection}},{key:"setOnChildren",value:function setOnChildren(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}this.set.apply(this,args);if(!this.hasManagedChildren)return;var children=this.getChildren();children.models.forEach(function(child){return child.setOnChildren.apply(child,args)})}},{key:"setOptional",value:function setOptional(value){Adapt.log.deprecated("Use model.set('_isOptional', value) as setOptional() may be removed in the future");this.set({_isOptional:value})}},{key:"checkLocking",value:function checkLocking(){var lockType=this.get("_lockType");if(!lockType)return;switch(lockType){case"sequential":this.setSequentialLocking();break;case"unlockFirst":this.setUnlockFirstLocking();break;case"lockLast":this.setLockLastLocking();break;case"custom":this.setCustomLocking();break;default:console.warn("AdaptModel.checkLocking: unknown _lockType '".concat(lockType,"' found on ").concat(this.get("_id")));}}},{key:"setSequentialLocking",value:function setSequentialLocking(){var children=this.getAvailableChildModels();children.slice(1).forEach(function(child,index){var previousChild=children[index];var isLockedByPreviousChild=previousChild.get("_isLocked")||!previousChild.get("_isComplete")&&!previousChild.get("_isOptional");child.set("_isLocked",isLockedByPreviousChild)},false)}},{key:"setUnlockFirstLocking",value:function setUnlockFirstLocking(){var children=this.getAvailableChildModels();var firstChild=children.shift();var isLockedByFirstChild=!firstChild.get("_isComplete")&&!firstChild.get("_isOptional");children.forEach(function(child){return child.set("_isLocked",isLockedByFirstChild)})}},{key:"setLockLastLocking",value:function setLockLastLocking(){var children=this.getAvailableChildModels();var lastChild=children.pop();var isLockedByChildren=children.some(function(child){return!child.get("_isComplete")&&!child.get("_isOptional")});lastChild.set("_isLocked",isLockedByChildren)}},{key:"setCustomLocking",value:function setCustomLocking(){var _this4=this;var children=this.getAvailableChildModels();children.forEach(function(child){return child.set("_isLocked",_this4.shouldLock(child))})}},{key:"shouldLock",value:function shouldLock(child){var lockedBy=child.get("_lockedBy");if(!lockedBy)return false;return lockedBy.some(function(id){try{var anotherModel=Adapt.findById(id);return anotherModel.get("_isAvailable")&&(anotherModel.get("_isLocked")||!anotherModel.get("_isComplete")&&!anotherModel.get("_isOptional"))}catch(e){console.warn("AdaptModel.shouldLock: unknown _lockedBy ID '".concat(id,"' found on ").concat(child.get("_id")));return false}})}},{key:"onIsComplete",value:function onIsComplete(){this.checkCompletionStatus();this.checkLocking()}},{key:"checkIfResetOnRevisit",value:function checkIfResetOnRevisit(){var isResetOnRevisit=this.get("_isResetOnRevisit");this.reset(isResetOnRevisit)}},{key:"deepClone",value:function deepClone(){var modifier=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var ModelClass=this.constructor;var clonedModel=new ModelClass(this.toJSON());if(modifier){modifier(clonedModel,this)}var clonedId=clonedModel.get("_id");var hasId=Boolean(clonedId);var shouldAssignUniqueId=this.get("_id")===clonedId;if(hasId&&shouldAssignUniqueId){var cid=_.uniqueId(ModelClass.prototype.cidPrefix||"c");clonedId="".concat(clonedId,"_").concat(cid);clonedModel.set("_id",clonedId)}if(hasId){Adapt.data.add(clonedModel)}if(this.hasManagedChildren){this.getChildren().each(function(child){if(!child.deepClone){throw new Error("Cannot deepClone child.")}child.deepClone(function(clone,child){if(hasId){clone.set("_parentId",clonedId)}if(modifier){modifier(clone,child)}})})}clonedModel.getParent().getChildren().add(clonedModel);clonedModel.setupModel();return clonedModel}},{key:"onAll",value:function onAll(type,model,value){if(!_.result(this,"bubblingEvents").includes(type))return;var event=new ModelEvent(type,model,value);this.bubble(event)}},{key:"bubble",value:function bubble(event){if(!event.canBubble)return;event.addPath(this);this.trigger("bubble:".concat(event.type," bubble"),event)}}]);return AdaptModel}(LockingModel));var ContentObjectModel=__AMD("core/js/models/contentObjectModel",function(_AdaptModel){_inherits(ContentObjectModel,_AdaptModel);var _super=_createSuper(ContentObjectModel);function ContentObjectModel(){_classCallCheck(this,ContentObjectModel);return _super.apply(this,arguments)}_createClass(ContentObjectModel,[{key:"_parent",get:function(){Adapt.log.deprecated("contentObjectModel._parent, use contentObjectModel.getParent() instead, parent models are defined by the JSON");var isParentCourse=this.get("_parentId")===Adapt.course.get("_id");if(isParentCourse){return"course"}return"contentObjects"}},{key:"_siblings",get:function(){Adapt.log.deprecated("contentObjectModel._siblings, use contentObjectModel.getSiblings() instead, sibling models are defined by the JSON");return"contentObjects"}},{key:"_children",get:function(){Adapt.log.deprecated("contentObjectModel._children, use contentObjectModel.hasManagedChildren instead, child models are defined by the JSON");return null}},{key:"getTypeGroup",value:function getTypeGroup(){return"contentobject"}}]);return ContentObjectModel}(AdaptModel));var MenuModel=function(_ContentObjectModel){_inherits(MenuModel,_ContentObjectModel);var _super=_createSuper(MenuModel);function MenuModel(){_classCallCheck(this,MenuModel);return _super.apply(this,arguments)}_createClass(MenuModel,[{key:"_children",get:function(){Adapt.log.deprecated("menuModel._children, use menuModel.hasManagedChildren instead, child models are defined by the JSON");return"contentObjects"}},{key:"getTypeGroup",value:function getTypeGroup(){return"menu"}},{key:"setCustomLocking",value:function setCustomLocking(){var _this=this;var children=this.getAvailableChildModels();children.forEach(function(child){child.set("_isLocked",_this.shouldLock(child));if(!(child instanceof MenuModel))return;child.checkLocking()})}}]);return MenuModel}(ContentObjectModel);Adapt.register("menu",{model:MenuModel});var MenuModel$1=__AMD("core/js/models/menuModel",MenuModel);var CourseModel=function(_MenuModel){_inherits(CourseModel,_MenuModel);var _super=_createSuper(CourseModel);function CourseModel(){_classCallCheck(this,CourseModel);return _super.apply(this,arguments)}_createClass(CourseModel,[{key:"_parent",get:function(){Adapt.log.deprecated("courseModel._parent, use courseModel.getParent() instead, parent models are defined by the JSON");return null}},{key:"_siblings",get:function(){Adapt.log.deprecated("courseModel._siblings, use courseModel.getSiblings() instead, sibling models are defined by the JSON");return null}}]);return CourseModel}(MenuModel$1);Adapt.register("course",{model:CourseModel});var CourseModel$1=__AMD("core/js/models/courseModel",CourseModel);var StartController=function(_Backbone$Controller){_inherits(StartController,_Backbone$Controller);var _super=_createSuper(StartController);function StartController(){_classCallCheck(this,StartController);return _super.apply(this,arguments)}_createClass(StartController,[{key:"initialize",value:function initialize(){var _get2;for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}(_get2=_get(_getPrototypeOf(StartController.prototype),"initialize",this)).call.apply(_get2,[this].concat(args));this.model=null}},{key:"loadCourseData",value:function loadCourseData(){this.model=new LockingModel(Adapt.course.get("_start"))}},{key:"setStartLocation",value:function setStartLocation(){if(!this.isEnabled())return;window.history.replaceState("","",this.getStartHash())}},{key:"returnToStartLocation",value:function returnToStartLocation(){var startIds=this.model.get("_startIds");if(startIds){startIds.forEach(function(startId){return startId._skipIfComplete=false})}window.location.hash=this.getStartHash(true)}},{key:"getStartHash",value:function getStartHash(alwaysForce){var startId=this.getStartId();var isRouteSpecified=window.location.href.indexOf("#")>-1;var shouldForceStartId=alwaysForce||this.model.get("_force");var shouldNavigateToStartId=startId&&(!isRouteSpecified||shouldForceStartId);if(shouldNavigateToStartId&&startId!==Adapt.course.get("_id")){return"#/id/"+startId}return window.location.hash||"#/"}},{key:"isEnabled",value:function isEnabled(){var _this$model;return Boolean((_this$model=this.model)===null||_this$model===void 0?void 0:_this$model.get("_isEnabled"))}},{key:"getStartId",value:function getStartId(){var startId=this.model.get("_id");var startIds=this.model.get("_startIds");if(!(startIds!==null&&startIds!==void 0&&startIds.length))return startId;var $html=$("html");for(var i=0,l=startIds.length;i<l;i++){var item=startIds[i];var className=item._className;var skipIfComplete=item._skipIfComplete;var model=Adapt.findById(item._id);if(!model){console.log("startController: cannot find id",item._id);continue}if(skipIfComplete){if(model.get("_isComplete"))continue}if(!className||$html.is(className)||$html.hasClass(className)){startId=item._id;break}}return startId}}]);return StartController}(Backbone.Controller);Adapt.once("adapt:start",function(){Adapt.startController.loadCourseData();Adapt.startController.setStartLocation()});Adapt.on("navigation:returnToStart",function(){Adapt.startController.returnToStartLocation()});__AMD("core/js/startController",Adapt.startController=new StartController);var Data=function(_AdaptCollection){_inherits(Data,_AdaptCollection);var _super=_createSuper(Data);function Data(){_classCallCheck(this,Data);return _super.apply(this,arguments)}_createClass(Data,[{key:"model",value:function model(json){var ModelClass=Adapt.getModelClass(json);if(!ModelClass){return new LockingModel(json)}return new ModelClass(json,{parse:true})}},{key:"initialize",value:function initialize(){_get(_getPrototypeOf(Data.prototype),"initialize",this).call(this);this.on({add:this.onAdded,remove:this.onRemoved})}},{key:"init",value:function(){var _init=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:this.reset();this._byAdaptID={};Adapt.build=new BuildModel(null,{url:"adapt/js/build.min.js",reset:true});_context.next=5;return Adapt.build.whenReady();case 5:$("html").attr("data-adapt-framework-version",Adapt.build.get("package").version);this.loadConfigData();case 7:case"end":return _context.stop();}}},_callee,this)}));function init(){return _init.apply(this,arguments)}return init}()},{key:"onAdded",value:function onAdded(model){this._byAdaptID[model.get("_id")]=model}},{key:"onRemoved",value:function onRemoved(model){delete this._byAdaptID[model.get("_id")]}},{key:"loadConfigData",value:function loadConfigData(){Adapt.config=new ConfigModel(null,{url:"course/config."+Adapt.build.get("jsonext"),reset:true});this.listenToOnce(Adapt,"configModel:loadCourseData",this.onLoadCourseData);this.listenTo(Adapt.config,{"change:_activeLanguage":this.onLanguageChange,"change:_defaultDirection":this.onDirectionChange})}},{key:"onDirectionChange",value:function onDirectionChange(model,direction){if(direction==="rtl"){$("html").removeClass("dir-ltr").addClass("dir-rtl").attr("dir","rtl")}else{$("html").removeClass("dir-rtl").addClass("dir-ltr").attr("dir","ltr")}}},{key:"onLoadCourseData",value:function onLoadCourseData(){if(!Adapt.config.get("_activeLanguage")){Adapt.config.set("_activeLanguage",Adapt.config.get("_defaultLanguage"));return}this.loadCourseData()}},{key:"onLanguageChange",value:function onLanguageChange(model,language){Adapt.offlineStorage.set("lang",language);if(Adapt.get("_isStarted")){Adapt.set("_isStarted",false)}this.loadCourseData(language)}},{key:"loadCourseData",value:function(){var _loadCourseData=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(newLanguage){var language,courseFolder;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:language=Adapt.config.get("_activeLanguage");courseFolder="course/"+language+"/";$("html").attr("lang",language);_context2.next=5;return this.loadManifestFiles(courseFolder);case 5:_context2.next=7;return this.triggerDataLoaded();case 7:_context2.next=9;return this.triggerDataReady(newLanguage);case 9:this.triggerInit();case 10:case"end":return _context2.stop();}}},_callee2,this)}));function loadCourseData(_x){return _loadCourseData.apply(this,arguments)}return loadCourseData}()},{key:"getJSON",value:function getJSON(path){return new Promise(function(resolve,reject){$.getJSON(path,function(data){data.__path__=path;resolve(data)}).fail(reject)})}},{key:"loadManifestFiles",value:function(){var _loadManifestFiles=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(languagePath){var _this=this;var manifestPath,manifest,allFileData,allModelData,course;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:this.trigger("loading");this.reset();manifestPath=languagePath+"language_data_manifest.js";_context3.prev=3;_context3.next=6;return this.getJSON(manifestPath);case 6:manifest=_context3.sent;_context3.next=13;break;case 9:_context3.prev=9;_context3.t0=_context3["catch"](3);manifest=["course.json","contentObjects.json","articles.json","blocks.json","components.json"];Adapt.log.warnOnce("Manifest path '".concat(manifestPath," not found. Using traditional files: ").concat(manifest.join(", ")));case 13:_context3.next=15;return Promise.all(manifest.map(function(filePath){return _this.getJSON("".concat(languagePath).concat(filePath))}));case 15:allFileData=_context3.sent;allModelData=allFileData.reduce(function(result,fileData){if(Array.isArray(fileData)){result.push.apply(result,_toConsumableArray(fileData))}else if(fileData instanceof Object){result.push(fileData)}else{Adapt.log.warnOnce("File data isn't an array or object: ".concat(fileData.__path__))}return result},[]);course=allModelData.find(function(modelData){return modelData._type==="course"});if(course){_context3.next=20;break}throw new Error("Expected a model data with \"_type\": \"course\", none found.");case 20:Adapt.trigger("courseModel:dataLoading");Adapt.course=this.push(course);Adapt.trigger("courseModel:dataLoaded");allModelData.forEach(function(modelData){if(modelData._type==="course"){return}_this.push(modelData)});this.trigger("reset");this.trigger("loaded");_context3.next=28;return Adapt.wait.queue();case 28:case"end":return _context3.stop();}}},_callee3,this,[[3,9]])}));function loadManifestFiles(_x2){return _loadManifestFiles.apply(this,arguments)}return loadManifestFiles}()},{key:"triggerDataLoaded",value:function(){var _triggerDataLoaded=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:Adapt.log.debug("Firing app:dataLoaded");try{this.forEach(function(model){var _model$setupModel;return(_model$setupModel=model.setupModel)===null||_model$setupModel===void 0?void 0:_model$setupModel.call(model)});Adapt.trigger("app:dataLoaded")}catch(e){Adapt.log.error("Error during app:dataLoading trigger",e)}_context4.next=4;return Adapt.wait.queue();case 4:case"end":return _context4.stop();}}},_callee4,this)}));function triggerDataLoaded(){return _triggerDataLoaded.apply(this,arguments)}return triggerDataLoaded}()},{key:"triggerDataReady",value:function(){var _triggerDataReady=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(newLanguage){return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(newLanguage){Adapt.trigger("app:languageChanged",newLanguage);this.performStartController()}Adapt.log.debug("Firing app:dataReady");try{Adapt.trigger("app:dataReady")}catch(e){Adapt.log.error("Error during app:dataReady trigger",e)}_context5.next=5;return Adapt.wait.queue();case 5:case"end":return _context5.stop();}}},_callee5,this)}));function triggerDataReady(_x3){return _triggerDataReady.apply(this,arguments)}return triggerDataReady}()},{key:"performStartController",value:function performStartController(){Adapt.startController.loadCourseData();var hash=Adapt.startController.isEnabled()?Adapt.startController.getStartHash(false):"#/";Adapt.router.navigate(hash,{trigger:true,replace:true})}},{key:"triggerInit",value:function triggerInit(){this.isReady=true;this.trigger("ready")}},{key:"whenReady",value:function whenReady(){var _this2=this;if(this.isReady)return Promise.resolve();return new Promise(function(resolve){_this2.once("ready",resolve)})}},{key:"findById",value:function findById(id){var model=this._byAdaptID[id];if(!model){console.warn("Adapt.findById() unable to find id: ".concat(id));return}return model}},{key:"findByTrackingPosition",value:function findByTrackingPosition(trackingPosition){var _trackingPosition=_slicedToArray(trackingPosition,2),trackingId=_trackingPosition[0],indexInTrackingIdDescendants=_trackingPosition[1];var trackingIdModel=this.find(function(model){return model.get("_trackingId")===trackingId});if(!trackingIdModel){console.warn("Adapt.findByTrackingPosition() unable to find trackingPosition: ".concat(trackingPosition));return}if(indexInTrackingIdDescendants>=0){var trackingIdDescendants=[trackingIdModel].concat(trackingIdModel.getAllDescendantModels(true));return trackingIdDescendants[indexInTrackingIdDescendants]}var trackingIdAncestors=trackingIdModel.getAncestorModels();var ancestorDistance=Math.abs(indexInTrackingIdDescendants)-1;return trackingIdAncestors[ancestorDistance]}}]);return Data}(AdaptCollection);var Data$1=__AMD("core/js/data",Adapt.data=new Data);var OfflineStorage$2=function(_Backbone$Controller){_inherits(OfflineStorage,_Backbone$Controller);var _super=_createSuper(OfflineStorage);function OfflineStorage(){_classCallCheck(this,OfflineStorage);return _super.apply(this,arguments)}_createClass(OfflineStorage,[{key:"initialize",value:function initialize(handler){this.ready=true;this._handler=undefined;if(!handler){return}this.ready=false;this._handler=handler}},{key:"hasHandler",value:function hasHandler(){return this._handler!==undefined}},{key:"save",value:function save(){var _this$_handler,_this$_handler$save;Adapt.trigger("tracking:save");return(_this$_handler=this._handler)===null||_this$_handler===void 0?void 0:(_this$_handler$save=_this$_handler.save)===null||_this$_handler$save===void 0?void 0:_this$_handler$save.apply(this._handler,arguments)}},{key:"serialize",value:function serialize(value){var _this$_handler2;if((_this$_handler2=this._handler)!==null&&_this$_handler2!==void 0&&_this$_handler2.serialize){return this._handler.serialize.apply(this._handler,arguments)}return JSON.stringify(value)}},{key:"deserialize",value:function deserialize(value){var _this$_handler3;if((_this$_handler3=this._handler)!==null&&_this$_handler3!==void 0&&_this$_handler3.deserialize){return this._handler.deserialize.apply(this._handler,arguments)}return JSON.parse(value)}},{key:"set",value:function set(name,value){var _this$_handler4;if((_this$_handler4=this._handler)!==null&&_this$_handler4!==void 0&&_this$_handler4.set){return this._handler.set.apply(this._handler,arguments)}this[name]=value}},{key:"get",value:function get(name){var _this$_handler5;if((_this$_handler5=this._handler)!==null&&_this$_handler5!==void 0&&_this$_handler5.get){return this._handler.get.apply(this._handler,arguments)}return this[name]}},{key:"setReadyStatus",value:function setReadyStatus(){this.ready=true;Adapt.trigger("offlineStorage:ready")}}]);return OfflineStorage}(Backbone.Controller);Adapt.offlineStorage=new OfflineStorage$2;__AMD("core/js/offlineStorage",Adapt.offlineStorage);var COMPLETION_STATE=ENUM(["INCOMPLETE","COMPLETED","PASSED","FAILED"]);var COMPLETION_STATE$1=__AMD("core/js/enums/completionStateEnum",COMPLETION_STATE);var Tracking=function(_Backbone$Controller){_inherits(Tracking,_Backbone$Controller);var _super=_createSuper(Tracking);function Tracking(){_classCallCheck(this,Tracking);return _super.apply(this,arguments)}_createClass(Tracking,[{key:"initialize",value:function initialize(){this._config={_requireContentCompleted:true,_requireAssessmentCompleted:false};this._assessmentState=null;Adapt.once("configModel:dataLoaded",this.loadConfig.bind(this));Adapt.on("app:dataReady",this.setupEventListeners.bind(this))}},{key:"setupEventListeners",value:function setupEventListeners(){if(this._config._requireAssessmentCompleted){this.listenTo(Adapt,{"assessment:complete":this.onAssessmentComplete,"assessment:restored":this.onAssessmentRestored})}if(this._config._requireContentCompleted){this.listenTo(Adapt.course,"change:_isComplete",this.checkCompletion)}}},{key:"onAssessmentComplete",value:function onAssessmentComplete(assessmentState){this._assessmentState=assessmentState;this.submitScore();this.checkCompletion()}},{key:"submitScore",value:function submitScore(){if(!this._config._shouldSubmitScore)return;if(this._assessmentState.isPercentageBased){Adapt.offlineStorage.set("score",this._assessmentState.scoreAsPercent,0,100);return}Adapt.offlineStorage.set("score",this._assessmentState.score,this._assessmentState.minScore,this._assessmentState.maxScore)}},{key:"onAssessmentRestored",value:function onAssessmentRestored(assessmentState){this._assessmentState=assessmentState}},{key:"checkCompletion",value:function checkCompletion(){var completionData=this.getCompletionData();if(completionData.status===COMPLETION_STATE$1.INCOMPLETE){return}Adapt.trigger("tracking:complete",completionData);Adapt.log.debug("tracking:complete",completionData)}},{key:"getCompletionData",value:function getCompletionData(){var completionData={status:COMPLETION_STATE$1.INCOMPLETE,assessment:null};if(this._config._requireContentCompleted&&!Adapt.course.get("_isComplete")){return completionData}if(this._config._requireAssessmentCompleted){if(!this._assessmentState){return completionData}completionData.status=this._assessmentState.isPass?COMPLETION_STATE$1.PASSED:COMPLETION_STATE$1.FAILED;completionData.assessment=this._assessmentState;return completionData}completionData.status=COMPLETION_STATE$1.COMPLETED;return completionData}},{key:"loadConfig",value:function loadConfig(){if(Adapt.config.has("_completionCriteria")){this._config=Adapt.config.get("_completionCriteria")}}}]);return Tracking}(Backbone.Controller);Adapt.tracking=new Tracking;__AMD("core/js/tracking",Adapt.tracking);var Device=function(_Backbone$Controller){_inherits(Device,_Backbone$Controller);var _super=_createSuper(Device);function Device(){_classCallCheck(this,Device);return _super.apply(this,arguments)}_createClass(Device,[{key:"initialize",value:function initialize(){this.$html=$("html");this.$window=$(window);this.touch=Modernizr.touchevents;this.screenWidth=this.getScreenWidth();this.screenHeight=this.getScreenHeight();this.browser=(Bowser__default["default"].name||"").toLowerCase();this.version=(Bowser__default["default"].version||"").toLowerCase();this.OS=this.getOperatingSystem().toLowerCase();this.osVersion=Bowser__default["default"].osversion||"";this.renderingEngine=this.getRenderingEngine();this.onWindowResize=_.debounce(this.onWindowResize.bind(this),100);this.listenTo(Adapt,{"configModel:dataLoaded":this.onConfigDataLoaded});var browser=this.browser.toLowerCase();var browserString=browser.replace(/msie|internet explorer/,"ie");browserString+=" version-".concat(this.version," OS-").concat(this.OS," ").concat(this.getAppleDeviceType());browserString+=browserString.replace(".","-").toLowerCase();browserString+=" pixel-density-".concat(this.pixelDensity());this.$html.addClass(browserString)}},{key:"orientation",get:function(){return this.screenWidth>=this.screenHeight?"landscape":"portrait"}},{key:"aspectRatio",get:function(){return this.screenWidth/this.screenHeight}},{key:"onConfigDataLoaded",value:function onConfigDataLoaded(){this.screenSize=this.checkScreenSize();this.$html.addClass("size-"+this.screenSize);if(this.orientation){this.$html.addClass("orientation-"+this.orientation)}this.$window.on("resize orientationchange",this.onWindowResize)}},{key:"checkScreenSize",value:function checkScreenSize(){var screenSizeConfig=Adapt.config.get("screenSize");var screenSize;var screensizeEmThreshold=300;var baseFontSize=16;var mediumEmBreakpoint=screenSizeConfig.medium>screensizeEmThreshold?screenSizeConfig.medium/baseFontSize:screenSizeConfig.medium;var smallEmBreakpoint=screenSizeConfig.small>screensizeEmThreshold?screenSizeConfig.small/baseFontSize:screenSizeConfig.small;var fontSize=parseFloat($("html").css("font-size"));var screenSizeEmWidth=this.screenWidth/fontSize;if(screenSizeEmWidth>=mediumEmBreakpoint){screenSize="large"}else if(screenSizeEmWidth>=smallEmBreakpoint){screenSize="medium"}else{screenSize="small"}return screenSize}},{key:"getScreenWidth",value:function getScreenWidth(){return this.isAppleDevice()?this.getAppleScreenWidth():window.innerWidth||this.$window.width()}},{key:"getScreenHeight",value:function getScreenHeight(){return this.isAppleDevice()?this.getAppleScreenHeight():window.innerHeight||this.$window.height()}},{key:"getOperatingSystem",value:function getOperatingSystem(){var flags=["windows","mac","linux","windowsphone","chromeos","android","ios","blackberry","firefoxos","webos","bada","tizen","sailfish"];var os=flags.find(function(name){return Bowser__default["default"][name]})||"";if(os===""){var platform=navigator.platform.toLowerCase();var match=platform.match(/win|mac|linux/);if(match)os=match[0];if(os==="win")os="windows";if(!os)os="PlatformUnknown"}return os}},{key:"getRenderingEngine",value:function getRenderingEngine(){var flags=["webkit","blink","gecko","msie","msedge"];return flags.find(function(name){return Bowser__default["default"][name]})||""}},{key:"onWindowResize",value:function onWindowResize(){var previousWidth=this.screenWidth;var previousHeight=this.screenHeight;this.screenWidth=this.getScreenWidth();this.screenHeight=this.getScreenHeight();if(previousWidth===this.screenWidth&&previousHeight===this.screenHeight){return}var newScreenSize=this.checkScreenSize();if(newScreenSize!==this.screenSize){this.screenSize=newScreenSize;this.$html.removeClass("size-small size-medium size-large").addClass("size-"+this.screenSize);if(this.orientation){this.$html.removeClass("orientation-landscape orientation-portrait").addClass("orientation-"+this.orientation)}Adapt.trigger("device:changed",this.screenSize)}Adapt.trigger("device:preResize device:resize device:postResize",this.screenWidth)}},{key:"isAppleDevice",value:function isAppleDevice(){return /iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}},{key:"getAppleScreenWidth",value:function getAppleScreenWidth(){return Math.abs(window.orientation)===90?window.screen.height:window.screen.width}},{key:"getAppleScreenHeight",value:function getAppleScreenHeight(){return Math.abs(window.orientation)===90?window.screen.width:window.screen.height}},{key:"getAppleDeviceType",value:function getAppleDeviceType(){var flags=["iphone","ipad","ipod"];return flags.find(function(name){return Bowser__default["default"][name]})||""}},{key:"pixelDensity",value:function pixelDensity(){var pixelDensity=window.devicePixelRatio||1;if(pixelDensity>=3){return"ultra-high"}else if(pixelDensity>=2){return"high"}else if(pixelDensity>=1.5){return"medium"}else{return"low"}}}]);return Device}(Backbone.Controller);__AMD("core/js/device",Adapt.device=new Device);var DrawerItemView=function(_Backbone$View){_inherits(DrawerItemView,_Backbone$View);var _super=_createSuper(DrawerItemView);function DrawerItemView(){_classCallCheck(this,DrawerItemView);return _super.apply(this,arguments)}_createClass(DrawerItemView,[{key:"className",value:function className(){return"drawer__menu drawer__item"}},{key:"attributes",value:function attributes(){return{role:"list"}}},{key:"initialize",value:function initialize(){this.listenTo(Adapt,"drawer:empty",this.remove);this.render()}},{key:"events",value:function events(){return{"click .drawer__item-btn":"onDrawerItemClicked"}}},{key:"render",value:function render(){var data=this.model.toJSON();var template=Handlebars.templates["drawerItem"];$(this.el).html(template(data)).appendTo(".drawer__holder");return this}},{key:"onDrawerItemClicked",value:function onDrawerItemClicked(event){event.preventDefault();var eventCallback=this.model.get("eventCallback");Adapt.trigger(eventCallback)}}]);return DrawerItemView}(Backbone.View);DrawerItemView.type="drawerItem";var DrawerItemView$1=__AMD("core/js/views/drawerItemView",DrawerItemView);var DrawerView=function(_Backbone$View){_inherits(DrawerView,_Backbone$View);var _super=_createSuper(DrawerView);function DrawerView(){_classCallCheck(this,DrawerView);return _super.apply(this,arguments)}_createClass(DrawerView,[{key:"className",value:function className(){return"drawer u-display-none"}},{key:"attributes",value:function attributes(){return{"role":"dialog","aria-modal":"true","aria-labelledby":"drawer-heading","aria-hidden":"true"}}},{key:"initialize",value:function initialize(){var _Adapt$config$get$_du,_Adapt$config$get;this._isVisible=false;this.disableAnimation=Adapt.config.has("_disableAnimation")?Adapt.config.get("_disableAnimation"):false;this.drawerDir=Adapt.config.get("_defaultDirection")==="rtl"?"left":"right";this.drawerDuration=(_Adapt$config$get$_du=(_Adapt$config$get=Adapt.config.get("_drawer"))===null||_Adapt$config$get===void 0?void 0:_Adapt$config$get._duration)!==null&&_Adapt$config$get$_du!==void 0?_Adapt$config$get$_du:400;this.setupEventListeners();this.render()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(Adapt,{"navigation:toggleDrawer":this.toggleDrawer,"drawer:triggerCustomView":this.openCustomView,"drawer:closeDrawer":this.onCloseDrawer,"remove":this.onRemove,"drawer:remove":this.remove});this.onKeyUp=this.onKeyUp.bind(this);this.setupEscapeKey()}},{key:"setupEscapeKey",value:function setupEscapeKey(){$(window).on("keyup",this.onKeyUp)}},{key:"onKeyUp",value:function onKeyUp(event){if(event.which!==27)return;event.preventDefault();this.onCloseDrawer()}},{key:"events",value:function events(){return{"click .drawer__back":"onBackButtonClicked","click .drawer__close":"onCloseClicked"}}},{key:"render",value:function render(){var template=Handlebars.templates.drawer;$(this.el).html(template({_globals:Adapt.course.get("_globals")})).prependTo("body");var shadowTemplate=Handlebars.templates.shadow;$(shadowTemplate()).prependTo("body");_.defer(this.postRender.bind(this));return this}},{key:"postRender",value:function postRender(){this.$("a, button, input, select, textarea").attr("tabindex",-1);this.checkIfDrawerIsAvailable()}},{key:"openCustomView",value:function openCustomView(view,hasBackButton){this._hasBackButton=hasBackButton;this._isCustomViewVisible=true;Adapt.trigger("drawer:empty");this.showDrawer();this.$(".drawer__holder").html(view)}},{key:"checkIfDrawerIsAvailable",value:function checkIfDrawerIsAvailable(){var isEmptyDrawer=this.collection.length===0;$(".js-nav-drawer-btn").toggleClass("u-display-none",isEmptyDrawer);if(isEmptyDrawer){Adapt.trigger("drawer:noItems")}}},{key:"onBackButtonClicked",value:function onBackButtonClicked(event){event.preventDefault();this.showDrawer(true)}},{key:"onCloseClicked",value:function onCloseClicked(event){event.preventDefault();this.hideDrawer()}},{key:"onCloseDrawer",value:function onCloseDrawer($toElement){this.hideDrawer($toElement)}},{key:"onRemove",value:function onRemove(){this.hideDrawer()}},{key:"toggleDrawer",value:function toggleDrawer(){if(this._isVisible&&this._isCustomViewVisible===false){this.hideDrawer();return}this.showDrawer(true)}},{key:"showDrawer",value:function showDrawer(emptyDrawer){var _this=this;this.$el.removeClass("u-display-none").removeAttr("aria-hidden");if(!this._isVisible){Adapt.a11y.popupOpened(this.$el);Adapt.a11y.scrollDisable("body");this._isVisible=true}this.$("a, button, input, select, textarea").attr("tabindex",0);if(emptyDrawer){this.$(".drawer__back").addClass("u-display-none");this._isCustomViewVisible=false;this.emptyDrawer();if(this.collection.models.length===1){Adapt.trigger(this.collection.models[0].get("eventCallback"));this._isCustomViewVisible=false}else{this.renderItems();Adapt.trigger("drawer:openedItemView")}}else{var hideDrawerBackButton=!this._hasBackButton||this.collection.models.length<=1;this.$(".drawer__back").toggleClass("u-display-none",hideDrawerBackButton);Adapt.trigger("drawer:openedCustomView")}var complete=function(){_this.addShadowEvent();Adapt.trigger("drawer:opened");Adapt.a11y.focusFirst(_this.$el,{defer:true})};var direction={};if(this.disableAnimation){$(".js-shadow").removeClass("u-display-none");$(".js-drawer-holder").scrollTop(0);direction[this.drawerDir]=0;this.$el.css(direction);complete()}else{var _Adapt$config$get2;$(".js-shadow").velocity({opacity:1},{duration:this.drawerDuration,begin:function(){$(".js-shadow").removeClass("u-display-none");$(".js-drawer-holder").scrollTop(0);complete()}});var easing=((_Adapt$config$get2=Adapt.config.get("_drawer"))===null||_Adapt$config$get2===void 0?void 0:_Adapt$config$get2._showEasing)||"easeOutQuart";direction[this.drawerDir]=0;this.$el.velocity(direction,this.drawerDuration,easing)}}},{key:"emptyDrawer",value:function emptyDrawer(){this.$(".drawer__holder").empty()}},{key:"renderItems",value:function renderItems(){Adapt.trigger("drawer:empty");this.emptyDrawer();this.collection.forEach(function(model){return new DrawerItemView$1({model:model})})}},{key:"hideDrawer",value:function hideDrawer($toElement){var _this2=this;if(!this._isVisible)return;var direction={};Adapt.a11y.popupClosed($toElement);this._isVisible=false;Adapt.a11y.scrollEnable("body");if(this.disableAnimation){direction[this.drawerDir]=-this.$el.width();this.$el.css(direction).addClass("u-display-none").attr("aria-hidden","true");$(".js-shadow").addClass("u-display-none");Adapt.trigger("drawer:closed")}else{var _Adapt$config$get3;var easing=((_Adapt$config$get3=Adapt.config.get("_drawer"))===null||_Adapt$config$get3===void 0?void 0:_Adapt$config$get3._hideEasing)||"easeInQuart";direction[this.drawerDir]=-this.$el.width();this.$el.velocity(direction,this.drawerDuration,easing,function(){_this2.$el.addClass("u-display-none").attr("aria-hidden","true");Adapt.trigger("drawer:closed")});$(".js-shadow").velocity({opacity:0},{duration:this.drawerDuration,complete:function(){$(".js-shadow").addClass("u-display-none")}})}this._isCustomViewVisible=false;this.removeShadowEvent()}},{key:"addShadowEvent",value:function addShadowEvent(){var _this3=this;$(".js-shadow").one("click touchstart",function(){return _this3.onCloseDrawer()})}},{key:"removeShadowEvent",value:function removeShadowEvent(){$(".js-shadow").off("click touchstart")}},{key:"remove",value:function remove(){_get(_getPrototypeOf(DrawerView.prototype),"remove",this).call(this);$(window).off("keyup",this.onKeyUp);Adapt.trigger("drawer:empty");this.collection.reset();$(".js-shadow").remove()}}]);return DrawerView}(Backbone.View);Object.assign(DrawerView,{childContainer:".js-drawer-holder",childView:DrawerItemView$1});var DrawerView$1=__AMD("core/js/views/drawerView",DrawerView);var DrawerCollection=new Backbone.Collection(null,{comparator:"drawerOrder"});var Drawer={};Drawer.addItem=function(drawerObject,eventCallback){drawerObject.eventCallback=eventCallback;DrawerCollection.add(drawerObject)};Drawer.triggerCustomView=function(view,hasBackButton){if(hasBackButton!==false){hasBackButton=true}Adapt.trigger("drawer:triggerCustomView",view,hasBackButton)};Adapt.on({"adapt:start":function(){new DrawerView$1({collection:DrawerCollection})},"app:languageChanged":function(){Adapt.trigger("drawer:remove")}});__AMD("core/js/drawer",Adapt.drawer=Drawer);var NotifyPushView=__AMD("core/js/views/notifyPushView",function(_Backbone$View){_inherits(NotifyPushView,_Backbone$View);var _super=_createSuper(NotifyPushView);function NotifyPushView(){_classCallCheck(this,NotifyPushView);return _super.apply(this,arguments)}_createClass(NotifyPushView,[{key:"className",value:function className(){var classes="notify-push ";classes+=this.model.get("_classes")||"";return classes}},{key:"attributes",value:function attributes(){return{"role":"dialog","aria-labelledby":"notify-push-heading","aria-modal":"false"}}},{key:"initialize",value:function initialize(){this.listenTo(Adapt,{"notify:pushShown notify:pushRemoved":this.updateIndexPosition,"remove":this.remove});this.listenTo(this.model.collection,{"remove":this.updateIndexPosition,"change:_index":this.updatePushPosition});this.preRender();this.render()}},{key:"events",value:function events(){return{"click .js-notify-push-close-btn":"closePush","click .js-notify-push-inner":"triggerEvent"}}},{key:"preRender",value:function preRender(){this.hasBeenRemoved=false}},{key:"render",value:function render(){var data=this.model.toJSON();var template=Handlebars.templates["notifyPush"];this.$el.html(template(data)).appendTo("#wrapper");_.defer(this.postRender.bind(this));return this}},{key:"postRender",value:function postRender(){this.$el.addClass("is-active");_.delay(this.closePush.bind(this),this.model.get("_timeout"));Adapt.trigger("notify:pushShown")}},{key:"closePush",value:function closePush(event){var _this=this;if(event){event.preventDefault()}if(this.hasBeenRemoved===false){this.hasBeenRemoved=true;this.$el.removeClass("is-active");_.delay(function(){_this.model.collection.remove(_this.model);Adapt.trigger("notify:pushRemoved",_this);_this.remove()},600)}}},{key:"triggerEvent",value:function triggerEvent(event){Adapt.trigger(this.model.get("_callbackEvent"));this.closePush()}},{key:"updateIndexPosition",value:function updateIndexPosition(){var _this2=this;if(this.hasBeenRemoved)return;var models=this.model.collection.models;models.forEach(function(model,index){if(!model.get("_isActive"))return;model.set("_index",index);_this2.updatePushPosition()})}},{key:"updatePushPosition",value:function updatePushPosition(){if(this.hasBeenRemoved){return}if(typeof this.model.get("_index")!=="undefined"){var elementHeight=this.$el.height();var offset=20;var navigationHeight=$(".nav").height();var currentIndex=this.model.get("_index");var flippedIndex=currentIndex===0?1:0;if(this.model.collection.where({_isActive:true}).length===1){flippedIndex=0}var positionLowerPush=(elementHeight+offset)*flippedIndex+navigationHeight+offset;this.$el.css("top",positionLowerPush)}}}]);return NotifyPushView}(Backbone.View));var NotifyModel=__AMD("core/js/models/notifyModel",function(_LockingModel){_inherits(NotifyModel,_LockingModel);var _super=_createSuper(NotifyModel);function NotifyModel(){_classCallCheck(this,NotifyModel);return _super.apply(this,arguments)}_createClass(NotifyModel,[{key:"defaults",value:function defaults(){return{_isActive:false,_showIcon:false,_timeout:3000}}}]);return NotifyModel}(LockingModel));var NotifyPushCollection=__AMD("core/js/collections/notifyPushCollection",function(_Backbone$Collection){_inherits(NotifyPushCollection,_Backbone$Collection);var _super=_createSuper(NotifyPushCollection);function NotifyPushCollection(){_classCallCheck(this,NotifyPushCollection);return _super.apply(this,arguments)}_createClass(NotifyPushCollection,[{key:"initialize",value:function initialize(){this.model=NotifyModel;this.listenTo(this,"add",this.onPushAdded);this.listenTo(Adapt,"notify:pushRemoved",this.onRemovePush)}},{key:"onPushAdded",value:function onPushAdded(model){this.checkPushCanShow(model)}},{key:"checkPushCanShow",value:function checkPushCanShow(model){if(!this.canShowPush())return;model.set("_isActive",true);this.showPush(model)}},{key:"canShowPush",value:function canShowPush(){var availablePushNotifications=this.where({_isActive:true});return availablePushNotifications.length<2}},{key:"showPush",value:function showPush(model){new NotifyPushView({model:model})}},{key:"onRemovePush",value:function onRemovePush(view){var inactivePushNotifications=this.where({_isActive:false});if(inactivePushNotifications.length>0){this.checkPushCanShow(inactivePushNotifications[0])}}}]);return NotifyPushCollection}(Backbone.Collection));var ChildEvent=__AMD("core/js/childEvent",function(_Backbone$Controller){_inherits(ChildEvent,_Backbone$Controller);var _super=_createSuper(ChildEvent);function ChildEvent(){_classCallCheck(this,ChildEvent);return _super.apply(this,arguments)}_createClass(ChildEvent,[{key:"initialize",value:function initialize(type,target,model){this.type=type;this.target=target;this.isForced=false;this.isStoppedImmediate=false;this.isStoppedNext=false;this.hasRequestChild=false;this._model=model}},{key:"model",get:function(){return this._model},set:function(model){if(this.type!=="requestChild"){Adapt.log.warn("Cannot change model in ".concat(this.type," event."));return}if(this._model){Adapt.log.warn("Cannot inject two models in one sitting. ".concat(model.get("_id")," attempts to overwrite ").concat(this._model.get("_id")));return}this._model=model;this.hasRequestChild=true}},{key:"reset",value:function reset(){this.isStoppedImmediate=false;this.isStoppedNext=false}},{key:"force",value:function force(){this.isForced=true}},{key:"stop",value:function stop(){var immediate=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(!immediate){return this.stopNext()}this.isStoppedImmediate=true}},{key:"stopNext",value:function stopNext(){this.isStoppedNext=true}},{key:"close",value:function close(){this.trigger("closed")}}]);return ChildEvent}(Backbone.Controller));var register=__AMD("core/js/reactHelpers",function register(name,component){templates[name]=function(){var mode="reactTemplate";for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}var preRenderEvent=new TemplateRenderEvent("".concat(mode,":preRender"),name,mode,null,args);Adapt.trigger(preRenderEvent.type,preRenderEvent);var value=component.apply(void 0,_toConsumableArray(preRenderEvent.args));var postRenderEvent=new TemplateRenderEvent("".concat(mode,":postRender"),name,mode,value,preRenderEvent.args);Adapt.trigger(postRenderEvent.type,postRenderEvent);return postRenderEvent.value}});(function(){var original=React__default["default"].createElement;React__default["default"].createElement=function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}var name=args[0];var mode="reactElement";var preRenderEvent=new TemplateRenderEvent("".concat(mode,":preRender"),name,mode,null,args);Adapt.trigger(preRenderEvent.type,preRenderEvent);var value=original.apply(void 0,_toConsumableArray(preRenderEvent.args));var postRenderEvent=new TemplateRenderEvent("".concat(mode,":postRender"),name,mode,value,preRenderEvent.args);Adapt.trigger(postRenderEvent.type,postRenderEvent);return postRenderEvent.value}})();var templates={};function html(html){if(!html)return;log.deprecated("reactHelpers.html please use react dangerouslySetInnerHTML instead: https://reactjs.org/docs/dom-elements.html#dangerouslysetinnerhtml");return{__html:html}}function compile(template){for(var _len3=arguments.length,args=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++){args[_key3-1]=arguments[_key3]}var output=Handlebars.compile(template).apply(void 0,args);return output}function classes(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++){args[_key5]=arguments[_key5]}return _.uniq(_.flatten(args).filter(Boolean).join(" ").split(" ")).join(" ")}function prefixClasses(prefixes){for(var _len6=arguments.length,args=new Array(_len6>1?_len6-1:0),_key6=1;_key6<_len6;_key6++){args[_key6-1]=arguments[_key6]}var classes=_.flatten(args).filter(Boolean);var prefixed=_.flatten(prefixes.map(function(prefix){return classes.map(function(className){return"".concat(prefix).concat(className)})}));return _.uniq(prefixed.join(" ").split(" ")).join(" ")}var AdaptView=function(_Backbone$View){_inherits(AdaptView,_Backbone$View);var _super=_createSuper(AdaptView);function AdaptView(){_classCallCheck(this,AdaptView);return _super.apply(this,arguments)}_createClass(AdaptView,[{key:"attributes",value:function attributes(){return{"data-adapt-id":this.model.get("_id")}}},{key:"initialize",value:function initialize(){this.listenTo(this.model,{"change:_isVisible":this.toggleVisibility,"change:_isHidden":this.toggleHidden,"change:_isComplete":this.onIsCompleteChange});this.isJSX=(this.constructor.template||"").includes(".jsx");if(this.isJSX){var _this$model,_this$model$getChildr;this._classSet=new Set(_.result(this,"className").trim().split(/\s+/));this.listenTo(this.model,"all",this.changed);var children=(_this$model=this.model)===null||_this$model===void 0?void 0:(_this$model$getChildr=_this$model.getChildren)===null||_this$model$getChildr===void 0?void 0:_this$model$getChildr.call(_this$model);children&&this.listenTo(children,"all",this.changed);this.listenTo(Adapt,"device:changed",this.changed)}this.model.set({_globals:Adapt.course.get("_globals"),_isReady:false});this._isRemoved=false;if(Adapt.location._currentId===this.model.get("_id")){Adapt.parentView=this}this.preRender();this.render();this.setupOnScreenHandler()}},{key:"preRender",value:function preRender(){}},{key:"postRender",value:function(){var _postRender=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return this.addChildren();case 2:case"end":return _context.stop();}}},_callee,this)}));function postRender(){return _postRender.apply(this,arguments)}return postRender}()},{key:"render",value:function render(){var _this=this;var type=this.constructor.type;Adapt.trigger("".concat(type,"View:preRender view:preRender"),this);if(this.isJSX){this.changed()}else{var data=this.model.toJSON();data.view=this;var template=Handlebars.templates[this.constructor.template];this.$el.html(template(data))}Adapt.trigger("".concat(type,"View:render view:render"),this);_.defer(_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!_this._isRemoved){_context2.next=2;break}return _context2.abrupt("return");case 2:_context2.next=4;return _this.postRender();case 4:Adapt.trigger("".concat(type,"View:postRender view:postRender"),_this);case 5:case"end":return _context2.stop();}}},_callee2)})));return this}},{key:"changed",value:function changed(){var eventName=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!this.isJSX){throw new Error("Cannot call changed on a non-react view")}if(typeof eventName==="string"&&eventName.startsWith("bubble")){return}var props=_objectSpread2(_objectSpread2(_objectSpread2({},this),this.model.toJSON()),{},{_globals:Adapt.course.get("_globals")});var Template=templates[this.constructor.template.replace(".jsx","")];this.updateViewProperties();ReactDOM__default["default"].render(React__default["default"].createElement(Template,props),this.el)}},{key:"updateViewProperties",value:function updateViewProperties(){var _this2=this;var classesToAdd=_.result(this,"className").trim().split(/\s+/);classesToAdd.forEach(function(i){return _this2._classSet.add(i)});var classesToRemove=_toConsumableArray(this._classSet).filter(function(i){return!classesToAdd.includes(i)});classesToRemove.forEach(function(i){return _this2._classSet.delete(i)});this._setAttributes(_objectSpread2(_objectSpread2({},_.result(this,"attributes")),{},{id:_.result(this,"id")}));this.$el.removeClass(classesToRemove).addClass(classesToAdd)}},{key:"setupOnScreenHandler",value:function setupOnScreenHandler(){var _this3=this;var onscreen=this.model.get("_onScreen");if(!(onscreen!==null&&onscreen!==void 0&&onscreen._isEnabled))return;this.$el.addClass("has-animation ".concat(onscreen._classes,"-before"));this.$el.on("onscreen.adaptView",function(e,m){if(!m.onscreen)return;var minVerticalInview=onscreen._percentInviewVertical||33;if(m.percentInviewVertical<minVerticalInview)return;_this3.$el.addClass("".concat(onscreen._classes,"-after")).off("onscreen.adaptView")})}},{key:"addChildren",value:function(){var _addChildren=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var addedCount,models,event,subsequentModels,model,ChildView,childView;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:this.nthChild=this.nthChild||0;_context3.next=3;return this.addDescendants(false);case 3:addedCount=_context3.sent;case 4:models=this.model.getAvailableChildModels();event=this._getAddChildEvent(models[this.nthChild]);if(event){_context3.next=9;break}return _context3.abrupt("break",26);case 9:if(event.isForced){event.reset()}if(!(event.isStoppedImmediate||!event.model)){_context3.next=14;break}subsequentModels=models.slice(this.nthChild);subsequentModels.forEach(function(model){return model.setOnChildren("_isRendered",false)});return _context3.abrupt("break",26);case 14:model=event.model;model.set({_isRendered:true,_nthChild:++this.nthChild});ChildView=this.constructor.childView||Adapt.getViewClass(model);if(ChildView){_context3.next=19;break}throw new Error("The component '".concat(model.attributes._id,"' ('").concat(model.attributes._component,"') has not been installed, and so is not available in your project."));case 19:childView=new ChildView({model:model});this.addChildView(childView);addedCount++;if(!event.isStoppedNext){_context3.next=24;break}return _context3.abrupt("break",26);case 24:_context3.next=4;break;case 26:if(addedCount){_context3.next=28;break}return _context3.abrupt("return",addedCount);case 28:this.model.set("_isReady",false);return _context3.abrupt("return",addedCount);case 30:case"end":return _context3.stop();}}},_callee3,this)}));function addChildren(){return _addChildren.apply(this,arguments)}return addChildren}()},{key:"addChildView",value:function addChildView(childView){var childViews=this.getChildViews()||[];childViews.push(childView);this.setChildViews(childViews);var $parentContainer=this.$(this.constructor.childContainer);switch(childView.model.get("_renderPosition")){case"outer-append":this.$el.append(childView.$el);break;case"inner-append":default:$parentContainer.append(childView.$el);break;}Adapt.trigger("view:childAdded",this,childView);return childView}},{key:"addDescendants",value:function(){var _addDescendants=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(){var addedDescendantCount,childViews,i,l,view;return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:addedDescendantCount=0;childViews=this.getChildViews();if(childViews){_context4.next=4;break}return _context4.abrupt("return",addedDescendantCount);case 4:i=0,l=childViews.length;case 5:if(!(i<l)){_context4.next=20;break}view=childViews[i];if(!view.addChildren){_context4.next=13;break}_context4.next=10;return view.addChildren();case 10:_context4.t0=_context4.sent;_context4.next=14;break;case 13:_context4.t0=0;case 14:addedDescendantCount=_context4.t0;if(!addedDescendantCount){_context4.next=17;break}return _context4.abrupt("break",20);case 17:i++;_context4.next=5;break;case 20:if(addedDescendantCount){_context4.next=23;break}this.model.checkReadyStatus();return _context4.abrupt("return",addedDescendantCount);case 23:this.model.set("_isReady",false);return _context4.abrupt("return",addedDescendantCount);case 25:case"end":return _context4.stop();}}},_callee4,this)}));function addDescendants(){return _addDescendants.apply(this,arguments)}return addDescendants}()},{key:"whenReady",value:function(){var _whenReady=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(){var _this4=this;return regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(!this.model.get("_isReady")){_context5.next=2;break}return _context5.abrupt("return");case 2:return _context5.abrupt("return",new Promise(function(resolve){var onReadyChange=function(model,value){if(!value)return;_this4.stopListening(_this4.model,"change:_isReady",onReadyChange);resolve()};_this4.listenTo(_this4.model,"change:_isReady",onReadyChange);_this4.model.checkReadyStatus()}));case 3:case"end":return _context5.stop();}}},_callee5,this)}));function whenReady(){return _whenReady.apply(this,arguments)}return whenReady}()},{key:"_getAddChildEvent",value:function _getAddChildEvent(model){var isRequestChild=!model;var event=new ChildEvent(null,this,model);if(isRequestChild){var canRequestChild=this.model.get("_canRequestChild");if(!canRequestChild){return}event.type="requestChild";Adapt.trigger("view:requestChild",event);if(!event.hasRequestChild){event.close();return}}event.type="addChild";Adapt.trigger("view:addChild",event);event.close();return event}},{key:"findDescendantViews",value:function findDescendantViews(isParentFirst){var descendants=[];var childViews=this.getChildViews();childViews===null||childViews===void 0?void 0:childViews.forEach(function(view){var _view$findDescendantV;if(isParentFirst)descendants.push(view);var children=(_view$findDescendantV=view.findDescendantViews)===null||_view$findDescendantV===void 0?void 0:_view$findDescendantV.call(view,isParentFirst);if(children)descendants.push.apply(descendants,_toConsumableArray(children));if(!isParentFirst)descendants.push(view)});return descendants}},{key:"setReadyStatus",value:function setReadyStatus(){this.model.set("_isReady",true)}},{key:"setCompletionStatus",value:function setCompletionStatus(){if(!this.model.get("_isVisible"))return;this.model.set({_isComplete:true,_isInteractionComplete:true})}},{key:"resetCompletionStatus",value:function resetCompletionStatus(type){if(!this.model.get("_canReset"))return;var descendantComponents=this.model.findDescendantModels("component");if(descendantComponents.length===0){this.model.reset(type)}else{descendantComponents.forEach(function(model){return model.reset(type)})}}},{key:"preRemove",value:function preRemove(){var type=this.constructor.type;Adapt.trigger("".concat(type,"View:preRemove view:preRemove"),this)}},{key:"remove",value:function remove(){var _this5=this;var type=this.constructor.type;this.preRemove();Adapt.trigger("".concat(type,"View:remove view:remove"),this);this._isRemoved=true;this.stopListening();Adapt.wait.for(function(end){if(_this5.isJSX){ReactDOM__default["default"].unmountComponentAtNode(_this5.el)}_this5.$el.off("onscreen.adaptView");_get(_getPrototypeOf(AdaptView.prototype),"remove",_this5).call(_this5);_.defer(function(){Adapt.trigger("".concat(type,"View:postRemove view:postRemove"),_this5)});end()});return this}},{key:"setVisibility",value:function setVisibility(){return this.model.get("_isVisible")?"":"u-visibility-hidden"}},{key:"toggleVisibility",value:function toggleVisibility(){this.$el.toggleClass("u-visibility-hidden",!this.model.get("_isVisible"))}},{key:"setHidden",value:function setHidden(){return this.model.get("_isHidden")?"u-display-none":""}},{key:"toggleHidden",value:function toggleHidden(){this.$el.toggleClass("u-display-none",this.model.get("_isHidden"))}},{key:"onIsCompleteChange",value:function onIsCompleteChange(model,isComplete){this.$el.toggleClass("is-complete",isComplete)}},{key:"getChildViews",value:function getChildViews(){if(!this._childViews)return this._childViews;return Object.entries(this._childViews).map(function(_ref2){var _ref3=_slicedToArray(_ref2,2);_ref3[0];var value=_ref3[1];return value})}},{key:"setChildViews",value:function setChildViews(value){this._childViews=value}},{key:"childViews",get:function(){Adapt.log.deprecated("view.childViews use view.getChildViews() and view.setChildViews([])");if(Array.isArray(this._childViews)){return _.indexBy(this._childViews,function(view){return view.model.get("_id")})}return this._childViews},set:function(value){Adapt.log.deprecated("view.childViews use view.getChildViews() and view.setChildViews([])");this.setChildViews(value)}}]);return AdaptView}(Backbone.View);AdaptView.className="";var AdaptView$1=__AMD("core/js/views/adaptView",AdaptView);var NotifyView=__AMD("core/js/views/notifyView",function(_Backbone$View){_inherits(NotifyView,_Backbone$View);var _super=_createSuper(NotifyView);function NotifyView(){_classCallCheck(this,NotifyView);return _super.apply(this,arguments)}_createClass(NotifyView,[{key:"className",value:function className(){return"notify ".concat(this.model.get("_classes")||"")}},{key:"attributes",value:function attributes(){return Object.assign({role:"dialog","aria-labelledby":"notify-heading","aria-modal":"true"},this.model.get("_attributes"))}},{key:"events",value:function events(){return{"click .js-notify-btn-alert":"onAlertButtonClicked","click .js-notify-btn-prompt":"onPromptButtonClicked","click .js-notify-close-btn":"onCloseButtonClicked","click .js-notify-shadow-click":"onShadowClicked"}}},{key:"initialize",value:function initialize(){_.bindAll(this,"resetNotifySize","onKeyUp");this.disableAnimation=Adapt.config.get("_disableAnimation")||false;this.isOpen=false;this.hasOpened=false;this.setupEventListeners();this.render()}},{key:"setupEventListeners",value:function setupEventListeners(){this.listenTo(Adapt,{"remove page:scrollTo":this.closeNotify,"notify:resize":this.resetNotifySize,"notify:cancel":this.cancelNotify,"notify:close":this.closeNotify,"device:resize":this.resetNotifySize});this.setupEscapeKey()}},{key:"setupEscapeKey",value:function setupEscapeKey(){$(window).on("keyup",this.onKeyUp)}},{key:"onKeyUp",value:function onKeyUp(event){if(event.which!==27)return;event.preventDefault();this.cancelNotify()}},{key:"render",value:function render(){var data=this.model.toJSON();var template=Handlebars.templates.notify;this.$el.css("visibility","hidden");this.$el.html(template(data)).appendTo("body");this.$(".notify__popup").css("visibility","hidden");this.$el.css("visibility","visible");this.showNotify();return this}},{key:"onAlertButtonClicked",value:function onAlertButtonClicked(event){event.preventDefault();this.closeNotify();Adapt.trigger(this.model.get("_callbackEvent"),this)}},{key:"onPromptButtonClicked",value:function onPromptButtonClicked(event){event.preventDefault();this.closeNotify();Adapt.trigger($(event.currentTarget).attr("data-event"),this)}},{key:"onCloseButtonClicked",value:function onCloseButtonClicked(event){event.preventDefault();this.cancelNotify()}},{key:"onShadowClicked",value:function onShadowClicked(event){event.preventDefault();if(this.model.get("_closeOnShadowClick")===false)return;this.cancelNotify()}},{key:"cancelNotify",value:function cancelNotify(){if(this.model.get("_isCancellable")===false)return;this.closeNotify();Adapt.trigger("notify:cancelled",this)}},{key:"resetNotifySize",value:function resetNotifySize(){if(!this.hasOpened)return;this.resizeNotify()}},{key:"resizeNotify",value:function resizeNotify(){var windowHeight=$(window).height();var notifyHeight=this.$(".notify__popup-inner").outerHeight();var isFullWindow=notifyHeight>=windowHeight;this.$(".notify__popup").css({"height":isFullWindow?"100%":"auto","top":isFullWindow?0:"","margin-top":isFullWindow?"":-(notifyHeight/2),"overflow-y":isFullWindow?"scroll":"","-webkit-overflow-scrolling":isFullWindow?"touch":""})}},{key:"showNotify",value:function(){var _showNotify=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:this.isOpen=true;_context.next=3;return this.addSubView();case 3:Adapt.notify.stack.push(this);this.$previousActiveElement=$(document.activeElement);Adapt.trigger("notify:opened",this);this.$el.imageready(this.onLoaded.bind(this));case 7:case"end":return _context.stop();}}},_callee,this)}));function showNotify(){return _showNotify.apply(this,arguments)}return showNotify}()},{key:"onLoaded",value:function onLoaded(){var _this=this;if(this.disableAnimation){this.$(".notify__shadow").css("display","block")}else{this.$(".notify__shadow").velocity({opacity:0},{duration:0}).velocity({opacity:1},{duration:400,begin:function(){_this.$(".notify__shadow").css("display","block")}})}this.resizeNotify();if(this.disableAnimation){this.$(".notify__popup").css("visibility","visible");this.onOpened()}else{this.$(".notify__popup").velocity({opacity:0},{duration:0}).velocity({opacity:1},{duration:400,begin:function(){_this.$(".notify__popup").css("visibility","visible");_this.onOpened()}})}}},{key:"onOpened",value:function onOpened(){$.inview();this.hasOpened=true;Adapt.a11y.popupOpened(this.$(".notify__popup"));Adapt.a11y.scrollDisable("body");$("html").addClass("notify");Adapt.a11y.focusFirst(this.$(".notify__popup"),{defer:false})}},{key:"addSubView",value:function(){var _addSubView=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var _this2=this;var model,View;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:this.subView=this.model.get("_view");if(this.model.get("_id")){model=Adapt.findById(this.model.get("_id"));View=Adapt.getViewClass(model);this.subView=new View({model:model})}if(this.subView){_context2.next=4;break}return _context2.abrupt("return");case 4:this.subView.$el.on("resize",this.resetNotifySize);this.$(".notify__content-inner").prepend(this.subView.$el);if(!(!(this.subView instanceof AdaptView$1)||this.subView.model.get("_isReady"))){_context2.next=8;break}return _context2.abrupt("return");case 8:return _context2.abrupt("return",new Promise(function(resolve){var check=function(model,value){if(!value)return;_this2.subView.model.off("change:_isReady",check);resolve()};_this2.subView.model.on("change:_isReady",check)}));case 9:case"end":return _context2.stop();}}},_callee2,this)}));function addSubView(){return _addSubView.apply(this,arguments)}return addSubView}()},{key:"closeNotify",value:function closeNotify(){var _this3=this;var stackItem=Adapt.notify.stack[Adapt.notify.stack.length-1];if(this!==stackItem)return;Adapt.notify.stack.pop();if(!this.isOpen)return;this.isOpen=false;if(this.hasOpened){this.onCloseReady();return}this.listenToOnce(Adapt,"popup:opened",function(){_.defer(_this3.onCloseReady.bind(_this3))})}},{key:"onCloseReady",value:function onCloseReady(){var _this4=this;if(this.disableAnimation){this.$(".notify__popup").css("visibility","hidden");this.$el.css("visibility","hidden");this.remove()}else{this.$(".notify__popup").velocity({opacity:0},{duration:400,complete:function(){_this4.$(".notify__popup").css("visibility","hidden")}});this.$(".notify__shadow").velocity({opacity:0},{duration:400,complete:function(){_this4.$el.css("visibility","hidden");_this4.remove()}})}Adapt.a11y.scrollEnable("body");$("html").removeClass("notify");Adapt.a11y.popupClosed(this.$previousActiveElement);Adapt.trigger("notify:closed",this)}},{key:"remove",value:function remove(){var _get2;this.removeSubView();$(window).off("keyup",this.onKeyUp);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}(_get2=_get(_getPrototypeOf(NotifyView.prototype),"remove",this)).call.apply(_get2,[this].concat(args))}},{key:"removeSubView",value:function removeSubView(){if(!this.subView)return;this.subView.$el.off("resize",this.resetNotifySize);if(this.subView instanceof AdaptView$1){var views=[].concat(_toConsumableArray(this.subView.findDescendantViews()),[this.subView]);views.forEach(function(view){view.model.set("_isReady",false);view.remove()})}else{this.subView.remove()}this.subView=null}}]);return NotifyView}(Backbone.View));var Notify=function(_Backbone$Controller){_inherits(Notify,_Backbone$Controller);var _super=_createSuper(Notify);function Notify(){_classCallCheck(this,Notify);return _super.apply(this,arguments)}_createClass(Notify,[{key:"initialize",value:function initialize(){this._stack=[];this.notifyPushes=new NotifyPushCollection;this.listenTo(Adapt,{"notify:popup":this._deprecated.bind(this,"popup"),"notify:alert":this._deprecated.bind(this,"alert"),"notify:prompt":this._deprecated.bind(this,"prompt"),"notify:push":this._deprecated.bind(this,"push")})}},{key:"stack",get:function(){return this._stack}},{key:"_deprecated",value:function _deprecated(type,notifyObject){Adapt.log.deprecated("NOTIFY DEPRECATED: Adapt.trigger('notify:".concat(type,"', notifyObject); is no longer supported, please use Adapt.notify.").concat(type,"(notifyObject);"));return this.create(notifyObject,{_type:type})}},{key:"create",value:function create(notifyObject,defaults){notifyObject=_.defaults({},notifyObject,defaults,{_type:"popup",_isCancellable:true,_showCloseButton:true,_closeOnShadowClick:true});if(notifyObject._type==="push"){this.notifyPushes.push(notifyObject);return}return new NotifyView({model:new NotifyModel(notifyObject)})}},{key:"popup",value:function popup(notifyObject){return this.create(notifyObject,{_type:"popup"})}},{key:"alert",value:function alert(notifyObject){return this.create(notifyObject,{_type:"alert"})}},{key:"prompt",value:function prompt(notifyObject){return this.create(notifyObject,{_type:"prompt"})}},{key:"push",value:function push(notifyObject){return this.create(notifyObject,{_type:"push"})}}]);return Notify}(Backbone.Controller);var notify=__AMD("core/js/notify",Adapt.notify=new Notify);var RouterModel=__AMD("core/js/models/routerModel",function(_LockingModel){_inherits(RouterModel,_LockingModel);var _super=_createSuper(RouterModel);function RouterModel(){_classCallCheck(this,RouterModel);return _super.apply(this,arguments)}_createClass(RouterModel,[{key:"defaults",value:function defaults(){return{_canNavigate:true,_shouldNavigateFocus:true}}},{key:"lockedAttributes",value:function lockedAttributes(){return{_canNavigate:false,_shouldNavigateFocus:false}}}]);return RouterModel}(LockingModel));var Router=function(_Backbone$Router){_inherits(Router,_Backbone$Router);var _super=_createSuper(Router);function Router(){_classCallCheck(this,Router);return _super.apply(this,arguments)}_createClass(Router,[{key:"routes",value:function routes(){return{"":"handleRoute","id/:id":"handleRoute",":pluginName(/*location)(/*action)":"handleRoute"}}},{key:"initialize",value:function initialize(_ref){var model=_ref.model;this._isBackward=false;this.model=model;this._navigationRoot=null;this._isCircularNavigationInProgress=false;this.showLoading();this.$wrapper=$("#wrapper");this.$html=$("html");this.listenToOnce(Adapt,"app:dataReady",this.setDocumentTitle);this.listenTo(Adapt,"router:navigateTo",this.navigateToArguments)}},{key:"rootModel",get:function(){return this._navigationRoot||Adapt.course},set:function(model){this._navigationRoot=model}},{key:"showLoading",value:function showLoading(){$(".js-loading").show()}},{key:"hideLoading",value:function hideLoading(){$(".js-loading").hide()}},{key:"setDocumentTitle",value:function setDocumentTitle(){var currentModel=Adapt.location._currentModel;var hasSubTitle=currentModel&&currentModel!==Adapt.router.rootModel&&currentModel.get("title");var title=[this.rootModel.get("title"),hasSubTitle&&currentModel.get("title")].filter(Boolean).join(" | ");this.listenToOnce(Adapt,"contentObjectView:preRender",function(){var escapedTitle=$("<div>".concat(title,"</div>")).text();document.title=escapedTitle})}},{key:"navigateToArguments",value:function navigateToArguments(args){args=args.filter(function(v){return v!==null});var options={trigger:false,replace:false};if(args.length===1&&Adapt.findById(args[0])){this.navigate("#/id/"+args[0],options);return}if(args.length<=3){this.navigate("#/"+args.join("/"),options);return}Adapt.log.deprecated("Use Backbone.history.navigate or window.location.href instead of Adapt.trigger('router:navigateTo')");this.handleRoute.apply(this,_toConsumableArray(args))}},{key:"handleRoute",value:function handleRoute(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}args=args.filter(function(v){return v!==null});if(this.model.get("_canNavigate")){this._isCircularNavigationInProgress=false}if(this._isCircularNavigationInProgress===false){Adapt.trigger("router:navigate",args)}if(this.model.get("_canNavigate")){this.model.set("_canNavigate",false,{pluginName:"adapt"});this._isBackward=false;if(args.length<=1){return this.handleId.apply(this,_toConsumableArray(args))}return this.handlePluginRouter.apply(this,_toConsumableArray(args))}if(this._isCircularNavigationInProgress){this._isCircularNavigationInProgress=false;return}this._isCircularNavigationInProgress=true;Adapt.trigger("router:navigationCancelled",args);Backbone.history.history[this._isBackward?"forward":"back"]();this._isBackward=false}},{key:"handlePluginRouter",value:function(){var _handlePluginRouter=_asyncToGenerator(regeneratorRuntime.mark(function _callee(pluginName,location,action){var pluginLocation;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:pluginLocation=[pluginName,location&&"-".concat(location),action&&"-".concat(action)].filter(Boolean).join("");_context.next=3;return this.updateLocation(pluginLocation,null,null,null);case 3:Adapt.trigger("router:plugin:"+pluginName,pluginName,location,action);Adapt.trigger("router:plugin",pluginName,location,action);this.model.set("_canNavigate",true,{pluginName:"adapt"});case 6:case"end":return _context.stop();}}},_callee,this)}));function handlePluginRouter(_x,_x2,_x3){return _handlePluginRouter.apply(this,arguments)}return handlePluginRouter}()},{key:"handleId",value:function(){var _handleId=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(id){var _this=this;var rootModel,model,isContentObject,navigateToId,isRoot,startController,isCourse,type,location,ViewClass,isMenu;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:rootModel=Adapt.router.rootModel;model=!id?rootModel:Adapt.findById(id);if(model){_context2.next=5;break}this.model.set("_canNavigate",true,{pluginName:"adapt"});return _context2.abrupt("return");case 5:isContentObject=model instanceof ContentObjectModel;navigateToId=model.get("_id");model=isContentObject?model:model.findAncestor("contentobject");id=model.get("_id");isRoot=model===rootModel;if(!(isRoot&&Adapt.course.has("_start"))){_context2.next=14;break}startController=Adapt.course.get("_start");if(!(startController._isEnabled===true&&startController._isMenuDisabled===true)){_context2.next=14;break}return _context2.abrupt("return");case 14:if(!(model.get("_isLocked")&&Adapt.config.get("_forceRouteLocking"))){_context2.next=20;break}Adapt.log.warn("Unable to navigate to locked id: "+id);this.model.set("_canNavigate",true,{pluginName:"adapt"});if(!(Adapt.location._previousId===undefined)){_context2.next=19;break}return _context2.abrupt("return",this.navigate("#/",{trigger:true,replace:true}));case 19:return _context2.abrupt("return",this.navigateBack());case 20:this.showLoading();_context2.next=23;return Adapt.remove();case 23:isCourse=model instanceof CourseModel$1;type=isCourse?"menu":model.get("_type");location=isCourse?"course":"".concat(type,"-").concat(id);model.set("_isVisited",true);_context2.next=29;return this.updateLocation(location,type,id,model);case 29:Adapt.once("contentObjectView:ready",function(){_this.model.set("_canNavigate",true,{pluginName:"adapt"});_this.handleNavigationFocus()});Adapt.trigger("router:".concat(type," router:contentObject"),model);ViewClass=Adapt.getViewClass(model);isMenu=model instanceof MenuModel$1;if(!(!ViewClass&&isMenu)){_context2.next=36;break}Adapt.log.deprecated("Using event based menu view instantiation for '".concat(Adapt.getViewName(model),"'"));return _context2.abrupt("return");case 36:if(isMenu){_context2.next=40;break}_.invoke(model.getAllDescendantModels(),"checkIfResetOnRevisit");_context2.next=40;return Adapt.deferUntilCompletionChecked();case 40:this.$wrapper.append(new ViewClass({model:model}).$el);if(!(!isContentObject&&!this.isScrolling)){_context2.next=44;break}_context2.next=44;return Adapt.navigateToElement("."+navigateToId,{replace:true,duration:400});case 44:case"end":return _context2.stop();}}},_callee2,this)}));function handleId(_x4){return _handleId.apply(this,arguments)}return handleId}()},{key:"updateLocation",value:function(){var _updateLocation=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(currentLocation,type,id,currentModel){return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:Adapt.location._previousModel=Adapt.location._currentModel;Adapt.location._previousId=Adapt.location._currentId;Adapt.location._previousContentType=Adapt.location._contentType;Adapt.location._currentModel=currentModel;Adapt.location._currentId=id;Adapt.location._contentType=type;Adapt.location._currentLocation=currentLocation;if(type==="menu"){Adapt.location._lastVisitedType="menu";Adapt.location._lastVisitedMenu=id}else if(type==="page"){Adapt.location._lastVisitedType="page";Adapt.location._lastVisitedPage=id}this.setDocumentTitle();this.setGlobalClasses();Adapt.trigger("router:location",Adapt.location);_context3.next=13;return Adapt.wait.queue();case 13:case"end":return _context3.stop();}}},_callee3,this)}));function updateLocation(_x5,_x6,_x7,_x8){return _updateLocation.apply(this,arguments)}return updateLocation}()},{key:"setGlobalClasses",value:function setGlobalClasses(){var currentModel=Adapt.location._currentModel;var htmlClasses=(currentModel===null||currentModel===void 0?void 0:currentModel.get("_htmlClasses"))||"";var classes=Adapt.location._currentId?"location-".concat(Adapt.location._contentType," location-id-").concat(Adapt.location._currentId):"location-".concat(Adapt.location._currentLocation);var currentClasses="".concat(classes," ").concat(htmlClasses);this.$html.removeClass(Adapt.location._previousClasses).addClass(currentClasses).attr("data-location",Adapt.location._currentLocation);this.$wrapper.removeClass().addClass(classes).attr("data-location",Adapt.location._currentLocation);Adapt.location._previousClasses=currentClasses}},{key:"handleNavigationFocus",value:function handleNavigationFocus(){if(!this.model.get("_shouldNavigateFocus"))return;Adapt.a11y.focus("body")}},{key:"navigateBack",value:function navigateBack(){this._isBackward=true;Backbone.history.history.back()}},{key:"navigateToCurrentRoute",value:function navigateToCurrentRoute(force){if(!this.model.get("_canNavigate")&&!force){return}if(!Adapt.location._currentId){return}var currentId=Adapt.location._currentModel.get("_id");var isRoot=Adapt.location._currentModel===this.rootModel;var route=isRoot?"#/":"#/id/"+currentId;this.navigate(route,{trigger:true,replace:true})}},{key:"navigateToPreviousRoute",value:function navigateToPreviousRoute(force){if(!this.model.get("_canNavigate")&&!force){return}var currentModel=Adapt.location._currentModel;var previousModel=Adapt.location._previousModel;if(!currentModel){return this.navigateBack()}if(Adapt.location._currentModel instanceof MenuModel$1){return this.navigateToParent()}if(previousModel){return this.navigateBack()}this.navigateToParent()}},{key:"navigateToParent",value:function navigateToParent(force){if(!this.model.get("_canNavigate")&&!force){return}var parentId=Adapt.location._currentModel.get("_parentId");var parentModel=Adapt.findById(parentId);var isRoot=parentModel===this.rootModel;var route=isRoot?"#/":"#/id/"+parentId;this.navigate(route,{trigger:true})}},{key:"navigateToHomeRoute",value:function navigateToHomeRoute(force){if(!this.model.get("_canNavigate")&&!force){return}this.navigate("#/",{trigger:true})}},{key:"navigateToElement",value:function(){var _navigateToElement=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(selector){var _this2=this;var settings,currentModelId,currentModel,shouldReplace,contentObject,contentObjectId,isNotInCurrentContentObject,location,disableScrollToAnimation,$wrapper,offsetTop,_args4=arguments;return regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:settings=_args4.length>1&&_args4[1]!==undefined?_args4[1]:{};currentModelId=selector.replace(/\./g,"").split(" ")[0];currentModel=Adapt.findById(currentModelId);if(!(currentModel&&(!currentModel.get("_isRendered")||!currentModel.get("_isReady")))){_context4.next=17;break}shouldReplace=settings.replace||false;contentObject=currentModel instanceof ContentObjectModel?currentModel:currentModel.findAncestor("contentobject");contentObjectId=contentObject.get("_id");isNotInCurrentContentObject=contentObjectId!==Adapt.location._currentId;if(!isNotInCurrentContentObject){_context4.next=15;break}this.isScrolling=true;this.navigate("#/id/".concat(currentModelId),{trigger:true,replace:shouldReplace});this.model.set("_shouldNavigateFocus",false,{pluginName:"adapt"});_context4.next=14;return new Promise(function(resolve){return Adapt.once("contentObjectView:ready",_.debounce(function(){_this2.model.set("_shouldNavigateFocus",true,{pluginName:"adapt"});resolve()},1))});case 14:this.isScrolling=false;case 15:_context4.next=17;return Adapt.parentView.renderTo(currentModelId);case 17:if(currentModel&&selector===currentModel.get("_id")){selector=".".concat(selector)}location=Adapt.location._contentType?Adapt.location._contentType:Adapt.location._currentLocation;Adapt.trigger("".concat(location,":scrollTo"),selector);disableScrollToAnimation=Adapt.config.has("_disableAnimation")?Adapt.config.get("_disableAnimation"):false;if(disableScrollToAnimation){settings.duration=0}else if(!settings.duration){settings.duration=$.scrollTo.defaults.duration}$wrapper=$("#wrapper");offsetTop=-parseInt($wrapper.css("padding-top"));if($(selector).hasClass("component")){offsetTop-=$(selector).find(".aria-label").height()||0}if(!settings.offset)settings.offset={top:offsetTop,left:0};if(settings.offset.top===undefined)settings.offset.top=offsetTop;if(settings.offset.left===undefined)settings.offset.left=0;if(settings.offset.left===0)settings.axis="y";if(Adapt.get("_canScroll")!==false){$.scrollTo(selector,settings)}_context4.next=32;return new Promise(function(resolve){_.delay(function(){Adapt.a11y.focusNext(selector);Adapt.trigger("".concat(location,":scrolledTo"),selector);resolve()},settings.duration+300)});case 32:case"end":return _context4.stop();}}},_callee4,this)}));function navigateToElement(_x9){return _navigateToElement.apply(this,arguments)}return navigateToElement}()},{key:"get",value:function get(){var _this$model;Adapt.log.deprecated("Adapt.router.get, please use Adapt.router.model.get");return(_this$model=this.model).get.apply(_this$model,arguments)}},{key:"set",value:function set(){var _this$model2;Adapt.log.deprecated("Adapt.router.set, please use Adapt.router.model.set");return(_this$model2=this.model).set.apply(_this$model2,arguments)}}]);return Router}(Backbone.Router);Adapt.router=new Router({model:new RouterModel(null,{reset:true})});Adapt.navigateToElement=Adapt.router.navigateToElement.bind(Adapt.router);var router=__AMD("core/js/router",Adapt.router);var AdaptSubsetCollection=__AMD("core/js/collections/adaptSubsetCollection",function(_AdaptCollection){_inherits(AdaptSubsetCollection,_AdaptCollection);var _super=_createSuper(AdaptSubsetCollection);function AdaptSubsetCollection(){_classCallCheck(this,AdaptSubsetCollection);return _super.apply(this,arguments)}_createClass(AdaptSubsetCollection,[{key:"initialize",value:function initialize(models,options){_get(_getPrototypeOf(AdaptSubsetCollection.prototype),"initialize",this).call(this,models,options);this.parent=options.parent;this.listenTo(this.parent,"reset",this.loadSubset)}},{key:"loadSubset",value:function loadSubset(){var _this=this;this.set(this.parent.filter(function(model){return model instanceof _this.model}));this._byAdaptID=this.groupBy("_id")}}]);return AdaptSubsetCollection}(AdaptCollection));var ArticleModel=function(_AdaptModel){_inherits(ArticleModel,_AdaptModel);var _super=_createSuper(ArticleModel);function ArticleModel(){_classCallCheck(this,ArticleModel);return _super.apply(this,arguments)}_createClass(ArticleModel,[{key:"_parent",get:function(){Adapt.log.deprecated("articleModel._parent, use articleModel.getParent() instead, parent models are defined by the JSON");return"contentObjects"}},{key:"_siblings",get:function(){Adapt.log.deprecated("articleModel._siblings, use articleModel.getSiblings() instead, sibling models are defined by the JSON");return"articles"}},{key:"_children",get:function(){Adapt.log.deprecated("articleModel._children, use articleModel.hasManagedChildren instead, child models are defined by the JSON");return"blocks"}},{key:"getTypeGroup",value:function getTypeGroup(){return"article"}}]);return ArticleModel}(AdaptModel);Adapt.register("article",{model:ArticleModel});var ArticleModel$1=__AMD("core/js/models/articleModel",ArticleModel);var BlockModel=function(_AdaptModel){_inherits(BlockModel,_AdaptModel);var _super=_createSuper(BlockModel);function BlockModel(){_classCallCheck(this,BlockModel);return _super.apply(this,arguments)}_createClass(BlockModel,[{key:"_parent",get:function(){Adapt.log.deprecated("blockModel._parent, use blockModel.getParent() instead, parent models are defined by the JSON");return"articles"}},{key:"_siblings",get:function(){Adapt.log.deprecated("blockModel._siblings, use blockModel.getSiblings() instead, sibling models are defined by the JSON");return"blocks"}},{key:"_children",get:function(){Adapt.log.deprecated("blockModel._children, use blockModel.hasManagedChildren instead, child models are defined by the JSON");return"components"}},{key:"getTypeGroup",value:function getTypeGroup(){return"block"}}]);return BlockModel}(AdaptModel);Adapt.register("block",{model:BlockModel});var BlockModel$1=__AMD("core/js/models/blockModel",BlockModel);var ComponentModel=function(_AdaptModel){_inherits(ComponentModel,_AdaptModel);var _super=_createSuper(ComponentModel);function ComponentModel(){_classCallCheck(this,ComponentModel);return _super.apply(this,arguments)}_createClass(ComponentModel,[{key:"_parent",get:function(){Adapt.log.deprecated("componentModel._parent, use componentModel.getParent() instead, parent models are defined by the JSON");return"blocks"}},{key:"_siblings",get:function(){Adapt.log.deprecated("componentModel._siblings, use componentModel.getSiblings() instead, sibling models are defined by the JSON");return"components"}},{key:"getTypeGroup",value:function getTypeGroup(){return"component"}},{key:"defaults",value:function defaults(){return AdaptModel.resultExtend("defaults",{_isA11yComponentDescriptionEnabled:true,_userAnswer:null,_attemptStates:null})}},{key:"trackable",value:function trackable(){return AdaptModel.resultExtend("trackable",["_userAnswer","_attemptStates"])}},{key:"trackableType",value:function trackableType(){return AdaptModel.resultExtend("trackableType",[Array,Array])}},{key:"hasManagedChildren",get:function(){return false}},{key:"init",value:function init(){if(Adapt.get("_isStarted")){this.onAdaptInitialize();return}this.listenToOnce(Adapt,"adapt:initialize",this.onAdaptInitialize)}},{key:"onAdaptInitialize",value:function onAdaptInitialize(){this.restoreUserAnswers()}},{key:"restoreUserAnswers",value:function restoreUserAnswers(){}},{key:"storeUserAnswer",value:function storeUserAnswer(){}},{key:"resetUserAnswer",value:function resetUserAnswer(){this.set("_userAnswer",null)}},{key:"reset",value:function reset(){var type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"hard";var canReset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.get("_canReset");var wasReset=_get(_getPrototypeOf(ComponentModel.prototype),"reset",this).call(this,type,canReset);if(!wasReset)return false;this.resetUserAnswer();return true}},{key:"getAttemptState",value:function getAttemptState(){var object=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.toJSON();var trackables=this.trackable();var types=this.trackableType();trackables.find(function(name,index){if(name!=="_attemptStates")return;trackables.splice(index,1);types.splice(index,1);return true});var values=trackables.map(function(n){return object[n]});var booleans=values.filter(function(v,i){return types[i]===Boolean}).map(Boolean);var numbers=values.filter(function(v,i){return types[i]===Number}).map(function(v){return Number(v)||0});var arrays=values.filter(function(v,i){return types[i]===Array});return[numbers,booleans,arrays]}},{key:"getAttemptObject",value:function getAttemptObject(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getAttemptState();var trackables=this.trackable();var types=this.trackableType();trackables.find(function(name,index){if(name!=="_attemptStates")return;trackables.splice(index,1);types.splice(index,1);return true});var numbers=(state[0]||[]).slice(0);var booleans=(state[1]||[]).slice(0);var arrays=(state[2]||[]).slice(0);var object={};trackables.forEach(function(n,i){if(n==="_id")return;switch(types[i]){case Number:object[n]=numbers.shift();break;case Boolean:object[n]=booleans.shift();break;case Array:object[n]=arrays.shift();break;}});return object}},{key:"setAttemptObject",value:function setAttemptObject(object){var silent=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;this.set(object,{silent:silent})}},{key:"addAttemptObject",value:function addAttemptObject(){var object=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.getAttemptObject();var attemptStates=this.get("_attemptStates")||[];var state=this.getAttemptState(object);attemptStates.push(state);this.set("_attemptStates",attemptStates)}},{key:"getAttemptObjects",value:function getAttemptObjects(){var _this=this;var states=this.get("_attemptStates")||[];return states.map(function(state){return _this.getAttemptObject(state)})}}]);return ComponentModel}(AdaptModel);Adapt.register("component",{model:ComponentModel});var ComponentModel$1=__AMD("core/js/models/componentModel",ComponentModel);var PageModel=function(_ContentObjectModel){_inherits(PageModel,_ContentObjectModel);var _super=_createSuper(PageModel);function PageModel(){_classCallCheck(this,PageModel);return _super.apply(this,arguments)}_createClass(PageModel,[{key:"_children",get:function(){Adapt.log.deprecated("pageModel._children, use menuModel.hasManagedChildren instead, child models are defined by the JSON");return"articles"}},{key:"getTypeGroup",value:function getTypeGroup(){return"page"}}]);return PageModel}(ContentObjectModel);Adapt.register("page",{model:PageModel});__AMD("core/js/models/pageModel",PageModel);var ContentObjectView=__AMD("core/js/views/contentObjectView",function(_AdaptView){_inherits(ContentObjectView,_AdaptView);var _super=_createSuper(ContentObjectView);function ContentObjectView(){_classCallCheck(this,ContentObjectView);return _super.apply(this,arguments)}_createClass(ContentObjectView,[{key:"attributes",value:function attributes(){return AdaptView$1.resultExtend("attributes",{"role":"main","aria-labelledby":"".concat(this.model.get("_id"),"-heading")},this)}},{key:"className",value:function className(){return[this.constructor.type,"contentobject",this.constructor.className,this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":""].filter(Boolean).join(" ")}},{key:"preRender",value:function preRender(){$.inview.lock(this.constructor.type+"View");this.disableAnimation=Adapt.config.has("_disableAnimation")?Adapt.config.get("_disableAnimation"):false;this.$el.css("opacity",0);this.listenTo(this.model,"change:_isReady",this.isReady)}},{key:"render",value:function render(){var _this=this;var type=this.constructor.type;Adapt.trigger("".concat(type,"View:preRender contentObjectView:preRender view:preRender"),this);if(this.isReact){this.changed()}else{var data=this.model.toJSON();data.view=this;var template=Handlebars.templates[this.constructor.template];this.$el.html(template(data))}Adapt.trigger("".concat(type,"View:render contentObjectView:render view:render"),this);_.defer(function(){if(_this._isRemoved)return;_this.postRender();Adapt.trigger("".concat(type,"View:postRender contentObjectView:postRender view:postRender"),_this)});return this}},{key:"isReady",value:function(){var _isReady=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var _this2=this;var type,performIsReady;return regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(!this.model.get("_isReady")||this._isTriggeredReady)){_context2.next=2;break}return _context2.abrupt("return");case 2:this._isTriggeredReady=true;type=this.constructor.type;performIsReady=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var styleOptions;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:Adapt.trigger("".concat(type,"View:preReady contentObjectView:preReady view:preReady"),_this2);_context.next=3;return Adapt.wait.queue();case 3:$(".js-loading").hide();if(Adapt.get("_shouldContentObjectScrollTop")!==false){$(window).scrollTop(0)}Adapt.trigger("".concat(type,"View:ready contentObjectView:ready view:ready"),_this2);$.inview.unlock("".concat(type,"View"));styleOptions={opacity:1};if(_this2.disableAnimation){_this2.$el.css(styleOptions);$.inview();_.defer(function(){Adapt.trigger("".concat(type,"View:postReady contentObjectView:postReady view:postReady"),_this2)})}else{_this2.$el.velocity(styleOptions,{duration:"fast",complete:function(){$.inview();Adapt.trigger("".concat(type,"View:postReady contentObjectView:postReady view:postReady"),_this2)}})}$(window).scroll();case 10:case"end":return _context.stop();}}},_callee)}));return function performIsReady(){return _ref.apply(this,arguments)}}();_.defer(performIsReady);case 6:case"end":return _context2.stop();}}},_callee2,this)}));function isReady(){return _isReady.apply(this,arguments)}return isReady}()},{key:"renderTo",value:function(){var _renderTo=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(id){var isRenderToSelf,models,index,model,isLocked,ids,forceUntilId;return regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:isRenderToSelf=id===this.model.get("_id");if(!isRenderToSelf){_context3.next=3;break}return _context3.abrupt("return");case 3:models=this.model.getAllDescendantModels(true).filter(function(model){return model.get("_isAvailable")});index=models.findIndex(function(model){return model.get("_id")===id});if(!(index===-1)){_context3.next=7;break}throw new Error("Cannot renderTo \"".concat(id,"\" as it isn't a descendant."));case 7:model=models[index];if(!(model.get("_isRendered")&&model.get("_isReady"))){_context3.next=10;break}return _context3.abrupt("return");case 10:models=models.slice(0,index+1);isLocked=models.some(function(model){return model.get("_isLocked")});if(!isLocked){_context3.next=14;break}throw new Error("Cannot renderTo ".concat(id," as it is preceded by locked content"));case 14:ids=_.indexBy(models,function(model){return model.get("_id")});forceUntilId=function(event){var addingId=event.model.get("_id");if(!ids[addingId])return;event.force();if(addingId!==id)return;Adapt.off("view:addChild",forceUntilId)};Adapt.on("view:addChild",forceUntilId);_context3.next=19;return this.addChildren();case 19:_context3.next=21;return this.whenReady();case 21:if(!(!model.get("_isRendered")||!model.get("_isReady"))){_context3.next=23;break}throw new Error("Cannot renderTo \"".concat(id,"\"."));case 23:case"end":return _context3.stop();}}},_callee3,this)}));function renderTo(_x){return _renderTo.apply(this,arguments)}return renderTo}()},{key:"preRemove",value:function preRemove(){var type=this.constructor.type;Adapt.trigger("".concat(type,"View:preRemove contentObjectView:preRemove view:preRemove"),this)}},{key:"remove",value:function remove(){var _this3=this;var type=this.constructor.type;this.preRemove();Adapt.trigger("".concat(type,"View:remove contentObjectView:remove view:remove"),this);this._isRemoved=true;Adapt.wait.for(function(end){if(_this3.isReact){ReactDOM.unmountComponentAtNode(_this3.el)}_this3.$el.off("onscreen.adaptView");_this3.findDescendantViews().reverse().forEach(function(view){view.remove()});_this3.setChildViews(null);_get(_getPrototypeOf(ContentObjectView.prototype),"remove",_this3).call(_this3);_.defer(function(){Adapt.trigger("".concat(type,"View:postRemove contentObjectView:postRemove view:postRemove"),_this3);_this3.trigger("postRemove")});end()});return this}},{key:"destroy",value:function destroy(){this.remove();if(Adapt.parentView===this){Adapt.parentView=null}}}]);return ContentObjectView}(AdaptView$1));var PageView=function(_ContentObjectView){_inherits(PageView,_ContentObjectView);var _super=_createSuper(PageView);function PageView(){_classCallCheck(this,PageView);return _super.apply(this,arguments)}_createClass(PageView,[{key:"remove",value:function remove(){if(this.$pageLabel){this.$pageLabel.remove()}_get(_getPrototypeOf(PageView.prototype),"remove",this).call(this)}}]);return PageView}(ContentObjectView);Object.assign(PageView,{childContainer:".article__container",type:"page",template:"page"});Adapt.register("page",{view:PageView});__AMD("core/js/views/pageView",PageView);var ArticleView=function(_AdaptView){_inherits(ArticleView,_AdaptView);var _super=_createSuper(ArticleView);function ArticleView(){_classCallCheck(this,ArticleView);return _super.apply(this,arguments)}_createClass(ArticleView,[{key:"className",value:function className(){return["article",this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":""].join(" ")}}]);return ArticleView}(AdaptView$1);Object.assign(ArticleView,{childContainer:".block__container",type:"article",template:"article"});Adapt.register("article",{view:ArticleView});var ArticleView$1=__AMD("core/js/views/articleView",ArticleView);var BlockView=function(_AdaptView){_inherits(BlockView,_AdaptView);var _super=_createSuper(BlockView);function BlockView(){_classCallCheck(this,BlockView);return _super.apply(this,arguments)}_createClass(BlockView,[{key:"className",value:function className(){return["block",this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":""].join(" ")}}]);return BlockView}(AdaptView$1);Object.assign(BlockView,{childContainer:".component__container",type:"block",template:"block"});Adapt.register("block",{view:BlockView});__AMD("core/js/views/blockView",BlockView);var MPABC=function(_Backbone$Controller){_inherits(MPABC,_Backbone$Controller);var _super=_createSuper(MPABC);function MPABC(){_classCallCheck(this,MPABC);return _super.apply(this,arguments)}_createClass(MPABC,[{key:"initialize",value:function initialize(){this.listenTo(Data$1,{loading:this.waitForDataLoaded,loaded:this.onDataLoaded});this.setupSubsetCollections()}},{key:"waitForDataLoaded",value:function waitForDataLoaded(){Adapt.wait.begin()}},{key:"onDataLoaded",value:function onDataLoaded(){Adapt.wait.end()}},{key:"setupSubsetCollections",value:function setupSubsetCollections(){Adapt.contentObjects=new AdaptSubsetCollection(null,{parent:Data$1,model:ContentObjectModel});Adapt.articles=new AdaptSubsetCollection(null,{parent:Data$1,model:ArticleModel$1});Adapt.blocks=new AdaptSubsetCollection(null,{parent:Data$1,model:BlockModel$1});Adapt.components=new AdaptSubsetCollection(null,{parent:Data$1,model:ComponentModel$1})}}]);return MPABC}(Backbone.Controller);__AMD("core/js/mpabc",Adapt.mpabc=new MPABC);var helpers={lowercase:function(text){return text.toLowerCase()},capitalise:function(text){return text.charAt(0).toUpperCase()+text.slice(1)},inc:function(index){return index+1},dec:function(index){return index-1},odd:function(index){return(index+1)%2===0?"even":"odd"},equals:function(value,text,block){return helpers.compare.call(this,value,"==",text,block)},compare:function(value,operator,text,block){switch(operator){case"===":if(value===text)return block.fn(this);break;case"=":case"==":if(value==text)return block.fn(this);break;case">=":if(value>=text)return block.fn(this);break;case"<=":if(value<=text)return block.fn(this);break;case">":if(value>text)return block.fn(this);break;case"<":if(value<text)return block.fn(this);break;}return block.inverse(this)},math:function(lvalue,operator,rvalue,options){lvalue=parseFloat(lvalue);rvalue=parseFloat(rvalue);switch(operator){case"+":return lvalue+rvalue;case"-":return lvalue-rvalue;case"*":return lvalue*rvalue;case"/":return lvalue/rvalue;case"%":return lvalue%rvalue;}},any:function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}var specified=args.slice(0,-1);var block=args.slice(-1)[0];return specified.some(Boolean)?block.fn?block.fn(this):true:block.inverse?block.inverse(this):false},all:function(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}var specified=args.slice(0,-1);var block=args.slice(-1)[0];return specified.every(Boolean)?block.fn?block.fn(this):true:block.inverse?block.inverse(this):false},none:function(){for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3]}var specified=args.slice(0,-1);var block=args.slice(-1)[0];return!specified.some(Boolean)?block.fn?block.fn(this):true:block.inverse?block.inverse(this):false},compile:function(template,context){if(!template){return""}if(template instanceof Object)template=template.toString();var data=this;if(context){var _context$data$root,_context$data;data=(_context$data$root=(_context$data=context.data)===null||_context$data===void 0?void 0:_context$data.root)!==null&&_context$data$root!==void 0?_context$data$root:context}return Handlebars.compile(template)(data)},compile_a11y_text:function(template,context){a11y.log.deprecated("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return helpers.compile.call(this,template,context)},compile_a11y_normalize:function(template,context){if(!template){return""}if(template instanceof Object)template=template.toString();return Handlebars.helpers.a11y_normalize.call(this,helpers.compile.call(this,template,context))},compile_a11y_remove_breaks:function(template,context){if(!template){return""}return Handlebars.helpers.a11y_remove_breaks.call(this,helpers.compile.call(this,template,context))},import_globals:function(context){if(context.data.root._globals){return""}context.data.root._globals=Adapt.course.get("_globals");return""},import_adapt:function(context){if(context.data.root.Adapt){return}var adapt=context.data.root.Adapt={};var i,l,name;var directImport=["config","course"];for(i=0,l=directImport.length;i<l;i++){name=directImport[i];adapt[name]=Adapt[name].toJSON()}var indexedImport=["contentObjects","articles","blocks","components"];for(i=0,l=indexedImport.length;i<l;i++){name=indexedImport[i];var importArray=Adapt[name].toJSON();var importIndex={};for(var i1=0,l1=importArray.length;i1<l1;i1++){var item=importArray[i1];importIndex[item._id]=item}adapt[name]=importIndex}return""},component_description:function(override,context){var _this$_globals$_compo;if(!this._isA11yComponentDescriptionEnabled){return}var isNotDefined=!((_this$_globals$_compo=this._globals._components)!==null&&_this$_globals$_compo!==void 0&&_this$_globals$_compo["_"+this._component]);if(isNotDefined){return}var hasOverride=arguments.length>1;var description;if(hasOverride){description=override;description=helpers.compile(description,context)}else{description=this._globals._components["_"+this._component].ariaRegion;description=helpers.compile(description,override)}if(!description){return}return new Handlebars.SafeString("<div class=\"aria-label\">"+description+"</div>")},a11y_text:function(text){a11y.log.deprecated("a11y_text is no longer required. https://tink.uk/understanding-screen-reader-interaction-modes/");return text},a11y_normalize:function(htmls){return a11y.normalize.apply(a11y,arguments)},a11y_remove_breaks:function(htmls){return a11y.removeBreaks.apply(a11y,arguments)},a11y_aria_label:function(htmls){var values=Array.prototype.slice.call(arguments,0,-1);values=values.filter(Boolean);return new Handlebars.SafeString("<div class=\"aria-label\">"+values.join(" ")+"</div>")},a11y_aria_label_relative:function(htmls){var values=Array.prototype.slice.call(arguments,0,-1);values=values.filter(Boolean);return new Handlebars.SafeString("<div class=\"aria-label relative\">"+values.join(" ")+"</div>")},a11y_aria_image:function(texts){var values=Array.prototype.slice.call(arguments,0,-1);values=values.filter(Boolean);return new Handlebars.SafeString("<div class=\"aria-label\" role=\"img\" aria-label=\""+values.join(" ")+"\"></div>")},a11y_wrap_focus:function(){var cfg=Adapt.config.get("_accessibility");if(cfg._isPopupWrapFocusEnabled===false)return"";return new Handlebars.SafeString("<a class=\"a11y-focusguard a11y-ignore a11y-ignore-focus\" role=\"presentation\">&nbsp;</a>")},a11y_attrs_heading:function(levelOrType){var level=a11y.ariaLevel(levelOrType,this._ariaLevel);return new Handlebars.SafeString(" role=\"heading\" aria-level=\""+level+"\" ")},a11y_attrs_tabbable:function(){a11y.log.deprecated("a11y_attrs_tabbable should not be used. tabbable elements should be natively tabbable.");return new Handlebars.SafeString(" role=\"region\" tabindex=\"0\" ")},a11y_alt_text:function(visible,alternatives){var values=Array.prototype.slice.call(arguments,1,-1);values=values.filter(Boolean);return new Handlebars.SafeString("<span aria-hidden=\"true\">"+visible+"</span><span class=\"aria-label\">"+values.join(" ")+"</span>")}};Object.assign(helpers,{if_value_equals:function(){a11y.log.deprecated("if_value_equals, use equals instead.");return helpers.equals.apply(this,arguments)},numbers:function(){a11y.log.deprecated("numbers, use inc instead.");return helpers.inc.apply(this,arguments)},lowerCase:function(){a11y.log.deprecated("lowerCase, use lowercase instead.");return helpers.lowercase.apply(this,arguments)}});for(var name in helpers){Handlebars.registerHelper(name,helpers[name])}__AMD("core/js/helpers",helpers);var Scrolling=function(_Backbone$Controller){_inherits(Scrolling,_Backbone$Controller);var _super=_createSuper(Scrolling);function Scrolling(){_classCallCheck(this,Scrolling);return _super.apply(this,arguments)}_createClass(Scrolling,[{key:"initialize",value:function initialize(){this.$html=$("html");this.isLegacyScrolling=true;Adapt.once("configModel:dataLoaded",this._loadConfig.bind(this))}},{key:"_loadConfig",value:function _loadConfig(){var config=Adapt.config.get("_scrollingContainer");if(!(config!==null&&config!==void 0&&config._isEnabled))return;var limitTo=config._limitToSelector;var isIncluded=!limitTo||this.$html.is(limitTo)||this.$html.hasClass(limitTo);if(!isIncluded)return;this.isLegacyScrolling=false;this._windowScrollFix();this._addStyling();this._updateScrollbarWidth();this.listenTo(Adapt,"device:resize",this._updateScrollbarWidth)}},{key:"_addStyling",value:function _addStyling(){this.$html.addClass("adapt-scrolling")}},{key:"_updateScrollbarWidth",value:function _updateScrollbarWidth(){var $tester=$("<div class=\"outer\" style=\"overflow:scroll; visibility: hidden; position:fixed; top: 0; left: 0;\"><div class=\"inner\"> </div></div>\"");$("body").append($tester);var scrollBarWidth=$tester.outerWidth()-$tester.find(".inner").outerWidth();$tester.remove();var documentStyle=document.documentElement.style;documentStyle.setProperty("--adapt-scrollbar-width","".concat(scrollBarWidth,"px"))}},{key:"_windowScrollFix",value:function _windowScrollFix(){var body=document.body;var html=Adapt.scrolling.$html[0];var scrollY={get:function(){return body.scrollTop},set:function(value){return body.scrollTop=value}};var scrollX={get:function(){return body.scrollLeft},set:function(value){return body.scrollLeft=value}};var scrollHeight={get:function(){return body.scrollHeight},set:function(value){return body.scrollHeight=value}};var scrollWidth={get:function(){return body.scrollWidth},set:function(value){return body.scrollWidth=value}};Object.defineProperties(window,{scrollY:scrollY,scrollX:scrollX,pageYOffset:scrollY,pageXOffset:scrollX});Object.defineProperties(html,{scrollHeight:scrollHeight,scrollWidth:scrollWidth});window.scrollTo=function(){var _ref,_ref2;for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}var isObject=args.length===1&&_typeof(args[0])==="object"&&args[0]!==null;var left=(_ref=isObject?args[0].left:args[0])!==null&&_ref!==void 0?_ref:null;var top=(_ref2=isObject?args[0].top:args[1])!==null&&_ref2!==void 0?_ref2:null;left!==null&&(body.scrollLeft=left);top!==null&&(body.scrollTop=top)};var MouseEvent=window.MouseEvent;Object.defineProperties(MouseEvent.prototype,{pageX:{get:function(){return this.clientX+scrollX.get()}},pageY:{get:function(){return this.clientY+scrollY.get()}}});var $window=$(window);$(document.body).on("scroll",function(){return $window.scroll()})}},{key:"scrollTo",value:function(){var _scrollTo=_asyncToGenerator(regeneratorRuntime.mark(function _callee(selector){var settings,_args=arguments;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:settings=_args.length>1&&_args[1]!==undefined?_args[1]:{};Adapt.log.deprecated("Adapt.scrollTo and Adapt.scrolling.scrollTo, use Adapt.navigateToElement instead.");return _context.abrupt("return",Adapt.router.navigateToElement(selector,settings));case 3:case"end":return _context.stop();}}},_callee)}));function scrollTo(_x){return _scrollTo.apply(this,arguments)}return scrollTo}()}]);return Scrolling}(Backbone.Controller);Adapt.scrolling=new Scrolling;Adapt.scrollTo=Adapt.scrolling.scrollTo.bind(Adapt.scrolling);__AMD("core/js/scrolling",Adapt.scrolling);var HeadingView=function(_Backbone$View){_inherits(HeadingView,_Backbone$View);var _super=_createSuper(HeadingView);function HeadingView(){_classCallCheck(this,HeadingView);return _super.apply(this,arguments)}_createClass(HeadingView,[{key:"initialize",value:function initialize(){this.listenTo(Adapt.parentView,"postRemove",this.remove);this.listenTo(this.model,"change:_isComplete",this.updateAria);this.render()}},{key:"render",value:function render(){var template=Handlebars.templates[this.constructor.template];var data=this.model.toJSON();var customHeadingType=this.$el.attr("data-a11y-heading-type");if(customHeadingType)data._type=customHeadingType;this.$el.html(template(data));this.checkCompletion()}},{key:"updateAria",value:function updateAria(){var template=Handlebars.templates[this.constructor.template];var data=this.model.toJSON();var $rendered=$("<div>".concat(template(data),"</div>"));this.$(".aria-label").html($rendered.find(".aria-label").html());this.checkCompletion()}},{key:"checkCompletion",value:function checkCompletion(){var isComplete=this.model.get("_isComplete");this.$el.toggleClass("is-complete",isComplete).toggleClass("is-incomplete",!isComplete)}}]);return HeadingView}(Backbone.View);HeadingView.template="heading";var HeadingView$1=__AMD("core/js/views/headingView",HeadingView);var Headings=function(_Backbone$Controller){_inherits(Headings,_Backbone$Controller);var _super=_createSuper(Headings);function Headings(){_classCallCheck(this,Headings);return _super.apply(this,arguments)}_createClass(Headings,[{key:"initialize",value:function initialize(){this.listenTo(Adapt,"view:render",this.onViewRender)}},{key:"onViewRender",value:function onViewRender(view){var $headingSeats=view.$(".js-heading");$headingSeats.each(function(index,el){return new HeadingView$1({el:el,model:view.model})})}}]);return Headings}(Backbone.Controller);__AMD("core/js/headings",new Headings);var NavigationView=function(_Backbone$View){_inherits(NavigationView,_Backbone$View);var _super=_createSuper(NavigationView);function NavigationView(){_classCallCheck(this,NavigationView);return _super.apply(this,arguments)}_createClass(NavigationView,[{key:"className",value:function className(){return"nav"}},{key:"events",value:function events(){return{"click [data-event]":"triggerEvent"}}},{key:"attributes",value:function attributes(){return{"role":"navigation"}}},{key:"initialize",value:function initialize(){this.listenToOnce(Adapt,{"courseModel:dataLoading":this.remove});this.listenTo(Adapt,"router:menu router:page",this.hideNavigationButton);this.preRender()}},{key:"preRender",value:function preRender(){Adapt.trigger("navigationView:preRender",this);this.render()}},{key:"render",value:function render(){var _this=this;var template=Handlebars.templates[this.constructor.template];this.$el.html(template({_globals:Adapt.course.get("_globals"),_accessibility:Adapt.config.get("_accessibility")})).insertBefore("#app");_.defer(function(){Adapt.trigger("navigationView:postRender",_this)});return this}},{key:"triggerEvent",value:function triggerEvent(event){event.preventDefault();var currentEvent=$(event.currentTarget).attr("data-event");Adapt.trigger("navigation:"+currentEvent);switch(currentEvent){case"backButton":Adapt.router.navigateToPreviousRoute();break;case"homeButton":Adapt.router.navigateToHomeRoute();break;case"parentButton":Adapt.router.navigateToParent();break;case"skipNavigation":this.skipNavigation();break;case"returnToStart":Adapt.startController.returnToStartLocation();break;}}},{key:"skipNavigation",value:function skipNavigation(){Adapt.a11y.focusFirst("."+Adapt.location._contentType)}},{key:"hideNavigationButton",value:function hideNavigationButton(model){var shouldHide=model.get("_type")==="course";this.$(".nav__back-btn, .nav__home-btn").toggleClass("u-display-none",shouldHide)}},{key:"showNavigationButton",value:function showNavigationButton(){this.$(".nav__back-btn, .nav__home-btn").removeClass("u-display-none")}}]);return NavigationView}(Backbone.View);NavigationView.template="nav";var NavigationView$1=__AMD("core/js/views/navigationView",NavigationView);var NavigationController=function(_Backbone$Controller){_inherits(NavigationController,_Backbone$Controller);var _super=_createSuper(NavigationController);function NavigationController(){_classCallCheck(this,NavigationController);return _super.apply(this,arguments)}_createClass(NavigationController,[{key:"initialize",value:function initialize(){this.listenTo(Adapt,"adapt:preInitialize",this.addNavigationBar)}},{key:"addNavigationBar",value:function addNavigationBar(){var adaptConfig=Adapt.course.get("_navigation");if(adaptConfig!==null&&adaptConfig!==void 0&&adaptConfig._isDefaultNavigationDisabled){Adapt.trigger("navigation:initialize");return}Adapt.navigation=new NavigationView$1}}]);return NavigationController}(Backbone.Controller);__AMD("core/js/navigation",new NavigationController);var ItemModel=__AMD("core/js/models/itemModel",function(_LockingModel){_inherits(ItemModel,_LockingModel);var _super=_createSuper(ItemModel);function ItemModel(){_classCallCheck(this,ItemModel);return _super.apply(this,arguments)}_createClass(ItemModel,[{key:"defaults",value:function defaults(){return{_isActive:false,_isVisited:false,_score:0}}},{key:"reset",value:function reset(){this.set({_isActive:false,_isVisited:false})}},{key:"toggleActive",value:function toggleActive(){var isActive=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!this.get("_isActive");this.set("_isActive",isActive)}},{key:"toggleVisited",value:function toggleVisited(){var isVisited=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!this.get("_isVisited");this.set("_isVisited",isVisited)}}]);return ItemModel}(LockingModel));var ItemsComponentModel=__AMD("core/js/models/itemsComponentModel",function(_ComponentModel){_inherits(ItemsComponentModel,_ComponentModel);var _super=_createSuper(ItemsComponentModel);function ItemsComponentModel(){_classCallCheck(this,ItemsComponentModel);return _super.apply(this,arguments)}_createClass(ItemsComponentModel,[{key:"toJSON",value:function toJSON(){var json=_get(_getPrototypeOf(ItemsComponentModel.prototype),"toJSON",this).call(this);json._items=this.getChildren().toJSON();return json}},{key:"init",value:function init(){this.setUpItems();this.listenTo(this.getChildren(),{all:this.onAll,"change:_isVisited":this.checkCompletionStatus});_get(_getPrototypeOf(ItemsComponentModel.prototype),"init",this).call(this)}},{key:"restoreUserAnswers",value:function restoreUserAnswers(){var booleanArray=this.get("_userAnswer");if(!booleanArray)return;this.getChildren().forEach(function(child,index){return child.set("_isVisited",booleanArray[index])})}},{key:"storeUserAnswer",value:function storeUserAnswer(){var booleanArray=this.getChildren().map(function(child){return child.get("_isVisited")});this.set("_userAnswer",booleanArray)}},{key:"setUpItems",value:function setUpItems(){var items=this.get("_items")||[];items.forEach(function(item,index){return item._index=index});this.setChildren(new Backbone.Collection(items,{model:ItemModel}))}},{key:"getItem",value:function getItem(index){return this.getChildren().findWhere({_index:index})}},{key:"getVisitedItems",value:function getVisitedItems(){return this.getChildren().where({_isVisited:true})}},{key:"getActiveItems",value:function getActiveItems(){return this.getChildren().where({_isActive:true})}},{key:"getActiveItem",value:function getActiveItem(){return this.getChildren().findWhere({_isActive:true})}},{key:"areAllItemsCompleted",value:function areAllItemsCompleted(){return this.getVisitedItems().length===this.getChildren().length}},{key:"checkCompletionStatus",value:function checkCompletionStatus(){this.storeUserAnswer();if(!this.areAllItemsCompleted())return;this.setCompletionStatus()}},{key:"reset",value:function reset(){var type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"hard";var canReset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.get("_canReset");var wasReset=_get(_getPrototypeOf(ItemsComponentModel.prototype),"reset",this).call(this,type,canReset);if(!wasReset)return false;this.getChildren().each(function(item){return item.reset()});return true}},{key:"resetActiveItems",value:function resetActiveItems(){this.getChildren().each(function(item){return item.toggleActive(false)})}},{key:"setActiveItem",value:function setActiveItem(index){var item=this.getItem(index);if(!item)return;var activeItem=this.getActiveItem();if(activeItem)activeItem.toggleActive(false);item.toggleActive(true)}}]);return ItemsComponentModel}(ComponentModel$1));var AccordionModel=function(_ItemsComponentModel){_inherits(AccordionModel,_ItemsComponentModel);var _super=_createSuper(AccordionModel);function AccordionModel(){_classCallCheck(this,AccordionModel);return _super.apply(this,arguments)}_createClass(AccordionModel,[{key:"defaults",value:function defaults(){return ItemsComponentModel.resultExtend("defaults",{_shouldCollapseItems:true,_shouldExpandFirstItem:false,_toggleSpeed:200},this)}},{key:"toggleItemsState",value:function toggleItemsState(index){var item=this.getItem(index);var previousActiveItem=this.getActiveItem();item.toggleActive();item.toggleVisited(true);if(previousActiveItem&&this.get("_shouldCollapseItems")){previousActiveItem.toggleActive(false)}}},{key:"checkExpandFirstItem",value:function checkExpandFirstItem(){if(!this.get("_shouldExpandFirstItem"))return;this.setActiveItem(0)}}]);return AccordionModel}(ItemsComponentModel);var AccordionModel$1=__AMD("components/adapt-contrib-accordion/js/accordionModel",AccordionModel);var ComponentView=function(_AdaptView){_inherits(ComponentView,_AdaptView);var _super=_createSuper(ComponentView);function ComponentView(){_classCallCheck(this,ComponentView);return _super.apply(this,arguments)}_createClass(ComponentView,[{key:"attributes",value:function attributes(){if(!this.model.get("_isA11yRegionEnabled")){return AdaptView$1.resultExtend("attributes",{},this)}return AdaptView$1.resultExtend("attributes",{"aria-labelledby":this.model.get("_id")+"-heading","role":"region"},this)}},{key:"className",value:function className(){return["component",this.model.get("_component").toLowerCase(),this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),"is-"+this.model.get("_layout"),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":""].join(" ")}},{key:"renderState",value:function renderState(){Adapt.log.removed("renderState is removed and moved to item title")}},{key:"setupInviewCompletion",value:function setupInviewCompletion(){var inviewElementSelector=arguments.length>0&&arguments[0]!==undefined?arguments[0]:".component__inner";var callback=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.setCompletionStatus;this.$inviewElement=this.$(inviewElementSelector);this.inviewCallback=callback;this.$inviewElement.on("inview.componentView",this.onInview.bind(this))}},{key:"removeInviewListener",value:function removeInviewListener(){if(!this.$inviewElement)return;this.$inviewElement.off("inview.componentView");this.$inviewElement=null}},{key:"onInview",value:function onInview(event,visible,visiblePartX,visiblePartY){if(!visible)return;switch(visiblePartY){case"top":this.hasSeenTop=true;break;case"bottom":this.hasSeenBottom=true;break;case"both":this.hasSeenTop=this.hasSeenBottom=true;}if(!this.hasSeenTop||!this.hasSeenBottom)return;this.inviewCallback();if(this.model.get("_isComplete")){this.removeInviewListener()}}},{key:"postRender",value:function postRender(){}},{key:"remove",value:function remove(){this.removeInviewListener();_get(_getPrototypeOf(ComponentView.prototype),"remove",this).call(this)}}]);return ComponentView}(AdaptView$1);ComponentView.type="component";var ComponentView$1=__AMD("core/js/views/componentView",ComponentView);var AccordionView=function(_ComponentView){_inherits(AccordionView,_ComponentView);var _super=_createSuper(AccordionView);function AccordionView(){_classCallCheck(this,AccordionView);return _super.apply(this,arguments)}_createClass(AccordionView,[{key:"events",value:function events(){return{"click .js-toggle-item":"onClick"}}},{key:"preRender",value:function preRender(){this.checkIfResetOnRevisit();this.model.resetActiveItems();this.model.checkExpandFirstItem();this.listenTo(this.model.get("_children"),{"change:_isActive":this.onItemsActiveChange,"change:_isVisited":this.onItemsVisitedChange})}},{key:"postRender",value:function postRender(){this.setReadyStatus();if(this.model.get("_setCompletionOn")==="inview"){this.setupInviewCompletion()}}},{key:"checkIfResetOnRevisit",value:function checkIfResetOnRevisit(){var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(isResetOnRevisit){this.model.reset(isResetOnRevisit)}}},{key:"onClick",value:function onClick(event){this.model.toggleItemsState($(event.currentTarget).parent().data("index"))}},{key:"onItemsActiveChange",value:function onItemsActiveChange(item,isActive){this.toggleItem(item,isActive)}},{key:"onItemsVisitedChange",value:function onItemsVisitedChange(item,isVisited){if(!isVisited)return;var $item=this.getItemElement(item);$item.children(".accordion__item-btn").addClass("is-visited")}},{key:"toggleItem",value:function toggleItem(item,shouldExpand){var $item=this.getItemElement(item);var $body=$item.children(".accordion__item-content").stop(true,true);$item.children(".accordion__item-btn").toggleClass("is-selected is-open",shouldExpand).toggleClass("is-closed",!shouldExpand).attr("aria-expanded",shouldExpand);if(!shouldExpand){$body.slideUp(this.model.get("_toggleSpeed"));return}$body.slideDown(this.model.get("_toggleSpeed"))}},{key:"getItemElement",value:function getItemElement(item){var index=item.get("_index");return this.$(".accordion__item").filter("[data-index=\"".concat(index,"\"]"))}}]);return AccordionView}(ComponentView$1);AccordionView.template="accordion";var AccordionView$1=__AMD("components/adapt-contrib-accordion/js/accordionView",AccordionView);__AMD("components/adapt-contrib-accordion/js/adapt-contrib-accordion",Adapt.register("accordion",{model:AccordionModel$1,view:AccordionView$1}));var GraphicView=function(_ComponentView){_inherits(GraphicView,_ComponentView);var _super=_createSuper(GraphicView);function GraphicView(){_classCallCheck(this,GraphicView);return _super.apply(this,arguments)}_createClass(GraphicView,[{key:"events",value:function events(){return{"click .js-graphic-link":"onClick"}}},{key:"postRender",value:function postRender(){var _this=this;this.$(".graphic__widget").imageready(function(){_this.setReadyStatus();_this.setupInviewCompletion(".graphic__widget")})}},{key:"onClick",value:function onClick(event){if(event)event.preventDefault();var item=this.model.get("_graphic");var url=item._url,_item$_target=item._target,target=_item$_target===void 0?"_blank":_item$_target;var isNewWindow=target!=="_self";if(isNewWindow)return window.open(url,target);var isRouterNavigation=url.substr(0,1)==="#";if(isRouterNavigation)return Backbone.history.navigate(url,{trigger:true});window.location.href=url}}]);return GraphicView}(ComponentView$1);GraphicView.template="graphic.jsx";var GraphicView$1=__AMD("components/adapt-contrib-graphic/js/GraphicView",GraphicView);var GraphicModel=__AMD("components/adapt-contrib-graphic/js/GraphicModel",function(_ComponentModel){_inherits(GraphicModel,_ComponentModel);var _super=_createSuper(GraphicModel);function GraphicModel(){_classCallCheck(this,GraphicModel);return _super.apply(this,arguments)}return GraphicModel}(ComponentModel$1));__AMD("components/adapt-contrib-graphic/js/adapt-contrib-graphic",Adapt.register("graphic",{model:GraphicModel,view:GraphicView$1}));var BUTTON_STATE=ENUM(["SUBMIT","CORRECT","INCORRECT","SHOW_CORRECT_ANSWER","HIDE_CORRECT_ANSWER","SHOW_FEEDBACK","RESET"]);var BUTTON_STATE$1=__AMD("core/js/enums/buttonStateEnum",BUTTON_STATE);var textPropertyName={SUBMIT:"submit",CORRECT:"correct",INCORRECT:"incorrect",SHOW_CORRECT_ANSWER:"showCorrectAnswer",HIDE_CORRECT_ANSWER:"hideCorrectAnswer",SHOW_FEEDBACK:"showFeedback",RESET:"reset"};var ButtonsView=__AMD("core/js/views/buttonsView",function(_Backbone$View){_inherits(ButtonsView,_Backbone$View);var _super=_createSuper(ButtonsView);function ButtonsView(){_classCallCheck(this,ButtonsView);return _super.apply(this,arguments)}_createClass(ButtonsView,[{key:"initialize",value:function initialize(options){this.parent=options.parent;this.listenTo(Adapt.parentView,"postRemove",this.remove);this.listenTo(this.model,{"change:_buttonState":this.onButtonStateChanged,"change:feedbackMessage":this.onFeedbackMessageChanged,"change:_attemptsLeft":this.onAttemptsChanged,"change:_canSubmit":this.onCanSubmitChange});this.render()}},{key:"events",value:function events(){return{"click .js-btn-action":"onActionClicked","click .js-btn-feedback":"onFeedbackClicked"}}},{key:"render",value:function render(){var _this=this;var data=this.model.toJSON();var template=Handlebars.templates.buttons;_.defer(function(){_this.postRender();Adapt.trigger("buttonsView:postRender",_this)});this.$el.html(template(data))}},{key:"postRender",value:function postRender(){this.refresh()}},{key:"checkResetSubmittedState",value:function checkResetSubmittedState(){var isSubmitted=this.model.get("_isSubmitted");if(isSubmitted){this.$el.addClass("is-submitted");return}this.$(".js-btn-marking").removeClass("is-incorrect is-correct").addClass("u-display-none");this.$el.removeClass("is-submitted");this.model.set("feedbackMessage",undefined);Adapt.a11y.toggleEnabled(this.$(".js-btn-feedback"),false)}},{key:"onActionClicked",value:function onActionClicked(){var buttonState=BUTTON_STATE$1(this.model.get("_buttonState"));this.trigger("buttons:stateUpdate",buttonState);this.checkResetSubmittedState();if(buttonState===BUTTON_STATE$1.SHOW_CORRECT_ANSWER){var _this$model$getCorrec,_this$model;var correctAnswer=(_this$model$getCorrec=(_this$model=this.model).getCorrectAnswerAsText)===null||_this$model$getCorrec===void 0?void 0:_this$model$getCorrec.call(_this$model);this.updateAnswerLiveRegion(correctAnswer)}if(buttonState===BUTTON_STATE$1.HIDE_CORRECT_ANSWER){var _this$model$getUserAn,_this$model2;var userAnswer=(_this$model$getUserAn=(_this$model2=this.model).getUserAnswerAsText)===null||_this$model$getUserAn===void 0?void 0:_this$model$getUserAn.call(_this$model2);this.updateAnswerLiveRegion(userAnswer)}}},{key:"onFeedbackClicked",value:function onFeedbackClicked(){this.trigger("buttons:stateUpdate",BUTTON_STATE$1.SHOW_FEEDBACK)}},{key:"onFeedbackMessageChanged",value:function onFeedbackMessageChanged(model,changedAttribute){if(changedAttribute&&this.model.get("_canShowFeedback")){Adapt.a11y.toggleEnabled(this.$(".js-btn-feedback"),true);return}Adapt.a11y.toggleEnabled(this.$(".js-btn-feedback"),false)}},{key:"onCanSubmitChange",value:function onCanSubmitChange(){this.onButtonStateChanged(this.model,this.model.get("_buttonState"))}},{key:"onButtonStateChanged",value:function onButtonStateChanged(model,changedAttribute){this.updateAttemptsCount();var $buttonsAction=this.$(".js-btn-action");var buttonState=BUTTON_STATE$1(changedAttribute);if(changedAttribute===BUTTON_STATE$1.CORRECT||changedAttribute===BUTTON_STATE$1.INCORRECT){Adapt.a11y.toggleEnabled($buttonsAction,false);return}var propertyName=textPropertyName[buttonState.asString];var ariaLabel=this.model.get("_buttons")["_"+propertyName].ariaLabel;var buttonText=this.model.get("_buttons")["_"+propertyName].buttonText;Adapt.a11y.toggleEnabled($buttonsAction,this.model.get("_canSubmit"));$buttonsAction.html(buttonText).attr("aria-label",ariaLabel)}},{key:"checkFeedbackState",value:function checkFeedbackState(){var canShowFeedback=this.model.get("_canShowFeedback");this.$(".js-btn-action").toggleClass("is-full-width",!canShowFeedback);this.$(".js-btn-feedback").toggleClass("u-display-none",!canShowFeedback);this.$(".js-btn-marking").toggleClass("is-full-width u-display-none",!canShowFeedback)}},{key:"updateAttemptsCount",value:function updateAttemptsCount(){var isInteractionComplete=this.model.get("_isInteractionComplete");var attemptsLeft=this.model.get("_attemptsLeft")?this.model.get("_attemptsLeft"):this.model.get("_attempts");var shouldDisplayAttempts=this.model.get("_shouldDisplayAttempts");var attemptsString;this.checkResetSubmittedState();if(!isInteractionComplete&&attemptsLeft>=0){attemptsString=attemptsLeft+" ";attemptsString+=attemptsLeft===1?this.model.get("_buttons").remainingAttemptText:this.model.get("_buttons").remainingAttemptsText}else{this.$(".js-display-attempts").addClass("u-visibility-hidden");this.showMarking()}if(shouldDisplayAttempts){this.$(".js-insert-attempts-string").html(attemptsString)}}},{key:"updateAnswerLiveRegion",value:function updateAnswerLiveRegion(answer){if(!answer)return;this.$(".js-answer-live-region").html(answer)}},{key:"showMarking",value:function showMarking(){if(!this.model.shouldShowMarking)return;var isCorrect=this.model.get("_isCorrect");var ariaLabels=Adapt.course.get("_globals")._accessibility._ariaLabels;this.$(".js-btn-marking").removeClass("u-display-none").addClass(isCorrect?"is-correct":"is-incorrect").attr("aria-label",isCorrect?ariaLabels.answeredCorrectly:ariaLabels.answeredIncorrectly)}},{key:"refresh",value:function refresh(){this.updateAttemptsCount();this.checkResetSubmittedState();this.checkFeedbackState();this.onButtonStateChanged(null,this.model.get("_buttonState"));this.onFeedbackMessageChanged(null,this.model.get("feedbackMessage"))}}]);return ButtonsView}(Backbone.View));var QuestionModel=function(_ComponentModel){_inherits(QuestionModel,_ComponentModel);var _super=_createSuper(QuestionModel);function QuestionModel(){_classCallCheck(this,QuestionModel);return _super.apply(this,arguments)}_createClass(QuestionModel,[{key:"defaults",value:function defaults(){return ComponentModel$1.resultExtend("defaults",{_isQuestionType:true,_shouldDisplayAttempts:false,_shouldShowMarking:false,_canShowModelAnswer:true,_canShowFeedback:true,_canShowMarking:true,_canSubmit:true,_isSubmitted:false,_isCorrectAnswerShown:false,_questionWeight:Adapt.config.get("_questionWeight"),_hasItemScoring:false,_items:[]})}},{key:"trackable",value:function trackable(){return ComponentModel$1.resultExtend("trackable",["_isSubmitted","_score","_isCorrect","_attemptsLeft"])}},{key:"trackableType",value:function trackableType(){return ComponentModel$1.resultExtend("trackableType",[Boolean,Number,Boolean,Number])}},{key:"getTypeGroup",value:function getTypeGroup(){return"question"}},{key:"init",value:function init(){this.setupDefaultSettings();this.setLocking("_canSubmit",true);this.updateRawScore();_get(_getPrototypeOf(QuestionModel.prototype),"init",this).call(this)}},{key:"setupDefaultSettings",value:function setupDefaultSettings(){this.setupWeightSettings();this.setupButtonSettings()}},{key:"setupButtonSettings",value:function setupButtonSettings(){var globalButtons=Adapt.course.get("_buttons");if(!this.has("_buttons")){this.set("_buttons",globalButtons)}else{var componentButtons=this.get("_buttons");for(var key in componentButtons){if(_typeof(componentButtons[key])==="object"){if(!componentButtons[key].buttonText&&globalButtons[key].buttonText){componentButtons[key].buttonText=globalButtons[key].buttonText}if(!componentButtons[key].ariaLabel&&globalButtons[key].ariaLabel){componentButtons[key].ariaLabel=globalButtons[key].ariaLabel}}if(!componentButtons[key]&&globalButtons[key]){componentButtons[key]=globalButtons[key]}}}}},{key:"setupWeightSettings",value:function setupWeightSettings(){}},{key:"canSubmit",value:function canSubmit(){}},{key:"checkCanSubmit",value:function checkCanSubmit(){this.set("_canSubmit",this.canSubmit(),{pluginName:"adapt"})}},{key:"updateAttempts",value:function updateAttempts(){var attemptsLeft=this.get("_attemptsLeft")||this.get("_attempts");this.set("_attemptsLeft",attemptsLeft-1)}},{key:"setQuestionAsSubmitted",value:function setQuestionAsSubmitted(){this.set({_isEnabled:false,_isSubmitted:true})}},{key:"markQuestion",value:function markQuestion(){if(this.isCorrect()){this.set("_isCorrect",true)}else{this.set("_isCorrect",false)}this.updateRawScore()}},{key:"isCorrect",value:function isCorrect(){}},{key:"setScore",value:function setScore(){}},{key:"updateRawScore",value:function updateRawScore(){this.set({_rawScore:this.score,_maxScore:this.maxScore,_minScore:this.minScore})}},{key:"score",get:function(){return this.get("_isCorrect")?this.maxScore:0}},{key:"maxScore",get:function(){return this.get("_questionWeight")}},{key:"minScore",get:function(){return 0}},{key:"checkQuestionCompletion",value:function checkQuestionCompletion(){var isComplete=this.get("_isCorrect")||this.get("_attemptsLeft")===0;if(isComplete){this.setCompletionStatus()}return isComplete}},{key:"updateButtons",value:function updateButtons(){var isInteractionComplete=this.get("_isInteractionComplete");var isCorrect=this.get("_isCorrect");var isEnabled=this.get("_isEnabled");var buttonState=this.get("_buttonState");var canShowModelAnswer=this.get("_canShowModelAnswer");if(isInteractionComplete){if(isCorrect||!canShowModelAnswer){this.set("_buttonState",BUTTON_STATE$1.CORRECT)}else{switch(buttonState){case BUTTON_STATE$1.SUBMIT:case BUTTON_STATE$1.HIDE_CORRECT_ANSWER:this.set("_buttonState",BUTTON_STATE$1.SHOW_CORRECT_ANSWER);break;default:this.set("_buttonState",BUTTON_STATE$1.HIDE_CORRECT_ANSWER);}}}else{if(isEnabled){this.set("_buttonState",BUTTON_STATE$1.SUBMIT)}else{this.set("_buttonState",BUTTON_STATE$1.RESET)}}}},{key:"setupFeedback",value:function setupFeedback(){if(!this.has("_feedback"))return;if(this.get("_isCorrect")){this.setupCorrectFeedback()}else if(this.isPartlyCorrect()){this.setupPartlyCorrectFeedback()}else{this.setupIncorrectFeedback()}}},{key:"isPartlyCorrect",value:function isPartlyCorrect(){}},{key:"setupCorrectFeedback",value:function setupCorrectFeedback(){this.set({feedbackTitle:this.getFeedbackTitle(),feedbackMessage:Handlebars.compile(this.get("_feedback").correct)(this.toJSON())})}},{key:"setupPartlyCorrectFeedback",value:function setupPartlyCorrectFeedback(){var feedback=this.get("_feedback")._partlyCorrect;if(feedback!==null&&feedback!==void 0&&feedback.final){this.setAttemptSpecificFeedback(feedback)}else{this.setupIncorrectFeedback()}}},{key:"setupIncorrectFeedback",value:function setupIncorrectFeedback(){this.setAttemptSpecificFeedback(this.get("_feedback")._incorrect)}},{key:"setAttemptSpecificFeedback",value:function setAttemptSpecificFeedback(feedback){var body=this.get("_attemptsLeft")&&feedback.notFinal||feedback.final;this.set({feedbackTitle:this.getFeedbackTitle(),feedbackMessage:Handlebars.compile(body)(this.toJSON())})}},{key:"getFeedbackTitle",value:function getFeedbackTitle(){var title=this.get("_feedback").title||this.get("displayTitle")||this.get("title")||"";return Handlebars.compile(title)(this.toJSON())}},{key:"isInteractive",value:function isInteractive(){return!this.get("_isComplete")||this.get("_isEnabled")&&!this.get("_isSubmitted")}},{key:"checkIfResetOnRevisit",value:function checkIfResetOnRevisit(){_get(_getPrototypeOf(QuestionModel.prototype),"checkIfResetOnRevisit",this).call(this);this.set("_buttonState",this.get("_isInteractionComplete")?BUTTON_STATE$1.HIDE_CORRECT_ANSWER:BUTTON_STATE$1.SUBMIT)}},{key:"reset",value:function reset(){var type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"hard";var canReset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.get("_canReset");var wasReset=_get(_getPrototypeOf(QuestionModel.prototype),"reset",this).call(this,type,canReset);if(!wasReset)return false;var attempts=this.get("_attempts");this.set({_attemptsLeft:attempts,_isCorrect:undefined,_isSubmitted:false,_buttonState:BUTTON_STATE$1.SUBMIT,_shouldShowMarking:this.shouldShowMarking});return true}},{key:"setQuestionAsReset",value:function setQuestionAsReset(){this.set({_isEnabled:true,_isSubmitted:false});this.resetQuestion()}},{key:"resetQuestion",value:function resetQuestion(){}},{key:"refresh",value:function refresh(){this.trigger("question:refresh")}},{key:"getButtonState",value:function getButtonState(){if(this.get("_isCorrect")){return BUTTON_STATE$1.CORRECT}if(this.get("_attemptsLeft")===0){return this.get("_canShowModelAnswer")?BUTTON_STATE$1.SHOW_CORRECT_ANSWER:BUTTON_STATE$1.INCORRECT}return this.get("_isSubmitted")?BUTTON_STATE$1.RESET:BUTTON_STATE$1.SUBMIT}},{key:"getInteractionObject",value:function getInteractionObject(){return{}}},{key:"getResponse",value:function getResponse(){}},{key:"getResponseType",value:function getResponseType(){}},{key:"onSubmitted",value:function onSubmitted(){this.addAttemptObject();this.set("_shouldShowMarking",this.shouldShowMarking)}},{key:"shouldShowMarking",get:function(){return!this.isInteractive()&&this.get("_canShowMarking")&&this.get("_isInteractionComplete")}}]);return QuestionModel}(ComponentModel$1);Adapt.register("question",{model:QuestionModel});var QuestionModel$1=__AMD("core/js/models/questionModel",QuestionModel);var QuestionView=function(_ComponentView){_inherits(QuestionView,_ComponentView);var _super=_createSuper(QuestionView);function QuestionView(){_classCallCheck(this,QuestionView);return _super.apply(this,arguments)}_createClass(QuestionView,[{key:"className",value:function className(){return["component","is-question",this.model.get("_component").toLowerCase(),this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),"is-"+this.model.get("_layout"),this.model.get("_isComplete")?"is-complete":"",this.model.get("_isOptional")?"is-optional":"",this.model.get("_canShowModelAnswer")?"can-show-model-answer":"",this.model.get("_canShowFeedback")?"can-show-feedback":"",this.model.get("_canShowMarking")?"can-show-marking":""].join(" ")}},{key:"initialize",value:function initialize(){var _get2;this.isInteractive=this.isInteractive.bind(this);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}(_get2=_get(_getPrototypeOf(QuestionView.prototype),"initialize",this)).call.apply(_get2,[this].concat(args))}},{key:"isInteractive",value:function isInteractive(){log.deprecated("questionView.isInteractive please use this.model.isInteractive, this.model.get('_shouldShowMarking') or this.model.shouldShowMarking");return this.model.isInteractive()}},{key:"preRender",value:function preRender(){var _this=this;this.listenTo(this.model,"change:_isEnabled",this.onEnabledChanged);this.listenTo(this.model,"question:refresh",this.refresh);if(this.checkIfResetOnRevisit!==QuestionView.prototype.checkIfResetOnRevisit){log.deprecated("QuestionView.checkIfResetOnRevisit, please use QuestionModel.checkIfResetOnRevisit")}this.checkIfResetOnRevisit();_.defer(function(){return _this.ensureLegacyLifecycleState()});this._runModelCompatibleFunction("setupDefaultSettings");this.setupQuestion()}},{key:"onEnabledChanged",value:function onEnabledChanged(model,changedAttribute){if(!changedAttribute){this.$(".component__widget").addClass("is-disabled");this.disableQuestion()}else{this.$(".component__widget").removeClass("is-disabled");this.enableQuestion()}}},{key:"disableQuestion",value:function disableQuestion(){}},{key:"enableQuestion",value:function enableQuestion(){}},{key:"checkIfResetOnRevisit",value:function checkIfResetOnRevisit(){var _this2=this;var canReset=this.model.get("_canReset")!==false;var isResetOnRevisit=this.model.get("_isResetOnRevisit");if(!canReset||!isResetOnRevisit)return;if(this.resetQuestionOnRevisit===QuestionView.prototype.resetQuestionOnRevisit)return;log.deprecated("QuestionView.resetQuestionOnRevisit, please QuestionModel.reset");_.defer(function(){_this2.resetQuestionOnRevisit(isResetOnRevisit)})}},{key:"ensureLegacyLifecycleState",value:function ensureLegacyLifecycleState(){var isInteractionComplete=this.model.get("_isInteractionComplete");if(isInteractionComplete){this.onHideCorrectAnswerClicked();return}this.onResetClicked()}},{key:"resetQuestionOnRevisit",value:function resetQuestionOnRevisit(type){}},{key:"setupQuestion",value:function setupQuestion(){}},{key:"postRender",value:function postRender(){this.addButtonsView();this.onQuestionRendered()}},{key:"addButtonsView",value:function addButtonsView(){this.buttonsView=new ButtonsView({model:this.model,el:this.$(".btn__container")});this.listenTo(this.buttonsView,"buttons:stateUpdate",this.onButtonStateUpdate)}},{key:"onButtonStateUpdate",value:function onButtonStateUpdate(buttonState){switch(buttonState){case BUTTON_STATE$1.SUBMIT:this.onSubmitClicked();break;case BUTTON_STATE$1.RESET:this.onResetClicked();break;case BUTTON_STATE$1.SHOW_CORRECT_ANSWER:this.onShowCorrectAnswerClicked();break;case BUTTON_STATE$1.HIDE_CORRECT_ANSWER:this.onHideCorrectAnswerClicked();break;case BUTTON_STATE$1.SHOW_FEEDBACK:this.showFeedback();break;}}},{key:"onQuestionRendered",value:function onQuestionRendered(){}},{key:"onSubmitClicked",value:function onSubmitClicked(){var canSubmit=this._runModelCompatibleFunction("canSubmit");if(!canSubmit){this.showInstructionError();this.onCannotSubmit();return}this._runModelCompatibleFunction("updateAttempts");this._runModelCompatibleFunction("setQuestionAsSubmitted");this.removeInstructionError();this._runModelCompatibleFunction("storeUserAnswer");this._runModelCompatibleFunction("markQuestion","isCorrect");this._runModelCompatibleFunction("setScore");this._runModelCompatibleFunction("checkQuestionCompletion");if(this.model.shouldShowMarking){this.showMarking()}this.recordInteraction();this._runModelCompatibleFunction("setupFeedback");this.showFeedback();$(window).resize();this._runModelCompatibleFunction("updateButtons");this.model.onSubmitted();this.onSubmitted()}},{key:"showInstructionError",value:function showInstructionError(){Adapt.trigger("questionView:showInstructionError",this)}},{key:"onCannotSubmit",value:function onCannotSubmit(){}},{key:"onSubmitted",value:function onSubmitted(){}},{key:"setQuestionAsSubmitted",value:function setQuestionAsSubmitted(){this.model.setQuestionAsSubmitted();this.$(".component__widget").addClass("is-submitted")}},{key:"removeInstructionError",value:function removeInstructionError(){this.$(".component__instruction-inner").removeClass("validation-error")}},{key:"showMarking",value:function showMarking(){}},{key:"checkQuestionCompletion",value:function checkQuestionCompletion(){var isComplete=this.model.checkQuestionCompletion();if(isComplete){this.$(".component__widget").addClass("is-complete show-user-answer")}}},{key:"recordInteraction",value:function recordInteraction(){if(this.model.get("_recordInteraction")===true||!this.model.has("_recordInteraction")){Adapt.trigger("questionView:recordInteraction",this)}}},{key:"showFeedback",value:function showFeedback(){if(this.model.get("_canShowFeedback")){Adapt.trigger("questionView:showFeedback",this)}else{Adapt.trigger("questionView:disabledFeedback",this)}}},{key:"onResetClicked",value:function onResetClicked(){this.setQuestionAsReset();this._runModelCompatibleFunction("resetUserAnswer");this.model.checkCanSubmit();this._runModelCompatibleFunction("updateButtons");if(!this.model.get("_isReady"))return;var currentModel=Adapt.findById(Adapt.location._currentId);if(!(currentModel!==null&&currentModel!==void 0&&currentModel.get("_isReady")))return;a11y.focusNext(this.$el,{preventScroll:true})}},{key:"setQuestionAsReset",value:function setQuestionAsReset(){this.model.setQuestionAsReset();this.resetQuestion();this.$(".component__widget").removeClass("is-submitted")}},{key:"resetQuestion",value:function resetQuestion(){}},{key:"refresh",value:function refresh(){this.model.set("_buttonState",this.model.getButtonState());if(this.model.shouldShowMarking){this.showMarking()}if(this.buttonsView){_.defer(this.buttonsView.refresh.bind(this.buttonsView))}}},{key:"onShowCorrectAnswerClicked",value:function onShowCorrectAnswerClicked(){this.setQuestionAsShowCorrect();this._runModelCompatibleFunction("updateButtons");this.showCorrectAnswer()}},{key:"setQuestionAsShowCorrect",value:function setQuestionAsShowCorrect(){this.$(".component__widget").addClass("is-submitted show-correct-answer").removeClass("show-user-answer")}},{key:"showCorrectAnswer",value:function showCorrectAnswer(){this.model.set("_isCorrectAnswerShown",true)}},{key:"onHideCorrectAnswerClicked",value:function onHideCorrectAnswerClicked(){this.setQuestionAsHideCorrect();this._runModelCompatibleFunction("updateButtons");this.hideCorrectAnswer()}},{key:"setQuestionAsHideCorrect",value:function setQuestionAsHideCorrect(){this.$(".component__widget").addClass("is-submitted show-user-answer").removeClass("show-correct-answer")}},{key:"hideCorrectAnswer",value:function hideCorrectAnswer(){this.model.set("_isCorrectAnswerShown",false)}},{key:"getLatency",value:function getLatency(){return null}},{key:"_runModelCompatibleFunction",value:function _runModelCompatibleFunction(name,lookForViewOnlyFunction){return this.model[name]()}}]);return QuestionView}(ComponentView$1);QuestionView._isQuestionType=true;var ViewOnlyQuestionViewCompatibilityLayer=function(_QuestionView){_inherits(ViewOnlyQuestionViewCompatibilityLayer,_QuestionView);var _super2=_createSuper(ViewOnlyQuestionViewCompatibilityLayer);function ViewOnlyQuestionViewCompatibilityLayer(){_classCallCheck(this,ViewOnlyQuestionViewCompatibilityLayer);return _super2.apply(this,arguments)}_createClass(ViewOnlyQuestionViewCompatibilityLayer,[{key:"getInteractionObject",value:function getInteractionObject(){log.deprecated("QuestionView.getInteractionObject, please use QuestionModel.getInteractionObject");return this.model.getInteractionObject()}},{key:"getResponse",value:function getResponse(){log.deprecated("QuestionView.getInteractionObject, please use QuestionModel.getInteractionObject");return this.model.getResponse()}},{key:"getResponseType",value:function getResponseType(){log.deprecated("QuestionView.getResponseType, please use QuestionModel.getResponseType");return this.model.getResponseType()}},{key:"setupDefaultSettings",value:function setupDefaultSettings(){log.deprecated("QuestionView.setupDefaultSettings, please use QuestionModel.setupDefaultSettings");return this.model.setupDefaultSettings()}},{key:"setupButtonSettings",value:function setupButtonSettings(){log.deprecated("QuestionView.setupButtonSettings, please use QuestionModel.setupButtonSettings");return this.model.setupButtonSettings()}},{key:"setupWeightSettings",value:function setupWeightSettings(){log.deprecated("QuestionView.setupWeightSettings, please use QuestionModel.setupWeightSettings");return this.model.setupWeightSettings()}},{key:"canSubmit",value:function canSubmit(){log.deprecated("QuestionView.canSubmit, please use QuestionModel.canSubmit");return this.model.canSubmit()}},{key:"updateAttempts",value:function updateAttempts(){log.deprecated("QuestionView.updateAttempts, please use QuestionModel.updateAttempts");return this.model.updateAttempts()}},{key:"storeUserAnswer",value:function storeUserAnswer(){log.deprecated("QuestionView.storeUserAnswer, please use QuestionModel.storeUserAnswer");return this.model.storeUserAnswer()}},{key:"resetUserAnswer",value:function resetUserAnswer(){log.deprecated("QuestionView.resetUserAnswer, please use QuestionModel.resetUserAnswer");return this.model.resetUserAnswer()}},{key:"markQuestion",value:function markQuestion(){if(this._isInViewOnlyCompatibleMode("isCorrect")){if(this.isCorrect()){this.model.set("_isCorrect",true)}else{this.model.set("_isCorrect",false)}this.model.set({_rawScore:this.model.get("_isCorrect")?this.model.get("_questionWeight"):0,_maxScore:this.model.get("_questionWeight"),_minScore:0})}else{return this.model.markQuestion()}}},{key:"isCorrect",value:function isCorrect(){log.deprecated("QuestionView.isCorrect, please use QuestionModel.isCorrect");return this.model.isCorrect()}},{key:"setScore",value:function setScore(){log.deprecated("QuestionView.setScore, please use QuestionModel.setScore");return this.model.setScore()}},{key:"updateButtons",value:function updateButtons(){log.deprecated("QuestionView.updateButtons, please use QuestionModel.updateButtons");return this.model.updateButtons()}},{key:"setupFeedback",value:function setupFeedback(){if(this._isInViewOnlyCompatibleMode("isPartlyCorrect")){if(this.model.get("_isCorrect")){this._runModelCompatibleFunction("setupCorrectFeedback")}else if(this.isPartlyCorrect()){this._runModelCompatibleFunction("setupPartlyCorrectFeedback")}else{this._runModelCompatibleFunction("setupIncorrectFeedback")}}else{this.model.setupFeedback()}}},{key:"isPartlyCorrect",value:function isPartlyCorrect(){log.deprecated("QuestionView.isPartlyCorrect, please use QuestionModel.isPartlyCorrect");return this.model.isPartlyCorrect()}},{key:"setupCorrectFeedback",value:function setupCorrectFeedback(){log.deprecated("QuestionView.setupCorrectFeedback, please use QuestionModel.setupCorrectFeedback");return this.model.setupCorrectFeedback()}},{key:"setupPartlyCorrectFeedback",value:function setupPartlyCorrectFeedback(){log.deprecated("QuestionView.setupPartlyCorrectFeedback, please use QuestionModel.setupPartlyCorrectFeedback");return this.model.setupPartlyCorrectFeedback()}},{key:"setupIncorrectFeedback",value:function setupIncorrectFeedback(){log.deprecated("QuestionView.setupIncorrectFeedback, please use QuestionModel.setupIncorrectFeedback");return this.model.setupIncorrectFeedback()}},{key:"_runModelCompatibleFunction",value:function _runModelCompatibleFunction(name,lookForViewOnlyFunction){if(this._isInViewOnlyCompatibleMode(name,lookForViewOnlyFunction)){return this[name]()}else{return this.model[name]()}}},{key:"_isInViewOnlyCompatibleMode",value:function _isInViewOnlyCompatibleMode(name,lookForViewOnlyFunction){var checkForFunction=lookForViewOnlyFunction||name;if(!this.constructor.prototype[checkForFunction])return false;var hasCompatibleVersion=Object.prototype.hasOwnProperty.call(ViewOnlyQuestionViewCompatibilityLayer.prototype,checkForFunction);var usingCompatibleVersion=this.constructor.prototype[checkForFunction]===ViewOnlyQuestionViewCompatibilityLayer.prototype[checkForFunction];if(hasCompatibleVersion&&usingCompatibleVersion){switch(checkForFunction){case"setupFeedback":case"markQuestion":return true;}return false}return true}}]);return ViewOnlyQuestionViewCompatibilityLayer}(QuestionView);var QuestionView$1=__AMD("core/js/views/questionView",ViewOnlyQuestionViewCompatibilityLayer);var DropDownOption=__AMD("components/adapt-contrib-matching/js/dropdownOption",function(_Backbone$View){_inherits(DropDownItem,_Backbone$View);var _super=_createSuper(DropDownItem);function DropDownItem(){_classCallCheck(this,DropDownItem);return _super.apply(this,arguments)}_createClass(DropDownItem,[{key:"events",value:function events(){return{click:"onClick","click *":"onClick"}}},{key:"initialize",value:function initialize(settings){this.settings=settings;this.$inner=this.$(".js-dropdown-list-item-inner")}},{key:"isPlaceholder",value:function isPlaceholder(){return this.$el.is("[hidden]")}},{key:"parent",value:function parent(){return this.settings.parent}},{key:"onClick",value:function onClick(event){var parent=this.parent();event.preventDefault();this.select().scrollTo();parent.$button.focus()}},{key:"getValue",value:function getValue(){return this.$el.attr("value").trim()}},{key:"select",value:function select(){var parent=this.parent();parent.deselectAll();parent.setActiveDescendantId(this.el.id);this.$el.attr({selected:"","aria-selected":"true"});parent.$inner.html(this.$el.attr("text"));var value=this.isPlaceholder()?"":this.getValue();parent.$input.val(value).trigger("change");parent.trigger("change",parent);return this}},{key:"deselect",value:function deselect(){if(!this.isSelected())return this;var parent=this.parent();parent.removeActiveDescendantId();this.$el.removeAttr("selected");this.$el.attr("aria-selected","false");parent.$inner.html("");parent.$input.val("").trigger("change");parent.trigger("change",parent);return this}},{key:"reselect",value:function reselect(){var parent=this.parent();parent.setActiveDescendantId(this.$el[0].id);if(this.isSelected())return this;this.select();return this}},{key:"isSelected",value:function isSelected(){return Boolean(this.$el.attr("selected"))}},{key:"getIndex",value:function getIndex(){var _this=this;var parent=this.parent();return parent.options.findIndex(function(option){return option===_this})}},{key:"getNext",value:function getNext(){var parent=this.parent();return parent.options[this.getIndex()+1]}},{key:"getPrevious",value:function getPrevious(){var parent=this.parent();return parent.options[this.getIndex()-1]}},{key:"getFirst",value:function getFirst(){var parent=this.parent();return parent.options[0]}},{key:"getLast",value:function getLast(){var parent=this.parent();return parent.options[parent.options.length-1]}},{key:"scrollTo",value:function scrollTo(){var parent=this.parent();parent.settings.scrollToItem.call(parent,this)}},{key:"destroy",value:function destroy(){var parent=this.parent();this.remove();if(this.isPlaceholder()){parent.placeholder=null}else{for(var i=0,l=parent.options.length;i<l;i++){var item=parent.options[i];if(item!==this)continue;parent.options.splice(i,1);break}}delete this.settings}}]);return DropDownItem}(Backbone.View));var DropDown=function(_Backbone$View){_inherits(DropDown,_Backbone$View);var _super=_createSuper(DropDown);function DropDown(){_classCallCheck(this,DropDown);return _super.apply(this,arguments)}_createClass(DropDown,[{key:"initialize",value:function initialize(settings){_.bindAll(this,"onStartInteraction","onButtonClick","onListBlur","onKeyDown");this.settings=_.defaults(settings,DropDown.defaults);this.placeholder=null;this.options=[];this.setUpElements();this.setUpItems();this.select(this.settings.value);this.addEventListeners();this.toggleOpen(false);this.settings.load.call(this,this);this.trigger("load",this)}},{key:"setUpElements",value:function setUpElements(){this.$list=this.$(".js-dropdown-list");this.$button=this.$(".js-dropdown-btn");this.$inner=this.$button.find(".js-dropdown-inner");this.$input=this.$(".js-data-output")}},{key:"setUpItems",value:function setUpItems(){var _this=this;var $options=this.$(".js-dropdown-list-item");$options.each(function(index,el){var option=new DropDownOption({parent:_this,el:el});if(option.isPlaceholder()){_this.placeholder=option;return}_this.options.push(option)})}},{key:"addEventListeners",value:function addEventListeners(){this.$button.on({"mousedown touchstart":this.onStartInteraction,click:this.onButtonClick});this.$list.on("blur",this.onListBlur);$(document).on("keydown",this.onKeyDown)}},{key:"onStartInteraction",value:function onStartInteraction(){this.wasOpen=this.isOpen()}},{key:"deselectAll",value:function deselectAll(){this.placeholder.deselect();this.options.forEach(function(option){return option.deselect()})}},{key:"onButtonClick",value:function onButtonClick(){if(this.wasOpen||this.isOpen()){this.wasOpen=false;return}this.toggleOpen();var option=this.getFirstSelectedItem()||this.placeholder;if(!option)return;option.reselect();option.scrollTo();this.$list.focus()}},{key:"isOpen",value:function isOpen(){return!this.$list.hasClass("u-display-none")}},{key:"toggleOpen",value:function toggleOpen(){var open=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!this.isOpen();if(open)clearTimeout(this.blurTimeout);this.$button.attr("aria-expanded",open?"true":"false");var name=open?"openList":"closeList";this.settings[name].call(this,this);this.trigger(name,this)}},{key:"onListBlur",value:function onListBlur(){var _this2=this;var handleBlur=function(){_this2.toggleOpen(false);_this2.removeActiveDescendantId()};this.blurTimeout=setTimeout(handleBlur,100)}},{key:"onKeyDown",value:function onKeyDown(event){if(!this.isOpen())return;var option=this.getFirstSelectedItem()||this.placeholder;switch(event.keyCode){case 38:event.preventDefault();option=option.getPrevious()||option.getLast();break;case 40:event.preventDefault();option=option.getNext()||option.getFirst();break;case 13:case 32:case 27:event.preventDefault();this.$button.focus();return;default:return;}option.select().scrollTo()}},{key:"getFirstSelectedItem",value:function getFirstSelectedItem(){return this.options.find(function(option){return option.isSelected()})||this.options[0]}},{key:"setActiveDescendantId",value:function setActiveDescendantId(id){this.$list.attr("aria-activedescendant",id)}},{key:"removeActiveDescendantId",value:function removeActiveDescendantId(){this.$list.removeAttr("aria-activedescendant")}},{key:"select",value:function select(value){value=String(value);var option=this.options.find(function(option){return option.getValue()===value});if(option){option.select();return}this.placeholder.select()}},{key:"toggleDisabled",value:function toggleDisabled(){var value=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!this.$input.attr("disabled");if(value===false){this.$input.removeAttr("disabled");this.$button.removeAttr("disabled").removeClass("is-disabled");this.$el.removeAttr("disabled");return}this.$input.attr("disabled","");this.$button.attr("disabled","").addClass("is-disabled");this.$el.attr("disabled","")}},{key:"isEmpty",value:function isEmpty(){return!this.getFirstSelectedItem()}},{key:"val",value:function val(){return this.$input.val()}},{key:"destroy",value:function destroy(){this.removeEventListeners();this.$el.remove();delete this.options;delete this.$input;delete this.$inner;delete this.$button;delete this.$list;delete this.$el}},{key:"removeEventListeners",value:function removeEventListeners(){this.$button.off({"mousedown touchstart":this.onStartInteraction,click:this.onButtonClick});this.$list.off("blur",this.onListBlur);$(document).off("keydown",this.onKeyDown)}}]);return DropDown}(Backbone.View);DropDown.defaults={load:function(){},openList:function(){this.$list.css({top:"",left:this.$button[0].offsetLeft,width:this.$button.outerWidth()}).addClass("u-visibility-hidden").removeClass("u-display-none");var offset=this.$list[0].getBoundingClientRect();var height=this.$list.height();var windowHeight=$(window).height();var isOffscreen=offset.top+height>windowHeight;this.$list.css("top",isOffscreen?-height:"").removeClass("u-visibility-hidden").focus()},closeList:function(){this.$list.removeClass("u-visibility-hidden").addClass("u-display-none").css("top","")},scrollToItem:function(option){var height=this.$list[0].clientHeight;var pos=option.$el[0].offsetTop-height/2;this.$list[0].scrollTop=pos}};var DropDown$1=__AMD("components/adapt-contrib-matching/js/dropdown",DropDown);var MatchingView=__AMD("components/adapt-contrib-matching/js/matchingView",function(_QuestionView){_inherits(MatchingView,_QuestionView);var _super=_createSuper(MatchingView);function MatchingView(){_classCallCheck(this,MatchingView);return _super.apply(this,arguments)}_createClass(MatchingView,[{key:"preinitialize",value:function preinitialize(){this.dropdowns=[]}},{key:"disableQuestion",value:function disableQuestion(){this.dropdowns.forEach(function(dropdown){return dropdown.toggleDisabled(true)})}},{key:"enableQuestion",value:function enableQuestion(){this.dropdowns.forEach(function(dropdown){return dropdown.toggleDisabled(false)})}},{key:"setupQuestion",value:function setupQuestion(){this.listenToOnce(Adapt.parentView,"postRemove",this.onPostRemove);this.model.setupRandomisation()}},{key:"onPostRemove",value:function onPostRemove(){var _this=this;this.dropdowns.forEach(function(dropdown){dropdown.off("change",_this.onOptionSelected);dropdown.destroy()})}},{key:"onQuestionRendered",value:function onQuestionRendered(){this.setReadyStatus();this.setUpDropdowns()}},{key:"setUpDropdowns",value:function setUpDropdowns(){var _this2=this;this.onOptionSelected=this.onOptionSelected.bind(this);var items=this.model.get("_items");this.$(".matching__item").each(function(i,el){var _selectedOption$_inde;var item=items[i];var selectedOption=item._options.find(function(_ref){var _isSelected=_ref._isSelected;return _isSelected});var dropdown=new DropDown$1({el:$(el).find(".dropdown")[0],placeholder:_this2.model.get("placeholder"),value:(_selectedOption$_inde=selectedOption===null||selectedOption===void 0?void 0:selectedOption._index)!==null&&_selectedOption$_inde!==void 0?_selectedOption$_inde:null});_this2.dropdowns.push(dropdown);dropdown.on("change",_this2.onOptionSelected)});this.enableQuestion();if(this.model.get("_isEnabled")!==true){this.disableQuestion()}}},{key:"onCannotSubmit",value:function onCannotSubmit(){this.dropdowns.forEach(function(dropdown){if(!dropdown.isEmpty())return;dropdown.$el.parents(".matching__select-container").addClass("has-error")})}},{key:"onOptionSelected",value:function onOptionSelected(dropdown){if(this.model.get("_isInteractionComplete"))return;var $container=dropdown.$el.parents(".matching__select-container");$container.removeClass("error");var itemIndex=dropdown.$el.parents(".matching__item").index();if(dropdown.isEmpty())return;var optionIndex=parseInt(dropdown.val());this.model.setOptionSelected(itemIndex,optionIndex,true)}},{key:"showMarking",value:function showMarking(){var _this3=this;if(!this.model.get("_canShowMarking"))return;this.model.get("_items").forEach(function(_ref2,i){var _isCorrect=_ref2._isCorrect;var $item=_this3.$(".matching__item").eq(i);$item.toggleClass("is-correct",_isCorrect).toggleClass("is-incorrect",!_isCorrect)})}},{key:"resetQuestion",value:function resetQuestion(){var _this4=this;this.$(".matching__item").removeClass("is-correct is-incorrect");this.model.set("_isAtLeastOneCorrectSelection",false);var resetAll=this.model.get("_shouldResetAllAnswers");this.model.get("_items").forEach(function(item,index){if(item._isCorrect&&resetAll===false)return;_this4.selectValue(index,null);item._options.forEach(function(option){return option._isSelected=false});item._selected=null})}},{key:"showCorrectAnswer",value:function showCorrectAnswer(){var _this5=this;this.model.get("_items").forEach(function(_ref3,index){var _options=_ref3._options;var correctOption=_options.find(function(_ref4){var _isCorrect=_ref4._isCorrect;return _isCorrect});_this5.selectValue(index,correctOption._index)})}},{key:"hideCorrectAnswer",value:function hideCorrectAnswer(){var _this6=this;var answerArray=this.model.has("_tempUserAnswer")?this.model.get("_tempUserAnswer"):this.model.get("_userAnswer");this.model.get("_items").forEach(function(_ref5,index){var _options=_ref5._options;var key=answerArray[index];var value=_options[key]._index;_this6.selectValue(index,value)})}},{key:"selectValue",value:function selectValue(index,optionIndex){if(!this.dropdowns)return;var dropdown=this.dropdowns[index];if(!dropdown)return;dropdown.select(optionIndex)}}]);return MatchingView}(QuestionView$1));var MatchingModel=__AMD("components/adapt-contrib-matching/js/matchingModel",function(_QuestionModel){_inherits(MatchingModel,_QuestionModel);var _super=_createSuper(MatchingModel);function MatchingModel(){_classCallCheck(this,MatchingModel);return _super.apply(this,arguments)}_createClass(MatchingModel,[{key:"init",value:function init(){_get(_getPrototypeOf(MatchingModel.prototype),"init",this).call(this);this.setupQuestionItemIndexes()}},{key:"reset",value:function reset(){var type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"hard";var canReset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.get("_canReset");var wasReset=_get(_getPrototypeOf(MatchingModel.prototype),"reset",this).call(this,type,canReset);if(!wasReset)return false;this.set("_isAtLeastOneCorrectSelection",false);this.get("_items").forEach(function(item){item._options.forEach(function(option){return option._isSelected=false});item._selected=null});return true}},{key:"setupQuestionItemIndexes",value:function setupQuestionItemIndexes(){this.get("_items").forEach(function(item,index){if(item._index===undefined){item._index=index;item._selected=false}item._options.forEach(function(option,index){if(option._index!==undefined)return;option._index=index;option._isSelected=false})})}},{key:"setupRandomisation",value:function setupRandomisation(){if(!this.get("_isRandom")||!this.get("_isEnabled"))return;this.get("_items").forEach(function(item){return item._options=_.shuffle(item._options)})}},{key:"restoreUserAnswers",value:function restoreUserAnswers(){if(!this.get("_isSubmitted"))return;var userAnswer=this.get("_userAnswer");this.get("_items").forEach(function(item){item._options.forEach(function(option){if(option._index!==userAnswer[item._index])return;option._isSelected=true;item._selected=option})});this.setQuestionAsSubmitted();this.checkCanSubmit();this.markQuestion();this.setScore();this.setupFeedback()}},{key:"canSubmit",value:function canSubmit(){var canSubmit=this.get("_items").every(function(_ref){var _options=_ref._options;return _options.some(function(_ref2){var _isSelected=_ref2._isSelected;return _isSelected})});return canSubmit}},{key:"setOptionSelected",value:function setOptionSelected(itemIndex,optionIndex,isSelected){var item=this.get("_items")[itemIndex];if(isNaN(optionIndex)){item._options.forEach(function(option){return option._isSelected=false});item._selected=null;return this.checkCanSubmit()}var option=item._options.find(function(_ref3){var _index=_ref3._index;return _index===optionIndex});option._isSelected=isSelected;item._selected=option;this.checkCanSubmit()}},{key:"storeUserAnswer",value:function storeUserAnswer(){var userAnswer=new Array(this.get("_items").length);var tempUserAnswer=new Array(this.get("_items").length);this.get("_items").forEach(function(item){var optionIndex=item._options.findIndex(function(_ref4){var _isSelected=_ref4._isSelected;return _isSelected});tempUserAnswer[item._index]=optionIndex;userAnswer[item._index]=item._options[optionIndex]._index});this.set({_userAnswer:userAnswer,_tempUserAnswer:tempUserAnswer})}},{key:"isCorrect",value:function isCorrect(){var _this=this;var numberOfCorrectAnswers=this.get("_items").reduce(function(a,item){var _item$_selected;var isCorrect=(_item$_selected=item._selected)===null||_item$_selected===void 0?void 0:_item$_selected._isCorrect;item._isCorrect=Boolean(isCorrect);if(!isCorrect){return a}_this.set("_isAtLeastOneCorrectSelection",true);return++a},0);this.set("_numberOfCorrectAnswers",numberOfCorrectAnswers);if(numberOfCorrectAnswers===this.get("_items").length){return true}return false}},{key:"setScore",value:function setScore(){var questionWeight=this.get("_questionWeight");if(this.get("_isCorrect")){this.set("_score",questionWeight);return}var numberOfCorrectAnswers=this.get("_numberOfCorrectAnswers");var itemLength=this.get("_items").length;var score=questionWeight*numberOfCorrectAnswers/itemLength;this.set("_score",score)}},{key:"isPartlyCorrect",value:function isPartlyCorrect(){return this.get("_isAtLeastOneCorrectSelection")}},{key:"resetUserAnswer",value:function resetUserAnswer(){this.set("_userAnswer",[])}},{key:"getInteractionObject",value:function getInteractionObject(){var interactions={correctResponsesPattern:null,source:null,target:null};var items=this.get("_items");interactions.correctResponsesPattern=[items.map(function(_ref5,questionIndex){var _options=_ref5._options;questionIndex++;return[questionIndex,_options.filter(function(_ref6){var _isCorrect=_ref6._isCorrect;return _isCorrect}).map(function(_ref7){var _index=_ref7._index;return"".concat(questionIndex,"_").concat(_index+1)})].join("[.]")}).join("[,]")];interactions.source=items.map(function(item){return{id:"".concat(item._index+1),description:item.text}}).flat(Infinity);interactions.target=items.map(function(_ref8,index){var _options=_ref8._options;index++;return _options.map(function(option){return{id:"".concat(index,"_").concat(option._index+1),description:option.text}})}).flat(Infinity);return interactions}},{key:"getResponse",value:function getResponse(){var responses=this.get("_userAnswer").map(function(userAnswer,index){return"".concat(index+1,".").concat(userAnswer+1)});return responses.join("#")}},{key:"getResponseType",value:function getResponseType(){return"matching"}},{key:"getCorrectAnswerAsText",value:function getCorrectAnswerAsText(){var correctAnswerTemplate=Adapt.course.get("_globals")._components._matching.ariaCorrectAnswer;var ariaAnswer=this.get("_items").map(function(item){var correctOption=item._options.find(function(_ref9){var _isCorrect=_ref9._isCorrect;return _isCorrect});return Handlebars.compile(correctAnswerTemplate)({itemText:item.text,correctAnswer:correctOption.text})}).join("<br>");return ariaAnswer}},{key:"getUserAnswerAsText",value:function getUserAnswerAsText(){var userAnswerTemplate=Adapt.course.get("_globals")._components._matching.ariaUserAnswer;var answerArray=this.has("_tempUserAnswer")?this.get("_tempUserAnswer"):this.get("_userAnswer");var ariaAnswer=this.get("_items").map(function(item,index){var key=answerArray[index];return Handlebars.compile(userAnswerTemplate)({itemText:item.text,userAnswer:item._options[key].text})}).join("<br>");return ariaAnswer}}]);return MatchingModel}(QuestionModel$1));__AMD("components/adapt-contrib-matching/js/adapt-contrib-matching",Adapt.register("matching",{view:MatchingView,model:MatchingModel}));var McqView=function(_QuestionView){_inherits(McqView,_QuestionView);var _super=_createSuper(McqView);function McqView(){_classCallCheck(this,McqView);return _super.apply(this,arguments)}_createClass(McqView,[{key:"initialize",value:function initialize(){var _get2;this.onKeyPress=this.onKeyPress.bind(this);this.onItemSelect=this.onItemSelect.bind(this);this.onItemFocus=this.onItemFocus.bind(this);this.onItemBlur=this.onItemBlur.bind(this);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}(_get2=_get(_getPrototypeOf(McqView.prototype),"initialize",this)).call.apply(_get2,[this].concat(args))}},{key:"setupQuestion",value:function setupQuestion(){this.model.setupRandomisation()}},{key:"onQuestionRendered",value:function onQuestionRendered(){this.setReadyStatus()}},{key:"onKeyPress",value:function onKeyPress(event){if(event.which!==13)return;this.onItemSelect(event)}},{key:"onItemFocus",value:function onItemFocus(event){if(!this.model.isInteractive())return;var index=parseInt($(event.currentTarget).data("adapt-index"));var item=this.model.getChildren().findWhere({_index:index});item.set("_isHighlighted",true)}},{key:"onItemBlur",value:function onItemBlur(event){var index=$(event.currentTarget).data("adapt-index");var item=this.model.getChildren().findWhere({_index:index});item.set("_isHighlighted",false)}},{key:"onItemSelect",value:function onItemSelect(event){if(!this.model.isInteractive())return;var index=$(event.currentTarget).data("adapt-index");var itemModel=this.model.getItem(index);var shouldSelect=!itemModel.get("_isActive");if(this.model.isSingleSelect()){shouldSelect=true;this.model.resetActiveItems()}else if(shouldSelect&&this.model.isAtActiveLimit()){this.model.getLastActiveItem().toggleActive(false)}itemModel.toggleActive(shouldSelect)}},{key:"resetQuestion",value:function resetQuestion(){this.model.resetItems()}}]);return McqView}(QuestionView$1);McqView.template="mcq.jsx";var McqView$1=__AMD("components/adapt-contrib-mcq/js/McqView",McqView);var BlendedItemsComponentQuestionModel=function(_QuestionModel){_inherits(BlendedItemsComponentQuestionModel,_QuestionModel);var _super=_createSuper(BlendedItemsComponentQuestionModel);function BlendedItemsComponentQuestionModel(){_classCallCheck(this,BlendedItemsComponentQuestionModel);return _super.apply(this,arguments)}_createClass(BlendedItemsComponentQuestionModel,[{key:"init",value:function init(){ItemsComponentModel.prototype.init.call(this);_get(_getPrototypeOf(BlendedItemsComponentQuestionModel.prototype),"init",this).call(this)}},{key:"reset",value:function reset(){var type=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"hard";var canReset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.get("_canReset");ItemsComponentModel.prototype.reset.call(this,type,canReset);return _get(_getPrototypeOf(BlendedItemsComponentQuestionModel.prototype),"reset",this).call(this,type,canReset)}}]);return BlendedItemsComponentQuestionModel}(QuestionModel$1);Object.getOwnPropertyNames(ItemsComponentModel.prototype).forEach(function(name){if(name==="constructor"||name==="init"||name==="reset")return;Object.defineProperty(BlendedItemsComponentQuestionModel.prototype,name,{value:ItemsComponentModel.prototype[name]})});var ItemsQuestionModel$1=__AMD("core/js/models/itemsQuestionModel",function(_BlendedItemsComponen){_inherits(ItemsQuestionModel,_BlendedItemsComponen);var _super2=_createSuper(ItemsQuestionModel);function ItemsQuestionModel(){_classCallCheck(this,ItemsQuestionModel);return _super2.apply(this,arguments)}_createClass(ItemsQuestionModel,[{key:"init",value:function init(){_get(_getPrototypeOf(ItemsQuestionModel.prototype),"init",this).call(this);this.set("_isRadio",this.isSingleSelect());this.listenTo(this.getChildren(),"change:_isActive",this.checkCanSubmit);this.checkCanSubmit()}},{key:"restoreUserAnswers",value:function restoreUserAnswers(){if(!this.get("_isSubmitted"))return;var itemModels=this.getChildren();var userAnswer=this.get("_userAnswer");itemModels.each(function(item){item.toggleActive(userAnswer[item.get("_index")])});this.setQuestionAsSubmitted();this.markQuestion();this.setScore();this.setupFeedback()}},{key:"setupRandomisation",value:function setupRandomisation(){if(!this.get("_isRandom")||!this.get("_isEnabled"))return;var children=this.getChildren();children.set(children.shuffle())}},{key:"canSubmit",value:function canSubmit(){var activeItems=this.getActiveItems();return activeItems.length>0}},{key:"storeUserAnswer",value:function storeUserAnswer(){var items=this.getChildren().slice(0);items.sort(function(a,b){return a.get("_index")-b.get("_index")});var userAnswer=items.map(function(itemModel){return itemModel.get("_isActive")});this.set("_userAnswer",userAnswer)}},{key:"isCorrect",value:function isCorrect(){var allChildren=this.getChildren();var activeChildren=allChildren.filter(function(itemModel){return itemModel.get("_isActive")});var isItemCorrect=function(itemModel){return itemModel.get("_shouldBeSelected")&&!itemModel.get("_isPartlyCorrect")};var isItemPartlyCorrect=function(itemModel){return itemModel.get("_isPartlyCorrect")};var isItemIncorrect=function(itemModel){return!itemModel.get("_shouldBeSelected")&&!itemModel.get("_isPartlyCorrect")};var sum=function(list,predicate){return list.reduce(function(sum,item){return sum+(predicate(item)?1:0)},0)};var props={_numberOfRequiredAnswers:sum(allChildren,isItemCorrect),_numberOfCorrectAnswers:sum(activeChildren,isItemCorrect),_numberOfPartlyCorrectAnswers:sum(activeChildren,isItemPartlyCorrect),_numberOfIncorrectAnswers:sum(activeChildren,isItemIncorrect)};activeChildren.forEach(function(itemModel){return itemModel.set("_isCorrect",itemModel.get("_shouldBeSelected"))});props._isAtLeastOneCorrectSelection=props._numberOfCorrectAnswers||props._numberOfPartlyCorrectAnswers;var numberOfSelectableAnswers=this.get("_selectable");var hasSelectableCorrectAnswers=props._numberOfCorrectAnswers===numberOfSelectableAnswers;var hasAllCorrectAnswers=props._numberOfCorrectAnswers===props._numberOfRequiredAnswers;var hasCorrectAnswers=hasSelectableCorrectAnswers||hasAllCorrectAnswers;var hasIncorrectAnswers=props._numberOfIncorrectAnswers;var hasPartlyCorrectAnswers=props._numberOfPartlyCorrectAnswers;this.set(props);return hasCorrectAnswers&&!hasIncorrectAnswers&&!hasPartlyCorrectAnswers}},{key:"setScore",value:function setScore(){var questionWeight=this.get("_questionWeight");var answeredCorrectly=this.get("_isCorrect");var score=answeredCorrectly?questionWeight:0;this.set("_score",score)}},{key:"score",get:function(){var _this$getChildren;if(!this.get("_hasItemScoring"))return _get(_getPrototypeOf(ItemsQuestionModel.prototype),"score",this);var children=((_this$getChildren=this.getChildren())===null||_this$getChildren===void 0?void 0:_this$getChildren.toArray())||[];return children.reduce(function(score,child){return score+=child.get("_isActive")?child.get("_score")||0:0},0)}},{key:"maxScore",get:function(){var _this$getChildren2;if(!this.get("_hasItemScoring"))return _get(_getPrototypeOf(ItemsQuestionModel.prototype),"maxScore",this);var children=((_this$getChildren2=this.getChildren())===null||_this$getChildren2===void 0?void 0:_this$getChildren2.toArray())||[];var scores=children.map(function(child){return child.get("_score")||0});scores.sort(function(a,b){return a-b});return scores.reverse().slice(0,this.get("_selectable")).filter(function(score){return score>0}).reduce(function(maxScore,score){return maxScore+=score},0)}},{key:"minScore",get:function(){var _this$getChildren3;if(!this.get("_hasItemScoring"))return _get(_getPrototypeOf(ItemsQuestionModel.prototype),"minScore",this);var children=((_this$getChildren3=this.getChildren())===null||_this$getChildren3===void 0?void 0:_this$getChildren3.toArray())||[];var scores=children.map(function(child){return child.get("_score")||0});scores.sort(function(a,b){return a-b});return scores.slice(0,this.get("_selectable")).filter(function(score){return score<0}).reduce(function(minScore,score){return minScore+=score},0)}},{key:"setupFeedback",value:function setupFeedback(){if(!this.has("_feedback"))return;if(this.get("_isCorrect")){this.setupCorrectFeedback();return}if(this.isPartlyCorrect()){this.setupPartlyCorrectFeedback();return}var activeItem=this.getActiveItem();if(this.isSingleSelect()&&activeItem.get("feedback")){this.setupIndividualFeedback(activeItem);return}this.setupIncorrectFeedback()}},{key:"setupIndividualFeedback",value:function setupIndividualFeedback(selectedItem){this.set({feedbackTitle:this.getFeedbackTitle(this.get("_feedback")),feedbackMessage:selectedItem.get("feedback")})}},{key:"isPartlyCorrect",value:function isPartlyCorrect(){return this.get("_isAtLeastOneCorrectSelection")}},{key:"resetUserAnswer",value:function resetUserAnswer(){this.set("_userAnswer",[])}},{key:"isAtActiveLimit",value:function isAtActiveLimit(){var selectedItems=this.getActiveItems();return selectedItems.length===this.get("_selectable")}},{key:"isSingleSelect",value:function isSingleSelect(){return this.get("_selectable")===1}},{key:"getLastActiveItem",value:function getLastActiveItem(){var selectedItems=this.getActiveItems();return selectedItems[selectedItems.length-1]}},{key:"resetQuestion",value:function resetQuestion(){this.resetItems()}},{key:"resetItems",value:function resetItems(){this.resetActiveItems();this.set("_isAtLeastOneCorrectSelection",false)}},{key:"getInteractionObject",value:function getInteractionObject(){var interactions={correctResponsesPattern:[],choices:[]};interactions.choices=this.getChildren().map(function(itemModel){return{id:(itemModel.get("_index")+1).toString(),description:itemModel.get("text")}});var correctItems=this.getChildren().filter(function(itemModel){return itemModel.get("_shouldBeSelected")});interactions.correctResponsesPattern=[correctItems.map(function(itemModel){return String(itemModel.get("_index")+1)}).join("[,]")];return interactions}},{key:"getResponse",value:function getResponse(){var activeItems=this.getActiveItems();var activeIndexes=activeItems.map(function(itemModel){return itemModel.get("_index")+1});return activeIndexes.join(",")}},{key:"getResponseType",value:function getResponseType(){return"choice"}},{key:"getCorrectAnswerAsText",value:function getCorrectAnswerAsText(){var _correctOptions$;var globals=Adapt.course.get("_globals")._components["_"+this.get("_component")];var isSingleSelect=this.isSingleSelect();var ariaAnswer=isSingleSelect?globals===null||globals===void 0?void 0:globals.ariaCorrectAnswer:globals===null||globals===void 0?void 0:globals.ariaCorrectAnswers;if(!ariaAnswer)return;var correctOptions=this.getChildren().where({_shouldBeSelected:true});var correctAnswer=isSingleSelect?(_correctOptions$=correctOptions[0])===null||_correctOptions$===void 0?void 0:_correctOptions$.get("text"):correctOptions.map(function(correctOption){return correctOption.get("text")}).join("<br>");return Handlebars.compile(ariaAnswer)({correctAnswer:correctAnswer})}},{key:"getUserAnswerAsText",value:function getUserAnswerAsText(){var globals=Adapt.course.get("_globals")._components["_"+this.get("_component")];var isSingleSelect=this.isSingleSelect();var ariaAnswer=isSingleSelect?globals===null||globals===void 0?void 0:globals.ariaUserAnswer:globals===null||globals===void 0?void 0:globals.ariaUserAnswers;if(!ariaAnswer)return;var selectedItems=this.getActiveItems();var userAnswer=isSingleSelect?selectedItems[0].get("text"):selectedItems.map(function(selectedItem){return selectedItem.get("text")}).join("<br>");return Handlebars.compile(ariaAnswer)({userAnswer:userAnswer})}}]);return ItemsQuestionModel}(BlendedItemsComponentQuestionModel));var McqModel=__AMD("components/adapt-contrib-mcq/js/McqModel",function(_ItemsQuestionModel){_inherits(McqModel,_ItemsQuestionModel);var _super=_createSuper(McqModel);function McqModel(){_classCallCheck(this,McqModel);return _super.apply(this,arguments)}return McqModel}(ItemsQuestionModel$1));__AMD("components/adapt-contrib-mcq/js/adapt-contrib-mcq",Adapt.register("mcq",{model:McqModel,view:McqView$1}));var TextView=function(_ComponentView){_inherits(TextView,_ComponentView);var _super=_createSuper(TextView);function TextView(){_classCallCheck(this,TextView);return _super.apply(this,arguments)}_createClass(TextView,[{key:"postRender",value:function postRender(){this.setReadyStatus();this.setupInview()}},{key:"setupInview",value:function setupInview(){var selector=this.getInviewElementSelector();if(!selector)return this.setCompletionStatus();this.setupInviewCompletion(selector)}},{key:"getInviewElementSelector",value:function getInviewElementSelector(){if(this.model.get("body"))return".component__body";if(this.model.get("instruction"))return".component__instruction";if(this.model.get("displayTitle"))return".component__title";return null}}]);return TextView}(ComponentView$1);TextView.template="text.jsx";var TextView$1=__AMD("components/adapt-contrib-text/js/TextView",TextView);var TextModel=__AMD("components/adapt-contrib-text/js/TextModel",function(_ComponentModel){_inherits(TextModel,_ComponentModel);var _super=_createSuper(TextModel);function TextModel(){_classCallCheck(this,TextModel);return _super.apply(this,arguments)}return TextModel}(ComponentModel$1));__AMD("components/adapt-contrib-text/js/adapt-contrib-text",Adapt.register("text",{model:TextModel,view:TextView$1}));var aboutPage=_.extend({initialize:function(){this.listenTo(Adapt,"aboutPage:showAboutPage",this.showAboutPage);this.listenTo(Adapt,"router:course",this.updateCourse);this.listenTo(Adapt,"pageView:ready",this.addLink);this.listenTo(Adapt,"menuView:ready",this.addLink);this.listenTo(Adapt,"router:page",this.updatePage)},updateCourse:function(target){this.currentCourse=target},updatePage:function(target){this.contentObject=target},getPage:function(){return this.contentObject},getCourse:function(){return this.currentCourse},addLink:function(){var title="About";var contactEmail="";var contactLinkText="";try{title=Adapt.course.get("_globals")._extensions._aboutPage.linkText}catch(err){}try{var items=Adapt.course.get("_aboutPage")._items}catch(err){return}try{if($(".about-links").prop("innerHTML").trim().length>0){$(".about-links").append(" | ")}$(".about-links").append("<a class=\"about\" onClick=\"require('core/js/adapt').trigger('aboutPage:showAboutPage'); return false;\">"+title+"</a>")}catch(err){}try{contactEmail=Adapt.course.get("_globals")._extensions._aboutPage.contactEMail;contactLinkText=Adapt.course.get("_globals")._extensions._aboutPage.contactLinkText;if(contactLinkText!=""&&contactEmail!=""){console.log(contactEmail);console.log(contactLinkText);if($(".about-links").prop("innerHTML").trim().length>0){$(".about-links").append(" | ")}$(".about-links").append("<a class=\"contact\" href=\"mailto:"+contactEmail+"\" target=\"_blank\">"+contactLinkText+"</a>")}}catch(err){console.log(err)}try{var aboutcredit=this.contentObject.get("_aboutPage").aboutCredit;if(aboutcredit!=""){$(".about-credit").html(aboutcredit)}}catch(err){}try{var aboutSLtext=this.contentObject.get("_aboutPage").SL_text;if(aboutSLtext!=""){$("#about-SL-text").html(aboutSLtext)}}catch(err){}},showAboutPage:function(){var items=[];try{items=this.contentObject.get("_aboutPage")._items}catch(err){}if(items.length<1){items=Adapt.course.get("_aboutPage")._items}var title="About";try{title=Adapt.course.get("_globals")._extensions._aboutPage.titleText}catch(err){}var string="";_.each(items,function(item){var graphic=item._graphic;if(graphic.src){string+="<div class='aboutPageGraphicElement'><img class='aboutPageGraphic' src='"+graphic.src+"'/></div>"}string+="<div class='aboutPageText'>";string+="<h2>"+item.title+"</h2>";string+="<p>"+item.description+"</p>";string+="</div>";string+="<hr class='aboutPageRule'/>"});var alertObject={title:title,body:string};Adapt.once("notify:closed",function(){Adapt.trigger("tutor:closed")});Adapt.trigger("notify:popup",alertObject);Adapt.trigger("tutor:opened")}},Backbone.Events);aboutPage.initialize();__AMD("extensions/adapt-contrib-aboutPage/js/adapt-contrib-aboutPage",aboutPage);var AssessmentView={postRender:function(){ArticleView$1.prototype.postRender.call(this);if(this.model.isAssessmentEnabled()){var _config$_questions;this._setupEventListeners();var config=this.model.getConfig();if((config===null||config===void 0?void 0:(_config$_questions=config._questions)===null||_config$_questions===void 0?void 0:_config$_questions._canShowMarking)===false){this.$el.addClass("has-no-marking")}}this.$el.addClass("is-assessment")},_setupEventListeners:function(){this.listenTo(Adapt,{"assessments:complete":this._onAssessmentComplete,"assessments:reset":this._onAssessmentReset,remove:this._onRemove})},_removeEventListeners:function(){this.stopListening(Adapt,{"assessments:complete":this._onAssessmentComplete,"assessments:reset":this._onAssessmentReset})},_onAssessmentComplete:function(state,model){if(state.id!==this.model.get("_assessment")._id)return;Adapt.log.info("assessment complete",state,model)},_onAssessmentReset:function(state,model){if(state.id!==this.model.get("_assessment")._id)return;Adapt.log.info("assessment reset",state,model)},_onRemove:function(){this._removeEventListeners()}};var AdaptAssessmentArticleView=__AMD("extensions/adapt-contrib-assessment/js/adapt-assessmentArticleView",AssessmentView);var QuestionBank=function(){function QuestionBank(quizBankid,articleId,numQuestionBlocks,uniqueQuestions){_classCallCheck(this,QuestionBank);this._id=quizBankid;this._articleId=articleId;this._numQuestionBlocks=numQuestionBlocks;this._uniqueQuestions=uniqueQuestions;this.questionBlocks=[];this.unUsedQuestionBlocks=undefined;this.usedQuestionBlocks=[]}_createClass(QuestionBank,[{key:"getID",value:function getID(){return this._id}},{key:"addBlock",value:function addBlock(block){this.questionBlocks.push(block)}},{key:"getRandomQuestionBlocks",value:function getRandomQuestionBlocks(){this.checkResetUnunsedBlocks();var questionBlocks=[];var usedQuestionBlocks=this.usedQuestionBlocks.slice(0);for(var i=0;i<this._numQuestionBlocks;i++){var question=this.getRandomQuestion();if(question!==undefined){questionBlocks.push(question);continue}if(usedQuestionBlocks.length===0)break;var index=Math.floor(Math.random()*(usedQuestionBlocks.length-1));question=usedQuestionBlocks.splice(index,1)[0];questionBlocks.push(question)}return questionBlocks}},{key:"checkResetUnunsedBlocks",value:function checkResetUnunsedBlocks(){if(this.unUsedQuestionBlocks!==undefined&&this._uniqueQuestions)return;this.unUsedQuestionBlocks=this.questionBlocks.slice(0)}},{key:"getRandomQuestion",value:function getRandomQuestion(){if(this.unUsedQuestionBlocks!==undefined&&this.unUsedQuestionBlocks.length<1){Adapt.log.warn("assessment:"+this._articleId+" No more unique questions for _assessment._quizBankID "+this._id);return undefined}var index=Math.round(Math.random()*(this.unUsedQuestionBlocks.length-1));var questionBlock=this.unUsedQuestionBlocks[index];this.usedQuestionBlocks.push(questionBlock);this.unUsedQuestionBlocks.splice(index,1);return questionBlock}}]);return QuestionBank}();var QuestionBank$1=__AMD("extensions/adapt-contrib-assessment/js/adapt-assessmentQuestionBank",QuestionBank);var givenIdCount=0;var assessmentConfigDefaults={_isEnabled:true,_questions:{_resetType:"soft",_canShowFeedback:false,_canShowMarking:false,_canShowModelAnswer:false},_suppressMarking:false,_isPercentageBased:true,_scoreToPass:100,_correctToPass:100,_includeInTotalScore:true,_assessmentWeight:1,_isResetOnRevisit:true,_reloadPageOnReset:true,_attempts:"infinite",_allowResetIfPassed:false};var AssessmentModel={_getCurrentQuestionComponents:function(){return this.findDescendantModels("block").filter(function(block){return block.get("_isAvailable")}).reduce(function(questions,block){return questions.concat(block.findDescendantModels("question"))},[])},_getAllQuestionComponents:function(){return this.findDescendantModels("question")},_postInitialize:function(){if(!this.isAssessmentEnabled())return;var assessmentConfig=this.getConfig();Object.assign(this,{_originalChildModels:null,_questionBanks:null,_forceResetOnRevisit:false});var attemptsLeft;switch(assessmentConfig._attempts){case"infinite":case 0:case undefined:case-1:case null:attemptsLeft="infinite";break;default:attemptsLeft=assessmentConfig._attempts;break;}this.set({_assessmentCompleteInSession:false,_attemptInProgress:false,_isAssessmentComplete:false,_numberOfQuestionsAnswered:0,_lastAttemptScoreAsPercent:0,_attempts:attemptsLeft,_attemptsLeft:attemptsLeft,_attemptsSpent:0});this.listenToOnce(Adapt,"app:dataReady",this._onDataReady);this.listenTo(Adapt,"remove",this._onRemove)},init:function(){this._originalChildModels=this.getChildren().models;this.setupCurrentQuestionComponents();this._setAssessmentOwnershipOnChildrenModels();this._updateQuestionsState()},setupCurrentQuestionComponents:function(){var assessmentQuestionsConfig=this.getConfig()._questions;this._getAllQuestionComponents().forEach(function(component){component.set({_canShowFeedback:assessmentQuestionsConfig._canShowFeedback,_canShowMarking:assessmentQuestionsConfig._canShowMarking,_canShowModelAnswer:assessmentQuestionsConfig._canShowModelAnswer})})},_setAssessmentOwnershipOnChildrenModels:function(){var assessmentConfig=this.get("_assessment");var childConfig={_isPartOfAssessment:true,_assessmentId:assessmentConfig._id};var _iterator=_createForOfIteratorHelper(this._originalChildModels),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var blockModel=_step.value;blockModel.set(childConfig);blockModel.setOnChildren(childConfig)}}catch(err){_iterator.e(err)}finally{_iterator.f()}},_onDataReady:function(){Adapt.assessment.register(this)},_setupAssessmentData:function(force,callback){var _this=this;var assessmentConfig=this.getConfig();var state=this.getState();var shouldResetAssessment=!this.get("_attemptInProgress")&&!state.isPass||force===true;var shouldResetQuestions=assessmentConfig._isResetOnRevisit&&(state.allowResetIfPassed||!state.isPass)||force===true;if(shouldResetAssessment||shouldResetQuestions){Adapt.trigger("assessments:preReset",this.getState(),this)}var quizModels;if(shouldResetAssessment){this.set({_numberOfQuestionsAnswered:0,_isAssessmentComplete:false,_assessmentCompleteInSession:false,_score:0});this.getChildren().models=this._originalChildModels;if(assessmentConfig!==null&&assessmentConfig!==void 0&&assessmentConfig._banks._isEnabled&&(assessmentConfig===null||assessmentConfig===void 0?void 0:assessmentConfig._banks._split.length)>1){quizModels=this._setupBankedAssessment()}else if(assessmentConfig!==null&&assessmentConfig!==void 0&&assessmentConfig._randomisation._isEnabled){quizModels=this._setupRandomisedAssessment()}}if(!quizModels){quizModels=this.getChildren().models}else if(quizModels.length===0){quizModels=this.getChildren().models;Adapt.log.warn("assessment: Not enough unique questions to create a fresh assessment, using last selection")}this.getChildren().models=quizModels;this.setupCurrentQuestionComponents();if(shouldResetAssessment||shouldResetQuestions){this._resetQuestions(function(){_this.set("_attemptInProgress",true);Adapt.trigger("assessments:reset",_this.getState(),_this);finalise.apply(_this)})}else{finalise.apply(this)}function finalise(){if(!state.isComplete){this.set("_attemptInProgress",true)}this._overrideQuestionComponentSettings();this._setupQuestionListeners();this._checkNumberOfQuestionsAnswered();this._updateQuestionsState();Adapt.assessment.saveState();if(typeof callback==="function")callback.apply(this);if(shouldResetAssessment||shouldResetQuestions){Adapt.trigger("assessments:postReset",this.getState(),this)}}},_setupBankedAssessment:function(){var assessmentConfig=this.getConfig();this._setupBanks();var questionModels=[];this._questionBanks.forEach(function(questionBank){var _questionModels;(_questionModels=questionModels).push.apply(_questionModels,_toConsumableArray(questionBank.getRandomQuestionBlocks()))});if(assessmentConfig._banks._randomisation){questionModels=_.shuffle(questionModels)}return questionModels},_setupBanks:function(){var assessmentConfig=this.getConfig();var banks=assessmentConfig._banks._split.split(",");var bankId;this._questionBanks=[];for(var i=0,l=banks.length;i<l;i++){var bank=banks[i];bankId=i+1;var questionBank=new QuestionBank$1(bankId,this.get("_id"),bank,true);this._questionBanks[bankId]=questionBank}var children=this.getChildren().models;var _iterator2=_createForOfIteratorHelper(children),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var blockModel=_step2.value;var blockAssessmentConfig=blockModel.get("_assessment");if(!blockAssessmentConfig)continue;bankId=blockAssessmentConfig._quizBankID;this._questionBanks[bankId].addBlock(blockModel)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}},_setupRandomisedAssessment:function(){var assessmentConfig=this.getConfig();var randomisationModel=assessmentConfig._randomisation;var blockModels=this.getChildren().models;var questionModels=_.shuffle(blockModels);if(randomisationModel._blockCount>0){questionModels=questionModels.slice(0,randomisationModel._blockCount)}return questionModels},_overrideQuestionComponentSettings:function(){var newSettings=this._getMarkingSettings();var questionConfig=this.getConfig()._questions;if(Object.prototype.hasOwnProperty.call(questionConfig,"_canShowFeedback")){newSettings._canShowFeedback=questionConfig._canShowFeedback}if(!_.isEmpty(newSettings)){var questionComponents=this._getAllQuestionComponents();questionComponents.forEach(function(model){return model.set(newSettings,{pluginName:"_assessment"})})}},_setupQuestionListeners:function(){this._removeQuestionListeners();this.listenTo(this.getChildren(),"change:_isInteractionComplete",this._onBlockCompleted)},_checkNumberOfQuestionsAnswered:function(){var questionComponents=this._getCurrentQuestionComponents();var numberOfQuestionsAnswered=questionComponents.filter(function(model){return model.get("_isInteractionComplete")}).length;this.set("_numberOfQuestionsAnswered",numberOfQuestionsAnswered)},_removeQuestionListeners:function(){this.stopListening(this.getChildren(),"change:_isInteractionComplete",this._onBlockCompleted)},_onBlockCompleted:function(blockModel,value){var _this2=this;if(value===false)return;var questionModels=blockModel.findDescendantModels("question");questionModels.forEach(function(questionModel){_this2._onQuestionCompleted(questionModel,value)});if(!blockModel.get("_isInteractionComplete"))return;this._checkAssessmentComplete()},_onQuestionCompleted:function(questionModel,value){if(value===false)return;if(!questionModel.get("_isInteractionComplete"))return;var numberOfQuestionsAnswered=this.get("_numberOfQuestionsAnswered");numberOfQuestionsAnswered++;this.set("_numberOfQuestionsAnswered",numberOfQuestionsAnswered);this._updateQuestionsState();Adapt.assessment.saveState();this._checkAssessmentComplete()},_checkAssessmentComplete:function(){var allQuestionsAdded=this.get("_requireCompletionOf")!==Number.POSITIVE_INFINITY;if(!allQuestionsAdded)return;var numberOfQuestionsAnswered=this.get("_numberOfQuestionsAnswered");var allQuestionsAnswered=numberOfQuestionsAnswered>=this._getCurrentQuestionComponents().length;if(!allQuestionsAnswered)return;this._onAssessmentComplete()},_onAssessmentComplete:function(){var _this3=this;var wasAttemptInProgess=this.get("_attemptInProgress");if(!wasAttemptInProgess)return;this.set("_attemptInProgress",false);this._spendAttempt();var _scoreAsPercent=this._getScoreAsPercent();var _score=this._getScore();var _maxScore=this._getMaxScore();var _minScore=this._getMinScore();var _correctCount=this._getCorrectCount();var _correctAsPercent=this._getCorrectAsPercent();var _questionCount=this._getQuestionCount();this.set({_scoreAsPercent:_scoreAsPercent,_score:_score,_maxScore:_maxScore,_minScore:_minScore,_correctAsPercent:_correctAsPercent,_correctCount:_correctCount,_questionCount:_questionCount,_lastAttemptScoreAsPercent:_scoreAsPercent,_assessmentCompleteInSession:true,_isAssessmentComplete:true});this._updateQuestionsState();this._checkIsPass();this._removeQuestionListeners();if(this._isMarkingSuppressionEnabled()&&!this._isAttemptsLeft()){_.defer(function(){_this3._overrideMarkingSettings();_this3._refreshQuestions()})}Adapt.trigger("assessments:complete",this.getState(),this)},_updateQuestionsState:function(){var questionComponents=this._getCurrentQuestionComponents();var questions=questionComponents.map(function(model){var _model$get;return{_id:model.get("_id"),_isCorrect:(_model$get=model.get("_isCorrect"))!==null&&_model$get!==void 0?_model$get:null}});this.set("_questions",questions)},_checkIsPass:function(){var assessmentConfig=this.getConfig();var isPercentageBased=assessmentConfig._isPercentageBased;var scoreToPass=assessmentConfig._scoreToPass;var correctToPass=assessmentConfig._correctToPass||0;var scoreAsPercent=this.get("_scoreAsPercent");var score=this.get("_score");var correctAsPercent=this.get("_correctAsPercent");var correctCount=this.get("_correctCount");var isPass=isPercentageBased?scoreAsPercent>=scoreToPass&&correctAsPercent>=correctToPass:score>=scoreToPass&&correctCount>=correctToPass;this.set("_isPass",isPass)},_getMarkingSettings:function(){var markingSettings={};if(this._shouldSuppressMarking()){markingSettings={_canShowMarking:false,_canShowModelAnswer:false}}else{var questionConfig=this.getConfig()._questions;if(Object.prototype.hasOwnProperty.call(questionConfig,"_canShowModelAnswer")){markingSettings._canShowModelAnswer=questionConfig._canShowModelAnswer}if(Object.prototype.hasOwnProperty.call(questionConfig,"_canShowMarking")){markingSettings._canShowMarking=questionConfig._canShowMarking}}return markingSettings},_overrideMarkingSettings:function(){var newMarkingSettings=this._getMarkingSettings();var questionComponents=this._getAllQuestionComponents();questionComponents.forEach(function(model){return model.set(newMarkingSettings,{pluginName:"_assessment"})})},_refreshQuestions:function(){var questionComponents=this._getCurrentQuestionComponents();questionComponents.forEach(function(model){return model.refresh()})},_shouldSuppressMarking:function(){return this._isMarkingSuppressionEnabled()&&this._isAttemptsLeft()},_isMarkingSuppressionEnabled:function(){var assessmentConfig=this.getConfig();return assessmentConfig._suppressMarking},_isAttemptsLeft:function(){if(this.get("_isAssessmentComplete")&&this.get("_isPass"))return false;if(this.get("_attemptsLeft")===0)return false;return true},_spendAttempt:function(){if(!this._isAttemptsLeft())return false;var attemptsSpent=this.get("_attemptsSpent");this.set("_attemptsSpent",++attemptsSpent);if(this.get("_attempts")==="infinite")return true;var attemptsLeft=this.get("_attemptsLeft");this.set("_attemptsLeft",--attemptsLeft);return true},_getScore:function(){var questionComponents=this._getCurrentQuestionComponents();var score=questionComponents.reduce(function(score,model){return score+=model.score||0},0);return score},_getMaxScore:function(){var questionComponents=this._getCurrentQuestionComponents();var maxScore=questionComponents.reduce(function(maxScore,model){return maxScore+=model.maxScore||0},0);return maxScore},_getMinScore:function(){var questionComponents=this._getCurrentQuestionComponents();var minScore=questionComponents.reduce(function(minScore,model){return minScore+=model.minScore||0},0);return minScore},_getScoreAsPercent:function(){var minScore=this._getMinScore();var maxScore=this._getMaxScore();var score=this._getScore();var range=maxScore-minScore;return range===0?0:Math.round((score-minScore)/range*100)},_getCorrectCount:function(){return this._getCurrentQuestionComponents().reduce(function(count,model){return count+=model.get("_isCorrect")?1:0},0)},_getQuestionCount:function(){return this._getCurrentQuestionComponents().length},_getCorrectAsPercent:function(){var questionCount=this._getQuestionCount();return questionCount===0?0:Math.round(this._getCorrectCount()/questionCount*100)},_getLastAttemptScoreAsPercent:function(){return this.get("_lastAttemptScoreAsPercent")},_checkReloadPage:function(){if(!this.canResetInPage())return false;var parentId=this.getParent().get("_id");var currentLocation=Adapt.location._currentId;if(currentLocation!==parentId)return false;if(!this.get("_isReady"))return false;return true},_reloadPage:function(callback){var _this4=this;var assessmentConfig=this.getConfig();this._forceResetOnRevisit=true;this.listenToOnce(Adapt,"pageView:ready",_asyncToGenerator(regeneratorRuntime.mark(function _callee(){return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!assessmentConfig._scrollToOnReset){_context.next=3;break}_context.next=3;return Adapt.navigateToElement(_this4.get("_id"));case 3:callback();case 4:case"end":return _context.stop();}}},_callee)})));_.delay(function(){Backbone.history.navigate("#/id/"+Adapt.location._currentId,{replace:true,trigger:true})},250)},_resetQuestions:function(callback){var assessmentConfig=this.getConfig();var syncIterations=1;var i=0;var qs=this._getCurrentQuestionComponents();var len=qs.length;function step(){for(var j=0,count=Math.min(syncIterations,len-i);j<count;i++,j++){var question=qs[i];question.reset(assessmentConfig._questions._resetType,true)}i===len?callback():setTimeout(step)}step()},_onRemove:function(){this._removeQuestionListeners()},_setCompletionStatus:function(){this.set({_isComplete:true,_isInteractionComplete:true})},_checkIfQuestionsWereRestored:function(){if(this.get("_assessmentCompleteInSession"))return;if(!this.get("_isAssessmentComplete"))return;var wereQuestionsRestored=true;var questions=this.get("_questions");var _iterator3=_createForOfIteratorHelper(questions),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var question=_step3.value;var questionModel=Adapt.findById(question._id);if(questionModel.get("_isAvailable")&&!questionModel.get("_isSubmitted")){wereQuestionsRestored=false;break}}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}if(!wereQuestionsRestored){this.set("_assessmentCompleteInSession",true);return true}return false},isAssessmentEnabled:function(){var _this$get;if((_this$get=this.get("_assessment"))!==null&&_this$get!==void 0&&_this$get._isEnabled)return true;return false},canResetInPage:function(){var assessmentConfig=this.getConfig();if(assessmentConfig._reloadPageOnReset===false)return false;return true},reset:function(force,callback){var _this5=this;if(this._isResetInProgress){this.once("reset",function(){_this5._isResetInProgress=false;if(typeof callback==="function"){callback(true)}});return}var assessmentConfig=this.getConfig();force=this._forceResetOnRevisit||force===true;this._forceResetOnRevisit=false;var isPageReload=this._checkReloadPage();if(this.get("_assessmentCompleteInSession")&&!assessmentConfig._isResetOnRevisit&&!isPageReload&&!force){if(typeof callback==="function"){callback(false)}return false}var wereQuestionsRestored=this._checkIfQuestionsWereRestored();force=force||wereQuestionsRestored;if(force&&!this._isAttemptsLeft()){this.set({_attemptsLeft:this.get("_attempts"),_attemptsSpent:0})}var allowResetIfPassed=this.get("_assessment")._allowResetIfPassed;if(!this._isAttemptsLeft()&&!force&&!allowResetIfPassed){if(typeof callback==="function")callback(false);return false}if(!isPageReload){this.once("reset",function(){_this5._isResetInProgress=false;if(typeof callback==="function"){callback(true)}});this._isResetInProgress=true;this._setupAssessmentData(force,function(){return _this5.trigger("reset")})}else{this._reloadPage(function(){if(typeof callback==="function"){callback(true)}})}return true},getSaveState:function(){var _cfg$_banks,_cfg$_randomisation;var state=this.getState();var blocks;var cfg=this.getConfig();var banksActive=((_cfg$_banks=cfg._banks)===null||_cfg$_banks===void 0?void 0:_cfg$_banks._isEnabled)&&cfg._banks._split.length>1;var randomisationActive=(_cfg$_randomisation=cfg._randomisation)===null||_cfg$_randomisation===void 0?void 0:_cfg$_randomisation._isEnabled;if(!banksActive&&!randomisationActive){blocks=this.findDescendantModels("block")}else{blocks=state.questions.map(function(question){return Adapt.findById(question._id).getParent()})}blocks=_toConsumableArray(new Set(blocks)).filter(function(block){var trackingId=block.get("_trackingId");return Number.isInteger(trackingId)&&trackingId>=0});var blockTrackingIds=blocks.map(function(block){return block.get("_trackingId")});var blockCompletion=blocks.map(function(block){var questions=block.findDescendantModels("question");return questions.map(function(question){return question.get("_isCorrect")||false})});var blockData=[blockTrackingIds,blockCompletion];var saveState=[state.isComplete?1:0,state.attemptsSpent,state.maxScore||0,state.score,state.attemptInProgress?1:0,state.minScore||0,state.correctAsPercent||0,state.correctCount||0,state.questionCount||0];var dataPackage=[saveState,blockData];return dataPackage},setRestoreState:function(dataPackage){var restoreState=dataPackage[0];var blockData=dataPackage[1];var _isAssessmentComplete=restoreState[0]===1;var attempts=this.get("_attempts");var _attemptsSpent=restoreState[1];var maxScore=restoreState[2];var score=restoreState[3];var _scoreAsPercent=score?Math.round(score/maxScore*100):0;var _attemptInProgress=restoreState[4]===1;var minScore=restoreState[5];var correctAsPercent=restoreState[6];var correctCount=restoreState[7];var questionCount=restoreState[8];var blocks=blockData[0].map(function(trackingId){return Adapt.data.findWhere({_trackingId:trackingId})});if(blocks.length){var nonBlockChildren=this.getChildren().models.filter(function(model){return!model.isTypeGroup("block")});this.getChildren().models=blocks.concat(nonBlockChildren)}var _questions=[];blocks.forEach(function(block,blockIndex){var blockQuestions=block.findDescendantModels("question");blockQuestions.forEach(function(question,questionIndex){_questions.push({_id:question.get("_id"),_isCorrect:blockData[1][blockIndex][questionIndex]})})});this.set({_isAssessmentComplete:_isAssessmentComplete,_assessmentCompleteInSession:false,_attemptsSpent:_attemptsSpent,_attemptInProgress:_attemptInProgress,_attemptsLeft:attempts==="infinite"?attempts:attempts-_attemptsSpent,_maxScore:maxScore||this._getMaxScore(),_minScore:minScore||this._getMinScore(),_score:score||0,_scoreAsPercent:_scoreAsPercent,_correctAsPercent:correctAsPercent||0,_correctCount:correctCount||0,_questions:_questions,_questionCount:questionCount||0,_lastAttemptScoreAsPercent:_scoreAsPercent});if(_isAssessmentComplete)this._checkIsPass();Adapt.trigger("assessments:restored",this.getState(),this)},getState:function(){var assessmentConfig=this.getConfig();var state={id:assessmentConfig._id,type:"article-assessment",pageId:this.getParent().get("_id"),articleId:this.get("_id"),isEnabled:assessmentConfig._isEnabled,isComplete:this.get("_isAssessmentComplete"),isPercentageBased:assessmentConfig._isPercentageBased,scoreToPass:assessmentConfig._scoreToPass,score:this.get("_score"),scoreAsPercent:this.get("_scoreAsPercent"),maxScore:this.get("_maxScore"),minScore:this.get("_minScore"),correctCount:this.get("_correctCount"),correctAsPercent:this.get("_correctAsPercent"),correctToPass:assessmentConfig._correctToPass,questionCount:this.get("_questionCount"),isPass:this.get("_isPass"),includeInTotalScore:assessmentConfig._includeInTotalScore,assessmentWeight:assessmentConfig._assessmentWeight,attempts:this.get("_attempts"),attemptsSpent:this.get("_attemptsSpent"),attemptsLeft:this.get("_attemptsLeft"),attemptInProgress:this.get("_attemptInProgress"),lastAttemptScoreAsPercent:this.get("_lastAttemptScoreAsPercent"),questions:this.get("_questions"),resetType:assessmentConfig._questions._resetType,allowResetIfPassed:assessmentConfig._allowResetIfPassed,questionModels:new Backbone.Collection(this._getCurrentQuestionComponents())};return state},getConfig:function(){var assessmentConfig=this.get("_assessment");if(!assessmentConfig){assessmentConfig=$.extend(true,{},assessmentConfigDefaults)}else{assessmentConfig=$.extend(true,{},assessmentConfigDefaults,assessmentConfig)}if(assessmentConfig._id===undefined){assessmentConfig._id="givenId"+givenIdCount++}this.set("_assessment",assessmentConfig);return assessmentConfig}};var AdaptAssessmentArticleModel=__AMD("extensions/adapt-contrib-assessment/js/adapt-assessmentArticleModel",AssessmentModel);var assessmentsConfigDefaults={_isPercentageBased:true,_scoreToPass:100,_isDefaultsLoaded:true};var Assessment=function(_Backbone$Controller){_inherits(Assessment,_Backbone$Controller);var _super=_createSuper(Assessment);function Assessment(){_classCallCheck(this,Assessment);return _super.apply(this,arguments)}_createClass(Assessment,[{key:"initialize",value:function initialize(){this._assessments=Object.assign([],{_byPageId:{},_byAssessmentId:{}});this.listenTo(Adapt,{"assessments:complete":this._onAssessmentsComplete,"router:location":this._checkResetAssessmentsOnRevisit,"router:plugin":this._handleRoute,"app:dataReady":this._onDataReady})}},{key:"_onAssessmentsComplete",value:function _onAssessmentsComplete(state){var assessmentId=state.id;state.isComplete=true;if(assessmentId===undefined)return;if(!this._getStateByAssessmentId(assessmentId)){Adapt.log.warn("assessments: state was not registered when assessment was created")}this.saveState();this._setPageProgress();this._checkAssessmentsComplete()}},{key:"_restoreModelState",value:function _restoreModelState(assessmentModel){if(!this._saveStateModel){this._saveStateModel=Adapt.offlineStorage.get("a")}if(this._saveStateModel){var state=assessmentModel.getState();if(this._saveStateModel[state.id]){assessmentModel.setRestoreState(Adapt.offlineStorage.deserialize(this._saveStateModel[state.id]))}}}},{key:"_handleRoute",value:function _handleRoute(plugin,id){if(plugin!=="assessment"&&plugin!=="article-assessment"||id===undefined){return}if(!Adapt.findById(id)){var assessment=Adapt.assessment._assessments._byAssessmentId[id];if(assessment){id=assessment.get("_id")}else{Adapt.log.warn("Assessment not found with _id: "+id);return}}_.defer(function(){Backbone.history.navigate("#/id/"+id,{trigger:true,replace:true})})}},{key:"_checkResetAssessmentsOnRevisit",value:function _checkResetAssessmentsOnRevisit(toObject){if(toObject._contentType!=="page")return;var pageAssessmentModels=this._getAssessmentByPageId(toObject._currentId);if(pageAssessmentModels===undefined)return;Adapt.wait.for(function resetAllAssessments(allAssessmentHaveReset){var numberOfAssessments=pageAssessmentModels.length;var numberOfResetAssessments=0;var forceAssessmentReset=false;pageAssessmentModels.forEach(function(model){model.reset(forceAssessmentReset,function(){numberOfResetAssessments++;var haveAllModelsReset=numberOfResetAssessments===numberOfAssessments;if(!haveAllModelsReset){return}allAssessmentHaveReset()})})});this._setPageProgress()}},{key:"_onDataReady",value:function _onDataReady(){this._assessments=Object.assign([],{_byPageId:{},_byAssessmentId:{}});this._restoredCount=0}},{key:"_checkAssessmentsComplete",value:function _checkAssessmentsComplete(){var _this=this;var allAssessmentsComplete=true;var assessmentToPostBack=0;var states=this._getStatesByAssessmentId();var assessmentStates=[];for(var id in states){var state=states[id];if(!state.includeInTotalScore)continue;if(!state.isComplete){allAssessmentsComplete=false;break}assessmentToPostBack++;assessmentStates.push(state)}if(!allAssessmentsComplete||assessmentToPostBack===0)return false;if(assessmentToPostBack===1){this._setupSingleAssessmentConfiguration(assessmentStates[0])}_.defer(function(){return Adapt.trigger("assessment:complete",_this.getState())});return true}},{key:"_setupSingleAssessmentConfiguration",value:function _setupSingleAssessmentConfiguration(assessmentState){var assessmentsConfig=Adapt.course.get("_assessment");$.extend(true,assessmentsConfig,{_isPercentageBased:assessmentState.isPercentageBased,_scoreToPass:assessmentState.scoreToPass});Adapt.course.set("_assessment",assessmentsConfig)}},{key:"_getAssessmentByPageId",value:function _getAssessmentByPageId(pageId){return this._assessments._byPageId[pageId]}},{key:"_getStateByAssessmentId",value:function _getStateByAssessmentId(assessmentId){if(assessmentId===undefined){return null}return this._assessments._byAssessmentId[assessmentId].getState()}},{key:"_getStatesByAssessmentId",value:function _getStatesByAssessmentId(){var states={};var _iterator=_createForOfIteratorHelper(this._assessments),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var assessmentModel=_step.value;if(!assessmentModel.get("_isAvailable"))continue;var state=assessmentModel.getState();states[state.id]=state}}catch(err){_iterator.e(err)}finally{_iterator.f()}return states}},{key:"_setPageProgress",value:function _setPageProgress(){for(var _i=0,_Object$entries=Object.entries(this._assessments._byPageId);_i<_Object$entries.length;_i++){var _Object$entries$_i=_slicedToArray(_Object$entries[_i],2),id=_Object$entries$_i[0],assessments=_Object$entries$_i[1];var assessmentsTotal=assessments.length;var assessmentsPassed=0;var _iterator2=_createForOfIteratorHelper(assessments),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var assessment=_step2.value;var assessmentState=assessment.getState();if(assessmentState.includeInTotalScore&&!assessmentState.isPass)continue;if(assessmentState.isComplete){assessmentsPassed++}}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}var pageModel=Adapt.findById(id);pageModel===null||pageModel===void 0?void 0:pageModel.set({_subProgressTotal:assessmentsTotal,_subProgressComplete:assessmentsPassed})}}},{key:"_addToAssessmentIdMap",value:function _addToAssessmentIdMap(id,model){if(id===undefined){Adapt.log.warn("An assessment has been registered with an undefined value for \"_id\"");return}if(id===""){Adapt.log.warn("An assessment has been registered with an empty value for \"_id\"")}if(!this._assessments._byAssessmentId[id]){this._assessments._byAssessmentId[id]=model}else{Adapt.log.warn("An assessment with an _id of \""+id+"\" already exists!")}}},{key:"_setupQuestionNumbering",value:function _setupQuestionNumbering(){var getRelatedQuestions=function(data){var currentAssessmentId=data._assessmentId;var currentAssessment=Adapt.assessment.get(currentAssessmentId);return currentAssessment.getState().questions};Handlebars.registerHelper("questionNumber",function getQuestionNumber(){var _this$view;var data=((_this$view=this.view)===null||_this$view===void 0?void 0:_this$view.model.toJSON())||this;if(!data._isPartOfAssessment)return;var related=_.pluck(getRelatedQuestions(data),"_id");return related.indexOf(data._id)+1});Handlebars.registerHelper("questionCount",function getTotalQuestions(){var data=this.view?this.view.model.toJSON():this;if(!data._isPartOfAssessment)return;return getRelatedQuestions(data).length})}},{key:"register",value:function register(assessmentModel){var state=assessmentModel.getState();var assessmentId=state.id;var pageId=state.pageId;if(this._assessments._byPageId[pageId]===undefined){this._assessments._byPageId[pageId]=[]}this._assessments._byPageId[pageId].push(assessmentModel);this._addToAssessmentIdMap(assessmentId,assessmentModel);this._assessments.push(assessmentModel);this._restoreModelState(assessmentModel);this._restoredCount++;Adapt.trigger("assessments:register",state,assessmentModel);this._setPageProgress();this._setupQuestionNumbering();if(this._restoredCount===this._assessments.length){Adapt.trigger("assessment:restored",this.getState())}}},{key:"get",value:function get(id){return id===undefined?this._assessments.slice(0):this._assessments._byAssessmentId[id]}},{key:"saveState",value:function saveState(){this._saveStateModel={};var _iterator3=_createForOfIteratorHelper(this._assessments),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var assessmentModel=_step3.value;var state=assessmentModel.getState();this._saveStateModel[state.id]=Adapt.offlineStorage.serialize(assessmentModel.getSaveState())}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}Adapt.offlineStorage.set("a",this._saveStateModel)}},{key:"getConfig",value:function getConfig(){var _assessmentsConfig;var assessmentsConfig=Adapt.course.get("_assessment");if((_assessmentsConfig=assessmentsConfig)!==null&&_assessmentsConfig!==void 0&&_assessmentsConfig._isDefaultsLoaded){return assessmentsConfig}if(assessmentsConfig===undefined){assessmentsConfig=$.extend(true,{},assessmentsConfigDefaults)}else{assessmentsConfig=$.extend(true,{},assessmentsConfigDefaults,assessmentsConfig)}Adapt.course.set("_assessment",assessmentsConfig);return assessmentsConfig}},{key:"getState",value:function getState(){var assessmentsConfig=this.getConfig();var score=0;var maxScore=0;var minScore=0;var correctCount=0;var questionCount=0;var assessments=0;var states=this._getStatesByAssessmentId();var assessmentsComplete=0;for(var id in states){var state=states[id];if(!state.includeInTotalScore)continue;if(state.isComplete)assessmentsComplete++;assessments++;maxScore+=state.maxScore/state.assessmentWeight;minScore+=state.minScore/state.assessmentWeight;score+=state.score/state.assessmentWeight;correctCount+=state.correctCount/state.assessmentWeight;questionCount+=state.questionCount/state.assessmentWeight}var isComplete=assessmentsComplete===assessments;var scoreRange=maxScore-minScore;var scoreAsPercent=scoreRange===0?0:Math.round((score-minScore)/scoreRange*100);var correctAsPercent=questionCount===0?0:Math.round(correctCount/questionCount*100);if(assessmentsConfig._correctToPass===undefined){Adapt.log.warnOnce("Assessment course config is missing _correctToPass")}var scoreToPass=assessmentsConfig._scoreToPass;var correctToPass=assessmentsConfig._correctToPass||scoreToPass;var isPercentageBased=assessmentsConfig._isPercentageBased;var isPass=isComplete&&(isPercentageBased?scoreAsPercent>=scoreToPass&&correctAsPercent>=correctToPass:score>=scoreToPass&&correctCount>=correctToPass);return{isComplete:isComplete,isPercentageBased:isPercentageBased,isPass:isPass,maxScore:maxScore,minScore:minScore,score:score,scoreToPass:scoreToPass,scoreAsPercent:scoreAsPercent,correctCount:correctCount,correctAsPercent:correctAsPercent,correctToPass:correctToPass,questionCount:questionCount,assessmentsComplete:assessmentsComplete,assessments:assessments}}}]);return Assessment}(Backbone.Controller);__AMD("extensions/adapt-contrib-assessment/js/assessment",Adapt.assessment=new Assessment);var ArticleViewInitialize=ArticleView$1.prototype.initialize;ArticleView$1.prototype.initialize=function(options){var _this$model$get;if(((_this$model$get=this.model.get("_assessment"))===null||_this$model$get===void 0?void 0:_this$model$get._isEnabled)===true){Object.assign(this,AdaptAssessmentArticleView)}return ArticleViewInitialize.apply(this,arguments)};var ArticleModelInitialize=ArticleModel$1.prototype.initialize;ArticleModel$1.prototype.initialize=function(options){var _this$get;if(((_this$get=this.get("_assessment"))===null||_this$get===void 0?void 0:_this$get._isEnabled)===true){Object.assign(this,AdaptAssessmentArticleModel);var returnValue=ArticleModelInitialize.apply(this,arguments);this._postInitialize();return returnValue}return ArticleModelInitialize.apply(this,arguments)};var Completion=function(_Backbone$Controller){_inherits(Completion,_Backbone$Controller);var _super=_createSuper(Completion);function Completion(){_classCallCheck(this,Completion);return _super.apply(this,arguments)}_createClass(Completion,[{key:"initialize",value:function initialize(){this.subProgressCompleted=0;this.subProgressTotal=0;this.nonAssessmentCompleted=0;this.nonAssessmentTotal=0;this.assessmentCompleted=0;this.assessmentTotal=0}},{key:"calculateCompletion",value:function calculateCompletion(contentObjectModel){var _Adapt$course$get,_contentObjectModel$g;var completion=Adapt.completion;var viewType=contentObjectModel.get("_type");var isComplete=contentObjectModel.get("_isComplete")?1:0;var children;switch(viewType){case"page":children=contentObjectModel.getAllDescendantModels().filter(function(model){return model.get("_isAvailable")&&!model.get("_isOptional")});var availableChildren=this.filterAvailableChildren(children);var components=this.getPageLevelProgressEnabledModels(availableChildren);var nonAssessmentComponents=this.getNonAssessmentComponents(components);completion.nonAssessmentTotal=nonAssessmentComponents.length;completion.nonAssessmentCompleted=this.getComponentsCompleted(nonAssessmentComponents).length;var assessmentComponents=this.getAssessmentComponents(components);completion.assessmentTotal=assessmentComponents.length;completion.assessmentCompleted=this.getComponentsInteractionCompleted(assessmentComponents).length;if(contentObjectModel.get("_pageLevelProgress")._excludeAssessments!==true){completion.subProgressCompleted=contentObjectModel.get("_subProgressComplete")||0;completion.subProgressTotal=contentObjectModel.get("_subProgressTotal")||0}var showPageCompletionCourse=((_Adapt$course$get=Adapt.course.get("_pageLevelProgress"))===null||_Adapt$course$get===void 0?void 0:_Adapt$course$get._showPageCompletion)!==false;var showPageCompletionPage=((_contentObjectModel$g=contentObjectModel.get("_pageLevelProgress"))===null||_contentObjectModel$g===void 0?void 0:_contentObjectModel$g._showPageCompletion)!==false;if(showPageCompletionCourse&&showPageCompletionPage){completion.nonAssessmentCompleted+=isComplete;completion.nonAssessmentTotal+=1}break;case"menu":case"course":children=contentObjectModel.get("_children").models;children.forEach(function(contentObject){var completionObject=Adapt.completion.calculateCompletion(contentObject);completion.subProgressCompleted+=completionObject.subProgressCompleted||0;completion.subProgressTotal+=completionObject.subProgressTotal||0;completion.nonAssessmentTotal+=completionObject.nonAssessmentTotal;completion.nonAssessmentCompleted+=completionObject.nonAssessmentCompleted;completion.assessmentTotal+=completionObject.assessmentTotal;completion.assessmentCompleted+=completionObject.assessmentCompleted});break;}return completion}},{key:"getNonAssessmentComponents",value:function getNonAssessmentComponents(models){return models.filter(function(model){return!model.get("_isPartOfAssessment")})}},{key:"getAssessmentComponents",value:function getAssessmentComponents(models){return models.filter(function(model){return model.get("_isPartOfAssessment")})}},{key:"getComponentsCompleted",value:function getComponentsCompleted(models){return models.filter(function(item){return item.get("_isComplete")})}},{key:"getComponentsInteractionCompleted",value:function getComponentsInteractionCompleted(models){return models.filter(function(item){return item.get("_isComplete")})}},{key:"getPageLevelProgressEnabledModels",value:function getPageLevelProgressEnabledModels(models){return models.filter(function(model){var config=model.get("_pageLevelProgress");return config===null||config===void 0?void 0:config._isEnabled})}},{key:"unavailableInHierarchy",value:function unavailableInHierarchy(parents){if(!parents)return;return parents.some(function(parent){return!parent.get("_isAvailable")})}},{key:"filterAvailableChildren",value:function filterAvailableChildren(children){var availableChildren=[];for(var i=0,count=children.length;i<count;i++){var parents=children[i].getAncestorModels();if(this.unavailableInHierarchy(parents))continue;availableChildren.push(children[i])}return availableChildren}},{key:"calculatePercentageComplete",value:function calculatePercentageComplete(model){var completionObject=this.calculateCompletion(model);var completed=completionObject.nonAssessmentCompleted+completionObject.assessmentCompleted+completionObject.subProgressCompleted;var total=completionObject.nonAssessmentTotal+completionObject.assessmentTotal+completionObject.subProgressTotal;var percentageComplete=Math.floor(completed/total*100);return percentageComplete}}]);return Completion}(Backbone.Controller);var completionCalculations=__AMD("extensions/adapt-contrib-pageLevelProgress/js/completionCalculations",Adapt.completion=new Completion);var PageLevelProgressIndicatorView=function(_Backbone$View){_inherits(PageLevelProgressIndicatorView,_Backbone$View);var _super=_createSuper(PageLevelProgressIndicatorView);function PageLevelProgressIndicatorView(){_classCallCheck(this,PageLevelProgressIndicatorView);return _super.apply(this,arguments)}_createClass(PageLevelProgressIndicatorView,[{key:"initialize",value:function initialize(options){options=options||{};this.parent=options.parent;this.calculatePercentage=options.calculatePercentage||this.calculatePercentage;this.ariaLabel=options.ariaLabel||"";this.type=options.type||this.model.get("_type");this.addClasses();this.setUpEventListeners();this.setPercentageComplete();this.render();this.refresh()}},{key:"addClasses",value:function addClasses(){this.$el.addClass(["pagelevelprogress__indicator","is-"+this.type].join(" "))}},{key:"checkAria",value:function checkAria(){if(!this.ariaLabel){this.$el.attr("aria-hidden",true);return}var data=this.getRenderData();this.$(".js-indicator-aria-label").html(Handlebars.compile(this.ariaLabel)(data))}},{key:"setUpEventListeners",value:function setUpEventListeners(){if(this.parent){this.listenToOnce(this.parent,"postRemove",this.remove)}else{this.listenTo(Adapt,"remove",this.remove)}this.listenTo(this.model,"change:_isComplete",this.refresh);if(!this.collection)return;this.listenTo(this.collection,"change:_isComplete",this.refresh)}},{key:"setPercentageComplete",value:function setPercentageComplete(){var percentage=this.calculatePercentage();this.model.set("percentageComplete",percentage);return percentage}},{key:"calculatePercentage",value:function calculatePercentage(){return this.model.get("_isComplete")?100:0}},{key:"render",value:function render(){var data=this.getRenderData();var template=Handlebars.templates[this.constructor.template];this.$el.html(template(data))}},{key:"getRenderData",value:function getRenderData(){var data=this.model.toJSON();data.ariaLabel=this.ariaLabel;data.type=this.type;return data}},{key:"refresh",value:function refresh(){this.checkCompletion();this.checkAria();this.$(".js-indicator-bar").css({width:this.calculatePercentage()+"%"})}},{key:"checkCompletion",value:function checkCompletion(){var percentage=this.setPercentageComplete();this.$el.toggleClass("is-complete",percentage===100).toggleClass("is-incomplete",percentage!==100)}}]);return PageLevelProgressIndicatorView}(Backbone.View);PageLevelProgressIndicatorView.template="pageLevelProgressIndicator";var PageLevelProgressIndicatorView$1=__AMD("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressIndicatorView",PageLevelProgressIndicatorView);var PageLevelProgressItemView=function(_Backbone$View){_inherits(PageLevelProgressItemView,_Backbone$View);var _super=_createSuper(PageLevelProgressItemView);function PageLevelProgressItemView(){_classCallCheck(this,PageLevelProgressItemView);return _super.apply(this,arguments)}_createClass(PageLevelProgressItemView,[{key:"className",value:function className(){return["pagelevelprogress__item drawer__item",this.model.get("_type")+"__indicator"].join(" ")}},{key:"attributes",value:function attributes(){return{role:"listitem"}}},{key:"initialize",value:function initialize(){this.listenTo(Adapt,"remove",this.remove);this.render();this.addIndicator()}},{key:"render",value:function render(){var data=this.model.toJSON();var template=Handlebars.templates[this.constructor.template];this.$el.html(template(data))}},{key:"addIndicator",value:function addIndicator(){if(this.model.get("_isOptional"))return;var item=new PageLevelProgressIndicatorView$1({model:this.model});this.$(".js-indicator").append(item.$el)}}]);return PageLevelProgressItemView}(Backbone.View);PageLevelProgressItemView.template="pageLevelProgressItem";var PageLevelProgressItemView$1=__AMD("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressItemView",PageLevelProgressItemView);var PageLevelProgressView=__AMD("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressView",function(_Backbone$View){_inherits(PageLevelProgressView,_Backbone$View);var _super=_createSuper(PageLevelProgressView);function PageLevelProgressView(){_classCallCheck(this,PageLevelProgressView);return _super.apply(this,arguments)}_createClass(PageLevelProgressView,[{key:"className",value:function className(){return"pagelevelprogress"}},{key:"events",value:function events(){return{"click .js-pagelevelprogress-item-click":"scrollToPageElement"}}},{key:"initialize",value:function initialize(){this.listenTo(Adapt,"remove",this.remove);this.render();this.addChildren()}},{key:"scrollToPageElement",value:function(){var _scrollToPageElement=_asyncToGenerator(regeneratorRuntime.mark(function _callee(event){var $target,id,model,currentComponentSelector;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(event&&event.preventDefault)event.preventDefault();$target=$(event.currentTarget);if(!$target.is(".is-disabled")){_context.next=4;break}return _context.abrupt("return");case 4:id=$target.attr("data-pagelevelprogress-id");model=Adapt.findById(id);if(model.get("_isRendered")){_context.next=15;break}_context.prev=7;_context.next=10;return Adapt.parentView.renderTo(id);case 10:_context.next=15;break;case 12:_context.prev=12;_context.t0=_context["catch"](7);return _context.abrupt("return");case 15:currentComponentSelector=".".concat(id);Adapt.once("drawer:closed",function(){Adapt.scrollTo(currentComponentSelector,{duration:400})}).trigger("drawer:closeDrawer",$(currentComponentSelector));case 17:case"end":return _context.stop();}}},_callee,null,[[7,12]])}));function scrollToPageElement(_x){return _scrollToPageElement.apply(this,arguments)}return scrollToPageElement}()},{key:"render",value:function render(){var template=Handlebars.templates.pageLevelProgress;this.$el.html(template({}))}},{key:"addChildren",value:function addChildren(){var $children=this.$(".js-children");this.collection.each(function(model){$children.append(new PageLevelProgressItemView$1({model:model}).$el)})}}]);return PageLevelProgressView}(Backbone.View));var PageLevelProgressNavigationView=__AMD("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressNavigationView",function(_Backbone$View){_inherits(PageLevelProgressNavigationView,_Backbone$View);var _super=_createSuper(PageLevelProgressNavigationView);function PageLevelProgressNavigationView(){_classCallCheck(this,PageLevelProgressNavigationView);return _super.apply(this,arguments)}_createClass(PageLevelProgressNavigationView,[{key:"tagName",value:function tagName(){return"button"}},{key:"className",value:function className(){return"btn-icon nav__btn nav__pagelevelprogress-btn pagelevelprogress__nav-btn"}},{key:"events",value:function events(){return{click:"onProgressClicked"}}},{key:"initialize",value:function initialize(){_.bindAll(this,"updateProgressBar");this.setUpEventListeners();this.render();this.addIndicator();this.deferredUpdate()}},{key:"setUpEventListeners",value:function setUpEventListeners(){this.listenTo(Adapt,{remove:this.remove,"router:location":this.updateProgressBar,"view:childAdded pageLevelProgress:update":this.refreshProgressBar})}},{key:"render",value:function render(){var template=Handlebars.templates.pageLevelProgressNavigation;this.$el.html(template({}))}},{key:"addIndicator",value:function addIndicator(){this.indicatorView=new PageLevelProgressIndicatorView$1({model:this.model,collection:this.collection,calculatePercentage:this._getPageCompletionPercentage,ariaLabel:Adapt.course.get("_globals")._extensions._pageLevelProgress.pageLevelProgressIndicatorBar});this.$el.prepend(this.indicatorView.$el)}},{key:"_getPageCompletionPercentage",value:function _getPageCompletionPercentage(){return completionCalculations.calculatePercentageComplete(this.model)}},{key:"deferredUpdate",value:function deferredUpdate(){_.defer(this.updateProgressBar)}},{key:"updateProgressBar",value:function updateProgressBar(){this.indicatorView.refresh()}},{key:"refreshProgressBar",value:function refreshProgressBar(){this.collection.repopulate();this.updateProgressBar()}},{key:"onProgressClicked",value:function onProgressClicked(event){if(event&&event.preventDefault)event.preventDefault();Adapt.drawer.triggerCustomView(new PageLevelProgressView({collection:this.collection}).$el,false)}},{key:"remove",value:function remove(){_get(_getPrototypeOf(PageLevelProgressNavigationView.prototype),"remove",this).call(this);this.collection.reset()}}]);return PageLevelProgressNavigationView}(Backbone.View));var PageLevelProgressCollection=__AMD("extensions/adapt-contrib-pageLevelProgress/js/PageLevelProgressCollection",function(_Backbone$Collection){_inherits(PageLevelProgressCollection,_Backbone$Collection);var _super=_createSuper(PageLevelProgressCollection);function PageLevelProgressCollection(){_classCallCheck(this,PageLevelProgressCollection);return _super.apply(this,arguments)}_createClass(PageLevelProgressCollection,[{key:"initialize",value:function initialize(models,options){this.listenTo(Adapt,"remove",this.reset);if(!(options!==null&&options!==void 0&&options.pageModel))return;this._pageModel=options.pageModel;this.repopulate()}},{key:"repopulate",value:function repopulate(){this.reset();if(!this._pageModel)return;var allDescendants=this._pageModel.getAllDescendantModels(true);var currentPageItems=allDescendants.filter(function(item){return item.get("_isAvailable")===true});var availableItems=completionCalculations.filterAvailableChildren(currentPageItems);var enabledProgressItems=completionCalculations.getPageLevelProgressEnabledModels(availableItems);this.add(enabledProgressItems)}}]);return PageLevelProgressCollection}(Backbone.Collection));var PageLevelProgress=function(_Backbone$Controller){_inherits(PageLevelProgress,_Backbone$Controller);var _super=_createSuper(PageLevelProgress);function PageLevelProgress(){_classCallCheck(this,PageLevelProgress);return _super.apply(this,arguments)}_createClass(PageLevelProgress,[{key:"initialize",value:function initialize(){this.listenTo(Adapt,{"app:dataReady":this.onDataReady,"app:languageChanged":this.onLanguageChange})}},{key:"getCourseConfig",value:function getCourseConfig(){return Adapt.course.get("_pageLevelProgress")}},{key:"onDataReady",value:function onDataReady(){var coursePLPConfig=this.getCourseConfig();if(!(coursePLPConfig!==null&&coursePLPConfig!==void 0&&coursePLPConfig._isEnabled))return;this.setUpEventListeners()}},{key:"onLanguageChange",value:function onLanguageChange(){this.stopListening();this.initialize()}},{key:"setUpEventListeners",value:function setUpEventListeners(){var headerIndicatorTypes=["menu","menuItem","page","article","block","component"];var headerIndicatorEventNames=headerIndicatorTypes.concat([""]).join("View:render ");this.listenTo(Adapt,headerIndicatorEventNames,this.renderHeaderIndicatorView);this.listenTo(Adapt,{"menuItemView:postRender":this.renderMenuItemIndicatorView,"router:page":this.renderNavigationView});this.listenTo(Adapt.course,"bubble:change:_isComplete",this.onCompletionChange)}},{key:"onCompletionChange",value:function onCompletionChange(event){if(!Adapt.location._currentId)return;var currentModel=Adapt.findById(Adapt.location._currentId);var completionState={currentLocation:completionCalculations.calculatePercentageComplete(currentModel),course:completionCalculations.calculatePercentageComplete(Adapt.course)};var hasChanged=!_.isMatch(this._previousCompletionState,completionState);if(!hasChanged)return;this._previousCompletionState=completionState;Adapt.trigger("pageLevelProgress:percentageCompleteChange",completionState)}},{key:"renderHeaderIndicatorView",value:function renderHeaderIndicatorView(view){var model=view.model;var config=model.get("_pageLevelProgress");if(!(config!==null&&config!==void 0&&config._isEnabled)||!(config!==null&&config!==void 0&&config._isCompletionIndicatorEnabled))return;var pageModel=model.findAncestor("contentObjects");var pageConfig=pageModel&&pageModel.get("_pageLevelProgress");if(!(pageConfig!==null&&pageConfig!==void 0&&pageConfig._isEnabled))return;var $headings=view.$(".js-heading");$headings.each(function(index,el){var $el=$(el);var indicatorView=new PageLevelProgressIndicatorView$1({parent:view,model:model});indicatorView.$el.insertAfter($el)})}},{key:"renderMenuItemIndicatorView",value:function renderMenuItemIndicatorView(view){if(view.model.get("_id")===Adapt.location._currentId)return;var viewType=view.model.get("_type");if(viewType==="course")return;var pageLevelProgress=view.model.get("_pageLevelProgress");if(!(pageLevelProgress!==null&&pageLevelProgress!==void 0&&pageLevelProgress._isEnabled))return;view.$el.find(".js-menu-item-progress").append(new PageLevelProgressIndicatorView$1({parent:view,model:view.model,type:"menu-item",calculatePercentage:this._getMenuItemCompletionPercentage.bind(view),ariaLabel:Adapt.course.get("_globals")._extensions._pageLevelProgress.pageLevelProgressMenuBar}).$el)}},{key:"_getMenuItemCompletionPercentage",value:function _getMenuItemCompletionPercentage(){return completionCalculations.calculatePercentageComplete(this.model)}},{key:"renderNavigationView",value:function renderNavigationView(pageModel){var coursePLPConfig=this.getCourseConfig();if((coursePLPConfig===null||coursePLPConfig===void 0?void 0:coursePLPConfig._isShownInNavigationBar)===false)return;var pagePLPConfig=pageModel.get("_pageLevelProgress");if(!(pagePLPConfig!==null&&pagePLPConfig!==void 0&&pagePLPConfig._isEnabled))return;var collection=new PageLevelProgressCollection(null,{pageModel:pageModel});if(collection.length===0)return;$(".nav__drawer-btn").after(new PageLevelProgressNavigationView({model:pageModel,collection:collection}).$el)}}]);return PageLevelProgress}(Backbone.Controller);__AMD("extensions/adapt-contrib-pageLevelProgress/js/adapt-contrib-pageLevelProgress",Adapt.pageLevelProgress=new PageLevelProgress);var Logger=function(){function Logger(){_classCallCheck(this,Logger);this.logArr=[];this.registeredViews=[]}_createClass(Logger,[{key:"getEntries",value:function getEntries(){return this.logArr}},{key:"getLastEntry",value:function getLastEntry(){return this.logArr[this.logArr.length-1]}},{key:"info",value:function info(str){this.logArr[this.logArr.length]={str:str,type:Logger.LOG_TYPE_INFO,time:Date.now()};this.updateViews()}},{key:"warn",value:function warn(str){this.logArr[this.logArr.length]={str:str,type:Logger.LOG_TYPE_WARN,time:Date.now()};this.updateViews()}},{key:"error",value:function error(str){this.logArr[this.logArr.length]={str:str,type:Logger.LOG_TYPE_ERROR,time:Date.now()};this.updateViews()}},{key:"debug",value:function debug(str){this.logArr[this.logArr.length]={str:str,type:Logger.LOG_TYPE_DEBUG,time:Date.now()};this.updateViews()}},{key:"registerView",value:function registerView(_view){this.registeredViews[this.registeredViews.length]=_view}},{key:"unregisterView",value:function unregisterView(_view){for(var i=0,l=this.registeredViews.length;i<l;i++){if(this.registeredViews[i]!==_view)continue;this.registeredViews.splice(i,1);i--}}},{key:"updateViews",value:function updateViews(){for(var i=0,l=this.registeredViews.length;i<l;i++){if(!this.registeredViews[i])continue;this.registeredViews[i].update(this)}}}],[{key:"getInstance",value:function getInstance(){if(Logger.instance===null){Logger.instance=new Logger}return Logger.instance}}]);return Logger}();Logger.instance=null;Logger.LOG_TYPE_INFO=0;Logger.LOG_TYPE_WARN=1;Logger.LOG_TYPE_ERROR=2;Logger.LOG_TYPE_DEBUG=3;var Logger$1=__AMD("extensions/adapt-contrib-spoor/js/scorm/logger",window.Logger=Logger);var ScormError=function ScormError(name){var data=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,ScormError);this.name=name;this.data=data};ScormError.CLIENT_COULD_NOT_CONNECT="CLIENT_COULD_NOT_CONNECT";ScormError.SERVER_STATUS_UNSUPPORTED="SERVER_STATUS_UNSUPPORTED";ScormError.CLIENT_STATUS_UNSUPPORTED="CLIENT_STATUS_UNSUPPORTED";ScormError.CLIENT_COULD_NOT_COMMIT="CLIENT_COULD_NOT_COMMIT";ScormError.CLIENT_NOT_CONNECTED="CLIENT_NOT_CONNECTED";ScormError.CLIENT_COULD_NOT_FINISH="CLIENT_COULD_NOT_FINISH";ScormError.CLIENT_COULD_NOT_GET_PROPERTY="CLIENT_COULD_NOT_GET_PROPERTY";ScormError.CLIENT_COULD_NOT_SET_PROPERTY="CLIENT_COULD_NOT_SET_PROPERTY";ScormError.CLIENT_INVALID_CHOICE_VALUE="CLIENT_INVALID_CHOICE_VALUE";ScormError.defaultMessages={title:"An error has occurred",pressOk:"Press 'OK' to view detailed debug information to send to technical support.",CLIENT_COULD_NOT_CONNECT:"The course could not connect to the Learning Management System",SERVER_STATUS_UNSUPPORTED:"An invalid lesson status of '{{{status}}}' was received from Learning Management System",CLIENT_STATUS_UNSUPPORTED:"The status '{{{status}}}' is not supported.",CLIENT_COULD_NOT_COMMIT:"There was a problem saving data to the Learning Management System\n\nError: {{errorCode}} - {{{errorInfo}}}\nLMS Error Info: {{{diagnosticInfo}}}",CLIENT_NOT_CONNECTED:"The course is not connected to the Learning Management System",CLIENT_COULD_NOT_FINISH:"The course was unable to terminate the learning session\n\nError: {{errorCode}} - {{{errorInfo}}}\nLMS Error Info: {{{diagnosticInfo}}}",CLIENT_COULD_NOT_GET_PROPERTY:"Unable to get the value of {{property}} from the Learning Management System\n\nError: {{errorCode}} - {{{errorInfo}}}\nLMS Error Info: {{{diagnosticInfo}}}",CLIENT_COULD_NOT_SET_PROPERTY:"Unable to set {{property}} to: '{{{value}}}'\n\nError: {{errorCode}} - {{{errorInfo}}}\nLMS Error Info: {{{diagnosticInfo}}}",CLIENT_INVALID_CHOICE_VALUE:"Numeric choice/matching response elements must use a value from 0 to 35 in SCORM 1.2"};var ScormError$1=__AMD("extensions/adapt-contrib-spoor/js/scorm/error",ScormError);var _ScormError=ScormError$1,CLIENT_COULD_NOT_CONNECT=_ScormError.CLIENT_COULD_NOT_CONNECT,SERVER_STATUS_UNSUPPORTED=_ScormError.SERVER_STATUS_UNSUPPORTED,CLIENT_STATUS_UNSUPPORTED=_ScormError.CLIENT_STATUS_UNSUPPORTED,CLIENT_COULD_NOT_COMMIT=_ScormError.CLIENT_COULD_NOT_COMMIT,CLIENT_NOT_CONNECTED=_ScormError.CLIENT_NOT_CONNECTED,CLIENT_COULD_NOT_FINISH=_ScormError.CLIENT_COULD_NOT_FINISH,CLIENT_COULD_NOT_GET_PROPERTY=_ScormError.CLIENT_COULD_NOT_GET_PROPERTY,CLIENT_COULD_NOT_SET_PROPERTY=_ScormError.CLIENT_COULD_NOT_SET_PROPERTY,CLIENT_INVALID_CHOICE_VALUE=_ScormError.CLIENT_INVALID_CHOICE_VALUE;var ScormWrapper=function(){function ScormWrapper(){_classCallCheck(this,ScormWrapper);this.setCompletedWhenFailed=true;this.commitOnStatusChange=true;this.commitOnAnyChange=false;this.timedCommitFrequency=10;this.maxCommitRetries=5;this.commitRetryDelay=1000;this.commitRetryPending=false;this.commitRetries=0;this.lastCommitSuccessTime=null;this.exitStateIfIncomplete="auto";this.exitStateIfComplete="auto";this.timedCommitIntervalID=null;this.retryCommitTimeoutID=null;this.logOutputWin=null;this.startTime=null;this.endTime=null;this.lmsConnected=false;this.finishCalled=false;this.logger=Logger$1.getInstance();this.scorm=pipwerks__default["default"].SCORM;this.scorm.handleExitMode=false;this.suppressErrors=false;this.debouncedCommit=_.debounce(this.commit.bind(this),100);if(window.__debug){this.showDebugWindow()}if(window.API&&window.API.__offlineAPIWrapper||window.API_1484_11&&window.API_1484_11.__offlineAPIWrapper){this.logger.error("Offline SCORM API is being used. No data will be reported to the LMS!")}}_createClass(ScormWrapper,[{key:"getVersion",value:function getVersion(){return this.scorm.version}},{key:"setVersion",value:function setVersion(value){this.logger.debug("ScormWrapper::setVersion: ".concat(value));this.scorm.version=value}},{key:"initialize",value:function initialize(){this.logger.debug("ScormWrapper::initialize");this.lmsConnected=this.scorm.init();if(!this.lmsConnected){this.handleError(new ScormError$1(CLIENT_COULD_NOT_CONNECT));return this.lmsConnected}this.startTime=new Date;this.initTimedCommit();return this.lmsConnected}},{key:"isFirstSession",value:function isFirstSession(){return this.getValue(this.isSCORM2004()?"cmi.entry":"cmi.core.entry")==="ab-initio"}},{key:"setIncomplete",value:function setIncomplete(){this.setValue(this.isSCORM2004()?"cmi.completion_status":"cmi.core.lesson_status","incomplete");if(this.commitOnStatusChange&&!this.commitOnAnyChange)this.commit()}},{key:"setCompleted",value:function setCompleted(){this.setValue(this.isSCORM2004()?"cmi.completion_status":"cmi.core.lesson_status","completed");if(this.commitOnStatusChange&&!this.commitOnAnyChange)this.commit()}},{key:"setPassed",value:function setPassed(){if(this.isSCORM2004()){this.setValue("cmi.completion_status","completed");this.setValue("cmi.success_status","passed")}else{this.setValue("cmi.core.lesson_status","passed")}if(this.commitOnStatusChange&&!this.commitOnAnyChange)this.commit()}},{key:"setFailed",value:function setFailed(){if(this.isSCORM2004()){this.setValue("cmi.success_status","failed");if(this.setCompletedWhenFailed){this.setValue("cmi.completion_status","completed")}}else{this.setValue("cmi.core.lesson_status","failed")}if(this.commitOnStatusChange&&!this.commitOnAnyChange)this.commit()}},{key:"getStatus",value:function getStatus(){var status=this.getValue(this.isSCORM2004()?"cmi.completion_status":"cmi.core.lesson_status");switch(status.toLowerCase()){case"passed":case"completed":case"incomplete":case"failed":case"browsed":case"not attempted":case"not_attempted":case"unknown":return status;default:this.handleError(new ScormError$1(SERVER_STATUS_UNSUPPORTED,{status:status}));return null;}}},{key:"setStatus",value:function setStatus(status){switch(status.toLowerCase()){case"incomplete":this.setIncomplete();break;case"completed":this.setCompleted();break;case"passed":this.setPassed();break;case"failed":this.setFailed();break;default:this.handleError(new ScormError$1(CLIENT_STATUS_UNSUPPORTED,{status:status}));}}},{key:"getScore",value:function getScore(){return this.getValue(this.isSCORM2004()?"cmi.score.raw":"cmi.core.score.raw")}},{key:"setScore",value:function setScore(score){var minScore=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var maxScore=arguments.length>2&&arguments[2]!==undefined?arguments[2]:100;if(this.isSCORM2004()){this.setValue("cmi.score.raw",score);this.setValue("cmi.score.min",minScore);this.setValue("cmi.score.max",maxScore);var range=maxScore-minScore;var scaledScore=((score-minScore)/range).toFixed(7);this.setValue("cmi.score.scaled",scaledScore);return}this.setValue("cmi.core.score.raw",score);if(this.isSupported("cmi.core.score.min"))this.setValue("cmi.core.score.min",minScore);if(this.isSupported("cmi.core.score.max"))this.setValue("cmi.core.score.max",maxScore)}},{key:"getLessonLocation",value:function getLessonLocation(){return this.getValue(this.isSCORM2004()?"cmi.location":"cmi.core.lesson_location")}},{key:"setLessonLocation",value:function setLessonLocation(location){this.setValue(this.isSCORM2004()?"cmi.location":"cmi.core.lesson_location",location)}},{key:"getSuspendData",value:function getSuspendData(){return this.getValue("cmi.suspend_data")}},{key:"setSuspendData",value:function setSuspendData(data){this.setValue("cmi.suspend_data",data)}},{key:"getStudentName",value:function getStudentName(){return this.getValue(this.isSCORM2004()?"cmi.learner_name":"cmi.core.student_name")}},{key:"getStudentId",value:function getStudentId(){return this.getValue(this.isSCORM2004()?"cmi.learner_id":"cmi.core.student_id")}},{key:"setLanguage",value:function setLanguage(lang){if(this.isSCORM2004()){this.setValue("cmi.learner_preference.language",lang);return}if(this.isSupported("cmi.student_preference.language")){this.setValue("cmi.student_preference.language",lang)}}},{key:"commit",value:function commit(){this.logger.debug("ScormWrapper::commit");if(!this.lmsConnected){this.handleError(new ScormError$1(ScormError$1.CLIENT_NOT_CONNECTED));return}if(this.commitRetryPending){this.logger.debug("ScormWrapper::commit: skipping this commit call as one is already pending.");return}if(this.scorm.save()){this.commitRetries=0;this.lastCommitSuccessTime=new Date;Adapt.trigger("spoor:commit",this);return}if(this.commitRetries<this.maxCommitRetries&&!this.finishCalled){this.commitRetries++;this.initRetryCommit();return}var errorCode=this.scorm.debug.getCode();this.handleError(new ScormError$1(CLIENT_COULD_NOT_COMMIT,{errorCode:errorCode,errorInfo:this.scorm.debug.getInfo(errorCode),diagnosticInfo:this.scorm.debug.getDiagnosticInfo(errorCode)}))}},{key:"finish",value:function finish(){this.logger.debug("ScormWrapper::finish");if(!this.lmsConnected||this.finishCalled){this.handleError(new ScormError$1(CLIENT_NOT_CONNECTED));return}this.finishCalled=true;if(this.timedCommitIntervalID!==null){window.clearInterval(this.timedCommitIntervalID)}if(this.commitRetryPending){window.clearTimeout(this.retryCommitTimeoutID);this.commitRetryPending=false}if(this.logOutputWin&&!this.logOutputWin.closed){this.logOutputWin.close()}this.endTime=new Date;if(this.isSCORM2004()){this.scorm.set("cmi.session_time",this.convertToSCORM2004Time(this.endTime.getTime()-this.startTime.getTime()));this.scorm.set("cmi.exit",this.getExitState())}else{this.scorm.set("cmi.core.session_time",this.convertToSCORM12Time(this.endTime.getTime()-this.startTime.getTime()));this.scorm.set("cmi.core.exit",this.getExitState())}this.lmsConnected=false;if(!this.scorm.quit()){var errorCode=this.scorm.debug.getCode();this.handleError(new ScormError$1(CLIENT_COULD_NOT_FINISH,{errorCode:errorCode,errorInfo:this.scorm.debug.getInfo(errorCode),diagnosticInfo:this.scorm.debug.getDiagnosticInfo(errorCode)}))}}},{key:"recordInteraction",value:function recordInteraction(id,response,correct,latency,type){if(!this.isSupported("cmi.interactions._count")){this.logger.info("ScormWrapper::recordInteraction: cmi.interactions are not supported by this LMS...");return}switch(type){case"choice":this.recordInteractionMultipleChoice.apply(this,arguments);break;case"matching":this.recordInteractionMatching.apply(this,arguments);break;case"numeric":this.isSCORM2004()?this.recordInteractionScorm2004.apply(this,arguments):this.recordInteractionScorm12.apply(this,arguments);break;case"fill-in":this.recordInteractionFillIn.apply(this,arguments);break;default:console.error("ScormWrapper.recordInteraction: unknown interaction type of '".concat(type,"' encountered..."));}}},{key:"getValue",value:function getValue(property){this.logger.debug("ScormWrapper::getValue: _property=".concat(property));if(this.finishCalled){this.logger.debug("ScormWrapper::getValue: ignoring request as 'finish' has been called");return}if(!this.lmsConnected){this.handleError(new ScormError$1(CLIENT_NOT_CONNECTED));return}var value=this.scorm.get(property);var errorCode=this.scorm.debug.getCode();switch(errorCode){case 0:break;case 403:this.logger.warn("ScormWrapper::getValue: data model element not initialized");break;default:this.handleError(new ScormError$1(CLIENT_COULD_NOT_GET_PROPERTY,{property:property,errorCode:errorCode,errorInfo:this.scorm.debug.getInfo(errorCode),diagnosticInfo:this.scorm.debug.getDiagnosticInfo(errorCode)}));}this.logger.debug("ScormWrapper::getValue: returning ".concat(value));return value+""}},{key:"setValue",value:function setValue(property,value){this.logger.debug("ScormWrapper::setValue: _property=".concat(property," _value=").concat(value));if(this.finishCalled){this.logger.debug("ScormWrapper::setValue: ignoring request as 'finish' has been called");return}if(!this.lmsConnected){this.handleError(new ScormError$1(CLIENT_NOT_CONNECTED));return}var success=this.scorm.set(property,value);if(!success){var errorCode=this.scorm.debug.getCode();if(errorCode!==0){this.handleError(new ScormError$1(CLIENT_COULD_NOT_SET_PROPERTY,{property:property,value:value,errorCode:errorCode,errorInfo:this.scorm.debug.getInfo(errorCode),diagnosticInfo:this.scorm.debug.getDiagnosticInfo(errorCode)}));return success}this.logger.warn("ScormWrapper::setValue: LMS reported that the 'set' call failed but then said there was no error!")}if(this.commitOnAnyChange)this.debouncedCommit();return success}},{key:"isSupported",value:function isSupported(property){this.logger.debug("ScormWrapper::isSupported: _property=".concat(property));if(this.finishCalled){this.logger.debug("ScormWrapper::isSupported: ignoring request as 'finish' has been called");return}if(!this.lmsConnected){this.handleError(new ScormError$1(CLIENT_NOT_CONNECTED));return false}this.scorm.get(property);return this.scorm.debug.getCode()!==401}},{key:"initTimedCommit",value:function initTimedCommit(){this.logger.debug("ScormWrapper::initTimedCommit");if(!this.commitOnAnyChange&&this.timedCommitFrequency>0){var delay=this.timedCommitFrequency*(60*1000);this.timedCommitIntervalID=window.setInterval(this.commit.bind(this),delay)}}},{key:"initRetryCommit",value:function initRetryCommit(){this.logger.debug("ScormWrapper::initRetryCommit ".concat(this.commitRetries," out of ").concat(this.maxCommitRetries));this.commitRetryPending=true;this.retryCommitTimeoutID=window.setTimeout(this.doRetryCommit.bind(this),this.commitRetryDelay)}},{key:"doRetryCommit",value:function doRetryCommit(){this.logger.debug("ScormWrapper::doRetryCommit");this.commitRetryPending=false;this.commit()}},{key:"handleError",value:function handleError(error){if(!Adapt.get("_isStarted")){Adapt.once("contentObjectView:ready",this.handleError.bind(this,error));return}if("value"in error.data){if(error.data.value.length&&error.data.value.length>80)error.data.value=error.data.value.slice(0,80)+"...";if(error.data.value==="")error.data.value="''"}var config=Adapt.course.get("_spoor");var messages=Object.assign({},ScormError$1.defaultMessages,config&&config._messages);var message=Handlebars.compile(messages[error.name])(error.data);switch(error.name){case CLIENT_COULD_NOT_CONNECT:Adapt.notify.popup({_isCancellable:false,title:messages.title,body:message});return;}this.logger.error(message);if(!this.suppressErrors&&(!this.logOutputWin||this.logOutputWin.closed)&&confirm("".concat(messages.title,":\n\n").concat(message,"\n\n").concat(messages.pressOk))){this.showDebugWindow()}}},{key:"getInteractionCount",value:function getInteractionCount(){var count=this.getValue("cmi.interactions._count");return count===""?0:count}},{key:"recordInteractionScorm12",value:function recordInteractionScorm12(id,response,correct,latency,type){id=id.trim();var cmiPrefix="cmi.interactions.".concat(this.getInteractionCount());this.setValue("".concat(cmiPrefix,".id"),id);this.setValue("".concat(cmiPrefix,".type"),type);this.setValue("".concat(cmiPrefix,".student_response"),response);this.setValue("".concat(cmiPrefix,".result"),correct?"correct":"wrong");if(latency!==null&&latency!==undefined)this.setValue("".concat(cmiPrefix,".latency"),this.convertToSCORM12Time(latency));this.setValue("".concat(cmiPrefix,".time"),this.getCMITime())}},{key:"recordInteractionScorm2004",value:function recordInteractionScorm2004(id,response,correct,latency,type){id=id.trim();var cmiPrefix="cmi.interactions.".concat(this.getInteractionCount());this.setValue("".concat(cmiPrefix,".id"),id);this.setValue("".concat(cmiPrefix,".type"),type);this.setValue("".concat(cmiPrefix,".learner_response"),response);this.setValue("".concat(cmiPrefix,".result"),correct?"correct":"incorrect");if(latency!==null&&latency!==undefined)this.setValue("".concat(cmiPrefix,".latency"),this.convertToSCORM2004Time(latency));this.setValue("".concat(cmiPrefix,".timestamp"),this.getISO8601Timestamp())}},{key:"recordInteractionMultipleChoice",value:function recordInteractionMultipleChoice(id,response,correct,latency,type){if(this.isSCORM2004()){response=response.replace(/,|#/g,"[,]")}else{response=response.replace(/#/g,",");response=this.checkResponse(response,"choice")}var scormRecordInteraction=this.isSCORM2004()?this.recordInteractionScorm2004:this.recordInteractionScorm12;scormRecordInteraction.call(this,id,response,correct,latency,type)}},{key:"recordInteractionMatching",value:function recordInteractionMatching(id,response,correct,latency,type){response=response.replace(/#/g,",");if(this.isSCORM2004()){response=response.replace(/,/g,"[,]");response=response.replace(/\./g,"[.]")}else{response=this.checkResponse(response,"matching")}var scormRecordInteraction=this.isSCORM2004()?this.recordInteractionScorm2004:this.recordInteractionScorm12;scormRecordInteraction.call(this,id,response,correct,latency,type)}},{key:"recordInteractionFillIn",value:function recordInteractionFillIn(id,response,correct,latency,type){var maxLength=this.isSCORM2004()?250:255;if(response.length>maxLength){response=response.substr(0,maxLength);this.logger.warn("ScormWrapper::recordInteractionFillIn: response data for ".concat(id," is longer than the maximum allowed length of ").concat(maxLength," characters; data will be truncated to avoid an error."))}var scormRecordInteraction=this.isSCORM2004()?this.recordInteractionScorm2004:this.recordInteractionScorm12;scormRecordInteraction.call(this,id,response,correct,latency,type)}},{key:"showDebugWindow",value:function showDebugWindow(){if(this.logOutputWin&&!this.logOutputWin.closed){this.logOutputWin.close()}this.logOutputWin=window.open("log_output.html","Log","width=600,height=300,status=no,scrollbars=yes,resizable=yes,menubar=yes,toolbar=yes,location=yes,top=0,left=0");if(this.logOutputWin){this.logOutputWin.focus()}}},{key:"convertToSCORM12Time",value:function convertToSCORM12Time(msConvert){var msPerSec=1000;var msPerMin=msPerSec*60;var msPerHour=msPerMin*60;var ms=msConvert%msPerSec;msConvert=msConvert-ms;var secs=msConvert%msPerMin;msConvert=msConvert-secs;secs=secs/msPerSec;var mins=msConvert%msPerHour;msConvert=msConvert-mins;mins=mins/msPerMin;var hrs=msConvert/msPerHour;if(hrs>9999){return"9999:99:99.99"}var str=[this.padWithZeroes(hrs,4),this.padWithZeroes(mins,2),this.padWithZeroes(secs,2)].join(":");return"".concat(str,".").concat(Math.floor(ms/10))}},{key:"convertToSCORM2004Time",value:function convertToSCORM2004Time(msConvert){var csConvert=Math.floor(msConvert/10);var csPerSec=100;var csPerMin=csPerSec*60;var csPerHour=csPerMin*60;var csPerDay=csPerHour*24;var days=Math.floor(csConvert/csPerDay);csConvert-=days*csPerDay;days=days?days+"D":"";var hours=Math.floor(csConvert/csPerHour);csConvert-=hours*csPerHour;hours=hours?hours+"H":"";var mins=Math.floor(csConvert/csPerMin);csConvert-=mins*csPerMin;mins=mins?mins+"M":"";var secs=Math.floor(csConvert/csPerSec);csConvert-=secs*csPerSec;secs=secs||"0";var cs=csConvert;cs=cs?"."+cs:"";var seconds=secs+cs+"S";var hms=[hours,mins,seconds].join("");return"P"+days+"T"+hms}},{key:"getCMITime",value:function getCMITime(){var date=new Date;var hours=this.padWithZeroes(date.getHours(),2);var min=this.padWithZeroes(date.getMinutes(),2);var sec=this.padWithZeroes(date.getSeconds(),2);return[hours,min,sec].join(":")}},{key:"getISO8601Timestamp",value:function getISO8601Timestamp(){var date=new Date().toISOString();return date.replace(/.\d\d\dZ/,"")}},{key:"padWithZeroes",value:function padWithZeroes(numToPad,padBy){var len=padBy;while(--len){numToPad="0"+numToPad}return numToPad.slice(-padBy)}},{key:"isSCORM2004",value:function isSCORM2004(){return this.scorm.version==="2004"}},{key:"checkResponse",value:function checkResponse(response,responseType){if(!response)return response;if(responseType!=="choice"&&responseType!=="matching")return response;response=response.split(/,|#/);var self=this;if(responseType==="choice"){response=response.map(checkIdentifier)}else{response=response.map(function(r){var identifiers=r.split(".");return checkIdentifier(identifiers[0])+"."+checkIdentifier(identifiers[1])})}function checkIdentifier(r){var i;if(r.length===1&&r>="0"&&r<="9")return r;if(r.length===1&&r>="a"&&r<="z")return r;i=parseInt(r);if(isNaN(i)||i<10||i>35){self.handleError(new ScormError$1(CLIENT_INVALID_CHOICE_VALUE))}return Number(i).toString(36)}return response.join(",")}},{key:"getExitState",value:function getExitState(){var completionStatus=this.scorm.data.completionStatus;var isIncomplete=completionStatus==="incomplete"||completionStatus==="not attempted";var exitState=isIncomplete?this.exitStateIfIncomplete:this.exitStateIfComplete;if(exitState!=="auto")return exitState;if(this.isSCORM2004())return isIncomplete?"suspend":"normal";return""}}],[{key:"getInstance",value:function getInstance(){if(ScormWrapper.instance===null){ScormWrapper.instance=new ScormWrapper}return ScormWrapper.instance}}]);return ScormWrapper}();ScormWrapper.instance=null;var ScormWrapper$1=__AMD("extensions/adapt-contrib-spoor/js/scorm/wrapper",ScormWrapper);var ZeroString={};function makeZeroString(length){ZeroString[length]=ZeroString[length]||new Array(length+1).join("0");return ZeroString[length]}for(var i$1=1,l=64;i$1<=l;i$1++){makeZeroString(i$1)}function zeroPadRightToLength(string,length){var padLength=length-string.length;if(padLength>0){string+=makeZeroString(padLength)}return string}function zeroPadLeftToLength(string,length){var padLength=length-string.length;if(padLength>0){string=makeZeroString(padLength)+string}return string}function zeroPadRightToMultiple(string,multiple){var padLength=multiple-string.length%multiple;if(padLength!==multiple){string+=makeZeroString(padLength)}return string}function binaryToUnsignedInteger(binary,binaryLength){if(binaryLength===0){return 0}binary=zeroPadLeftToLength(binary,binaryLength);var integer=parseInt(binary.slice(0,binaryLength),2);return integer}function shiftUnsignedIntegerFromBinary(binary,binaryLength){if(binaryLength===0){return[0,binary]}binary=zeroPadLeftToLength(binary,binaryLength);var integer=parseInt(binary.slice(0,binaryLength),2);binary=binary.slice(binaryLength);return[integer,binary]}function shiftBinary(binary,binaryLength){if(binaryLength===0){return["",binary]}binary=zeroPadLeftToLength(binary,binaryLength);var shifted=binary.slice(0,binaryLength);binary=binary.slice(binaryLength);return[shifted,binary]}function unsignedIntegerToBinary(integer,binaryLength){if(binaryLength===0){return""}var binary=Math.abs(integer).toString(2);if(typeof binaryLength==="undefined"){return binary}var length=binary.length;if(length>binaryLength){throw new Error("Integer too big for specified binary length. integer: ".concat(integer," binarylen: ").concat(binaryLength))}binary=zeroPadLeftToLength(binary,binaryLength);return binary}function byteArrayToString(array){var arrayLength=array.length;var string=new Array(arrayLength);for(var _i=0,_l=arrayLength;_i<_l;_i++){string[_i]=String.fromCharCode(array[_i])}string=string.join("");return string}function stringToByteArray(string){var stringLength=string.length;var array=new Array(stringLength);for(var _i2=0,_l2=stringLength;_i2<_l2;_i2++){array[_i2]=string.charCodeAt(_i2)}return array}var BYTE_BIT_LENGTH=8;function binaryToBase64(binary){binary=___default["default"].flatten(binary).join("");binary=zeroPadRightToMultiple(binary,BYTE_BIT_LENGTH);var bytesCount=binary.length/BYTE_BIT_LENGTH;var charCodes=new Array(bytesCount);for(var _i3=0,_l3=bytesCount;_i3<_l3;_i3++){var _shiftUnsignedInteger=shiftUnsignedIntegerFromBinary(binary,BYTE_BIT_LENGTH);var _shiftUnsignedInteger2=_slicedToArray(_shiftUnsignedInteger,2);charCodes[_i3]=_shiftUnsignedInteger2[0];binary=_shiftUnsignedInteger2[1]}var base64=btoa(byteArrayToString(charCodes));base64=base64.replace(/=/g,"");base64=base64.replace(/\+/g,"-");return base64}function base64ToBinary(base64){base64=base64.replace(/-/g,"+");var charCodes=stringToByteArray(atob(base64));var bytesCount=charCodes.length;var binary=new Array(bytesCount);for(var _i4=0,_l4=bytesCount;_i4<_l4;_i4++){binary[_i4]=unsignedIntegerToBinary(charCodes[_i4],BYTE_BIT_LENGTH)}binary=binary.join("");return binary}var logs={usedTypes:{},typeLengths:{},binarySamples:{}};var AbstractValueType=function(){function AbstractValueType(options){_classCallCheck(this,AbstractValueType);Object.assign(this,options);this.binaryTypeLength=this.binaryType.length}_createClass(AbstractValueType,[{key:"log",value:function log(binary){var name=this.name;logs.usedTypes[name]=logs.usedTypes[name]||0;logs.usedTypes[name]++;logs.binarySamples[name]=logs.binarySamples[name]||[];logs.binarySamples[name].push(binary)}}]);return AbstractValueType}();var FixedIntegerType=function(_AbstractValueType){_inherits(FixedIntegerType,_AbstractValueType);var _super=_createSuper(FixedIntegerType);function FixedIntegerType(options){var _this;_classCallCheck(this,FixedIntegerType);_this=_super.call(this,options);_this.esType="number";if(!_this.valueBinaryLength){return _possibleConstructorReturn(_this)}_this.minValue=options.minValue||0;_this.maxValue=options.maxValue||Math.pow(2,_this.valueBinaryLength)-1;return _this}_createClass(FixedIntegerType,[{key:"valueToBinary",value:function valueToBinary(integer){var logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var binary=unsignedIntegerToBinary(integer,this.valueBinaryLength);if(logStats){this.log(binary)}binary=[binary];return binary}},{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var integer;var _shiftUnsignedInteger3=shiftUnsignedIntegerFromBinary(binary,this.valueBinaryLength);var _shiftUnsignedInteger4=_slicedToArray(_shiftUnsignedInteger3,2);integer=_shiftUnsignedInteger4[0];binary=_shiftUnsignedInteger4[1];return[integer,binary]}}]);return FixedIntegerType}(AbstractValueType);var FixedBooleanType=function(_FixedIntegerType){_inherits(FixedBooleanType,_FixedIntegerType);var _super2=_createSuper(FixedBooleanType);function FixedBooleanType(options){var _this2;_classCallCheck(this,FixedBooleanType);options.valueBinaryLength=1;_this2=_super2.call(this,options);_this2.esType="boolean";return _this2}_createClass(FixedBooleanType,[{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var bool=binary[0]==="1";binary=binary.slice(1);return[bool,binary]}}]);return FixedBooleanType}(FixedIntegerType);var LengthAndValueBinary=function(){function LengthAndValueBinary(parent,name,bitSizes){_classCallCheck(this,LengthAndValueBinary);this.parent=parent;this.name=name;this.bitSizes=bitSizes;this.maxValues=___default["default"].flatten(this.bitSizes).map(function(value){return Math.pow(2,value)-1});this.maxValue=this.maxValues[this.maxValues.length-1];this.sizeBinaryLength=unsignedIntegerToBinary(this.bitSizes.length-1).length}_createClass(LengthAndValueBinary,[{key:"valueToBinary",value:function valueToBinary(integer){var logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var parentName=this.parent.name;var sizeIndex=this.maxValues.findIndex(function(maxValue){return integer<=maxValue});if(sizeIndex===-1){throw new Error("Value is too large for type: ".concat(parentName," value: ").concat(integer," max: ").concat(this.maxValue))}var sizeBinary=unsignedIntegerToBinary(sizeIndex,this.sizeBinaryLength);var valueLength=this.bitSizes[sizeIndex];var name=this.name;if(logStats){logs.typeLengths[parentName]=logs.typeLengths[parentName]||{};logs.typeLengths[parentName][name]=logs.typeLengths[parentName][name]||{};logs.typeLengths[parentName][name][valueLength]=logs.typeLengths[parentName][name][valueLength]||0;logs.typeLengths[parentName][name][valueLength]++}var integerBinary=unsignedIntegerToBinary(integer,valueLength);var binary=[sizeBinary,integerBinary];return binary}},{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var sizeBinary;var _shiftBinary=shiftBinary(binary,this.sizeBinaryLength);var _shiftBinary2=_slicedToArray(_shiftBinary,2);sizeBinary=_shiftBinary2[0];binary=_shiftBinary2[1];var sizeIndex=binaryToUnsignedInteger(sizeBinary);var valueLength=this.bitSizes[sizeIndex];var integer;var _shiftUnsignedInteger5=shiftUnsignedIntegerFromBinary(binary,valueLength);var _shiftUnsignedInteger6=_slicedToArray(_shiftUnsignedInteger5,2);integer=_shiftUnsignedInteger6[0];binary=_shiftUnsignedInteger6[1];return[integer,binary]}}]);return LengthAndValueBinary}();var VariableIntegerType=function(_FixedIntegerType2){_inherits(VariableIntegerType,_FixedIntegerType2);var _super3=_createSuper(VariableIntegerType);function VariableIntegerType(options){var _this3;_classCallCheck(this,VariableIntegerType);_this3=_super3.call(this,options);_this3.isNegative=_this3.minValue<0&&_this3.maxValue===0;_this3.integer=new LengthAndValueBinary(_assertThisInitialized(_this3),"integer",options.integerBitSizes);return _this3}_createClass(VariableIntegerType,[{key:"valueToBinary",value:function valueToBinary(integer){var logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;integer=integer.toFixed(0);var binary=this.integer.valueToBinary(Math.abs(integer),logStats);if(logStats){this.log(binary)}return binary}},{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var integer;var _this$integer$shiftVa=this.integer.shiftValueFromBinary(binary);var _this$integer$shiftVa2=_slicedToArray(_this$integer$shiftVa,2);integer=_this$integer$shiftVa2[0];binary=_this$integer$shiftVa2[1];if(this.isNegative){integer=-integer}return[integer,binary]}}]);return VariableIntegerType}(FixedIntegerType);var VariableArrayType=function(_VariableIntegerType){_inherits(VariableArrayType,_VariableIntegerType);var _super4=_createSuper(VariableArrayType);function VariableArrayType(options){var _this4;_classCallCheck(this,VariableArrayType);_this4=_super4.call(this,options);_this4.esType="array";return _this4}_createClass(VariableArrayType,[{key:"valueToBinary",value:function valueToBinary(array){var logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var arrayLength=array.length;var binary=_get(_getPrototypeOf(VariableArrayType.prototype),"valueToBinary",this).call(this,arrayLength);if(arrayLength){var valueType=findValueTypeFromValues(array);binary.push(valueType.binaryType);binary.type=valueType.name;binary.push(array.map(function(value){return valueType.valueToBinary(value,logStats)}))}if(logStats){this.log(binary)}return binary}},{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var arrayLength;var _get$call=_get(_getPrototypeOf(VariableArrayType.prototype),"shiftValueFromBinary",this).call(this,binary);var _get$call2=_slicedToArray(_get$call,2);arrayLength=_get$call2[0];binary=_get$call2[1];var value=new Array(arrayLength);if(arrayLength){var valueType;var _shiftValueTypeFromBi=shiftValueTypeFromBinary(binary);var _shiftValueTypeFromBi2=_slicedToArray(_shiftValueTypeFromBi,2);valueType=_shiftValueTypeFromBi2[0];binary=_shiftValueTypeFromBi2[1];for(var _i5=0,_l5=arrayLength;_i5<_l5;_i5++){var _valueType$shiftValue=valueType.shiftValueFromBinary(binary);var _valueType$shiftValue2=_slicedToArray(_valueType$shiftValue,2);value[_i5]=_valueType$shiftValue2[0];binary=_valueType$shiftValue2[1]}}return[value,binary]}}]);return VariableArrayType}(VariableIntegerType);var VariableSignedIntegerType=function(_VariableIntegerType2){_inherits(VariableSignedIntegerType,_VariableIntegerType2);var _super5=_createSuper(VariableSignedIntegerType);function VariableSignedIntegerType(){_classCallCheck(this,VariableSignedIntegerType);return _super5.apply(this,arguments)}_createClass(VariableSignedIntegerType,[{key:"valueToBinary",value:function valueToBinary(integer){var logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;integer=integer.toFixed(0);var isNegative=integer<0;var signBinary=isNegative?"1":"0";var integerBinary=this.integer.valueToBinary(Math.abs(integer),logStats);var binary=[signBinary,integerBinary];if(logStats){this.log(binary)}return binary}},{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var isNegative;var _shiftUnsignedInteger7=shiftUnsignedIntegerFromBinary(binary,1);var _shiftUnsignedInteger8=_slicedToArray(_shiftUnsignedInteger7,2);isNegative=_shiftUnsignedInteger8[0];binary=_shiftUnsignedInteger8[1];var integer;var _this$integer$shiftVa3=this.integer.shiftValueFromBinary(binary);var _this$integer$shiftVa4=_slicedToArray(_this$integer$shiftVa3,2);integer=_this$integer$shiftVa4[0];binary=_this$integer$shiftVa4[1];if(isNegative){integer=-integer}return[integer,binary]}}]);return VariableSignedIntegerType}(VariableIntegerType);var VariableDecimalType=function(_VariableIntegerType3){_inherits(VariableDecimalType,_VariableIntegerType3);var _super6=_createSuper(VariableDecimalType);function VariableDecimalType(options){var _this5;_classCallCheck(this,VariableDecimalType);_this5=_super6.call(this,options);_this5.isFloat=true;_this5.decimal=new LengthAndValueBinary(_assertThisInitialized(_this5),"decimal",options.decimalBitSizes);return _this5}_createClass(VariableDecimalType,[{key:"valueToBinary",value:function valueToBinary(float){var logStats=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;float=float.toFixed(2);var isNegative=float<0;float=Math.abs(float);var parts=String(float).split(".");var higherInteger=parseInt(parts[0]);var lowerInteger=parseInt(zeroPadRightToLength(parts[1]||0,2));var signBinary=isNegative?"1":"0";var integerValueBinary=this.integer.valueToBinary(higherInteger,logStats);var decimalValueBinary=this.decimal.valueToBinary(lowerInteger,logStats);var binary=[signBinary,integerValueBinary,decimalValueBinary];if(logStats){this.log(binary)}return binary}},{key:"shiftValueFromBinary",value:function shiftValueFromBinary(binary){var isNegative;var _shiftUnsignedInteger9=shiftUnsignedIntegerFromBinary(binary,1);var _shiftUnsignedInteger10=_slicedToArray(_shiftUnsignedInteger9,2);isNegative=_shiftUnsignedInteger10[0];binary=_shiftUnsignedInteger10[1];var higherInteger;var _this$integer$shiftVa5=this.integer.shiftValueFromBinary(binary);var _this$integer$shiftVa6=_slicedToArray(_this$integer$shiftVa5,2);higherInteger=_this$integer$shiftVa6[0];binary=_this$integer$shiftVa6[1];var lowerInteger;var _this$decimal$shiftVa=this.decimal.shiftValueFromBinary(binary);var _this$decimal$shiftVa2=_slicedToArray(_this$decimal$shiftVa,2);lowerInteger=_this$decimal$shiftVa2[0];binary=_this$decimal$shiftVa2[1];lowerInteger=zeroPadLeftToLength(String(lowerInteger),2);var float=parseFloat(higherInteger+"."+lowerInteger);if(isNegative){float=-float}return[float,binary]}}]);return VariableDecimalType}(VariableIntegerType);var arrayType=new VariableArrayType({name:"array",binaryType:"10",integerBitSizes:[4,16]});var booleanType=new FixedBooleanType({name:"boolean",binaryType:"0"});var integerTypes=[new FixedIntegerType({name:"uint3",binaryType:"1110",valueBinaryLength:3}),new VariableIntegerType({name:"vint8+",binaryType:"110",minValue:0,maxValue:255,integerBitSizes:[2,8]}),new VariableIntegerType({name:"vint8-",binaryType:"111100",minValue:-255,maxValue:0,integerBitSizes:[2,8]}),new VariableSignedIntegerType({name:"sint32",binaryType:"111110",minValue:-4294967295,maxValue:4294967295,integerBitSizes:[2,4,16,32]})];var decimalTypes=[new VariableDecimalType({name:"sdec15",binaryType:"111101",minValue:-255.99,maxValue:255.99,integerBitSizes:[2,8],decimalBitSizes:[0,7]}),new VariableDecimalType({name:"sdec39",binaryType:"111111",minValue:-4294967295.99,maxValue:4294967295.99,integerBitSizes:[2,4,16,32],decimalBitSizes:[0,7]})];var ValueTypes=[booleanType,arrayType].concat(integerTypes).concat(decimalTypes);ValueTypes.nameIndex={};ValueTypes.forEach(function(valueType){return ValueTypes.nameIndex[valueType.name]=valueType});function esTypeOf(value){if(Array.isArray(value)){return"array"}if(value===null){return"null"}return _typeof(value)}function findValueTypeFromName(name){return ValueTypes.nameIndex[name.toLowerCase()]}function findValueTypeFromValue(value){var esType=esTypeOf(value);switch(esType){case"array":return arrayType;case"boolean":return booleanType;}value=value.toFixed(2);var isFloat=!Number.isInteger(value);var isValueInValueTypeRange=function(valueType){return value>=valueType.minValue&&value<=valueType.maxValue};var valueType=isFloat?decimalTypes.find(isValueInValueTypeRange):integerTypes.find(isValueInValueTypeRange);if(!valueType){throw new Error("Cannot find type from value: ".concat(value))}return valueType}function findValueTypeFromValues(values){if(!values.length){return}var minValue=0;var maxValue=0;var isFloat=false;var esTypes=values.map(function(value){var valueType=findValueTypeFromValue(value);if(valueType.esType==="number"){minValue=___default["default"].min([value,minValue]);maxValue=___default["default"].max([value,maxValue]);isFloat=isFloat||!Number.isInteger(value)}return valueType.esType});var uniqESTypes=___default["default"].uniq(esTypes);if(uniqESTypes.length>1){throw new Error("Cannot resolve array to one type: ".concat(uniqESTypes.join()))}var esType=uniqESTypes[0];switch(esType){case"array":return arrayType;case"boolean":return booleanType;}var isRangeInValueTypeRange=function(valueType){return minValue>=valueType.minValue&&maxValue<=valueType.maxValue};var valueType=isFloat?decimalTypes.find(isRangeInValueTypeRange):integerTypes.find(isRangeInValueTypeRange);if(!valueType){throw new Error("Cannot find type from value. min: ".concat(minValue," max: ").concat(maxValue," isfloat: ").concat(isFloat))}return valueType}function shiftValueTypeFromBinary(binary){var valueType=ValueTypes.find(function(valueType){var binaryType=binary.slice(0,valueType.binaryTypeLength);return binaryType===valueType.binaryType});if(!valueType){throw new Error("Cannot find type from binary: ".concat(binary.slice(0,6),"..."))}binary=binary.slice(valueType.binaryTypeLength);return[valueType,binary]}function convertValuesToNumbers(value){var esType=esTypeOf(value);switch(esType){case"array":return value.map(convertValuesToNumbers);case"undefined":case"null":return value?1:0;case"boolean":case"number":return value;}throw new Error("Cannot convert ".concat(esType," to number"))}var Converter=function(){function Converter(){_classCallCheck(this,Converter)}_createClass(Converter,[{key:"getInvalidTypeError",value:function getInvalidTypeError(value){try{value=convertValuesToNumbers(value);esTypeOf(value)==="array"?findValueTypeFromValues(value):findValueTypeFromValue(value);return}catch(err){return err}}},{key:"valueToBinary",value:function valueToBinary(value){var typeName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var logStats=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;this.clearLog();var hasInitialType=typeof typeName==="string";value=convertValuesToNumbers(value);var valueType=hasInitialType?findValueTypeFromName(typeName):findValueTypeFromValue(value);if(!valueType){throw new Error("Could not find value type from ".concat(hasInitialType?"name ".concat(typeName):"value ".concat(value)," accepts: ").concat(Object.keys(ValueTypes.nameIndex),". Leave typeName empty for auto-detect."))}var binary=valueType.valueToBinary(value,logStats);if(!hasInitialType){binary.unshift(valueType.binaryType)}if(logStats){this.printLog()}return binary}},{key:"valueFromBinary",value:function valueFromBinary(binary){var typeName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;binary=___default["default"].flatten(binary).join("");var hasInitialType=typeof typeName==="string";var valueType;if(hasInitialType){valueType=findValueTypeFromName(typeName)}else{var _shiftValueTypeFromBi3=shiftValueTypeFromBinary(binary);var _shiftValueTypeFromBi4=_slicedToArray(_shiftValueTypeFromBi3,2);valueType=_shiftValueTypeFromBi4[0];binary=_shiftValueTypeFromBi4[1]}if(!valueType||!(valueType instanceof AbstractValueType)){throw new Error("Could not find value type from ".concat(hasInitialType?"name \"".concat(typeName,"\""):"binary \"".concat(binary.slice(0,8),"\"...")," accepts: ").concat(Object.keys(ValueTypes.nameIndex),". Leave typeName empty for auto-detect."))}var _valueType$shiftValue3=valueType.shiftValueFromBinary(binary),_valueType$shiftValue4=_slicedToArray(_valueType$shiftValue3,1),value=_valueType$shiftValue4[0];return value}},{key:"clearLog",value:function clearLog(){logs.usedTypes={};logs.typeLengths={};logs.binarySamples={}}},{key:"printLog",value:function printLog(){console.log("Types used count:",logs.usedTypes);console.log("Type lengths used count:",logs.typeLengths);console.log("Type binary samples:",logs.binarySamples)}},{key:"serialize",value:function serialize(value){var typeName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var logStats=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var binary=this.valueToBinary(value,typeName,logStats);var base64=binaryToBase64(binary);return base64}},{key:"deserialize",value:function deserialize(base64){var typeName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var binary=base64ToBinary(base64);var value=this.valueFromBinary(binary,typeName);return value}}]);return Converter}();var SCORMSuspendData=__AMD("extensions/adapt-contrib-spoor/js/serializers/SCORMSuspendData",window.SCORMSuspendData=new Converter);var ComponentSerializer=function(_Backbone$Controller){_inherits(ComponentSerializer,_Backbone$Controller);var _super=_createSuper(ComponentSerializer);function ComponentSerializer(){_classCallCheck(this,ComponentSerializer);return _super.apply(this,arguments)}_createClass(ComponentSerializer,[{key:"initialize",value:function initialize(trackingIdType){this.trackingIdType=trackingIdType}},{key:"serialize",value:function serialize(shouldStoreResponses,shouldStoreAttempts){var _this=this;if(shouldStoreAttempts&&!shouldStoreResponses){log.warnOnce("SPOOR configuration error, cannot use '_shouldStoreAttempts' without '_shouldStoreResponses'")}var states=[];Adapt.data.each(function(model){if(model.get("_type")!==_this.trackingIdType){return}var trackingId=model.get("_trackingId");if(typeof trackingId==="undefined"){return}var isContainer=model.hasManagedChildren;var components=isContainer?model.findDescendantModels("component"):[model];components.forEach(function(component,index){if(component.get("_isTrackable")===false){return}if(!shouldStoreResponses){var _state=[[trackingId,index],[component.get("_isComplete")]];states.push(_state);return}var modelState=null;if(!component.getAttemptState){modelState=component.get("_isQuestionType")?[[component.get("_score")||0,component.get("_attemptsLeft")||0],[component.get("_isComplete")||false,component.get("_isInteractionComplete")||false,component.get("_isSubmitted")||false,component.get("_isCorrect")||false],[component.get("_userAnswer")]]:[[],[component.get("_isComplete")||false,component.get("_isInteractionComplete")||false],[component.get("_userAnswer")]]}else{modelState=component.getAttemptState()}var userAnswer=modelState[2][0];var hasUserAnswer=typeof userAnswer!=="undefined"&&userAnswer!==null;var isUserAnswerArray=Array.isArray(userAnswer);if(!hasUserAnswer){modelState[2][0]=[]}else if(!isUserAnswerArray){modelState[2][0]=[modelState[2][0]]}var attemptStates=component.get("_attemptStates");var hasAttemptStates=shouldStoreAttempts&&Array.isArray(attemptStates);if(hasAttemptStates){modelState[2][1]=attemptStates}var state=[[trackingId,index],[hasUserAnswer,isUserAnswerArray,hasAttemptStates],modelState];states.push(state)})});return SCORMSuspendData.serialize(states)}},{key:"deserialize",value:function deserialize(binary){var trackingIdMap=Adapt.data.toArray().reduce(function(trackingIdMap,model){var trackingId=model.get("_trackingId");if(typeof trackingId==="undefined")return trackingIdMap;trackingIdMap[trackingId]=model;return trackingIdMap},{});var states=SCORMSuspendData.deserialize(binary);var shouldStoreResponses=states[0].length>2;states.forEach(function(state){var _state$=_slicedToArray(state[0],2),trackingId=_state$[0],index=_state$[1];var model=trackingIdMap[trackingId];if(!model){return}var isContainer=model.hasManagedChildren;var components=isContainer?model.findDescendantModels("component"):[model];var component=components[index];if(!component){log.warn("SPOOR could not restore tracking id: ".concat(trackingId,", index: ").concat(index));return}if(!shouldStoreResponses){var isComplete=state[1][0];component.set("_isComplete",isComplete);return}var _state$2=_slicedToArray(state[1],3),hasUserAnswer=_state$2[0],isUserAnswerArray=_state$2[1],hasAttemptStates=_state$2[2];var modelState=state[2];if(!hasUserAnswer){modelState[2][0]=null}else if(!isUserAnswerArray){modelState[2][0]=modelState[2][0][0]}if(!hasAttemptStates){modelState[2][1]=null}if(component.setAttemptObject){component.set("_attemptStates",modelState[2][1]);var attemptObject=component.getAttemptObject(modelState);component.setAttemptObject(attemptObject,false);return}component.get("_isQuestionType")?component.set({_score:modelState[0][0],_attemptsLeft:modelState[0][1],_isComplete:modelState[1][0],_isInteractionComplete:modelState[1][1],_isSubmitted:modelState[1][2],_isCorrect:modelState[1][3],_userAnswer:modelState[2][0],_attemptStates:modelState[2][1]}):component.set({_isComplete:modelState[1][0],_isInteractionComplete:modelState[1][1],_userAnswer:modelState[2][0],_attemptStates:modelState[2][1]})})}}]);return ComponentSerializer}(Backbone.Controller);var ComponentSerializer$1=__AMD("extensions/adapt-contrib-spoor/js/serializers/ComponentSerializer",ComponentSerializer);var StatefulSession=function(_Backbone$Controller){_inherits(StatefulSession,_Backbone$Controller);var _super=_createSuper(StatefulSession);function StatefulSession(){_classCallCheck(this,StatefulSession);return _super.apply(this,arguments)}_createClass(StatefulSession,[{key:"initialize",value:function initialize(){_.bindAll(this,"beginSession","onVisibilityChange","endSession");this.scorm=ScormWrapper$1.getInstance();this._trackingIdType="block";this._componentSerializer=null;this._shouldStoreResponses=true;this._shouldStoreAttempts=false;this._shouldRecordInteractions=true;this.beginSession()}},{key:"beginSession",value:function beginSession(){this.listenTo(Adapt,"app:dataReady",this.restoreSession);this._trackingIdType=Adapt.build.get("trackingIdType")||"block";this._componentSerializer=new ComponentSerializer$1(this._trackingIdType);if(window.location.search.indexOf("nolmserrors")!==-1){this.scorm.suppressErrors=true}var config=Adapt.spoor.config;if(!config)return;var tracking=config._tracking;this._shouldStoreResponses=tracking&&tracking._shouldStoreResponses||false;this._shouldStoreAttempts=tracking&&tracking._shouldStoreAttempts||false;if(tracking&&tracking._shouldRecordInteractions===false){this._shouldRecordInteractions=false}var settings=config._advancedSettings;if(!settings){this.scorm.setVersion("1.2");this.scorm.initialize();return}if(settings._showDebugWindow){this.scorm.showDebugWindow()}this.scorm.setVersion(settings._scormVersion||"1.2");if(_.isBoolean(settings._suppressErrors)){this.scorm.suppressErrors=settings._suppressErrors}if(_.isBoolean(settings._commitOnStatusChange)){this.scorm.commitOnStatusChange=settings._commitOnStatusChange}if(_.isBoolean(settings._commitOnAnyChange)){this.scorm.commitOnAnyChange=settings._commitOnAnyChange}if(_.isFinite(settings._timedCommitFrequency)){this.scorm.timedCommitFrequency=settings._timedCommitFrequency}if(_.isFinite(settings._maxCommitRetries)){this.scorm.maxCommitRetries=settings._maxCommitRetries}if(_.isFinite(settings._commitRetryDelay)){this.scorm.commitRetryDelay=settings._commitRetryDelay}if("_exitStateIfIncomplete"in settings){this.scorm.exitStateIfIncomplete=settings._exitStateIfIncomplete}if("_exitStateIfComplete"in settings){this.scorm.exitStateIfComplete=settings._exitStateIfComplete}this.scorm.initialize()}},{key:"restoreSession",value:function restoreSession(){this.setupLearnerInfo();this.restoreSessionState();_.defer(this.setupEventListeners.bind(this))}},{key:"setupLearnerInfo",value:function setupLearnerInfo(){var globals=Adapt.course.get("_globals");if(!globals._learnerInfo){globals._learnerInfo={}}Object.assign(globals._learnerInfo,Adapt.offlineStorage.get("learnerinfo"))}},{key:"restoreSessionState",value:function restoreSessionState(){var sessionPairs=Adapt.offlineStorage.get();var hasNoPairs=!Object.keys(sessionPairs).length;if(hasNoPairs)return;if(sessionPairs.c){var _SCORMSuspendData$des=SCORMSuspendData.deserialize(sessionPairs.c),_SCORMSuspendData$des2=_slicedToArray(_SCORMSuspendData$des,2),_isComplete=_SCORMSuspendData$des2[0],_isAssessmentPassed=_SCORMSuspendData$des2[1];Adapt.course.set({_isComplete:_isComplete,_isAssessmentPassed:_isAssessmentPassed})}if(sessionPairs.q){this._componentSerializer.deserialize(sessionPairs.q)}}},{key:"setupEventListeners",value:function setupEventListeners(){var debouncedSaveSession=_.debounce(this.saveSessionState.bind(this),1);this.listenTo(Adapt.data,"change:_isComplete",debouncedSaveSession);if(this._shouldStoreResponses){this.listenTo(Adapt.data,"change:_isSubmitted change:_userAnswer",debouncedSaveSession)}this.listenTo(Adapt,{"app:languageChanged":this.onLanguageChanged,"questionView:recordInteraction":this.onQuestionRecordInteraction,"assessment:complete":this.onAssessmentComplete,"tracking:complete":this.onTrackingComplete});var config=Adapt.spoor.config;var advancedSettings=config._advancedSettings;var shouldCommitOnVisibilityChange=!advancedSettings||advancedSettings._commitOnVisibilityChangeHidden!==false;if(shouldCommitOnVisibilityChange){document.addEventListener("visibilitychange",this.onVisibilityChange)}$(window).on("beforeunload unload",this.endSession)}},{key:"saveSessionState",value:function saveSessionState(){var courseState=SCORMSuspendData.serialize([Boolean(Adapt.course.get("_isComplete")),Boolean(Adapt.course.get("_isAssessmentPassed"))]);var componentStates=this._componentSerializer.serialize(this._shouldStoreResponses,this._shouldStoreAttempts);var sessionPairs={"c":courseState,"q":componentStates};Adapt.offlineStorage.set(sessionPairs);this.printCompletionInformation(sessionPairs)}},{key:"printCompletionInformation",value:function printCompletionInformation(suspendData){var _this=this;if(typeof suspendData==="string"){suspendData=JSON.parse(suspendData)}var courseState=SCORMSuspendData.deserialize(suspendData.c);var courseComplete=courseState[0];var assessmentPassed=courseState[1];var trackingIdModels=Adapt.data.filter(function(model){return model.get("_type")===_this._trackingIdType&&model.has("_trackingId")});var trackingIds=trackingIdModels.map(function(model){return model.get("_trackingId")});if(!trackingIds.length){Adapt.log.info("course._isComplete: ".concat(courseComplete,", course._isAssessmentPassed: ").concat(assessmentPassed,", ").concat(this._trackingIdType," completion: no tracking ids found"));return}var data=SCORMSuspendData.deserialize(suspendData.q);var max=Math.max.apply(Math,_toConsumableArray(data.map(function(item){return item[0][0]})));var shouldStoreResponses=data[0].length===3;var completionString=data.reduce(function(markers,item){var trackingId=item[0][0];var isComplete=shouldStoreResponses?item[2][1][0]:item[1][0];var mark=isComplete?"1":"0";markers[trackingId]=markers[trackingId]==="-"||markers[trackingId]==="1"?mark:"0";return markers},new Array(max+1).join("-").split("")).join("");Adapt.log.info("course._isComplete: ".concat(courseComplete,", course._isAssessmentPassed: ").concat(assessmentPassed,", ").concat(this._trackingIdType," completion: ").concat(completionString))}},{key:"onLanguageChanged",value:function onLanguageChanged(){var config=Adapt.spoor.config;this.removeEventListeners();this.setupEventListeners();this.saveSessionState();if(config&&config._reporting&&config._reporting._resetStatusOnLanguageChange===true){Adapt.offlineStorage.set("status","incomplete")}}},{key:"onVisibilityChange",value:function onVisibilityChange(){if(document.visibilityState==="hidden")this.scorm.commit()}},{key:"onQuestionRecordInteraction",value:function onQuestionRecordInteraction(questionView){if(!this._shouldRecordInteractions)return;var responseType=questionView.getResponseType();if(_.isEmpty(responseType))return;var id=questionView.model.get("_id");var response=questionView.getResponse();var result=questionView.isCorrect();var latency=questionView.getLatency();Adapt.offlineStorage.set("interaction",id,response,result,latency,responseType)}},{key:"onAssessmentComplete",value:function onAssessmentComplete(stateModel){var _Adapt$offlineStorage;var config=Adapt.spoor.config;Adapt.course.set("_isAssessmentPassed",stateModel.isPass);this.saveSessionState();var shouldSubmitScore=config&&config._tracking&&config._tracking._shouldSubmitScore;if(!shouldSubmitScore)return;var scoreArgs=stateModel.isPercentageBased?[stateModel.scoreAsPercent,0,100]:[stateModel.score,0,stateModel.maxScore];(_Adapt$offlineStorage=Adapt.offlineStorage).set.apply(_Adapt$offlineStorage,["score"].concat(scoreArgs))}},{key:"onTrackingComplete",value:function onTrackingComplete(completionData){var config=Adapt.spoor.config;this.saveSessionState();var completionStatus=completionData.status.asLowerCase;switch(completionData.status){case COMPLETION_STATE$1.COMPLETED:case COMPLETION_STATE$1.PASSED:{if(!config||!config._reporting||!config._reporting._onTrackingCriteriaMet){Adapt.log.warn("No value defined for '_onTrackingCriteriaMet', so defaulting to '".concat(completionStatus,"'"))}else{completionStatus=config._reporting._onTrackingCriteriaMet}break}case COMPLETION_STATE$1.FAILED:{if(!config||!config._reporting||!config._reporting._onAssessmentFailure){Adapt.log.warn("No value defined for '_onAssessmentFailure', so defaulting to '".concat(completionStatus,"'"))}else{completionStatus=config._reporting._onAssessmentFailure}}}Adapt.offlineStorage.set("status",completionStatus)}},{key:"endSession",value:function endSession(){if(!this.scorm.finishCalled){this.scorm.finish()}this.removeEventListeners()}},{key:"removeEventListeners",value:function removeEventListeners(){$(window).off("beforeunload unload",this.endSession);document.removeEventListener("visibilitychange",this.onVisibilityChange);this.stopListening()}}]);return StatefulSession}(Backbone.Controller);var StatefulSession$1=__AMD("extensions/adapt-contrib-spoor/js/adapt-stateful-session",StatefulSession);var OfflineStorage=function(_Backbone$Controller){_inherits(OfflineStorage,_Backbone$Controller);var _super=_createSuper(OfflineStorage);function OfflineStorage(){_classCallCheck(this,OfflineStorage);return _super.apply(this,arguments)}_createClass(OfflineStorage,[{key:"initialize",value:function initialize(statefulSession){this.scorm=ScormWrapper$1.getInstance();this.statefulSession=statefulSession;this.temporaryStore={};this.suspendDataStore={};this.suspendDataRestored=false;Adapt.offlineStorage.initialize(this)}},{key:"save",value:function save(){this.statefulSession.saveSessionState();this.scorm.commit()}},{key:"serialize",value:function serialize(){var _SCORMSuspendData;return(_SCORMSuspendData=SCORMSuspendData).serialize.apply(_SCORMSuspendData,arguments)}},{key:"deserialize",value:function deserialize(){var _SCORMSuspendData2;return(_SCORMSuspendData2=SCORMSuspendData).deserialize.apply(_SCORMSuspendData2,arguments)}},{key:"get",value:function get(name){if(name===undefined){if(this.useTemporaryStore())return this.temporaryStore;this.suspendDataStore=this.getCustomStates();var data=Object.assign(_.clone(this.suspendDataStore),{location:this.scorm.getLessonLocation(),score:this.scorm.getScore(),status:this.scorm.getStatus(),student:this.scorm.getStudentName(),learnerInfo:this.getLearnerInfo()});this.suspendDataRestored=true;return data}if(this.useTemporaryStore())return this.temporaryStore[name];var courseState;switch(name.toLowerCase()){case"location":return this.scorm.getLessonLocation();case"score":return this.scorm.getScore();case"status":return this.scorm.getStatus();case"student":return this.scorm.getStudentName();case"learnerinfo":return this.getLearnerInfo();case"coursestate":courseState=this.getCustomState("c");var stateArray=courseState&&SCORMSuspendData.deserialize(courseState)||[];return{_isCourseComplete:Boolean(stateArray.slice(0,1).map(Number)[0]),_isAssessmentPassed:Boolean(stateArray.slice(1,2).map(Number)[0]),completion:stateArray.slice(2).map(Number).map(String).join("")||""};case"completion":courseState=this.getCustomState("c");return courseState&&SCORMSuspendData.deserialize(courseState).slice(2).map(Number).map(String).join("")||"";case"_iscoursecomplete":courseState=this.getCustomState("c");return Boolean(courseState&&SCORMSuspendData.deserialize(courseState).slice(0,1).map(Number)[0]);case"_isassessmentpassed":courseState=this.getCustomState("c");return Boolean(courseState&&SCORMSuspendData.deserialize(courseState).slice(1,2).map(Number)[0]);case"questions":var questionsState=this.getCustomState("q");return questionsState||"";default:return this.getCustomState(name);}}},{key:"set",value:function set(name,value){var _this$scorm,_this$scorm2,_this$scorm3,_this$scorm4;var args=Array.prototype.slice.call(arguments).slice(1);var isObject=_typeof(name)==="object";if(isObject){value=name;name="suspendData"}if(this.useTemporaryStore()){if(isObject){Object.assign(this.temporaryStore,value)}else{this.temporaryStore[name]=value}return true}switch(name.toLowerCase()){case"interaction":return(_this$scorm=this.scorm).recordInteraction.apply(_this$scorm,_toConsumableArray(args));case"location":return(_this$scorm2=this.scorm).setLessonLocation.apply(_this$scorm2,_toConsumableArray(args));case"score":return(_this$scorm3=this.scorm).setScore.apply(_this$scorm3,_toConsumableArray(args));case"status":return(_this$scorm4=this.scorm).setStatus.apply(_this$scorm4,_toConsumableArray(args));case"student":case"learnerinfo":return false;case"lang":this.scorm.setLanguage(value);break;}if(isObject){Object.assign(this.suspendDataStore,value)}else{this.suspendDataStore[name]=value}var dataAsString=JSON.stringify(this.suspendDataStore);return this.suspendDataRestored?this.scorm.setSuspendData(dataAsString):false}},{key:"getCustomStates",value:function getCustomStates(){var isSuspendDataStoreEmpty=_.isEmpty(this.suspendDataStore);if(!isSuspendDataStoreEmpty&&this.suspendDataRestored){return _.clone(this.suspendDataStore)}var dataAsString=this.scorm.getSuspendData();if(dataAsString===""||dataAsString===" "||dataAsString===undefined){return{}}var dataAsJSON=JSON.parse(dataAsString);if(!isSuspendDataStoreEmpty&&!this.suspendDataRestored){Object.assign(dataAsJSON,this.suspendDataStore)}return dataAsJSON}},{key:"getCustomState",value:function getCustomState(name){var dataAsJSON=this.getCustomStates();return dataAsJSON[name]}},{key:"useTemporaryStore",value:function useTemporaryStore(){var cfg=Adapt.config.get("_spoor");if(!this.scorm.lmsConnected||cfg&&cfg._isEnabled===false)return true;return false}},{key:"getLearnerInfo",value:function getLearnerInfo(){var id=this.scorm.getStudentId();var name=this.scorm.getStudentName();var firstname="";var lastname="";var hasName=name&&name!=="undefined";var isNameCommaSeparated=hasName&&name.includes(",");var isNameSpaceSeparated=hasName&&name.includes(" ");hasName=hasName&&(isNameCommaSeparated||isNameSpaceSeparated);if(!hasName){console.log("SPOOR: LMS learner_name not in 'lastname, firstname' or 'firstname lastname' format");return{id:id,name:name,firstname:firstname,lastname:lastname}}var separator=isNameCommaSeparated?",":" ";var nameParts=name.split(separator);if(isNameCommaSeparated){nameParts.reverse()}var _nameParts$map=nameParts.map(function(part){return part.trim()});var _nameParts$map2=_slicedToArray(_nameParts$map,2);firstname=_nameParts$map2[0];lastname=_nameParts$map2[1];name="".concat(firstname," ").concat(lastname);return{id:id,name:name,firstname:firstname,lastname:lastname}}}]);return OfflineStorage}(Backbone.Controller);var OfflineStorage$1=__AMD("extensions/adapt-contrib-spoor/js/adapt-offlineStorage-scorm",OfflineStorage);var Spoor=function(_Backbone$Controller){_inherits(Spoor,_Backbone$Controller);var _super=_createSuper(Spoor);function Spoor(){_classCallCheck(this,Spoor);return _super.apply(this,arguments)}_createClass(Spoor,[{key:"initialize",value:function initialize(){this.config=null;this.scorm=ScormWrapper$1.getInstance();this.listenToOnce(Adapt,"offlineStorage:prepare",this._prepare)}},{key:"_prepare",value:function _prepare(){this.config=Adapt.config.get("_spoor");if(!this.isEnabled){Adapt.offlineStorage.setReadyStatus();return}this.statefulSession=new StatefulSession$1;this.offlineStorage=new OfflineStorage$1(this.statefulSession);Adapt.offlineStorage.get();Adapt.offlineStorage.setReadyStatus();require(["libraries/jquery.keycombo"],function(){$.onKeyCombo([68,69,86],function(){Adapt.spoor.scorm.showDebugWindow()})})}},{key:"isEnabled",get:function(){return this.config&&this.config._isEnabled}}]);return Spoor}(Backbone.Controller);Adapt.spoor=new Spoor;__AMD("extensions/adapt-contrib-spoor/js/adapt-contrib-spoor",Spoor);var TUTOR_TYPE=ENUM(["NOTIFY","INLINE","OVERLAY","NONE"]);var TUTOR_TYPE$1=__AMD("extensions/adapt-contrib-tutor/js/TUTOR_TYPE",TUTOR_TYPE);var TutorModel=__AMD("extensions/adapt-contrib-tutor/js/TutorModel",function(_Backbone$Model){_inherits(TutorModel,_Backbone$Model);var _super=_createSuper(TutorModel);function TutorModel(){_classCallCheck(this,TutorModel);return _super.apply(this,arguments)}_createClass(TutorModel,[{key:"defaults",value:function defaults(){return{_type:TUTOR_TYPE$1.NOTIFY.asLowerCase,_classes:"",_hasNotifyBottomButton:false,_button:{text:"{{_globals._extensions._tutor.hideFeedback}}",ariaLabel:"{{_globals._extensions._tutor.hideFeedback}}"}}}},{key:"initialize",value:function initialize(data,parentModel){data=$.extend(true,this.defaults(),_objectSpread2(_objectSpread2({},data),{},{_attributes:{"data-adapt-id":parentModel.get("_id")},title:parentModel.get("feedbackTitle"),body:parentModel.get("feedbackMessage")}));data._classes+=" tutor ".concat(this.getOriginClasses(parentModel));this.set(data)}},{key:"getOriginClasses",value:function getOriginClasses(model){var component=model.get("_component");var extension=model.get("_extension");return[model.get("_isCorrect")?"is-correct":model.get("_isAtLeastOneCorrectSelection")?"is-partially-correct":"is-incorrect",component&&"is-component is-".concat(component),extension&&"is-extension is-".concat(extension)].filter(Boolean).join(" ")}}]);return TutorModel}(Backbone.Model));var TutorNotify=__AMD("extensions/adapt-contrib-tutor/js/TutorNotify",function(_Backbone$Controller){_inherits(TutorNotify,_Backbone$Controller);var _super=_createSuper(TutorNotify);function TutorNotify(){_classCallCheck(this,TutorNotify);return _super.apply(this,arguments)}_createClass(TutorNotify,[{key:"initialize",value:function initialize(options){this.parentView=options.parentView;this.listenToOnce(Adapt,"notify:closed",this.onNotifyClosed);this.triggerNotify()}},{key:"triggerNotify",value:function triggerNotify(){var _this$model$toJSON=this.model.toJSON(),isButtonEnabled=_this$model$toJSON._hasNotifyBottomButton,promptText=_this$model$toJSON._button.text;this.notifyOptions=_objectSpread2(_objectSpread2({},this.model.toJSON()),{},{_prompts:isButtonEnabled&&[{promptText:Handlebars.compile(promptText)({_globals:Adapt.course.get("_globals")})}],_type:isButtonEnabled?"prompt":"popup"});notify.create(this.notifyOptions);Adapt.trigger("tutor:opened",this.parentView,this.notifyOptions)}},{key:"onNotifyClosed",value:function onNotifyClosed(){Adapt.trigger("tutor:closed",this.parentView,this.notifyOptions)}}]);return TutorNotify}(Backbone.Controller));var TutorView=__AMD("extensions/adapt-contrib-tutor/js/TutorView",function(_Backbone$View){_inherits(TutorView,_Backbone$View);var _super=_createSuper(TutorView);function TutorView(){_classCallCheck(this,TutorView);return _super.apply(this,arguments)}_createClass(TutorView,[{key:"className",value:function className(){return["tutor","tutor-type-".concat(this.model.get("_type")),this.model.get("_classes")].join(" ")}},{key:"events",value:function events(){return{"click .js-tutor-btn":"onCloseClick"}}},{key:"initialize",value:function initialize(options){this.parentView=options.parentView;this.buttonsView=this.parentView.buttonsView;this.listenTo(this.parentView,"postRemove",this.onTutorClosed);this.listenTo(this.buttonsView,"buttons:stateUpdate",this.onButtonsStateUpdate);this.render()}},{key:"render",value:function render(){this.$el.html(Handlebars.templates.tutor(this.model.toJSON()));_.defer(this.postRender.bind(this))}},{key:"postRender",value:function postRender(){this.toggleFeedback({shouldOpen:true})}},{key:"toggleFeedback",value:function toggleFeedback(){var _ref=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},shouldOpen=_ref.shouldOpen,_ref$shouldManageFocu=_ref.shouldManageFocus,shouldManageFocus=_ref$shouldManageFocu===void 0?true:_ref$shouldManageFocu;var animation=this.model.get("_type")==="inline"?"slide":"fade";var onAnimationEnd=shouldOpen?this.onTutorOpened.bind(this,shouldManageFocus):this.onTutorClosed.bind(this,shouldManageFocus);if(shouldManageFocus){a11y.toggleEnabled(this.buttonsView.$(".js-btn-feedback"),!shouldOpen)}this.$(".tutor__inner").stop()["".concat(animation,"Toggle")](200,onAnimationEnd)}},{key:"onCloseClick",value:function onCloseClick(){this.toggleFeedback({shouldOpen:false})}},{key:"onTutorOpened",value:function onTutorOpened(shouldManageFocus){if(shouldManageFocus){a11y.focus(this.$(".tutor__inner"),{defer:true,preventScroll:true})}Adapt.trigger("tutor:opened",this.parentView,this.model.toJSON())}},{key:"onTutorClosed",value:function onTutorClosed(shouldManageFocus){if(shouldManageFocus){var $showFeedbackButton=this.buttonsView.$(".js-btn-feedback");a11y.focus($showFeedbackButton,{defer:true,preventScroll:true})}Adapt.trigger("tutor:closed",this.parentView,this.model.toJSON());this.remove()}},{key:"onButtonsStateUpdate",value:function onButtonsStateUpdate(state){if(state!==BUTTON_STATE$1.RESET)return;this.toggleFeedback({shouldOpen:false,shouldManageFocus:false})}}]);return TutorView}(Backbone.View));var Tutor=function(_Backbone$Controller){_inherits(Tutor,_Backbone$Controller);var _super=_createSuper(Tutor);function Tutor(){_classCallCheck(this,Tutor);return _super.apply(this,arguments)}_createClass(Tutor,[{key:"initialize",value:function initialize(){this.listenTo(Adapt,"questionView:showFeedback",this.onQuestionViewShowFeedback)}},{key:"onQuestionViewShowFeedback",value:function onQuestionViewShowFeedback(view){var parentModel=view.model;var tutorModel=new TutorModel(parentModel.get("_tutor"),parentModel);var options={model:tutorModel,parentView:view};switch(TUTOR_TYPE$1(tutorModel.get("_type").toUpperCase())){case TUTOR_TYPE$1.NOTIFY:new TutorNotify(options);break;case TUTOR_TYPE$1.INLINE:case TUTOR_TYPE$1.OVERLAY:view.$(".component__inner").append(new TutorView(options).$el);break;case TUTOR_TYPE$1.NONE:}}}]);return Tutor}(Backbone.Controller);__AMD("extensions/adapt-contrib-tutor/js/adapt-contrib-tutor",Adapt.tutor=new Tutor);var DevtoolsModel=Backbone.Model.extend({initialize:function(){var config=Adapt.config.has("_devtools")?Adapt.config.get("_devtools"):this.getDefaultConfig();this.set(_.extend({"_trickleEnabled":false,"_hintingAvailable":true,"_hintingEnabled":false,"_toggleFeedbackAvailable":true,"_feedbackEnabled":true,"_autoCorrectAvailable":true,"_autoCorrectEnabled":false,"_altTextAvailable":true,"_altTextEnabled":false,"_tutorListener":null,"_unlockAvailable":true,"_unlocked":false,"_toggleBankingAvailable":true,"_traceFocusAvailable":true,"_traceFocusEnabled":false,"_extended":true},config))},getDefaultConfig:function(){return{"_isEnabled":false,"_extended":true}},toggleFeedback:function(){this.set("_feedbackEnabled",!this.get("_feedbackEnabled"))},toggleHinting:function(){this.set("_hintingEnabled",!this.get("_hintingEnabled"))},toggleAutoCorrect:function(){this.set("_autoCorrectEnabled",!this.get("_autoCorrectEnabled"))},toggleAltText:function(){this.set("_altTextEnabled",!this.get("_altTextEnabled"))},toggleTraceFocus:function(){this.set("_traceFocusEnabled",!this.get("_traceFocusEnabled"))}});var DevtoolsModel$1=__AMD("extensions/adapt-devtools/js/devtools-model",DevtoolsModel);var Hinting=_.extend({initialize:function(){this.listenTo(Adapt.devtools,"change:_hintingEnabled",this.toggleHints)},toggleHints:function(){var contentObject=Adapt.findById(Adapt.location._currentId);var components=contentObject.findDescendantModels("components");var renderedQuestions=_.filter(components,function(m){return m.get("_isQuestionType")===true&&m.get("_isReady")===true});_.each(renderedQuestions,function(model){this.setHinting($("."+model.get("_id")),model,Adapt.devtools.get("_hintingEnabled"))},this);if(Adapt.devtools.get("_hintingEnabled"))this.listenTo(Adapt,"componentView:postRender",this.onComponentRendered);else this.stopListening(Adapt,"componentView:postRender")},onComponentRendered:function(view,hintingEnabled){if(view.model.get("_isQuestionType"))this.setHinting(view.$el,view.model)},setHinting:function($el,model,hintingEnabled){switch(model.get("_component")){case"mcq":this.setMcqHinting($el,model,hintingEnabled!==false);break;case"gmcq":this.setGmcqHinting($el,model,hintingEnabled!==false);break;case"matching":this.setMatchingHinting($el,model,hintingEnabled!==false);break;case"ppq":this.setPpqHinting($el,model,hintingEnabled!==false);break;case"slider":this.setSliderHinting($el,model,hintingEnabled!==false);break;case"textinput":this.setTextInputHinting($el,model,hintingEnabled!==false);break;case"questionStrip":this.setQuestionStripHinting($el,model,hintingEnabled!==false);break;}},setMcqHinting:function($el,model,hintingEnabled){if(hintingEnabled){_.each(model.get("_items"),function(item,index){$el.find(".js-mcq-item").eq(index).addClass(item._shouldBeSelected?"hint-is-correct":"hint-is-incorrect")})}else{$el.find(".js-mcq-item").removeClass("hint-is-correct hint-is-incorrect")}},setGmcqHinting:function($el,model,hintingEnabled){if(hintingEnabled){_.each(model.get("_items"),function(item,index){$el.find(".js-mcq-item").eq(index).addClass(item._shouldBeSelected?"hint-is-correct":"hint-is-incorrect")})}else{$el.find(".js-mcq-item").removeClass("hint-is-correct hint-is-incorrect")}},setMatchingHinting:function($el,model,hintingEnabled){if(hintingEnabled){_.each(model.get("_items"),function(item,itemIndex){var $item=$el.find(".item").eq(itemIndex);var $options=$item.find(".js-dropdown-list-item");_.each(item._options,function(option,optionIndex){if(option._isCorrect)$options.eq(optionIndex+1).find(".js-dropdown-list-item-inner").append("<span class=\"hint\"> (correct)</span>")})})}else{$el.find(".js-dropdown-list-item-inner .hint").remove()}},setSliderHinting:function($el,model,hintingEnabled){if(hintingEnabled){var correctAnswer=model.get("_correctAnswer");if(correctAnswer){$el.find(".js-slider-number").addClass("hint-is-incorrect");$el.find(".js-slider-number[data-id=\""+correctAnswer+"\"]").removeClass("hint-is-incorrect").addClass("hint-is-correct")}else{$el.find(".js-slider-number").addClass("hint-is-incorrect");var bottom=model.get("_correctRange")._bottom;var top=model.get("_correctRange")._top;for(var i=bottom;i<=top;i++){$el.find(".js-slider-number[data-id=\""+i+"\"]").removeClass("hint-is-incorrect").addClass("hint-is-correct")}}}else{$el.find(".js-slider-number").removeClass("hint-is-correct hint-is-incorrect")}},setTextInputHinting:function($el,model,hintingEnabled){if(hintingEnabled){_.each(model.get("_items"),function(item,index){if(model.get("_answers")){$el.find(".js-textinput-item").eq(index).find("input").attr("placeholder",model.get("_answers")[index][0])}else{$el.find(".js-textinput-item").eq(index).find("input").attr("placeholder",item._answers[0])}})}else{_.each(model.get("_items"),function(item,index){if(model.get("_answers")){$el.find(".js-textinput-item").eq(index).find("input").attr("placeholder",item.placeholder)}})}},setQuestionStripHinting:function($el,model,hintingEnabled){if(hintingEnabled){_.each(model.get("_items"),function(item,itemIndex){var $item=$el.find(".component-item").eq(itemIndex);var $subItems=$item.find(".qs-strapline-header-inner:not(.qs-noop) .qs-strapline-title-inner");_.each(item._subItems,function(subItem,subItemIndex){if(subItem._isCorrect)$subItems.eq(subItemIndex).append("<span class=\"hint\"> (correct)</span>")})})}else{$el.find(".qs-strapline-title-inner .hint").remove()}},setPpqHinting:function($el,model,hintingEnabled){console.log("setPpqHinting",hintingEnabled);if(!model.get("_developerMode")){$el.find(".ppq-correct-zone").toggleClass("display-none",!hintingEnabled);$el.find(".ppq-pinboard").toggleClass("developer-mode",hintingEnabled)}}},Backbone.Events);Adapt.once("adapt:initialize devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;Hinting.initialize()});var Hinting$1=__AMD("extensions/adapt-devtools/js/hinting",Hinting);function isQuestionSupported(model){switch(model.get("_component")){case"mcq":case"gmcq":case"matching":case"ppq":case"slider":case"textinput":case"questionStrip":return true;default:return false;}}var isQuestionSupported$1=__AMD("extensions/adapt-devtools/js/is-question-supported",isQuestionSupported);var ItemsQuestionModel=undefined;var AutoAnswer=_.extend({mousedownHandlers:[],initialize:function(){this.listenTo(Adapt,{"componentView:postRender":this.componentRendered,"remove":this.onRemove})},componentRendered:function(view){if(isQuestionSupported$1(view.model)){if(view.buttonsView){var handler=_.bind(this.onQuestionMouseDown,this,view);view.$el.on("mousedown",handler);this.mousedownHandlers.push({element:view.$el,handler:handler})}else if(Adapt.devtools.get("_debug")){console.warn("adapt-devtools: could not find submit button on "+view.model.get("_id"))}}},onQuestionMouseDown:function(view,e){if(Adapt.devtools.get("_hintingEnabled"))Hinting$1.setHinting(view.$el,view.model,false);if(e.ctrlKey&&!e.shiftKey||Adapt.devtools.get("_autoCorrectEnabled")){this.answer(view)}else if(e.ctrlKey&&e.shiftKey){this.answer(view,true)}},isItemsQuestionModel:function(model){if(ItemsQuestionModel){return model instanceof ItemsQuestionModel}else if(ItemsQuestionModel===null){return false}if(require.defined("core/js/models/"+"itemsQuestionModel")){ItemsQuestionModel=require("core/js/models/"+"itemsQuestionModel");return model instanceof ItemsQuestionModel}else{ItemsQuestionModel=null;return false}},answer:function(view,incorrectly){if(view.model.get("_isSubmitted"))return;if(Adapt.devtools.get("_debug")){console.log("adapt-devtools: answer "+view.model.get("_id")+(incorrectly===true?" incorrectly":""))}if(incorrectly===true){switch(view.model.get("_component")){case"mcq":this.answerMultipleChoiceIncorrectly(view);break;case"gmcq":this.answerMultipleChoiceIncorrectly(view,true);break;case"matching":this.answerMatchingIncorrectly(view);break;case"ppq":this.answerPpqIncorrectly(view);break;case"slider":this.answerSliderIncorrectly(view);break;case"textinput":this.answerTextInputIncorrectly(view);break;case"questionStrip":this.answerQuestionStripIncorrectly(view);break;default:this.answerUnsupportedIncorrectly(view);}}else{switch(view.model.get("_component")){case"mcq":this.answerMultipleChoice(view);break;case"gmcq":this.answerMultipleChoice(view,true);break;case"matching":this.answerMatching(view);break;case"ppq":this.answerPpq(view);break;case"slider":this.answerSlider(view);break;case"textinput":this.answerTextInput(view);break;case"questionStrip":this.answerQuestionStrip(view);break;default:this.answerUnsupported(view);}}view.$(".js-btn-action").trigger("click")},answerMultipleChoice:function(view,isGraphical){var items=this.isItemsQuestionModel(view.model)?view.model.getChildren().toJSON():view.model.get("_items");var noCorrectOptions=_.where(items,{"_shouldBeSelected":true}).length==0;if(this.isItemsQuestionModel(view.model)){if(noCorrectOptions){view.model.getItem(_.random(items.length-1)).set("_isActive",true)}else{view.model.getChildren().forEach(function(item){if(item.get("_shouldBeSelected")&&!item.get("_isActive")||!item.get("_shouldBeSelected")&&item.get("_isActive")){item.toggleActive()}})}return}if(noCorrectOptions){if(_.where(items,{"_isSelected":true}).length==0){view.$(isGraphical?".js-item-input":".js-item-input").eq(_.random(items.length-1)).trigger("change")}}else{_.each(items,function(item,index){if(item._shouldBeSelected&&!item._isSelected||!item._shouldBeSelected&&item._isSelected){view.$(isGraphical?".js-item-input":".js-item-input").eq(index).trigger("change")}})}},answerMultipleChoiceIncorrectly:function(view,isGraphical){var model=view.model;var items=this.isItemsQuestionModel(model)?model.getChildren().toJSON():model.get("_items");var itemCount=items.length;var selectionStates=_.times(itemCount,function(){return false});var nShould=_.where(items,{_shouldBeSelected:true}).length;var nShouldNot=itemCount-nShould;var nSelect=model.get("_selectable");var nIncorrect=nShouldNot==0?0:_.random(nShould==1?1:0,Math.min(nShouldNot,nSelect));var nCorrect=nIncorrect==0?_.random(1,Math.min(nShould-1,nSelect)):_.random(0,Math.min(nShould,nSelect-nIncorrect));if(itemCount==1||nSelect==0){console.warn("adapt-devtools: not possible to answer "+model.get("_id")+" incorrectly");return}for(var j=0;j<nIncorrect;j++){for(var k=_.random(itemCount),err=itemCount,found=false;!found&&err>=0;k++,err--){var index=k%itemCount;if(selectionStates[index]===false){if(!items[index]._shouldBeSelected)selectionStates[index]=found=true}}}for(var j=0;j<nCorrect;j++){for(var k=_.random(itemCount),err=itemCount,found=false;!found&&err>=0;k++,err--){var index=k%itemCount;if(selectionStates[index]===false){if(items[index]._shouldBeSelected)selectionStates[index]=found=true}}}if(this.isItemsQuestionModel(view.model)){view.model.getChildren().forEach(function(item,index){if(selectionStates[index]&&!item.get("_isActive")||!selectionStates[index]&&item.get("_isActive")){item.toggleActive()}});return}_.each(items,function(item,index){if(selectionStates[index]&&!item._isSelected||!selectionStates[index]&&item._isSelected){view.$(isGraphical?".js-item-input":".js-item-input").eq(index).trigger("change")}})},answerMatching:function(view){_.each(view.model.get("_items"),function(item,itemIndex){var noCorrectOptions=_.where(item._options,{"_isCorrect":true}).length==0;if(noCorrectOptions){if(!view.dropdowns[itemIndex].getFirstSelectedItem()){var i=_.random(item._options.length-1);view.selectValue(itemIndex,i)}}else{_.each(item._options,function(option,optionIndex){if(option._isCorrect){view.selectValue(itemIndex,option._index)}})}})},answerMatchingIncorrectly:function(view){var items=view.model.get("_items"),itemCount=items.length,nIncorrect=_.random(1,itemCount);var selectionStates=_.shuffle(_.times(itemCount,function(i){return i<nIncorrect}));_.each(items,function(item,itemIndex){var $select=view.$("select").eq(itemIndex);var $options=$select.find("option");if(selectionStates[itemIndex]){for(var count=item._options.length,i=_.random(count),err=count;err>=0;i++,err--){if(!item._options[i%count]._isCorrect){if(view.selectValue){var option=item._options[i%count];view.selectValue(itemIndex,option._index)}else if(view.model.setOptionSelected){var option=item._options[i%count];$select.val(option.text);$select.trigger("change");view.model.setOptionSelected(itemIndex,i%count,true)}else{$options.eq(i%count+1).prop("selected",true)}return}}}else{_.each(item._options,function(option,optionIndex){if(option._isCorrect){if(view.selectValue){view.selectValue(itemIndex,option._index)}else if(view.model.setOptionSelected){$select.val(option.text);$select.trigger("change");view.model.setOptionSelected(itemIndex,optionIndex,true)}else{$options.eq(optionIndex+1).prop("selected",true)}}})}})},answerSlider:function(view){var correctAnswer=view.model.get("_correctAnswer");if(correctAnswer){view.$(".js-slider-number[data-id=\""+correctAnswer+"\"]").trigger("click")}else{var bottom=view.model.get("_correctRange")._bottom;var top=view.model.get("_correctRange")._top;var d=top-bottom;view.$(".js-slider-number[data-id=\""+(bottom+Math.floor(Math.random()*(d+1)))+"\"]").trigger("click")}},answerSliderIncorrectly:function(view){var correctAnswer=view.model.get("_correctAnswer");var start=view.model.get("_scaleStart"),end=view.model.get("_scaleEnd");var incorrect=_.times(end-start+1,function(i){return start+i});if(correctAnswer){incorrect.splice(correctAnswer-start,1)}else{var bottom=view.model.get("_correctRange")._bottom;var top=view.model.get("_correctRange")._top;incorrect.splice(bottom-start,top-bottom+1)}view.$(".js-slider-number[data-id=\""+_.shuffle(incorrect)[0]+"\"]").trigger("click")},answerTextInput:function(view){var answers=view.model.get("_answers");_.each(view.model.get("_items"),function(item,index){if(answers)view.$(".js-textinput-textbox").eq(index).val(answers[index][0]).trigger("change");else view.$(".js-textinput-textbox").eq(index).val(item._answers[0]).trigger("change")})},answerTextInputIncorrectly:function(view){var items=view.model.get("_items"),itemCount=items.length,nIncorrect=_.random(1,itemCount);var selectionStates=_.shuffle(_.times(itemCount,function(i){return i<nIncorrect}));var answers=view.model.get("_answers");_.each(items,function(item,index){if(selectionStates[index]){view.$(".js-textinput-textbox").eq(index).val("***4n 1nc0rr3ct 4nsw3r***").trigger("change")}else{if(answers)view.$(".js-textinput-textbox").eq(index).val(answers[index][0]).trigger("change");else view.$(".js-textinput-textbox").eq(index).val(item._answers[0]).trigger("change")}})},answerQuestionStrip:function(view){_.each(view.model.get("_items"),function(item,itemIndex){_.each(item._subItems,function(subItem,subItemIndex){if(subItem._isCorrect)view.setStage(itemIndex,subItemIndex,true)})})},answerQuestionStripIncorrectly:function(view){var items=view.model.get("_items"),itemCount=items.length,nIncorrect=_.random(1,itemCount);var selectionStates=_.shuffle(_.times(itemCount,function(i){return i<nIncorrect}));_.each(items,function(item,itemIndex){if(selectionStates[itemIndex]){for(var count=item._subItems.length,i=_.random(count),err=count;err>=0;i++,err--){if(!item._subItems[i%count]._isCorrect){view.setStage(itemIndex,i%count,true);return}}}else{_.each(item._subItems,function(subItem,subItemIndex){if(subItem._isCorrect)view.setStage(itemIndex,subItemIndex,true)})}})},answerPpq:function(view){var model=view.model,items=model.get("_items"),itemCount=items.length;var isDesktop=Adapt.device.screenSize!="small";var items=_.pluck(model.get("_items"),isDesktop?"desktop":"mobile");var $pinboard=view.$(".ppq-pinboard");var boardw=$pinboard.width();var boardh=$pinboard.height();for(i=0;i<itemCount;i++){var zone=items[i];var pin=view.getNextUnusedPin();var x=zone.left+zone.width/2;var y=zone.top+zone.height/2;console.log("using correct position",x+","+y);pin.setPosition(x,y);pin.$el.css({"left":boardw*x/100-pin.$el.width()/2,"top":boardh*y/100-pin.$el.height()})}},answerPpqIncorrectly:function(view){var model=view.model,items=model.get("_items"),itemCount=items.length;var isDesktop=Adapt.device.screenSize!="small";var items=_.pluck(model.get("_items"),isDesktop?"desktop":"mobile");var nSelect=_.random(model.get("_minSelection"),model.get("_maxSelection"));var nIncorrect=_.random(1,nSelect);var nCorrect=nSelect-nIncorrect;var $pinboard=view.$(".ppq-pinboard");var boardw=$pinboard.width();var boardh=$pinboard.height();console.log("nIncorrect=",nIncorrect,"nCorrect=",nCorrect);var maxSize=function(zone){return zone.left<1&&zone.top<1&&zone.width>9999&&zone.height>9999};items=_.map(items,function(item){return{"left":Math.round(item.left*100),"top":Math.round(item.top*100),"width":Math.round(item.width*100),"height":Math.round(item.height*100)}});if(_.some(items,maxSize)||nSelect==0){console.warn("adapt-devtools: not possible to answer "+model.get("_id")+" incorrectly");return}view.resetPins();for(var i=0;i<nIncorrect;i++){var ok=false;var x,y;while(!ok){x=_.random(1,10000);ok=!_.some(items,function(zone){return x>=zone.left&&x<zone.left+zone.width&&zone.top<1&&zone.height>9999})}ok=false;while(!ok){y=_.random(1,10000);ok=!_.some(items,function(zone){return x>=zone.left&&x<zone.left+zone.width&&y>=zone.top&&y<zone.top+zone.height})}x=x/100;y=y/100;console.log("using incorrect position",x+","+y);var pin=view.getNextUnusedPin();pin.setPosition(x,y);pin.$el.css({"left":boardw*x/100-pin.$el.width()/2,"top":boardh*y/100-pin.$el.height()})}var correct=_.shuffle(_.times(itemCount,function(i){return i}));for(i=0;i<nCorrect;i++){var zone=items[correct[i]];var pin=view.getNextUnusedPin();var x=zone.left+zone.width/2;var y=zone.top+zone.height/2;x=x/100;y=y/100;console.log("using correct position",x+","+y);pin.setPosition(x,y);pin.$el.css({"left":boardw*x/100-pin.$el.width()/2,"top":boardh*y/100-pin.$el.height()})}},answerUnsupported:function(view){var model=view.model;model.set({"_isComplete":true,"_isInteractionComplete":true,"_isCorrect":true,"_isSubmitted":true,"_score":1});model.set("_attemptsLeft",Math.max(0,model.get("_attempts")-1))},answerUnsupportedIncorrectly:function(view){var model=view.model;model.set({"_isComplete":true,"_isInteractionComplete":true,"_isCorrect":false,"_isSubmitted":true,"_score":0});model.set("_attemptsLeft",Math.max(0,model.get("_attempts")-1))},onRemove:function(){this.mousedownHandlers.forEach(function(tuple){tuple.element.off("mousedown",tuple.handler)})}},Backbone.Events);Adapt.on("app:dataReady devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;AutoAnswer.initialize()});var AutoAnswer$1=__AMD("extensions/adapt-devtools/js/auto-answer",AutoAnswer);var PassHalfFail=_.extend({syncIterations:1,mouseTarget:null,initialize:function(){_.bindAll(this,"onMouseDown","onMouseUp","onKeypress","onPassHalfFailComplete");this._questionViews=[];this._currentPageId=null;this.listenTo(Adapt,"pageView:preRender",this.onPagePreRender);this.listenTo(Adapt,"remove",this.onRemove);$(window).off("keypress",this.onKeypress);$(window).off("mousedown",this.onMouseDown);$(window).off("mouseup",this.onMouseUp);$(window).on("keypress",this.onKeypress);$(window).on("mousedown",this.onMouseDown);$(window).on("mouseup",this.onMouseUp)},_completeNonQuestions:function(){var currentModel=Adapt.findById(Adapt.location._currentId);var nonQuestions=_.filter(currentModel.findDescendantModels("components"),function(m){return m.get("_isQuestionType")!==true});_.each(nonQuestions,function(item){item.set("_isComplete",true);item.set("_isInteractionComplete",true)})},pass:function(callback){var i=0,qs=this._questionViews,len=qs.length;function step(){for(var j=0,count=Math.min(PassHalfFail.syncIterations,len-i);j<count;i++,j++){AutoAnswer$1.answer(qs[i]);if(!qs[i].model.get("_isSubmitted"))qs[i].$(".js-btn-action").trigger("click")}i==len?callback():setTimeout(step)}step()},half:function(callback){var notSubmitted=function(view){return!view.model.get("_isSubmitted")};var qs=_.shuffle(_.filter(this._questionViews,notSubmitted));var i=0,len=qs.length;function step(){for(var j=0,count=Math.min(PassHalfFail.syncIterations,len-i);j<count;i++,j++){AutoAnswer$1.answer(qs[i],i%2==0);if(!qs[i].model.get("_isSubmitted"))qs[i].$(".js-btn-action").trigger("click")}i==len?callback():setTimeout(step)}step()},fail:function(callback){var i=0,qs=this._questionViews,len=qs.length;function step(){for(var j=0,count=Math.min(PassHalfFail.syncIterations,len-i);j<count;i++,j++){AutoAnswer$1.answer(qs[i],true);if(!qs[i].model.get("_isSubmitted"))qs[i].$(".js-btn-action").trigger("click")}i==len?callback():setTimeout(step)}step()},onPagePreRender:function(view){this._currentPageId=view.model.get("_id");this.listenTo(Adapt,"componentView:postRender",this.onComponentRendered)},onRemove:function(){this.stopListening(Adapt,"componentView:postRender",this.onComponentRendered);this._questionViews=[]},onComponentRendered:function(view){if(view.model.has("_parentId")&&view.model.findAncestor("contentObjects").get("_id")==this._currentPageId){if(view.model.get("_isQuestionType")){this._questionViews.push(view)}}},onMouseDown:function(e){if(e.which===1)this.mouseTarget=e.target},onMouseUp:function(e){if(e.which===1)this.mouseTarget=null},onKeypress:function(e){var char=String.fromCharCode(e.which).toLowerCase();var perform=function(type){if(Adapt.devtools.get("_trickleEnabled"))Adapt.trigger("trickle:kill");var tutorEnabled=Adapt.devtools.get("_feedbackEnabled");if(tutorEnabled)Adapt.devtools.set("_feedbackEnabled",false);if(type=="pass")this.pass(_.partial(this.onPassHalfFailComplete,tutorEnabled));else if(type=="half")this.half(_.partial(this.onPassHalfFailComplete,tutorEnabled));else this.fail(_.partial(this.onPassHalfFailComplete,tutorEnabled));Adapt.trigger("drawer:closeDrawer")}.bind(this);if(this.mouseTarget&&$(".drawer .devtools").length===0){switch(char){case"p":return perform("pass");case"h":return perform("half");case"f":return perform("fail");}}else{switch(char){case"p":return perform("pass");case"h":return perform("half");case"f":return perform("fail");}}},onPassHalfFailComplete:function(tutorEnabled){console.log("onPassHalfFailComplete");if(tutorEnabled)Adapt.devtools.set("_feedbackEnabled",true)}},Backbone.Events);Adapt.on("app:dataReady devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;PassHalfFail.initialize()});var PassHalfFail$1=__AMD("extensions/adapt-devtools/js/pass-half-fail",PassHalfFail);var ToggleBanking={initialize:function(){Adapt.articles.each(function(m){var config=this.getConfig(m);if(m.has("_assessment")&&m.get("_assessment")._banks&&!m.get("_assessment")._banks._isEnabled){config._assessmentBankDisabled=true}},this)},getConfig:function(articleModel){if(!articleModel.has("_devtools"))articleModel.set("_devtools",{});return articleModel.get("_devtools")},getBankedAssessmentsInCurrentPage:function(){var pageModel=Adapt.findById(Adapt.location._currentId);var f=function(m){var config=this.getConfig(m);if(!config._assessmentBankDisabled&&m.has("_assessment")&&m.get("_assessment")._isEnabled&&m.get("_assessment")._banks._split.length>1)return true;return false};return Adapt.location._contentType==="menu"?[]:_.filter(pageModel.findDescendantModels("articles"),f,this)},toggle:function(){var bankedAssessments=this.getBankedAssessmentsInCurrentPage();var isBankingEnabled=function(m){return m.get("_assessment")._banks._isEnabled};var enable=!_.some(bankedAssessments,isBankingEnabled);_.each(bankedAssessments,function(articleModel){articleModel.get("_assessment")._banks._isEnabled=enable;articleModel.set({_attemptInProgress:false,_isPass:false})});router.handleId(Adapt.location._currentId)}};Adapt.once("adapt:initialize devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;ToggleBanking.initialize()});var ToggleBanking$1=__AMD("extensions/adapt-devtools/js/toggle-banking",ToggleBanking);var MapView=Backbone.View.extend({events:{"click a":"onLinkClicked"},initialize:function(){this.$("html").addClass("has-devtools-map");this._renderIntervalId=setInterval(this._checkRenderInterval.bind(this),500);this.listenTo(Adapt.components,"change:_isComplete",this.onModelCompletionChanged);this.listenTo(Adapt.blocks,"change:_isComplete",this.onModelCompletionChanged);this.listenTo(Adapt.articles,"change:_isComplete",this.onModelCompletionChanged);this.listenTo(Adapt.contentObjects,"change:_isComplete",this.onModelCompletionChanged);this.render()},render:function(){var data=this.model;var template=Handlebars.templates.devtoolsMap;this.$("body").html(template(data))},remove:function(){clearInterval(this._renderIntervalId);this.$("body").html("Course closed!");this.stopListening();return this},_checkRenderInterval:function(){if(this._invalid){this._invalid=false;this.render()}},_getConfig:function(pageModel){if(!pageModel.has("_devtools"))pageModel.set("_devtools",{});return pageModel.get("_devtools")},_disablePageIncompletePrompt:function(pageModel){var config=this._getConfig(pageModel);if(pageModel.has("_pageIncompletePrompt")){config._pageIncompletePromptExists=true;if(pageModel.get("_pageIncompletePrompt").hasOwnProperty("_isEnabled")){config._pageIncompletePromptEnabled=pageModel.get("_pageIncompletePrompt")._isEnabled}}else{config._pageIncompletePromptExists=false;pageModel.set("_pageIncompletePrompt",{})}pageModel.get("_pageIncompletePrompt")._isEnabled=false},_restorePageIncompletePrompt:function(pageModel){var config=this._getConfig(pageModel);if(config._pageIncompletePromptExists){if(config.hasOwnProperty("_pageIncompletePromptEnabled"))pageModel.get("_pageIncompletePrompt")._isEnabled=config._pageIncompletePromptEnabled;else delete pageModel.get("_pageIncompletePrompt")._isEnabled}else{pageModel.unset("_pageIncompletePrompt")}delete config._pageIncompletePromptExists;delete config._pageIncompletePromptEnabled},onModelCompletionChanged:function(){this.invalidate()},onLinkClicked:function(e){var $target=$(e.currentTarget);var id=$target.attr("href").slice(1);var model=Adapt.findById(id);e.preventDefault();if(e.ctrlKey&&this.el.defaultView){id=id.replace(/-/g,"");this.el.defaultView[id]=model;this.el.defaultView.console.log("devtools: add property window."+id+":");this.el.defaultView.console.log(model)}else if(e.shiftKey){this.navigateAndDisableTrickle(id)}else{this.navigateAndDisableTrickleUpTo(id)}},invalidate:function(){this._invalid=true},navigateAndDisableTrickleUpTo:function(id){var model=Adapt.findById(id);var pageModel=Adapt.findById(Adapt.location._currentId);this._disablePageIncompletePrompt(pageModel);if(model._siblings==="contentObjects"){Backbone.history.navigate("#/id/"+id,{trigger:true})}else{var level=model.get("_type")==="component"?model.getParent():model;var siblings=level.getParent().getChildren();var sibling=null;for(var i=0,count=siblings.indexOf(level);i<count;i++){sibling=siblings.at(i);console.log("disabling trickle on "+sibling.get("_id"));if(sibling.has("_trickle")){sibling.get("_trickle")._isEnabled=false}else{sibling.set("_trickle",{_isEnabled:false})}}if(Adapt.location._currentId===model.findAncestor("contentObjects").get("_id")){this.listenToOnce(Adapt,"pageView:ready",function(view){_.defer(function(){Adapt.scrollTo($("."+id));this.checkVisibility(id)}.bind(this))});if(Adapt.location._currentId===Adapt.course.get("_id"))router.handleRoute?router.handleRoute():router.handleCourse();else router.handleId(Adapt.location._currentId)}else{this.listenToOnce(Adapt,"pageView:ready",function(){_.defer(function(){this.checkVisibility(id)}.bind(this))});Backbone.history.navigate("#/id/"+id,{trigger:true})}}this._restorePageIncompletePrompt(pageModel);this.invalidate()},navigateAndDisableTrickle:function(id){var model=Adapt.findById(id);var pageModel=Adapt.findById(Adapt.location._currentId);this._disablePageIncompletePrompt(pageModel);if(model._siblings==="contentObjects"){Backbone.history.navigate("#/id/"+id,{trigger:true})}else{if(Adapt.location._currentId===model.findAncestor("contentObjects").get("_id")){Adapt.devtools.set("_trickleEnabled",false);Adapt.scrollTo($("."+id));this.checkVisibility(id)}else{var targetModel=Adapt.trickle?model.findAncestor("contentObjects"):Adapt.course;if(!targetModel.has("_trickle")){targetModel.set("_trickle",{_isEnabled:false});this.listenToOnce(Adapt,"pageView:ready",function(){_.defer(function(){targetModel.get("_trickle")._isEnabled=true;this.checkVisibility(id)}.bind(this))})}else if(targetModel.get("_trickle")._isEnabled){targetModel.get("_trickle")._isEnabled=false;this.listenToOnce(Adapt,"pageView:ready",function(){_.defer(function(){targetModel.get("_trickle")._isEnabled=true;this.checkVisibility(id)}.bind(this))})}Backbone.history.navigate("#/id/"+id,{trigger:true})}}this._restorePageIncompletePrompt(pageModel);this.invalidate()},checkVisibility:function(id){var model=Adapt.findById(id);if($("."+id).is(":visible")||model===Adapt.course)return;while(!$("."+id).is(":visible")&&model!==Adapt.course){model=model.getParent();id=model.get("_id")}console.log("adapt-devtools::checkVisibility scrolling to ancestor "+id);Adapt.scrollTo($("."+id))}});var CourseMap=_.extend({initialize:function(){this.listenTo(Adapt,"devtools:mapLoaded",this.onMapLoaded);$(window).on("unload",this.onCourseClosed.bind(this));function isMenu(options){if(this.get("_type")!=="page"){return options.fn(this)}return options.inverse(this)}function eachChild(options){var ret="";var children=this.getChildren().models;for(var i=0,j=children.length;i<j;i++){ret=ret+options.fn(children[i],{data:{index:i,first:i===0,last:i===j-1}})}return ret}function getId(options){var val=this.get("_id")||"";return val.slice(-6)}function getProp(prop,options){return this.get(prop)}function isStringEmpty(str){return!str||str.trim&&str.trim().length===0||$.trim(str).length===0}function getTitle(options){var t=this.get("displayTitle");if(isStringEmpty(t))t=this.get("title");if(isStringEmpty(t))t=this.get("_id");return t}function when(prop,options){if(this.get(prop)){return options.fn(this)}else{return options.inverse(this)}}function isTrickled(options){var trickleConfig=this.get("_trickle");var trickled=false;var isBlock=this.get("_type")==="block";if(trickleConfig)trickled=(isBlock||trickleConfig._onChildren!==true)&&trickleConfig._isEnabled;else if(isBlock){trickleConfig=this.getParent().get("_trickle");if(trickleConfig)trickled=trickleConfig._onChildren&&trickleConfig._isEnabled}if(trickled){return options.fn(this)}else{return options.inverse(this)}}Handlebars.registerHelper("isMenu",isMenu);Handlebars.registerHelper("eachChild",eachChild);Handlebars.registerHelper("getId",getId);Handlebars.registerHelper("getProp",getProp);Handlebars.registerHelper("getTitle",getTitle);Handlebars.registerHelper("when",when);Handlebars.registerHelper("isTrickled",isTrickled)},open:function(){if(!this.mapWindow){this.mapWindow=window.open("assets/map.html","Map")}else{this.mapWindow.focus()}},onMapClosed:function(){console.log("onMapClosed");this.mapWindow=null},onMapLoaded:function(mapWindow){console.log("onMapLoaded");this.mapWindow=mapWindow;this.mapWindow.focus();$("html",this.mapWindow.document).addClass($("html",window.document).attr("class"));this.mapView=new MapView({model:Adapt,el:this.mapWindow.document});$(this.mapWindow).on("unload",this.onMapClosed.bind(this))},onCourseClosed:function(){if(this.mapView){this.mapView.remove()}}},Backbone.Events);Adapt.once("adapt:initialize devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;CourseMap.initialize()});var CourseMap$1=__AMD("extensions/adapt-devtools/js/map",CourseMap);var mouseTarget$1=null;function onMouseDown$2(e){if(e.which==1)mouseTarget$1=e.target}function onMouseUp$2(e){if(e.which==1)mouseTarget$1=null}function onKeypress$2(e){var char=String.fromCharCode(e.which).toLowerCase();if(mouseTarget$1){if(char=="m"){var model=Utils.getModelForElement(mouseTarget$1);if(model){var id=model.get("_id").replace(/-/g,"");window[id]=model;console.log("devtools: add property window."+id+":");console.log(model.attributes)}}}}function getAdaptCoreVersion(){try{if(Adapt.build&&Adapt.build.has("package"))return Adapt.build.get("package").version||">=v3.0.0";if(typeof AdaptModel.prototype.checkCompletionStatusFor=="function")return">=v2.2.3";if(typeof AdaptModel.prototype.setCompletionStatus=="function")return">=v2.0.10";if(typeof AdaptModel.prototype.checkLocking=="function")return"v2.0.9";if(typeof Adapt.checkingCompletion=="function")return"v2.0.8";if(typeof AdaptModel.prototype.getParents=="function")return"v2.0.7";if($.a11y&&$.a11y.options.hasOwnProperty("isIOSFixesEnabled"))return"v2.0.5-v2.0.6";if(Adapt instanceof Backbone.Model)return"v2.0.4";if(typeof QuestionView$1.prototype.recordInteraction=="function")return"v2.0.2-v2.0.3";if(typeof Adapt.findById=="function")return"v2.0.0-v2.0.1";return"v1.x"}catch(e){return"unknown version"}}var Utils={getModelForElement:function(element){var $target=$(element);if($target.length==0)return false;var id=$target.parents("[data-adapt-id]").data("adapt-id");return!id?false:Adapt.findById(id)}};Adapt.once("adapt:initialize",function(){var str="Version of Adapt core detected: "+getAdaptCoreVersion();var horz=getHorzLine();console.log(horz+"\nVersion of Adapt core detected: "+getAdaptCoreVersion()+"\n"+horz);function getHorzLine(){for(var s="",i=0,c=str.length;i<c;i++){s+="*"}return s}});Adapt.once("adapt:initialize devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;$(window).on("keypress",onKeypress$2);$(window).on("mousedown",onMouseDown$2);$(window).on("mouseup",onMouseUp$2);if(!window.Adapt)window.Adapt=Adapt});var Utils$1=__AMD("extensions/adapt-devtools/js/utils",Utils);function onTrickleBegun(){if(!Adapt.devtools.get("_trickleEnabled")){console.log("Trickle started");Adapt.devtools.set("_trickleEnabled",true);Adapt.devtools.once("change:_trickleEnabled",onTrickleChange)}}function onTrickleEnded(){console.log("Trickle ended");Adapt.devtools.off("change:_trickleEnabled",onTrickleChange);Adapt.devtools.set("_trickleEnabled",false)}function onTrickleChange(){if(!Adapt.devtools.get("_trickleEnabled")){Adapt.trigger("trickle:kill")}}function remove(){if(Adapt.devtools.get("_trickleEnabled")){onTrickleEnded()}}Adapt.once("adapt:initialize devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;Adapt.on("trickle:interactionInitialize trickle:started",onTrickleBegun);Adapt.on("trickle:kill trickle:finished",onTrickleEnded);Adapt.on("remove",remove)});function onShowFeedback(){Adapt.trigger("tutor:closed")}function hushTutor(){Adapt.devtools.set("_tutorListener",Adapt._events["questionView:showFeedback"].pop());Adapt.on("questionView:showFeedback",onShowFeedback)}function reinstateTutor(){Adapt.off("questionView:showFeedback",onShowFeedback);if(!Adapt._events.hasOwnProperty("questionView:showFeedback")){Adapt._events["questionView:showFeedback"]=[]}Adapt._events["questionView:showFeedback"].push(Adapt.devtools.get("_tutorListener"))}function onFeedbackToggled(){if(Adapt.devtools.get("_feedbackEnabled")){reinstateTutor();$(document).off("mouseup",".js-btn-feedback")}else{hushTutor();$(document).on("mouseup",".js-btn-feedback",onFeedbackButtonClicked)}}function onFeedbackButtonClicked(e){var classes=$(e.currentTarget).parents(".component").attr("class");var componentId=/[\s]+(c\-[^\s]+)/.exec(classes)[1];if(componentId){reinstateTutor();Adapt.trigger("questionView:showFeedback",{model:Adapt.findById(componentId)});hushTutor()}else console.error("devtools:onFeedbackButtonClicked: malformed component class name")}Adapt.once("adapt:initialize devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;if(Adapt.devtools.get("_toggleFeedbackAvailable")){if(Adapt._events.hasOwnProperty("questionView:showFeedback")&&Adapt._events["questionView:showFeedback"].length==1){Adapt.devtools.on("change:_feedbackEnabled",onFeedbackToggled)}else{console.warn("devtools: no tutor or multiple registrants of questionView:showFeedback so disabling ability to toggle feedback.");Adapt.devtools.set("_toggleFeedbackAvailable",false)}}});var AltText=_.extend({initialize:function(){this.listenTo(Adapt.devtools,"change:_altTextEnabled",this.toggleAltText);if(typeof MutationObserver=="function"){this.observer=new MutationObserver(_.bind(this.onDomMutation,this))}},addTimer:function(fireNow){this.timerId=setInterval(_.bind(this.onTimer,this),1000);if(fireNow)this.onTimer()},removeTimer:function(){clearInterval(this.timerId)},connectObserver:function(){if(this.observer)this.observer.observe(document.getElementById("wrapper"),{childList:true,subtree:true,attributes:true,attributeFilter:["class","style"]})},disconnectObserver:function(){if(this.observer)this.observer.disconnect()},toggleAltText:function(){if(Adapt.devtools.get("_altTextEnabled")){this.addTimer(true);this.connectObserver()}else{this.removeTimer();this.removeAllAnnotations();this.disconnectObserver()}},addAnnotation:function($img,$annotation){var template=Handlebars.templates["devtoolsAnnotation"];var text=$img.attr("alt");if(!text)text=$img.attr("aria-label");var $annotation=$(template({text:text}));if(!text)$annotation.addClass("has-annotation-warning");$img.after($annotation);$img.data("annotation",$annotation);this.updateAnnotation($img,$annotation)},removeAnnotation:function($img,$annotation){$annotation.remove();$img.removeData("annotation")},removeAllAnnotations:function(){$("img").each(_.bind(function(index,element){var $img=$(element);var $annotation=$img.data("annotation");if($annotation)this.removeAnnotation($img,$annotation)},this))},updateAnnotation:function($img,$annotation){var position=$img.position();position.left+=parseInt($img.css("marginLeft"),10)+parseInt($img.css("paddingLeft"),10);position.top+=parseInt($img.css("marginTop"),10)+parseInt($img.css("paddingTop"),10);$annotation.css(position)},onDomMutation:function(mutations){this.mutated=true},onTimer:function(){if(this.mutated===false)return;if(this.observer)this.mutated=false;this.disconnectObserver();$("img").each(_.bind(function(index,element){var $img=$(element);var $annotation=$img.data("annotation");var isVisible=$img.is(":visible");if(isVisible){if(!$annotation)this.addAnnotation($img,$annotation);else this.updateAnnotation($img,$annotation)}else if($annotation){this.removeAnnotation($img,$annotation)}},this));this.connectObserver()}},Backbone.Events);Adapt.once("adapt:initialize devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;AltText.initialize()});__AMD("extensions/adapt-devtools/js/toggle-alt-text",AltText);function breakCoreLocking(){Adapt.course.unset("_lockType");breakLocks(Adapt.contentObjects);breakLocks(Adapt.articles);breakLocks(Adapt.blocks);function breakLocks(collection){collection.each(function(model){model.unset("_lockType");model.unset("_isLocked")})}}function onUnlocked(){if(Adapt.devtools.get("_unlocked")){breakCoreLocking();if(Adapt.location._currentId==Adapt.course.get("_id"))router.handleRoute?router.handleRoute():router.handleCourse();else router.handleId(Adapt.location._currentId)}}function onMenuPreRender(view){if(Adapt.devtools.get("_unlocked")){if(Adapt.location._currentId==view.model.get("_id")){view.model.once("change:_isReady",_.bind(onMenuReady,view));view.model.getChildren().each(function(item){if(item.has("_lock"))item.set("_lock",item.get("_lock").length>-1?[]:false);if(item._lock)item._lock=item._lock.length>-1?[]:false;if(item._locked===true)item._locked=false;if(item._isLocked===true)item._isLocked=false})}}}function onMenuReady(){if(Adapt.devtools.get("_unlocked")){this.$("a, button").prop("disabled",false).css("pointer-events","auto")}}Adapt.once("adapt:initialize devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;if(Adapt.devtools.get("_unlockAvailable")){Adapt.devtools.on("change:_unlocked",onUnlocked);Adapt.on("menuView:preRender",onMenuPreRender)}});var buffer="";var isMouseDown=false;var hitArea=100;var coords={};var topLeftTapHold=false;var topRightTapHold=false;var listenType=0;var timeoutId;var focusableElements="a,button,input,select,textarea,[tabindex],label";function onKeypress$1(e){var c=String.fromCharCode(e.which).toLowerCase();buffer+=c;if(isMouseDown&&c=="5"&&!Adapt.devtools.get("_isEnabled"))enable();else processBuffer()}function onMouseDown$1(){isMouseDown=true}function onMouseUp$1(){isMouseDown=false}function processBuffer(){var blen=buffer.length;if(blen>100)buffer=buffer.substr(1,100);blen=buffer.length;if(buffer.substr(blen-"kcheat".length,"kcheat".length)=="kcheat"){if(!Adapt.devtools.get("_isEnabled"))enable()}}function enable(){removeHooks();Adapt.devtools.set("_isEnabled",true);Adapt.trigger("devtools:enable");if(Adapt.location._currentId==Adapt.course.get("_id"))router.handleRoute?router.handleRoute():router.handleCourse();else router.handleId(Adapt.location._currentId)}function addHooks(){$(window).on("keypress",onKeypress$1);$(window).on("mousedown",onMouseDown$1);$(window).on("mouseup",onMouseUp$1);window.kcheat=function(){buffer="kcheat";processBuffer()};router.route("kcheat","kcheat",function(){if(window.kcheat)window.kcheat()});if(Modernizr.touch)addTouchHook()}function removeHooks(){$(window).off("keypress",onKeypress$1);$(window).off("mousedown",onMouseDown$1);$(window).off("mouseup",onMouseUp$1);window.kcheat=undefined;if(Modernizr.touch)removeTouchHook()}function addTouchHook(){$("body").on("touchstart",onTouchStart);$("body").on("touchend",onTouchEnd);$("body").on("touchstart",focusableElements,onTouchStart)}function removeTouchHook(){clearTimeout(timeoutId);$("body").off("touchstart",onTouchStart);$("body").off("touchend",onTouchEnd);$("body").off("touchstart",focusableElements,onTouchStart)}function onTouchStart(event){var touches=event.originalEvent.touches;if(touches.length!=1)return;coords.x=touches[0].pageX;coords.y=touches[0].pageY;if(coords.x>=0&&coords.x<hitArea&&coords.y>=0&&coords.y<hitArea){listenType=1}else if(coords.x>=$(window).width()-hitArea&&coords.x<$(window).width()&&coords.y>=0&&coords.y<hitArea){listenType=2}else{listenType=topLeftTapHold=topRightTapHold=false}if(listenType){timeoutId=setTimeout(function(){if(listenType){if(listenType==1)topLeftTapHold=true;else if(listenType==2)topRightTapHold=true;if(topLeftTapHold&&topRightTapHold){if(window.kcheat)window.kcheat()}}},200)}}function onTouchEnd(event){listenType=false;clearTimeout(timeoutId)}Adapt.once("adapt:initialize",function(){if(Adapt.devtools.get("_isEnabled"))return;_.defer(function(){addHooks()})});var TraceFocus=_.extend({openingTags:new RegExp("<[\\w-]+((\\s+[\\w-]+(\\s*=\\s*(?:\".*?\"|'.*?'|[^'\">\\s]+))*)+\\s*|\\s*)/?>"),consoleStyle:"background: lightgray; color: blue",initialize:function(){this.onFocusIn=_.bind(this.onFocusIn,this);this.listenTo(Adapt.devtools,"change:_traceFocusEnabled",this.toggleTraceFocus);this.toggleTraceFocus()},toggleTraceFocus:function(){if(Adapt.devtools.get("_traceFocusEnabled")){$("body").on("focusin",this.onFocusIn)}else{$("body").off("focusin",this.onFocusIn)}},onFocusIn:function(e){if(!$("html").is(".ie, .Edge"))return console.log("%cfocussed",this.consoleStyle,e.target);var $el=$(e.target);if(!$el[0]||!$el[0].outerHTML)return console.log("focussed: ",e.target);var openingTag=this.openingTags.exec($el[0].outerHTML)[0];if(openingTag){var tokens=$el.text().replace(/[\s\xA0]*/,"").split(/\r\n|\r|\n/);if(tokens[0])openingTag=openingTag.slice(0,20)+"[...]";if($("html").is(".ie8")){console.log("focussed: ",openingTag,tokens[0])}else{console.log("focussed: ",openingTag,tokens[0],$el)}}else{console.log("focussed: "+e.target)}}},Backbone.Events);Adapt.once("adapt:initialize devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;TraceFocus.initialize()});__AMD("extensions/adapt-devtools/js/toggle-trace-focus",TraceFocus);var mouseTarget=null;function init(){$(window).on("keypress",onKeypress);$(window).on("mousedown",onMouseDown);$(window).on("mouseup",onMouseUp)}function onKeypress(e){var char=String.fromCharCode(e.which).toLowerCase();if(mouseTarget){switch(char){case"c":return complete(mouseTarget);case"r":return reset(mouseTarget);}}}function complete(element){var model=Utils$1.getModelForElement(element);if(!model)return;function doCompletion(component){component.set("_isComplete",true)}var descendantComponents=model.findDescendantModels("components");if(!descendantComponents||descendantComponents.length===0){console.log("devtools: completing",model.get("_id"));doCompletion(model);return}console.log("devtools: completing all components in",model.get("_id"));_.each(descendantComponents,function(model){doCompletion(model)})}function reset(element){var model=Utils$1.getModelForElement(element);if(!model)return;var descendantComponents=model.findDescendantModels("components");if(!descendantComponents||descendantComponents.length===0){console.log("devtools: resetting",model.get("_id"));model.reset(true,true);return}console.log("devtools: resetting all components in",model.get("_id"));_.each(descendantComponents,function(model){model.reset(true,true)})}function onMouseDown(e){if(e.which===1)mouseTarget=e.target}function onMouseUp(e){if(e.which===1)mouseTarget=null}Adapt.once("adapt:initialize devtools:enable",function(){if(!Adapt.devtools.get("_isEnabled"))return;init()});var navigationView;var DevtoolsView=Backbone.View.extend({className:"devtools",events:{"click .end-trickle":"onEndTrickle","change .hinting input":"onToggleHinting","change .banking input":"onToggleBanking","change .feedback input":"onToggleFeedback","change .auto-correct input":"onToggleAutoCorrect","change .alt-text input":"onToggleAltText","click .unlock":"onUnlock","click .open-map":"onOpenMap","click .open-spoor-log":"onOpenSpoorLog","click .complete-page":"onCompletePage","click .complete-menu":"onCompleteMenu","click .pass":"onPassHalfFail","click .half":"onPassHalfFail","click .fail":"onPassHalfFail","change .trace-focus input":"onToggleTraceFocus"},initialize:function(){this.render();this._checkUnlockVisibility();this._checkSpoorLogVisibility();this._checkTrickleEndVisibility();this._checkBankingVisibility();this._checkFeedbackVisibility();this._checkHintingVisibility();this._checkAutoCorrectVisibility();this._checkAltTextVisibility();this._checkPassHalfFailVisibility();this._checkCompletePageVisibility();this._checkCompleteMenuVisibility();this._checkTraceFocusVisibility()},render:function(){var data=Adapt.devtools.toJSON();var template=Handlebars.templates["devtools"];this.$el.html(template(data));return this},_checkUnlockVisibility:function(){if(!Adapt.devtools.get("_unlockAvailable")||Adapt.devtools.get("_unlocked"))this.$(".unlock").addClass("u-display-none");else this.$(".unlock").toggleClass("u-display-none",!this._checkForLocks())},_checkForLocks:function(){if(typeof AdaptModel.prototype.checkLocking!=="function")return Adapt.location._contentType==="menu";var hasLock=function(model){return model.has("_lockType")};if(hasLock(Adapt.course))return true;if(Adapt.contentObjects.some(hasLock))return true;if(Adapt.articles.some(hasLock))return true;if(Adapt.blocks.some(hasLock))return true;return false},onUnlock:function(){Adapt.devtools.set("_unlocked",true);this._checkUnlockVisibility()},onOpenMap:function(){CourseMap$1.open();Adapt.trigger("drawer:closeDrawer")},_checkSpoorLogVisibility:function(){var spoorInstalled=require.defined("extensions/adapt-contrib-spoor/js/adapt-contrib-spoor");if(spoorInstalled)return;this.$(".open-spoor-log").addClass("is-disabled").attr("disabled","disabled")},onOpenSpoorLog:function(){Adapt.trigger("drawer:closeDrawer");if(Adapt.spoor){Adapt.spoor.scorm.showDebugWindow();return}require("extensions/adapt-contrib-spoor/js/scorm").showDebugWindow()},_checkTrickleEndVisibility:function(){this.$(".end-trickle").toggleClass("u-display-none",!Adapt.devtools.get("_trickleEnabled"))},onEndTrickle:function(){Adapt.devtools.set("_trickleEnabled",false);this._checkTrickleEndVisibility()},_checkBankingVisibility:function(){if(!Adapt.devtools.get("_toggleFeedbackAvailable")){this.$(".banking").addClass("u-display-none");return}var bankedAssessments=ToggleBanking$1.getBankedAssessmentsInCurrentPage();var isBankingEnabled=function(m){return m.get("_assessment")._banks._isEnabled};if(bankedAssessments.length>0){this.$(".banking").removeClass("u-display-none");this.$(".banking label").toggleClass("is-selected",_.some(bankedAssessments,isBankingEnabled));return}this.$(".banking").addClass("u-display-none")},onToggleBanking:function(){ToggleBanking$1.toggle();this._checkBankingVisibility()},_checkFeedbackVisibility:function(){if(Adapt.devtools.get("_toggleFeedbackAvailable")){this.$(".feedback").removeClass("u-display-none");this.$(".feedback label").toggleClass("is-selected",Adapt.devtools.get("_feedbackEnabled"));return}this.$(".feedback").addClass("u-display-none")},onToggleFeedback:function(){Adapt.devtools.toggleFeedback();this._checkFeedbackVisibility()},_checkHintingVisibility:function(){if(Adapt.devtools.get("_hintingAvailable")){this.$(".hinting").removeClass("u-display-none");this.$(".hinting label").toggleClass("is-selected",Adapt.devtools.get("_hintingEnabled"));return}this.$(".hinting").addClass("u-display-none")},onToggleHinting:function(){Adapt.devtools.toggleHinting();this._checkHintingVisibility()},_checkAutoCorrectVisibility:function(){if(Adapt.devtools.get("_autoCorrectAvailable")){this.$(".is-toggle.auto-correct").removeClass("u-display-none");this.$(".is-toggle.auto-correct label").toggleClass("is-selected",Adapt.devtools.get("_autoCorrectEnabled"));this.$(".is-tip.auto-correct").toggleClass("u-display-none",Adapt.devtools.get("_autoCorrectEnabled"));return}this.$(".auto-correct").addClass("u-display-none")},onToggleAutoCorrect:function(){Adapt.devtools.toggleAutoCorrect();this._checkAutoCorrectVisibility()},_checkAltTextVisibility:function(){if(Adapt.devtools.get("_altTextAvailable")){this.$(".is-toggle.alt-text").removeClass("u-display-none");this.$(".is-toggle.alt-text label").toggleClass("is-selected",Adapt.devtools.get("_altTextEnabled"));this.$(".is-tip.alt-text").toggleClass("u-display-none",Adapt.devtools.get("_altTextEnabled"));return}this.$(".alt-text").addClass("u-display-none")},onToggleAltText:function(){Adapt.devtools.toggleAltText();this._checkAltTextVisibility()},_checkCompletePageVisibility:function(){var currentModel=Adapt.findById(Adapt.location._currentId);if(currentModel.get("_type")!=="page"){this.$(".complete-page").addClass("u-display-none");return}var incomplete=currentModel.findDescendantModels("components",{where:{_isInteractionComplete:false}});this.$(".complete-page").toggleClass("u-display-none",incomplete.length===0)},onCompletePage:function(e){var currentModel=Adapt.findById(Adapt.location._currentId);if(Adapt.devtools.get("_trickleEnabled"))Adapt.trigger("trickle:kill");var incomplete=currentModel.findDescendantModels("components",{where:{_isInteractionComplete:false}});incomplete.forEach(function(component){if(component.get("_isQuestionType")){component.set({_isCorrect:true,_isSubmitted:true,_score:1});component.set("_attemptsLeft",Math.max(0,component.set("_attempts")-1))}component.set("_isComplete",true);component.set(currentModel.has("_isInteractionsComplete")?"_isInteractionsComplete":"_isInteractionComplete",true)});Adapt.trigger("drawer:closeDrawer")},_checkCompleteMenuVisibility:function(){var currentModel=Adapt.findById(Adapt.location._currentId);if(currentModel.get("_type")!=="menu"&&currentModel.get("_type")!=="course"){this.$(".complete-menu").addClass("u-display-none");return}var incomplete=currentModel.findDescendantModels("components",{where:{_isComplete:false}});this.$(".complete-menu").toggleClass("u-display-none",incomplete.length===0)},onCompleteMenu:function(e){var currentModel=Adapt.findById(Adapt.location._currentId);if(Adapt.devtools.get("_trickleEnabled"))Adapt.trigger("trickle:kill");var incomplete=currentModel.findDescendantModels("components",{where:{_isComplete:false}});_.invoke(incomplete,"set","_isComplete",true);Adapt.trigger("drawer:closeDrawer")},_checkPassHalfFailVisibility:function(){var currentModel=Adapt.findById(Adapt.location._currentId);if(currentModel.get("_type")!=="page"){this.$(".pass, .half, .fail").addClass("u-display-none");return}var unanswered=currentModel.findDescendantModels("components",{where:{_isQuestionType:true,_isSubmitted:false}});if(unanswered.length===0)this.$(".tip.pass-half-fail").html("");else this.$(".is-tip.pass-half-fail").html("With the "+unanswered.length+" unanswered question(s) in this page do the following:");this.$(".pass, .half, .fail").toggleClass("u-display-none",unanswered.length===0)},onPassHalfFail:function(e){if(Adapt.devtools.get("_trickleEnabled"))Adapt.trigger("trickle:kill");$(".js-loading").show();var tutorEnabled=Adapt.devtools.get("_feedbackEnabled");if(tutorEnabled)Adapt.devtools.set("_feedbackEnabled",false);if($(e.currentTarget).hasClass("pass"))PassHalfFail$1.pass(this.onPassHalfFailComplete.bind(this,tutorEnabled));else if($(e.currentTarget).hasClass("half"))PassHalfFail$1.half(this.onPassHalfFailComplete.bind(this,tutorEnabled));else PassHalfFail$1.fail(this.onPassHalfFailComplete.bind(this,tutorEnabled));Adapt.trigger("drawer:closeDrawer")},onPassHalfFailComplete:function(tutorEnabled){console.log("onPassHalfFailComplete");if(tutorEnabled)Adapt.devtools.set("_feedbackEnabled",true);$(".js-loading").hide()},_checkTraceFocusVisibility:function(){if(Adapt.devtools.get("_traceFocusAvailable")){this.$(".is-toggle.trace-focus").removeClass("u-display-none");this.$(".is-toggle.trace-focus label").toggleClass("is-selected",Adapt.devtools.get("_traceFocusEnabled"));return}this.$(".trace-focus").addClass("u-display-none")},onToggleTraceFocus:function(){Adapt.devtools.toggleTraceFocus();this._checkTraceFocusVisibility()}});var DevtoolsNavigationView=Backbone.View.extend({initialize:function(){var template=Handlebars.templates.devtoolsNavigation;this.$el=$(template());$("html").addClass("devtools-enabled").toggleClass("devtools-extended",Adapt.devtools.get("_extended"));if(this.$el.is("a")||this.$el.is("button"))this.$el.on("click",this.onDevtoolsClicked.bind(this));else this.$el.find("a, button").on("click",this.onDevtoolsClicked.bind(this));this.listenTo(Adapt,"pageView:postRender menuView:postRender",this.onContentRendered);this.listenToOnce(Adapt,"pageView:postRender menuView:postRender",this.render)},render:function(){$(".nav__inner").append(this.$el);return this},remove:function(){this.$el.remove();this.stopListening();return this},deferredRender:function(){_.defer(this.render.bind(this))},onContentRendered:function(view){if(view.model.get("_id")===Adapt.location._currentId){this.stopListening(view.model,"change:_isReady",this.deferredRender);this.listenToOnce(view.model,"change:_isReady",this.deferredRender)}},onDevtoolsClicked:function(event){if(event&&event.preventDefault)event.preventDefault();Adapt.drawer.triggerCustomView(new DevtoolsView().$el,false)}});Adapt.once("courseModel:dataLoaded",function(){Adapt.devtools=new DevtoolsModel$1});function initNavigationView(){if(!Adapt.devtools.get("_isEnabled"))return;if(navigationView)navigationView.remove();navigationView=new DevtoolsNavigationView}Adapt.once("adapt:initialize devtools:enable",function(){initNavigationView();Adapt.on("app:languageChanged",initNavigationView)});var footerLink=_.extend({initialize:function(){this.listenTo(Adapt,"router:course",this.updateCourse);this.listenTo(Adapt,"pageView:ready",this.addLinks);this.listenTo(Adapt,"menuView:ready",this.addLinks);this.listenTo(Adapt,"router:page",this.updatePage)},updateCourse:function(target){this.currentCourse=target},getCourse:function(){return this.currentCourse},updatePage:function(target){this.contentObject=target},getPage:function(){return this.contentObject},addLinks:function(){var items=[];try{items=this.contentObject.get("_FooterLink")._items}catch(err){}if(items.length<1){items=Adapt.course.get("_FooterLink")._items}_.each(items,function(item){var title=item.title;var link=item.link;try{if($(".about-links").prop("innerHTML").trim().length>0){$(".about-links").append(" | ")}$(".about-links").append("<a class=\"about\" target=\"_blank\"; href='"+link+"'>"+title+"</a>")}catch(err){}})}},Backbone.Events);footerLink.initialize();__AMD("extensions/adapt-odi-footerLink/js/adapt-odi-footerLink",footerLink);var MenuItemView=function(_AdaptView){_inherits(MenuItemView,_AdaptView);var _super=_createSuper(MenuItemView);function MenuItemView(){_classCallCheck(this,MenuItemView);return _super.apply(this,arguments)}_createClass(MenuItemView,[{key:"attributes",value:function attributes(){return AdaptView$1.resultExtend("attributes",{"role":"listitem","aria-labelledby":this.model.get("_id")+"-heading"},this)}},{key:"className",value:function className(){return["menu-item",this.constructor.className,this.model.get("_id"),this.model.get("_classes"),this.setVisibility(),this.setHidden(),this.model.get("_isVisited")?"is-visited":"",this.model.get("_isComplete")?"is-complete":"",this.model.get("_isLocked")?"is-locked":"",this.model.get("_isOptional")?"is-optional":""].join(" ")}},{key:"preRender",value:function preRender(){this.model.checkCompletionStatus();this.model.checkInteractionCompletionStatus()}},{key:"postRender",value:function postRender(){this.$el.imageready(this.setReadyStatus.bind(this))}}]);return MenuItemView}(AdaptView$1);MenuItemView.type="menuItem";var MenuItemView$1=__AMD("core/js/views/menuItemView",MenuItemView);var MenuView=function(_ContentObjectView){_inherits(MenuView,_ContentObjectView);var _super=_createSuper(MenuView);function MenuView(){_classCallCheck(this,MenuView);return _super.apply(this,arguments)}return MenuView}(ContentObjectView);Object.assign(MenuView,{childContainer:".js-children",childView:MenuItemView$1,type:"menu",template:"menu"});var MenuView$1=__AMD("core/js/views/menuView",MenuView);var BoxMenuItemView=function(_MenuItemView){_inherits(BoxMenuItemView,_MenuItemView);var _super=_createSuper(BoxMenuItemView);function BoxMenuItemView(){_classCallCheck(this,BoxMenuItemView);return _super.apply(this,arguments)}_createClass(BoxMenuItemView,[{key:"className",value:function className(){return"boxmenu-item"}},{key:"events",value:function events(){return{"click .js-btn-click":"onClickMenuItemButton"}}},{key:"onClickMenuItemButton",value:function onClickMenuItemButton(event){if(event&&event.preventDefault)event.preventDefault();if(this.model.get("_isLocked"))return;router.navigateToElement(this.model.get("_id"))}}]);return BoxMenuItemView}(MenuItemView$1);BoxMenuItemView.template="boxMenuItem";var BoxMenuItemView$1=__AMD("menu/adapt-contrib-boxMenu/js/BoxMenuItemView",BoxMenuItemView);var BoxMenuGroupView=function(_MenuItemView){_inherits(BoxMenuGroupView,_MenuItemView);var _super=_createSuper(BoxMenuGroupView);function BoxMenuGroupView(){_classCallCheck(this,BoxMenuGroupView);return _super.apply(this,arguments)}_createClass(BoxMenuGroupView,[{key:"className",value:function className(){return"boxMenuGroup"}},{key:"postRender",value:function postRender(){_.defer(this.addChildren.bind(this));this.$el.imageready(this.setReadyStatus.bind(this));this.$el.parents(".boxmenu__item-container").addClass("has-groups")}}]);return BoxMenuGroupView}(MenuItemView$1);BoxMenuGroupView.template="boxMenuGroup";BoxMenuGroupView.childContainer=".js-group-children";BoxMenuGroupView.childView=BoxMenuItemView$1;var BoxMenuGroupView$1=__AMD("menu/adapt-contrib-boxMenu/js/BoxMenuGroupView",BoxMenuGroupView);var BoxMenuView=function(_MenuView){_inherits(BoxMenuView,_MenuView);var _super=_createSuper(BoxMenuView);function BoxMenuView(){_classCallCheck(this,BoxMenuView);return _super.apply(this,arguments)}_createClass(BoxMenuView,[{key:"initialize",value:function initialize(){_get(_getPrototypeOf(BoxMenuView.prototype),"initialize",this).call(this);this.setStyles();this.listenTo(Adapt,"device:changed",this.onDeviceResize)}},{key:"onDeviceResize",value:function onDeviceResize(){this.setStyles()}},{key:"addChildren",value:function addChildren(){var _this=this;var nthChild=0;var models=this.model.getChildren().models;var childViews=[];models.forEach(function(model){if(!model.get("_isAvailable"))return;if(model.get("_isHidden")){model.set("_isReady",true);return}nthChild++;model.set("_nthChild",nthChild);var ChildView=model.get("_type")==="menu"&&model.get("_boxMenu")&&model.get("_boxMenu")._renderAsGroup?BoxMenuGroupView$1:BoxMenuItemView$1;var $parentContainer=_this.$(_this.constructor.childContainer);var childView=new ChildView({model:model});childViews.push(childView);$parentContainer.append(childView.$el)});this.setChildViews(childViews)}},{key:"setStyles",value:function setStyles(){this.setBackgroundImage();this.setBackgroundStyles();this.processHeader()}},{key:"setBackgroundImage",value:function setBackgroundImage(){var _backgroundImages$;var config=this.model.get("_boxMenu");var backgroundImages=config===null||config===void 0?void 0:config._backgroundImage;if(!backgroundImages)return;var backgroundImage=(_backgroundImages$=backgroundImages["_".concat(Adapt.device.screenSize)])!==null&&_backgroundImages$!==void 0?_backgroundImages$:backgroundImages._small;this.$el.toggleClass("has-bg-image",Boolean(backgroundImage)).css("background-image",backgroundImage?"url("+backgroundImage+")":"")}},{key:"setBackgroundStyles",value:function setBackgroundStyles(){var config=this.model.get("_boxMenu");var styles=config===null||config===void 0?void 0:config._backgroundStyles;if(!styles)return;this.$el.css({"background-repeat":styles._backgroundRepeat,"background-size":styles._backgroundSize,"background-position":styles._backgroundPosition})}},{key:"processHeader",value:function processHeader(){var config=this.model.get("_boxMenu");var header=config===null||config===void 0?void 0:config._menuHeader;if(!header)return;var $header=this.$(".menu__header");this.setHeaderBackgroundImage(header,$header);this.setHeaderBackgroundStyles(header,$header);this.setHeaderMinimumHeight(header,$header)}},{key:"setHeaderBackgroundImage",value:function setHeaderBackgroundImage(config,$header){var _backgroundImages$2;var backgroundImages=config._backgroundImage;if(!backgroundImages)return;var backgroundImage=(_backgroundImages$2=backgroundImages["_".concat(Adapt.device.screenSize)])!==null&&_backgroundImages$2!==void 0?_backgroundImages$2:backgroundImages._small;$header.toggleClass("has-bg-image",Boolean(backgroundImage)).css("background-image",backgroundImage?"url("+backgroundImage+")":"")}},{key:"setHeaderBackgroundStyles",value:function setHeaderBackgroundStyles(config,$header){var styles=config._backgroundStyles;if(!styles)return;$header.css({"background-repeat":styles._backgroundRepeat,"background-size":styles._backgroundSize,"background-position":styles._backgroundPosition})}},{key:"setHeaderMinimumHeight",value:function setHeaderMinimumHeight(config,$header){var _minimumHeights$;var minimumHeights=config._minimumHeights;if(!minimumHeights)return;var minimumHeight=(_minimumHeights$=minimumHeights["_".concat(Adapt.device.screenSize)])!==null&&_minimumHeights$!==void 0?_minimumHeights$:minimumHeights._small;$header.toggleClass("has-min-height",Boolean(minimumHeight)).css("min-height",minimumHeight?minimumHeight+"px":"")}}]);return BoxMenuView}(MenuView$1);BoxMenuView.className="boxmenu";BoxMenuView.template="boxMenu";var BoxMenuView$1=__AMD("menu/adapt-contrib-boxMenu/js/BoxMenuView",BoxMenuView);Adapt.register("course menu",{view:BoxMenuView$1});Adapt.register("boxMenu",{view:BoxMenuView$1,model:MenuModel$1.extend({})});var ThemeView=Backbone.View.extend({className:function(){},initialize:function(){this.setStyles();this.listenTo(Adapt,{"device:changed":this.onDeviceResize,"remove":this.remove})},onDeviceResize:function(){this.setStyles()},remove:function(){Backbone.View.prototype.remove.call(this);this.onRemove()},setStyles:function(){this.setClasses();this.setBackgroundImage();this.setBackgroundStyles();this.setMinimumHeight();this.setCustomStyles()},setClasses:function(){this.$el.addClass(this.className())},setBackgroundImage:function(){var backgroundImages=this.model.get("_backgroundImage");if(!backgroundImages)return;var backgroundImage;switch(Adapt.device.screenSize){case"large":backgroundImage=backgroundImages._large;break;case"medium":backgroundImage=backgroundImages._medium;break;default:backgroundImage=backgroundImages._small;}if(backgroundImage){this.$el.addClass("has-bg-image").css("background-image","url("+backgroundImage+")")}else{this.$el.removeClass("has-bg-image").css("background-image","")}},setBackgroundStyles:function(){var styles=this.model.get("_backgroundStyles");if(!styles)return;this.$el.css({"background-repeat":styles._backgroundRepeat,"background-size":styles._backgroundSize,"background-position":styles._backgroundPosition})},setMinimumHeight:function(){var minimumHeights=this.model.get("_minimumHeights");if(!minimumHeights)return;var minimumHeight;switch(Adapt.device.screenSize){case"large":minimumHeight=minimumHeights._large;break;case"medium":minimumHeight=minimumHeights._medium;break;default:minimumHeight=minimumHeights._small;}if(minimumHeight){this.$el.addClass("has-min-height").css("min-height",minimumHeight+"px")}else{this.$el.removeClass("has-min-height").css("min-height","")}},setCustomStyles:function(){},onRemove:function(){}});var ThemeView$1=__AMD("theme/5ee351b2d140fe35be130b76/js/themeView",ThemeView);var ThemePageView=ThemeView$1.extend({className:function(){},setCustomStyles:function(){this.processHeader()},processHeader:function(){var header=this.model.get("_pageHeader");if(!header)return;var $header=this.$(".page__header");this.setHeaderBackgroundImage(header,$header);this.setHeaderBackgroundStyles(header,$header);this.setHeaderMinimumHeight(header,$header)},setHeaderBackgroundImage:function(config,$header){var backgroundImages=config._backgroundImage;if(!backgroundImages)return;var backgroundImage;switch(Adapt.device.screenSize){case"large":backgroundImage=backgroundImages._large;break;case"medium":backgroundImage=backgroundImages._medium;break;default:backgroundImage=backgroundImages._small;}if(backgroundImage){$header.addClass("has-bg-image").css("background-image","url("+backgroundImage+")")}else{$header.removeClass("has-bg-image").css("background-image","")}},setHeaderBackgroundStyles:function(config,$header){var styles=config._backgroundStyles;if(!styles)return;$header.css({"background-repeat":styles._backgroundRepeat,"background-size":styles._backgroundSize,"background-position":styles._backgroundPosition})},setHeaderMinimumHeight:function(config,$header){var minimumHeights=config._minimumHeights;if(!minimumHeights)return;var minimumHeight;switch(Adapt.device.screenSize){case"large":minimumHeight=minimumHeights._large;break;case"medium":minimumHeight=minimumHeights._medium;break;default:minimumHeight=minimumHeights._small;}if(minimumHeight){$header.addClass("has-min-height").css("min-height",minimumHeight+"px")}else{$header.removeClass("has-min-height").css("min-height","")}},onRemove:function(){}});var ThemePageView$1=__AMD("theme/5ee351b2d140fe35be130b76/js/themePageView",ThemePageView);var ThemeArticleView=ThemeView$1.extend({className:function(){},setCustomStyles:function(){},onRemove:function(){}});var ThemeArticleView$1=__AMD("theme/5ee351b2d140fe35be130b76/js/themeArticleView",ThemeArticleView);var ThemeBlockView=ThemeView$1.extend({className:function(){return this.model.get("_isDividerBlock")?"is-divider-block":""},setCustomStyles:function(){},onRemove:function(){}});var ThemeBlockView$1=__AMD("theme/5ee351b2d140fe35be130b76/js/themeBlockView",ThemeBlockView);function onDataReady(){$("html").addClass(Adapt.course.get("_courseStyle"))}function onPostRender(view){var model=view.model;var theme=model.get("_odi-generic");if(!theme)return;switch(model.get("_type")){case"page":new ThemePageView$1({model:new Backbone.Model(theme),el:view.$el});break;case"article":new ThemeArticleView$1({model:new Backbone.Model(theme),el:view.$el});break;case"block":new ThemeBlockView$1({model:new Backbone.Model(theme),el:view.$el});break;default:new ThemeView$1({model:new Backbone.Model(theme),el:view.$el});}}Adapt.on({"app:dataReady":onDataReady,"pageView:postRender articleView:postRender blockView:postRender":onPostRender});register("header",function Header(props){var _globals$_components,_globals$_components$;var jsxHeading=React.useRef(null);var _id=props._id,displayTitle=props.displayTitle,body=props.body,instruction=props.instruction,mobileInstruction=props.mobileInstruction,_type=props._type,_component=props._component,_disableAccessibilityState=props._disableAccessibilityState,_isA11yComponentDescriptionEnabled=props._isA11yComponentDescriptionEnabled,_props$classNamePrefi=props.classNamePrefixes,classNamePrefixes=_props$classNamePrefi===void 0?[_type&&_type.toLowerCase(),_component&&_component.toLowerCase()].filter(Boolean):_props$classNamePrefi;var sizedInstruction=mobileInstruction&&Adapt.device.screenSize!=="large"?mobileInstruction:instruction;var isSet=displayTitle||body||sizedInstruction;if(!isSet)return null;var _globals=Adapt.course.get("_globals");var ariaRegion=_globals===null||_globals===void 0?void 0:(_globals$_components=_globals._components)===null||_globals$_components===void 0?void 0:(_globals$_components$=_globals$_components["_".concat(_component)])===null||_globals$_components$===void 0?void 0:_globals$_components$.ariaRegion;return React__default["default"].createElement("div",{id:"".concat(_id,"-header"),className:prefixClasses(classNamePrefixes,["__header"])},React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__header-inner"])},displayTitle&&React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__title"])},!_disableAccessibilityState&&React__default["default"].createElement("div",{className:"js-heading",ref:jsxHeading}),React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__title-inner"]),"aria-hidden":!_disableAccessibilityState},html(compile(displayTitle,props)))),_isA11yComponentDescriptionEnabled&&ariaRegion&&React__default["default"].createElement("div",{className:"aria-label"},html(compile(ariaRegion))),body&&React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__body"])},React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__body-inner"])},html(compile(body,props)))),sizedInstruction&&React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__instruction"])},React__default["default"].createElement("div",{className:prefixClasses(classNamePrefixes,["__instruction-inner"])},html(compile(sizedInstruction,props))))))});register("image",function Image(props){var hasMediumSetting=Object.prototype.hasOwnProperty.call(props,"_medium")||Object.prototype.hasOwnProperty.call(props,"medium");var screenSize=hasMediumSetting?Adapt.device.screenSize:Adapt.device.screenSize==="large"?"large":"small";var src=props["_".concat(screenSize)]||props["".concat(screenSize)]||props._src||props.src;var hasSource=Boolean(src);if(!hasSource)return null;var attributionClassNamePrefixes=props.attributionClassNamePrefixes||props.classNamePrefixes;return React__default["default"].createElement("div",{className:classes([prefixClasses(props.classNamePrefixes,["__image-container"]),props.attribution&&"has-attribution"])},React__default["default"].createElement("img",{className:prefixClasses(props.classNamePrefixes,["__image"]),src:src,"aria-label":Adapt.a11y.normalize(props.alt),"aria-hidden":!props.alt,loading:"eager"}),props.attribution&&React__default["default"].createElement("div",{className:prefixClasses(attributionClassNamePrefixes,["__attribution"])},React__default["default"].createElement("div",{className:prefixClasses(attributionClassNamePrefixes,["__attribution-inner"])},html(props.attribution))))});var LinkWrapper=function(_ref){var href=_ref.href,children=_ref.children,target=_ref.target,className=_ref.className,role=_ref.role;return href?React__default["default"].createElement("a",{href:href,target:target,className:className,role:role},children):children};register("graphic",function Graphic(props){var _graphic=props._graphic;return React__default["default"].createElement("div",{className:"component__inner graphic__inner"},React__default["default"].createElement(templates.header,props),React__default["default"].createElement("div",{className:"component__widget graphic__widget"},React__default["default"].createElement(LinkWrapper,{href:_graphic._url,target:_graphic._target,className:"graphic__link js-graphic-link",role:"link"},React__default["default"].createElement(templates.image,_extends({},_graphic,{classNamePrefixes:["component","graphic"]})))))});register("mcq",function Mcq(props){var ariaLabels=Adapt.course.get("_globals")._accessibility._ariaLabels;var _id=props._id,_isEnabled=props._isEnabled,_isInteractionComplete=props._isInteractionComplete,_isCorrect=props._isCorrect,_isCorrectAnswerShown=props._isCorrectAnswerShown,_canShowMarking=props._canShowMarking,_isRadio=props._isRadio,displayTitle=props.displayTitle,body=props.body,instruction=props.instruction,onKeyPress=props.onKeyPress,onItemSelect=props.onItemSelect,onItemFocus=props.onItemFocus,onItemBlur=props.onItemBlur,isInteractive=props.isInteractive;var shouldShowMarking=!isInteractive()&&_canShowMarking;return React__default["default"].createElement("div",{className:"component__inner mcq__inner"},React__default["default"].createElement(templates.header,props),React__default["default"].createElement("div",{className:classes(["component__widget","mcq__widget",!_isEnabled&&"is-disabled",_isInteractionComplete&&"is-complete is-submitted show-user-answer",_isCorrect&&"is-correct"]),role:_isRadio?"radiogroup":"group","aria-labelledby":(displayTitle||body||instruction)&&"".concat(_id,"-header")},props._items.map(function(_ref,index){var text=_ref.text,_index=_ref._index,_isActive=_ref._isActive,_shouldBeSelected=_ref._shouldBeSelected,_isHighlighted=_ref._isHighlighted;return React__default["default"].createElement("div",{className:classes(["mcq__item item-".concat(index),shouldShowMarking&&_shouldBeSelected&&"is-correct",shouldShowMarking&&!_shouldBeSelected&&"is-incorrect"]),key:_index},React__default["default"].createElement("input",{className:"mcq__item-input",id:"".concat(_id,"-").concat(index,"-input"),name:_isRadio?"".concat(_id,"-item"):null,type:_isRadio?"radio":"checkbox",disabled:!_isEnabled,"aria-label":!shouldShowMarking?Adapt.a11y.normalize(text):"".concat(_shouldBeSelected?ariaLabels.correct:ariaLabels.incorrect,", ").concat(_isActive?ariaLabels.selectedAnswer:ariaLabels.unselectedAnswer,". ").concat(Adapt.a11y.normalize(text)),"data-adapt-index":_index,onKeyPress:onKeyPress,onChange:onItemSelect,onFocus:onItemFocus,onBlur:onItemBlur}),React__default["default"].createElement("label",{className:classes(["mcq__item-label",!_isEnabled&&"is-disabled",_isHighlighted&&"is-highlighted",(_isCorrectAnswerShown?_shouldBeSelected:_isActive)&&"is-selected"]),"aria-hidden":true,htmlFor:"".concat(_id,"-").concat(index,"-input"),"data-adapt-index":_index},React__default["default"].createElement("div",{className:"mcq__item-state"},React__default["default"].createElement("div",{className:classes(["mcq__item-icon","mcq__item-answer-icon",_isRadio?"is-radio":"is-checkbox"])},React__default["default"].createElement("div",{className:"icon"})),React__default["default"].createElement("div",{className:"mcq__item-icon mcq__item-correct-icon"},React__default["default"].createElement("div",{className:"icon"})),React__default["default"].createElement("div",{className:"mcq__item-icon mcq__item-incorrect-icon"},React__default["default"].createElement("div",{className:"icon"}))),React__default["default"].createElement("div",{className:"mcq__item-text"},React__default["default"].createElement("div",{className:"mcq__item-text-inner"},html(compile(text))))))})),React__default["default"].createElement("div",{className:"btn__container"}))});register("text",function Text(props){return React__default["default"].createElement("div",{className:"component__inner text__inner"},React__default["default"].createElement(templates.header,props))});$("body").append(Handlebars.templates.loading());Adapt.data.on("ready",function triggerInit(){Adapt.log.debug("Calling Adapt.init");Adapt.init();Adapt.off("adaptCollection:dataLoaded courseModel:dataLoaded")}).init()});window.__AMD=function(id,value){window.define(id,function(){return value});window.require([id]);return value};
